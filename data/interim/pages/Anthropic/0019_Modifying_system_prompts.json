{
  "title": "Modifying system prompts",
  "source_url": "https://docs.claude.com/en/docs/agent-sdk/modifying-system-prompts",
  "content": "Learn how to customize Claude's behavior by modifying system prompts using three approaches - output styles, systemPrompt with append, and custom system prompts.\n\nSystem prompts define Claude's behavior, capabilities, and response style. The Claude Agent SDK provides three ways to customize system prompts: using output styles (persistent, file-based configurations), appending to Claude Code's prompt, or using a fully custom prompt.\n\n## Understanding system prompts\n\nA system prompt is the initial instruction set that shapes how Claude behaves throughout a conversation.\n\n<Note>\n  **Default behavior:** The Agent SDK uses an **empty system prompt** by default for maximum flexibility. To use Claude Code's system prompt (tool instructions, code guidelines, etc.), specify `systemPrompt: { preset: \"claude_code\" }` in TypeScript or `system_prompt=\"claude_code\"` in Python.\n</Note>\n\nClaude Code's system prompt includes:\n\n* Tool usage instructions and available tools\n* Code style and formatting guidelines\n* Response tone and verbosity settings\n* Security and safety instructions\n* Context about the current working directory and environment\n\n## Methods of modification\n\n### Method 1: CLAUDE.md files (project-level instructions)\n\nCLAUDE.md files provide project-specific context and instructions that are automatically read by the Agent SDK when it runs in a directory. They serve as persistent \"memory\" for your project.\n\n#### How CLAUDE.md works with the SDK\n\n**Location and discovery:**\n\n* **Project-level:** `CLAUDE.md` or `.claude/CLAUDE.md` in your working directory\n* **User-level:** `~/.claude/CLAUDE.md` for global instructions across all projects\n\n**IMPORTANT:** The SDK only reads CLAUDE.md files when you explicitly configure `settingSources` (TypeScript) or `setting_sources` (Python):\n\n* Include `'project'` to load project-level CLAUDE.md\n* Include `'user'` to load user-level CLAUDE.md (`~/.claude/CLAUDE.md`)\n\nThe `claude_code` system prompt preset does NOT automatically load CLAUDE.md - you must also specify setting sources.\n\n**Content format:**\nCLAUDE.md files use plain markdown and can contain:\n\n* Coding guidelines and standards\n* Project-specific context\n* Common commands or workflows\n* API conventions\n* Testing requirements\n\n#### Example CLAUDE.md\n\n```markdown  theme={null}\n# Project Guidelines\n\n## Code Style\n\n- Use TypeScript strict mode\n- Prefer functional components in React\n- Always include JSDoc comments for public APIs\n\n## Testing\n\n- Run `npm test` before committing\n- Maintain >80% code coverage\n- Use jest for unit tests, playwright for E2E\n\n## Commands\n\n- Build: `npm run build`\n- Dev server: `npm run dev`\n- Type check: `npm run typecheck`\n```\n\n#### Using CLAUDE.md with the SDK\n\n<CodeGroup>\n  ```typescript TypeScript theme={null}\n  import { query } from \"@anthropic-ai/claude-agent-sdk\";\n\n  // IMPORTANT: You must specify settingSources to load CLAUDE.md\n  // The claude_code preset alone does NOT load CLAUDE.md files\n  const messages = [];\n\n  for await (const message of query({\n    prompt: \"Add a new React component for user profiles\",\n    options: {\n      systemPrompt: {\n        type: \"preset\",\n        preset: \"claude_code\", // Use Claude Code's system prompt\n      },\n      settingSources: [\"project\"], // Required to load CLAUDE.md from project\n    },\n  })) {\n    messages.push(message);\n  }\n\n  // Now Claude has access to your project guidelines from CLAUDE.md\n  ```\n\n  ```python Python theme={null}\n  from claude_agent_sdk import query, ClaudeAgentOptions\n\n  # IMPORTANT: You must specify setting_sources to load CLAUDE.md\n  # The claude_code preset alone does NOT load CLAUDE.md files\n  messages = []\n\n  async for message in query(\n      prompt=\"Add a new React component for user profiles\",\n      options=ClaudeAgentOptions(\n          system_prompt={\n              \"type\": \"preset\",\n              \"preset\": \"claude_code\"  # Use Claude Code's system prompt\n          },\n          setting_sources=[\"project\"]  # Required to load CLAUDE.md from project\n      )\n  ):\n      messages.append(message)\n\n  # Now Claude has access to your project guidelines from CLAUDE.md\n  ```\n</CodeGroup>\n\n#### When to use CLAUDE.md\n\n**Best for:**\n\n* **Team-shared context** - Guidelines everyone should follow\n* **Project conventions** - Coding standards, file structure, naming patterns\n* **Common commands** - Build, test, deploy commands specific to your project\n* **Long-term memory** - Context that should persist across all sessions\n* **Version-controlled instructions** - Commit to git so the team stays in sync\n\n**Key characteristics:**\n\n* ✅ Persistent across all sessions in a project\n* ✅ Shared with team via git\n* ✅ Automatic discovery (no code changes needed)\n* ⚠️ Requires loading settings via `settingSources`\n\n### Method 2: Output styles (persistent configurations)\n\nOutput styles are saved configurations that modify Claude's system prompt. They're stored as markdown files and can be reused across sessions and projects.\n\n#### Creating an output style\n\n<CodeGroup>\n  ```typescript TypeScript theme={null}\n  import { writeFile, mkdir } from \"fs/promises\";\n  import { join } from \"path\";\n  import { homedir } from \"os\";\n\n  async function createOutputStyle(\n    name: string,\n    description: string,\n    prompt: string\n  ) {\n    // User-level: ~/.claude/output-styles\n    // Project-level: .claude/output-styles\n    const outputStylesDir = join(homedir(), \".claude\", \"output-styles\");\n\n    await mkdir(outputStylesDir, { recursive: true });\n\n    const content = `---\n  name: ${name}\n  description: ${description}\n  ---\n\n  ${prompt}`;\n\n    const filePath = join(\n      outputStylesDir,\n      `${name.toLowerCase().replace(/\\s+/g, \"-\")}.md`\n    );\n    await writeFile(filePath, content, \"utf-8\");\n  }\n\n  // Example: Create a code review specialist\n  await createOutputStyle(\n    \"Code Reviewer\",\n    \"Thorough code review assistant\",\n    `You are an expert code reviewer.\n\n  For every code submission:\n  1. Check for bugs and security issues\n  2. Evaluate performance\n  3. Suggest improvements\n  4. Rate code quality (1-10)`\n  );\n  ```\n\n  ```python Python theme={null}\n  from pathlib import Path\n\n  async def create_output_style(name: str, description: str, prompt: str):\n      # User-level: ~/.claude/output-styles\n      # Project-level: .claude/output-styles\n      output_styles_dir = Path.home() / '.claude' / 'output-styles'\n\n      output_styles_dir.mkdir(parents=True, exist_ok=True)\n\n      content = f\"\"\"---\n  name: {name}\n  description: {description}\n  ---\n\n  {prompt}\"\"\"\n\n      file_name = name.lower().replace(' ', '-') + '.md'\n      file_path = output_styles_dir / file_name\n      file_path.write_text(content, encoding='utf-8')\n\n  # Example: Create a code review specialist\n  await create_output_style(\n      'Code Reviewer',\n      'Thorough code review assistant',\n      \"\"\"You are an expert code reviewer.\n\n  For every code submission:\n  1. Check for bugs and security issues\n  2. Evaluate performance\n  3. Suggest improvements\n  4. Rate code quality (1-10)\"\"\"\n  )\n  ```\n</CodeGroup>\n\n#### Using output styles\n\nOnce created, activate output styles via:\n\n* **CLI**: `/output-style [style-name]`\n* **Settings**: `.claude/settings.local.json`\n* **Create new**: `/output-style:new [description]`\n\n**Note for SDK users:** Output styles are loaded when you include `settingSources: ['user']` or `settingSources: ['project']` (TypeScript) / `setting_sources=[\"user\"]` or `setting_sources=[\"project\"]` (Python) in your options.\n\n### Method 3: Using `systemPrompt` with append\n\nYou can use the Claude Code preset with an `append` property to add your custom instructions while preserving all built-in functionality.\n\n<CodeGroup>\n  ```typescript TypeScript theme={null}\n  import { query } from \"@anthropic-ai/claude-agent-sdk\";\n\n  const messages = [];\n\n  for await (const message of query({\n    prompt: \"Help me write a Python function to calculate fibonacci numbers\",\n    options: {\n      systemPrompt: {\n        type: \"preset\",\n        preset: \"claude_code\",\n        append:\n          \"Always include detailed docstrings and type hints in Python code.\",\n      },\n    },\n  })) {\n    messages.push(message);\n    if (message.type === \"assistant\") {\n      console.log(message.message.content);\n    }\n  }\n  ```\n\n  ```python Python theme={null}\n  from claude_agent_sdk import query, ClaudeAgentOptions\n\n  messages = []\n\n  async for message in query(\n      prompt=\"Help me write a Python function to calculate fibonacci numbers\",\n      options=ClaudeAgentOptions(\n          system_prompt={\n              \"type\": \"preset\",\n              \"preset\": \"claude_code\",\n              \"append\": \"Always include detailed docstrings and type hints in Python code.\"\n          }\n      )\n  ):\n      messages.append(message)\n      if message.type == 'assistant':\n          print(message.message.content)\n  ```\n</CodeGroup>\n\n### Method 4: Custom system prompts\n\nYou can provide a custom string as `systemPrompt` to replace the default entirely with your own instructions.\n\n<CodeGroup>\n  ```typescript TypeScript theme={null}\n  import { query } from \"@anthropic-ai/claude-agent-sdk\";\n\n  const customPrompt = `You are a Python coding specialist.\n  Follow these guidelines:\n  - Write clean, well-documented code\n  - Use type hints for all functions\n  - Include comprehensive docstrings\n  - Prefer functional programming patterns when appropriate\n  - Always explain your code choices`;\n\n  const messages = [];\n\n  for await (const message of query({\n    prompt: \"Create a data processing pipeline\",\n    options: {\n      systemPrompt: customPrompt,\n    },\n  })) {\n    messages.push(message);\n    if (message.type === \"assistant\") {\n      console.log(message.message.content);\n    }\n  }\n  ```\n\n  ```python Python theme={null}\n  from claude_agent_sdk import query, ClaudeAgentOptions\n\n  custom_prompt = \"\"\"You are a Python coding specialist.\n  Follow these guidelines:\n  - Write clean, well-documented code\n  - Use type hints for all functions\n  - Include comprehensive docstrings\n  - Prefer functional programming patterns when appropriate\n  - Always explain your code choices\"\"\"\n\n  messages = []\n\n  async for message in query(\n      prompt=\"Create a data processing pipeline\",\n      options=ClaudeAgentOptions(\n          system_prompt=custom_prompt\n      )\n  ):\n      messages.append(message)\n      if message.type == 'assistant':\n          print(message.message.content)\n  ```\n</CodeGroup>\n\n## Comparison of all four approaches\n\n| Feature                 | CLAUDE.md        | Output Styles   | `systemPrompt` with append | Custom `systemPrompt`  |\n| ----------------------- | ---------------- | --------------- | -------------------------- | ---------------------- |\n| **Persistence**         | Per-project file | Saved as files  | Session only               | Session only           |\n| **Reusability**         | Per-project      | Across projects | Code duplication           | Code duplication       |\n| **Management**          | On filesystem    | CLI + files     | In code                    | In code                |\n| **Default tools**       | Preserved        | Preserved       | Preserved                  | Lost (unless included) |\n| **Built-in safety**     | Maintained       | Maintained      | Maintained                 | Must be added          |\n| **Environment context** | Automatic        | Automatic       | Automatic                  | Must be provided       |\n| **Customization level** | Additions only   | Replace default | Additions only             | Complete control       |\n| **Version control**     | With project     | Yes             | With code                  | With code              |\n| **Scope**               | Project-specific | User or project | Code session               | Code session           |\n\n**Note:** \"With append\" means using `systemPrompt: { type: \"preset\", preset: \"claude_code\", append: \"...\" }` in TypeScript or `system_prompt={\"type\": \"preset\", \"preset\": \"claude_code\", \"append\": \"...\"}` in Python.\n\n## Use cases and best practices\n\n### When to use CLAUDE.md\n\n**Best for:**\n\n* Project-specific coding standards and conventions\n* Documenting project structure and architecture\n* Listing common commands (build, test, deploy)\n* Team-shared context that should be version controlled\n* Instructions that apply to all SDK usage in a project\n\n**Examples:**\n\n* \"All API endpoints should use async/await patterns\"\n* \"Run `npm run lint:fix` before committing\"\n* \"Database migrations are in the `migrations/` directory\"\n\n**Important:** To load CLAUDE.md files, you must explicitly set `settingSources: ['project']` (TypeScript) or `setting_sources=[\"project\"]` (Python). The `claude_code` system prompt preset does NOT automatically load CLAUDE.md without this setting.\n\n### When to use output styles\n\n**Best for:**\n\n* Persistent behavior changes across sessions\n* Team-shared configurations\n* Specialized assistants (code reviewer, data scientist, DevOps)\n* Complex prompt modifications that need versioning\n\n**Examples:**\n\n* Creating a dedicated SQL optimization assistant\n* Building a security-focused code reviewer\n* Developing a teaching assistant with specific pedagogy\n\n### When to use `systemPrompt` with append\n\n**Best for:**\n\n* Adding specific coding standards or preferences\n* Customizing output formatting\n* Adding domain-specific knowledge\n* Modifying response verbosity\n* Enhancing Claude Code's default behavior without losing tool instructions\n\n### When to use custom `systemPrompt`\n\n**Best for:**\n\n* Complete control over Claude's behavior\n* Specialized single-session tasks\n* Testing new prompt strategies\n* Situations where default tools aren't needed\n* Building specialized agents with unique behavior\n\n## Combining approaches\n\nYou can combine these methods for maximum flexibility:\n\n### Example: Output style with session-specific additions\n\n<CodeGroup>\n  ```typescript TypeScript theme={null}\n  import { query } from \"@anthropic-ai/claude-agent-sdk\";\n\n  // Assuming \"Code Reviewer\" output style is active (via /output-style)\n  // Add session-specific focus areas\n  const messages = [];\n\n  for await (const message of query({\n    prompt: \"Review this authentication module\",\n    options: {\n      systemPrompt: {\n        type: \"preset\",\n        preset: \"claude_code\",\n        append: `\n          For this review, prioritize:\n          - OAuth 2.0 compliance\n          - Token storage security\n          - Session management\n        `,\n      },\n    },\n  })) {\n    messages.push(message);\n  }\n  ```\n\n  ```python Python theme={null}\n  from claude_agent_sdk import query, ClaudeAgentOptions\n\n  # Assuming \"Code Reviewer\" output style is active (via /output-style)\n  # Add session-specific focus areas\n  messages = []\n\n  async for message in query(\n      prompt=\"Review this authentication module\",\n      options=ClaudeAgentOptions(\n          system_prompt={\n              \"type\": \"preset\",\n              \"preset\": \"claude_code\",\n              \"append\": \"\"\"\n              For this review, prioritize:\n              - OAuth 2.0 compliance\n              - Token storage security\n              - Session management\n              \"\"\"\n          }\n      )\n  ):\n      messages.append(message)\n  ```\n</CodeGroup>\n\n## See also\n\n* [Output styles](https://code.claude.com/docs/en/output-styles) - Complete output styles documentation\n* [TypeScript SDK guide](/en/docs/agent-sdk/typescript) - Complete SDK usage guide\n* [Configuration guide](https://code.claude.com/docs/en/settings) - General configuration options",
  "content_length": 15490
}