{
  "title": "Claude in Microsoft Foundry",
  "source_url": "https://docs.claude.com/en/docs/build-with-claude/claude-in-microsoft-foundry",
  "content": "Access Claude models through Microsoft Foundry with Azure-native endpoints and authentication.\n\nThis guide will walk you through the process of setting up and making API calls to Claude in Foundry in Python, TypeScript, or using direct HTTP requests. When you can access Claude in Foundry, you will be billed for Claude usage in the Microsoft Marketplace with your Azure subscription, allowing you to access Claude's latest capabilities while managing costs through your Azure subscription.\n\nRegional availability: At launch, Claude is available as a Global Standard deployment type in Foundry resources with US DataZone coming soon. Pricing for Claude in the Microsoft Marketplace uses Anthropic's standard API pricing. Visit our [pricing page](https://claude.com/pricing#api) for details.\n\n## Preview\n\nIn this preview platform integration, Claude models run on Anthropic's infrastructure. This is a commercial integration for billing and access through Azure. As an independent processor for Microsoft, customers using Claude through Microsoft Foundry are subject to Anthropic's data use terms. Anthropic continues to provide its industry-leading safety and data commitments, including zero data retention availability.\n\n## Prerequisites\n\nBefore you begin, ensure you have:\n\n* An active Azure subscription\n* Access to [Foundry](https://ai.azure.com/)\n* The [Azure CLI](https://docs.microsoft.com/en-us/cli/azure/install-azure-cli) installed (optional, for resource management)\n\n## Install an SDK\n\nAnthropic's [client SDKs](/en/api/client-sdks) support Foundry through platform-specific packages.\n\n```bash  theme={null}\n# Python\npip install -U \"anthropic\"\n\n# Typescript\nnpm install @anthropic-ai/foundry-sdk\n```\n\n## Provisioning\n\nFoundry uses a two-level hierarchy: **resources** contain your security and billing configuration, while **deployments** are the model instances you call via API. You'll first create a Foundry resource, then create one or more Claude deployments within it.\n\n### Provisioning Foundry resources\n\nCreate a Foundry resource, which is required to use and manage services in Azure. You can follow these instructions to create a [Foundry resource](https://learn.microsoft.com/en-us/azure/ai-services/multi-service-resource?pivots=azportal#create-a-new-azure-ai-foundry-resource). Alternatively, you can start by creating a [Foundry project](https://learn.microsoft.com/en-us/azure/ai-foundry/how-to/create-projects?tabs=ai-foundry), which involves creating a Foundry resource.\n\nTo provision your resource:\n\n1. Navigate to the [Foundry portal](https://ai.azure.com/)\n2. Create a new Foundry resource or select an existing one\n3. Configure access management using Azure-issued API keys or Entra ID for role-based access control\n4. Optionally configure the resource to be part of a private network (Azure Virtual Network) for enhanced security\n5. Note your resource nameâ€”you'll use this as `{resource}` in API endpoints (e.g., `https://{resource}.services.ai.azure.com/anthropic/v1/*`)\n\n### Creating Foundry deployments\n\nAfter creating your resource, deploy a Claude model to make it available for API calls:\n\n1. In the Foundry portal, navigate to your resource\n2. Go to **Models + endpoints** and select **+ Deploy model** > **Deploy base model**\n3. Search for and select a Claude model (e.g., `claude-sonnet-4-5`)\n4. Configure deployment settings:\n   * **Deployment name**: Defaults to the model ID, but you can customize it (e.g., `my-claude-deployment`). The deployment name cannot be changed after it has been created.\n   * **Deployment type**: Select Global Standard (recommended for Claude)\n5. Select **Deploy** and wait for provisioning to complete\n6. Once deployed, you can find your endpoint URL and keys under **Keys and Endpoint**\n\n<Note>\n  The deployment name you choose becomes the value you pass in the `model` parameter of your API requests. You can create multiple deployments of the same model with different names to manage separate configurations or rate limits.\n</Note>\n\n## Authentication\n\nClaude on Foundry supports two authentication methods: API keys and Entra ID tokens. Both methods use Azure-hosted endpoints in the format `https://{resource}.services.ai.azure.com/anthropic/v1/*`.\n\n### API key authentication\n\nAfter provisioning your Foundry Claude resource, you can obtain an API key from the Foundry portal:\n\n1. Navigate to your resource in the Foundry portal\n2. Go to **Keys and Endpoint** section\n3. Copy one of the provided API keys\n4. Use either the `api-key` or `x-api-key` header in your requests, or provide it to the SDK\n\nThe Python and TypeScript SDKs require an API key and either a resource name or base URL. The SDKs will automatically read these from the following environment variables if they are defined:\n\n* `ANTHROPIC_FOUNDRY_API_KEY` - Your API key\n* `ANTHROPIC_FOUNDRY_RESOURCE` - Your resource name (e.g., `example-resource`)\n* `ANTHROPIC_FOUNDRY_BASE_URL` - Alternative to resource name; the full base URL (e.g., `https://example-resource.services.ai.azure.com/anthropic/`)\n\n<Note>\n  The `resource` and `base_url` parameters are mutually exclusive. Provide either the resource name (which the SDK uses to construct the URL as `https://{resource}.services.ai.azure.com/anthropic/`) or the full base URL directly.\n</Note>\n\n**Example using API key:**\n\n<CodeGroup>\n  ```python Python theme={null}\n  import os\n  from anthropic import AnthropicFoundry\n\n  client = AnthropicFoundry(\n      api_key=os.environ.get(\"ANTHROPIC_FOUNDRY_API_KEY\"),\n      resource='example-resource', # your resource name\n  )\n\n  message = client.messages.create(\n      model=\"claude-sonnet-4-5\",\n      max_tokens=1024,\n      messages=[{\"role\": \"user\", \"content\": \"Hello!\"}]\n  )\n  print(message.content)\n  ```\n\n  ```typescript TypeScript theme={null}\n  import AnthropicFoundry from \"@anthropic-ai/foundry-sdk\";\n\n  const client = new AnthropicFoundry({\n    apiKey: process.env.ANTHROPIC_FOUNDRY_API_KEY,\n    resource: 'example-resource', // your resource name\n  });\n\n  const message = await client.messages.create({\n    model: \"claude-sonnet-4-5\",\n    max_tokens: 1024,\n    messages: [{ role: \"user\", content: \"Hello!\" }],\n  });\n  console.log(message.content);\n  ```\n\n  ```bash Shell theme={null}\n  curl https://{resource}.services.ai.azure.com/anthropic/v1/messages \\\n    -H \"content-type: application/json\" \\\n    -H \"api-key: YOUR_AZURE_API_KEY\" \\\n    -H \"anthropic-version: 2023-06-01\" \\\n    -d '{\n      \"model\": \"claude-sonnet-4-5\",\n      \"max_tokens\": 1024,\n      \"messages\": [\n        {\"role\": \"user\", \"content\": \"Hello!\"}\n      ]\n    }'\n  ```\n</CodeGroup>\n\n<Warning>\n  Keep your API keys secure. Never commit them to version control or share them publicly. Anyone with access to your API key can make requests to Claude through your Foundry resource.\n</Warning>\n\n## Microsoft Entra authentication\n\nFor enhanced security and centralized access management, you can use Entra ID (formerly Azure Active Directory) tokens:\n\n1. Enable Entra authentication for your Foundry resource\n2. Obtain an access token from Entra ID\n3. Use the token in the `Authorization: Bearer {TOKEN}` header\n\n**Example using Entra ID:**\n\n<CodeGroup>\n  ```python Python theme={null}\n  import os\n  from anthropic import AnthropicFoundry\n  from azure.identity import DefaultAzureCredential, get_bearer_token_provider\n\n  # Get Azure Entra ID token using token provider pattern\n  token_provider = get_bearer_token_provider(\n      DefaultAzureCredential(),\n      \"https://cognitiveservices.azure.com/.default\"\n  )\n\n  # Create client with Entra ID authentication\n  client = AnthropicFoundry(\n      resource='example-resource', # your resource name\n      azure_ad_token_provider=token_provider  # Use token provider for Entra ID auth\n  )\n\n  # Make request\n  message = client.messages.create(\n      model=\"claude-sonnet-4-5\",\n      max_tokens=1024,\n      messages=[{\"role\": \"user\", \"content\": \"Hello!\"}]\n  )\n  print(message.content)\n  ```\n\n  ```typescript TypeScript theme={null}\n  import AnthropicFoundry from \"@anthropic-ai/foundry-sdk\";\n  import {\n    DefaultAzureCredential,\n    getBearerTokenProvider,\n  } from \"@azure/identity\";\n\n  // Get Entra ID token using token provider pattern\n  const credential = new DefaultAzureCredential();\n  const tokenProvider = getBearerTokenProvider(\n    credential,\n    \"https://cognitiveservices.azure.com/.default\"\n  );\n\n  // Create client with Entra ID authentication\n  const client = new AnthropicFoundry({\n    resource: 'example-resource', // your resource name\n    azureADTokenProvider: tokenProvider, // Use token provider for Entra ID auth\n  });\n\n  // Make request\n  const message = await client.messages.create({\n    model: \"claude-sonnet-4-5\",\n    max_tokens: 1024,\n    messages: [{ role: \"user\", content: \"Hello!\" }],\n  });\n  console.log(message.content);\n  ```\n\n  ```bash Shell theme={null}\n  # Get Azure Entra ID token\n  ACCESS_TOKEN=$(az account get-access-token --resource https://cognitiveservices.azure.com --query accessToken -o tsv)\n\n  # Make request with token. Replace {resource} with your resource name\n  curl https://{resource}.services.ai.azure.com/anthropic/v1/messages \\\n    -H \"content-type: application/json\" \\\n    -H \"Authorization: Bearer $ACCESS_TOKEN\" \\\n    -H \"anthropic-version: 2023-06-01\" \\\n    -d '{\n      \"model\": \"claude-sonnet-4-5\",\n      \"max_tokens\": 1024,\n      \"messages\": [\n        {\"role\": \"user\", \"content\": \"Hello!\"}\n      ]\n    }'\n  ```\n</CodeGroup>\n\n<Note>\n  Azure Entra ID authentication allows you to manage access using Azure RBAC, integrate with your organization's identity management, and avoid managing API keys manually.\n</Note>\n\n## Correlation request IDs\n\nFoundry includes request identifiers in HTTP response headers for debugging and tracing. When contacting support, provide both the `request-id` and `apim-request-id` values to help teams quickly locate and investigate your request across both Anthropic and Azure systems.\n\n## Supported features\n\nClaude on Foundry supports most of Claude's powerful features. You can find all the features currently supported [here](/en/docs/build-with-claude/overview).\n\n### Features not supported\n\n* Admin API (`/v1/organizations/*` endpoints)\n* Models API (`/v1/models`)\n* Message Batch API (`/v1/messages/batches`)\n\n## API responses\n\nAPI responses from Claude on Foundry follow the standard [Anthropic API response format](/en/api/messages). This includes the `usage` object in response bodies, which provides detailed token consumption information for your requests. The `usage` object is consistent across all platforms (first-party API, Foundry, Amazon Bedrock, and Google Vertex AI).\n\nFor details on response headers specific to Foundry, see the [correlation request IDs section](#correlation-request-ids).\n\n## API model IDs and deployments\n\nThe following Claude models are available through Foundry. The latest generation models (Sonnet 4.5, Opus 4.1, and Haiku 4.5) offer the most advanced capabilities:\n\n| Model             | Default Deployment Name |\n| :---------------- | :---------------------- |\n| Claude Sonnet 4.5 | `claude-sonnet-4-5`     |\n| Claude Opus 4.1   | `claude-opus-4-1`       |\n| Claude Haiku 4.5  | `claude-haiku-4-5`      |\n\nBy default, deployment names match the model IDs shown above. However, you can create custom deployments with different names in the Foundry portal to manage different configurations, versions, or rate limits. Use the deployment name (not necessarily the model ID) in your API requests.\n\n## Monitoring and logging\n\nAzure provides comprehensive monitoring and logging capabilities for your Claude usage through standard Azure patterns:\n\n* **Azure Monitor**: Track API usage, latency, and error rates\n* **Azure Log Analytics**: Query and analyze request/response logs\n* **Cost Management**: Monitor and forecast costs associated with Claude usage\n\nAnthropic recommends logging your activity on at least a 30-day rolling basis to understand usage patterns and investigate any potential issues.\n\n<Note>\n  Azure's logging services are configured within your Azure subscription. Enabling logging does not provide Microsoft or Anthropic access to your content beyond what's necessary for billing and service operation.\n</Note>\n\n## Troubleshooting\n\n### Authentication errors\n\n**Error**: `401 Unauthorized` or `Invalid API key`\n\n* **Solution**: Verify your API key is correct. You can obtain a new API key from the Azure portal under **Keys and Endpoint** for your Claude resource.\n* **Solution**: If using Azure Entra ID, ensure your access token is valid and hasn't expired. Tokens typically expire after 1 hour.\n\n**Error**: `403 Forbidden`\n\n* **Solution**: Your Azure account may lack the necessary permissions. Ensure you have the appropriate Azure RBAC role assigned (e.g., \"Cognitive Services OpenAI User\").\n\n### Rate limiting\n\n**Error**: `429 Too Many Requests`\n\n* **Solution**: You've exceeded your rate limit. Implement exponential backoff and retry logic in your application.\n* **Solution**: Consider requesting rate limit increases through the Azure portal or Azure support.\n\n#### Rate limit headers\n\nFoundry does not include Anthropic's standard rate limit headers (`anthropic-ratelimit-tokens-limit`, `anthropic-ratelimit-tokens-remaining`, `anthropic-ratelimit-tokens-reset`, `anthropic-ratelimit-input-tokens-limit`, `anthropic-ratelimit-input-tokens-remaining`, `anthropic-ratelimit-input-tokens-reset`, `anthropic-ratelimit-output-tokens-limit`, `anthropic-ratelimit-output-tokens-remaining`, and `anthropic-ratelimit-output-tokens-reset`) in responses. Manage rate limiting through Azure's monitoring tools instead.\n\n### Model and deployment errors\n\n**Error**: `Model not found` or `Deployment not found`\n\n* **Solution**: Verify you're using the correct deployment name. If you haven't created a custom deployment, use the default model ID (e.g., `claude-sonnet-4-5`).\n* **Solution**: Ensure the model/deployment is available in your Azure region.\n\n**Error**: `Invalid model parameter`\n\n* **Solution**: The model parameter should contain your deployment name, which can be customized in the Foundry portal. Verify the deployment exists and is properly configured.\n\n## Additional resources\n\n* **Foundry documentation**: [ai.azure.com/catalog](https://ai.azure.com/catalog/publishers/anthropic)\n* **Azure pricing**: [azure.microsoft.com/en-us/pricing](https://azure.microsoft.com/en-us/pricing/)\n* **Anthropic pricing details**: [Pricing documentation](/en/docs/about-claude/pricing#third-party-platform-pricing)\n* **Authentication guide**: See the [authentication section](#authentication) above\n* **Azure portal**: [portal.azure.com](https://portal.azure.com/)",
  "content_length": 14670
}