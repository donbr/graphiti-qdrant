{
  "title": "Session Management",
  "source_url": "https://docs.claude.com/en/docs/agent-sdk/sessions",
  "content": "Understanding how the Claude Agent SDK handles sessions and session resumption\n\n# Session Management\n\nThe Claude Agent SDK provides session management capabilities for handling conversation state and resumption. Sessions allow you to continue conversations across multiple interactions while maintaining full context.\n\n## How Sessions Work\n\nWhen you start a new query, the SDK automatically creates a session and returns a session ID in the initial system message. You can capture this ID to resume the session later.\n\n### Getting the Session ID\n\n<CodeGroup>\n  ```typescript TypeScript theme={null}\n  import { query } from \"@anthropic-ai/claude-agent-sdk\"\n\n  let sessionId: string | undefined\n\n  const response = query({\n    prompt: \"Help me build a web application\",\n    options: {\n      model: \"claude-sonnet-4-5\"\n    }\n  })\n\n  for await (const message of response) {\n    // The first message is a system init message with the session ID\n    if (message.type === 'system' && message.subtype === 'init') {\n      sessionId = message.session_id\n      console.log(`Session started with ID: ${sessionId}`)\n      // You can save this ID for later resumption\n    }\n\n    // Process other messages...\n    console.log(message)\n  }\n\n  // Later, you can use the saved sessionId to resume\n  if (sessionId) {\n    const resumedResponse = query({\n      prompt: \"Continue where we left off\",\n      options: {\n        resume: sessionId\n      }\n    })\n  }\n  ```\n\n  ```python Python theme={null}\n  from claude_agent_sdk import query, ClaudeAgentOptions\n\n  session_id = None\n\n  async for message in query(\n      prompt=\"Help me build a web application\",\n      options=ClaudeAgentOptions(\n          model=\"claude-sonnet-4-5\"\n      )\n  ):\n      # The first message is a system init message with the session ID\n      if hasattr(message, 'subtype') and message.subtype == 'init':\n          session_id = message.data.get('session_id')\n          print(f\"Session started with ID: {session_id}\")\n          # You can save this ID for later resumption\n\n      # Process other messages...\n      print(message)\n\n  # Later, you can use the saved session_id to resume\n  if session_id:\n      async for message in query(\n          prompt=\"Continue where we left off\",\n          options=ClaudeAgentOptions(\n              resume=session_id\n          )\n      ):\n          print(message)\n  ```\n</CodeGroup>\n\n## Resuming Sessions\n\nThe SDK supports resuming sessions from previous conversation states, enabling continuous development workflows. Use the `resume` option with a session ID to continue a previous conversation.\n\n<CodeGroup>\n  ```typescript TypeScript theme={null}\n  import { query } from \"@anthropic-ai/claude-agent-sdk\"\n\n  // Resume a previous session using its ID\n  const response = query({\n    prompt: \"Continue implementing the authentication system from where we left off\",\n    options: {\n      resume: \"session-xyz\", // Session ID from previous conversation\n      model: \"claude-sonnet-4-5\",\n      allowedTools: [\"Read\", \"Edit\", \"Write\", \"Glob\", \"Grep\", \"Bash\"]\n    }\n  })\n\n  // The conversation continues with full context from the previous session\n  for await (const message of response) {\n    console.log(message)\n  }\n  ```\n\n  ```python Python theme={null}\n  from claude_agent_sdk import query, ClaudeAgentOptions\n\n  # Resume a previous session using its ID\n  async for message in query(\n      prompt=\"Continue implementing the authentication system from where we left off\",\n      options=ClaudeAgentOptions(\n          resume=\"session-xyz\",  # Session ID from previous conversation\n          model=\"claude-sonnet-4-5\",\n          allowed_tools=[\"Read\", \"Edit\", \"Write\", \"Glob\", \"Grep\", \"Bash\"]\n      )\n  ):\n      print(message)\n\n  # The conversation continues with full context from the previous session\n  ```\n</CodeGroup>\n\nThe SDK automatically handles loading the conversation history and context when you resume a session, allowing Claude to continue exactly where it left off.\n\n## Forking Sessions\n\nWhen resuming a session, you can choose to either continue the original session or fork it into a new branch. By default, resuming continues the original session. Use the `forkSession` option (TypeScript) or `fork_session` option (Python) to create a new session ID that starts from the resumed state.\n\n### When to Fork a Session\n\nForking is useful when you want to:\n\n* Explore different approaches from the same starting point\n* Create multiple conversation branches without modifying the original\n* Test changes without affecting the original session history\n* Maintain separate conversation paths for different experiments\n\n### Forking vs Continuing\n\n| Behavior             | `forkSession: false` (default) | `forkSession: true`                  |\n| -------------------- | ------------------------------ | ------------------------------------ |\n| **Session ID**       | Same as original               | New session ID generated             |\n| **History**          | Appends to original session    | Creates new branch from resume point |\n| **Original Session** | Modified                       | Preserved unchanged                  |\n| **Use Case**         | Continue linear conversation   | Branch to explore alternatives       |\n\n### Example: Forking a Session\n\n<CodeGroup>\n  ```typescript TypeScript theme={null}\n  import { query } from \"@anthropic-ai/claude-agent-sdk\"\n\n  // First, capture the session ID\n  let sessionId: string | undefined\n\n  const response = query({\n    prompt: \"Help me design a REST API\",\n    options: { model: \"claude-sonnet-4-5\" }\n  })\n\n  for await (const message of response) {\n    if (message.type === 'system' && message.subtype === 'init') {\n      sessionId = message.session_id\n      console.log(`Original session: ${sessionId}`)\n    }\n  }\n\n  // Fork the session to try a different approach\n  const forkedResponse = query({\n    prompt: \"Now let's redesign this as a GraphQL API instead\",\n    options: {\n      resume: sessionId,\n      forkSession: true,  // Creates a new session ID\n      model: \"claude-sonnet-4-5\"\n    }\n  })\n\n  for await (const message of forkedResponse) {\n    if (message.type === 'system' && message.subtype === 'init') {\n      console.log(`Forked session: ${message.session_id}`)\n      // This will be a different session ID\n    }\n  }\n\n  // The original session remains unchanged and can still be resumed\n  const originalContinued = query({\n    prompt: \"Add authentication to the REST API\",\n    options: {\n      resume: sessionId,\n      forkSession: false,  // Continue original session (default)\n      model: \"claude-sonnet-4-5\"\n    }\n  })\n  ```\n\n  ```python Python theme={null}\n  from claude_agent_sdk import query, ClaudeAgentOptions\n\n  # First, capture the session ID\n  session_id = None\n\n  async for message in query(\n      prompt=\"Help me design a REST API\",\n      options=ClaudeAgentOptions(model=\"claude-sonnet-4-5\")\n  ):\n      if hasattr(message, 'subtype') and message.subtype == 'init':\n          session_id = message.data.get('session_id')\n          print(f\"Original session: {session_id}\")\n\n  # Fork the session to try a different approach\n  async for message in query(\n      prompt=\"Now let's redesign this as a GraphQL API instead\",\n      options=ClaudeAgentOptions(\n          resume=session_id,\n          fork_session=True,  # Creates a new session ID\n          model=\"claude-sonnet-4-5\"\n      )\n  ):\n      if hasattr(message, 'subtype') and message.subtype == 'init':\n          forked_id = message.data.get('session_id')\n          print(f\"Forked session: {forked_id}\")\n          # This will be a different session ID\n\n  # The original session remains unchanged and can still be resumed\n  async for message in query(\n      prompt=\"Add authentication to the REST API\",\n      options=ClaudeAgentOptions(\n          resume=session_id,\n          fork_session=False,  # Continue original session (default)\n          model=\"claude-sonnet-4-5\"\n      )\n  ):\n      print(message)\n  ```\n</CodeGroup>",
  "content_length": 7944
}