{
  "title": "Plugins in the SDK",
  "source_url": "https://docs.claude.com/en/docs/agent-sdk/plugins",
  "content": "Load custom plugins to extend Claude Code with commands, agents, skills, and hooks through the Agent SDK\n\nPlugins allow you to extend Claude Code with custom functionality that can be shared across projects. Through the Agent SDK, you can programmatically load plugins from local directories to add custom slash commands, agents, skills, hooks, and MCP servers to your agent sessions.\n\n## What are plugins?\n\nPlugins are packages of Claude Code extensions that can include:\n\n* **Commands**: Custom slash commands\n* **Agents**: Specialized subagents for specific tasks\n* **Skills**: Model-invoked capabilities that Claude uses autonomously\n* **Hooks**: Event handlers that respond to tool use and other events\n* **MCP servers**: External tool integrations via Model Context Protocol\n\nFor complete information on plugin structure and how to create plugins, see [Plugins](https://code.claude.com/docs/en/plugins).\n\n## Loading plugins\n\nLoad plugins by providing their local file system paths in your options configuration. The SDK supports loading multiple plugins from different locations.\n\n<CodeGroup>\n  ```typescript TypeScript theme={null}\n  import { query } from \"@anthropic-ai/claude-agent-sdk\";\n\n  for await (const message of query({\n    prompt: \"Hello\",\n    options: {\n      plugins: [\n        { type: \"local\", path: \"./my-plugin\" },\n        { type: \"local\", path: \"/absolute/path/to/another-plugin\" }\n      ]\n    }\n  })) {\n    // Plugin commands, agents, and other features are now available\n  }\n  ```\n\n  ```python Python theme={null}\n  import asyncio\n  from claude_agent_sdk import query\n\n  async def main():\n      async for message in query(\n          prompt=\"Hello\",\n          options={\n              \"plugins\": [\n                  {\"type\": \"local\", \"path\": \"./my-plugin\"},\n                  {\"type\": \"local\", \"path\": \"/absolute/path/to/another-plugin\"}\n              ]\n          }\n      ):\n          # Plugin commands, agents, and other features are now available\n          pass\n\n  asyncio.run(main())\n  ```\n</CodeGroup>\n\n### Path specifications\n\nPlugin paths can be:\n\n* **Relative paths**: Resolved relative to your current working directory (e.g., `\"./plugins/my-plugin\"`)\n* **Absolute paths**: Full file system paths (e.g., `\"/home/user/plugins/my-plugin\"`)\n\n<Note>\n  The path should point to the plugin's root directory (the directory containing `.claude-plugin/plugin.json`).\n</Note>\n\n## Verifying plugin installation\n\nWhen plugins load successfully, they appear in the system initialization message. You can verify that your plugins are available:\n\n<CodeGroup>\n  ```typescript TypeScript theme={null}\n  import { query } from \"@anthropic-ai/claude-agent-sdk\";\n\n  for await (const message of query({\n    prompt: \"Hello\",\n    options: {\n      plugins: [{ type: \"local\", path: \"./my-plugin\" }]\n    }\n  })) {\n    if (message.type === \"system\" && message.subtype === \"init\") {\n      // Check loaded plugins\n      console.log(\"Plugins:\", message.plugins);\n      // Example: [{ name: \"my-plugin\", path: \"./my-plugin\" }]\n\n      // Check available commands from plugins\n      console.log(\"Commands:\", message.slash_commands);\n      // Example: [\"/help\", \"/compact\", \"my-plugin:custom-command\"]\n    }\n  }\n  ```\n\n  ```python Python theme={null}\n  import asyncio\n  from claude_agent_sdk import query\n\n  async def main():\n      async for message in query(\n          prompt=\"Hello\",\n          options={\"plugins\": [{\"type\": \"local\", \"path\": \"./my-plugin\"}]}\n      ):\n          if message.type == \"system\" and message.subtype == \"init\":\n              # Check loaded plugins\n              print(\"Plugins:\", message.data.get(\"plugins\"))\n              # Example: [{\"name\": \"my-plugin\", \"path\": \"./my-plugin\"}]\n\n              # Check available commands from plugins\n              print(\"Commands:\", message.data.get(\"slash_commands\"))\n              # Example: [\"/help\", \"/compact\", \"my-plugin:custom-command\"]\n\n  asyncio.run(main())\n  ```\n</CodeGroup>\n\n## Using plugin commands\n\nCommands from plugins are automatically namespaced with the plugin name to avoid conflicts. The format is `plugin-name:command-name`.\n\n<CodeGroup>\n  ```typescript TypeScript theme={null}\n  import { query } from \"@anthropic-ai/claude-agent-sdk\";\n\n  // Load a plugin with a custom /greet command\n  for await (const message of query({\n    prompt: \"/my-plugin:greet\",  // Use plugin command with namespace\n    options: {\n      plugins: [{ type: \"local\", path: \"./my-plugin\" }]\n    }\n  })) {\n    // Claude executes the custom greeting command from the plugin\n    if (message.type === \"assistant\") {\n      console.log(message.content);\n    }\n  }\n  ```\n\n  ```python Python theme={null}\n  import asyncio\n  from claude_agent_sdk import query, AssistantMessage, TextBlock\n\n  async def main():\n      # Load a plugin with a custom /greet command\n      async for message in query(\n          prompt=\"/demo-plugin:greet\",  # Use plugin command with namespace\n          options={\"plugins\": [{\"type\": \"local\", \"path\": \"./plugins/demo-plugin\"}]}\n      ):\n          # Claude executes the custom greeting command from the plugin\n          if isinstance(message, AssistantMessage):\n              for block in message.content:\n                  if isinstance(block, TextBlock):\n                      print(f\"Claude: {block.text}\")\n\n  asyncio.run(main())\n  ```\n</CodeGroup>\n\n<Note>\n  If you installed a plugin via the CLI (e.g., `/plugin install my-plugin@marketplace`), you can still use it in the SDK by providing its installation path. Check `~/.claude/plugins/` for CLI-installed plugins.\n</Note>\n\n## Complete example\n\nHere's a full example demonstrating plugin loading and usage:\n\n<CodeGroup>\n  ```typescript TypeScript theme={null}\n  import { query } from \"@anthropic-ai/claude-agent-sdk\";\n  import * as path from \"path\";\n\n  async function runWithPlugin() {\n    const pluginPath = path.join(__dirname, \"plugins\", \"my-plugin\");\n\n    console.log(\"Loading plugin from:\", pluginPath);\n\n    for await (const message of query({\n      prompt: \"What custom commands do you have available?\",\n      options: {\n        plugins: [\n          { type: \"local\", path: pluginPath }\n        ],\n        maxTurns: 3\n      }\n    })) {\n      if (message.type === \"system\" && message.subtype === \"init\") {\n        console.log(\"Loaded plugins:\", message.plugins);\n        console.log(\"Available commands:\", message.slash_commands);\n      }\n\n      if (message.type === \"assistant\") {\n        console.log(\"Assistant:\", message.content);\n      }\n    }\n  }\n\n  runWithPlugin().catch(console.error);\n  ```\n\n  ```python Python theme={null}\n  #!/usr/bin/env python3\n  \"\"\"Example demonstrating how to use plugins with the Agent SDK.\"\"\"\n\n  from pathlib import Path\n  import anyio\n  from claude_agent_sdk import (\n      AssistantMessage,\n      ClaudeAgentOptions,\n      TextBlock,\n      query,\n  )\n\n\n  async def run_with_plugin():\n      \"\"\"Example using a custom plugin.\"\"\"\n      plugin_path = Path(__file__).parent / \"plugins\" / \"demo-plugin\"\n\n      print(f\"Loading plugin from: {plugin_path}\")\n\n      options = ClaudeAgentOptions(\n          plugins=[\n              {\"type\": \"local\", \"path\": str(plugin_path)}\n          ],\n          max_turns=3,\n      )\n\n      async for message in query(\n          prompt=\"What custom commands do you have available?\",\n          options=options\n      ):\n          if message.type == \"system\" and message.subtype == \"init\":\n              print(f\"Loaded plugins: {message.data.get('plugins')}\")\n              print(f\"Available commands: {message.data.get('slash_commands')}\")\n\n          if isinstance(message, AssistantMessage):\n              for block in message.content:\n                  if isinstance(block, TextBlock):\n                      print(f\"Assistant: {block.text}\")\n\n\n  if __name__ == \"__main__\":\n      anyio.run(run_with_plugin)\n  ```\n</CodeGroup>\n\n## Plugin structure reference\n\nA plugin directory must contain a `.claude-plugin/plugin.json` manifest file. It can optionally include:\n\n```\nmy-plugin/\n├── .claude-plugin/\n│   └── plugin.json          # Required: plugin manifest\n├── commands/                 # Custom slash commands\n│   └── custom-cmd.md\n├── agents/                   # Custom agents\n│   └── specialist.md\n├── skills/                   # Agent Skills\n│   └── my-skill/\n│       └── SKILL.md\n├── hooks/                    # Event handlers\n│   └── hooks.json\n└── .mcp.json                # MCP server definitions\n```\n\nFor detailed information on creating plugins, see:\n\n* [Plugins](https://code.claude.com/docs/en/plugins) - Complete plugin development guide\n* [Plugins reference](https://code.claude.com/docs/en/plugins-reference) - Technical specifications and schemas\n\n## Common use cases\n\n### Development and testing\n\nLoad plugins during development without installing them globally:\n\n```typescript  theme={null}\nplugins: [\n  { type: \"local\", path: \"./dev-plugins/my-plugin\" }\n]\n```\n\n### Project-specific extensions\n\nInclude plugins in your project repository for team-wide consistency:\n\n```typescript  theme={null}\nplugins: [\n  { type: \"local\", path: \"./project-plugins/team-workflows\" }\n]\n```\n\n### Multiple plugin sources\n\nCombine plugins from different locations:\n\n```typescript  theme={null}\nplugins: [\n  { type: \"local\", path: \"./local-plugin\" },\n  { type: \"local\", path: \"~/.claude/custom-plugins/shared-plugin\" }\n]\n```\n\n## Troubleshooting\n\n### Plugin not loading\n\nIf your plugin doesn't appear in the init message:\n\n1. **Check the path**: Ensure the path points to the plugin root directory (containing `.claude-plugin/`)\n2. **Validate plugin.json**: Ensure your manifest file has valid JSON syntax\n3. **Check file permissions**: Ensure the plugin directory is readable\n\n### Commands not available\n\nIf plugin commands don't work:\n\n1. **Use the namespace**: Plugin commands require the `plugin-name:command-name` format\n2. **Check init message**: Verify the command appears in `slash_commands` with the correct namespace\n3. **Validate command files**: Ensure command markdown files are in the `commands/` directory\n\n### Path resolution issues\n\nIf relative paths don't work:\n\n1. **Check working directory**: Relative paths are resolved from your current working directory\n2. **Use absolute paths**: For reliability, consider using absolute paths\n3. **Normalize paths**: Use path utilities to construct paths correctly\n\n## See also\n\n* [Plugins](https://code.claude.com/docs/en/plugins) - Complete plugin development guide\n* [Plugins reference](https://code.claude.com/docs/en/plugins-reference) - Technical specifications\n* [Slash Commands](/en/docs/agent-sdk/slash-commands) - Using slash commands in the SDK\n* [Subagents](/en/docs/agent-sdk/subagents) - Working with specialized agents\n* [Skills](/en/docs/agent-sdk/skills) - Using Agent Skills",
  "content_length": 10735
}