{
  "title": "Subagents in the SDK",
  "source_url": "https://docs.claude.com/en/docs/agent-sdk/subagents",
  "content": "Working with subagents in the Claude Agent SDK\n\nSubagents in the Claude Agent SDK are specialized AIs that are orchestrated by the main agent.\nUse subagents for context management and parallelization.\n\nThis guide explains how to define and use subagents in the SDK using the `agents` parameter.\n\n## Overview\n\nSubagents can be defined in two ways when using the SDK:\n\n1. **Programmatically** - Using the `agents` parameter in your `query()` options (recommended for SDK applications)\n2. **Filesystem-based** - Placing markdown files with YAML frontmatter in designated directories (`.claude/agents/`)\n\nThis guide primarily focuses on the programmatic approach using the `agents` parameter, which provides a more integrated development experience for SDK applications.\n\n## Benefits of Using Subagents\n\n### Context Management\n\nSubagents maintain separate context from the main agent, preventing information overload and keeping interactions focused. This isolation ensures that specialized tasks don't pollute the main conversation context with irrelevant details.\n\n**Example**: A `research-assistant` subagent can explore dozens of files and documentation pages without cluttering the main conversation with all the intermediate search results - only returning the relevant findings.\n\n### Parallelization\n\nMultiple subagents can run concurrently, dramatically speeding up complex workflows.\n\n**Example**: During a code review, you can run `style-checker`, `security-scanner`, and `test-coverage` subagents simultaneously, reducing review time from minutes to seconds.\n\n### Specialized Instructions and Knowledge\n\nEach subagent can have tailored system prompts with specific expertise, best practices, and constraints.\n\n**Example**: A `database-migration` subagent can have detailed knowledge about SQL best practices, rollback strategies, and data integrity checks that would be unnecessary noise in the main agent's instructions.\n\n### Tool Restrictions\n\nSubagents can be limited to specific tools, reducing the risk of unintended actions.\n\n**Example**: A `doc-reviewer` subagent might only have access to Read and Grep tools, ensuring it can analyze but never accidentally modify your documentation files.\n\n## Creating Subagents\n\n### Programmatic Definition (Recommended)\n\nDefine subagents directly in your code using the `agents` parameter:\n\n```typescript  theme={null}\nimport { query } from '@anthropic-ai/claude-agent-sdk';\n\nconst result = query({\n  prompt: \"Review the authentication module for security issues\",\n  options: {\n    agents: {\n      'code-reviewer': {\n        description: 'Expert code review specialist. Use for quality, security, and maintainability reviews.',\n        prompt: `You are a code review specialist with expertise in security, performance, and best practices.\n\nWhen reviewing code:\n- Identify security vulnerabilities\n- Check for performance issues\n- Verify adherence to coding standards\n- Suggest specific improvements\n\nBe thorough but concise in your feedback.`,\n        tools: ['Read', 'Grep', 'Glob'],\n        model: 'sonnet'\n      },\n      'test-runner': {\n        description: 'Runs and analyzes test suites. Use for test execution and coverage analysis.',\n        prompt: `You are a test execution specialist. Run tests and provide clear analysis of results.\n\nFocus on:\n- Running test commands\n- Analyzing test output\n- Identifying failing tests\n- Suggesting fixes for failures`,\n        tools: ['Bash', 'Read', 'Grep'],\n      }\n    }\n  }\n});\n\nfor await (const message of result) {\n  console.log(message);\n}\n```\n\n### AgentDefinition Configuration\n\n| Field         | Type                                         | Required | Description                                                      |\n| :------------ | :------------------------------------------- | :------- | :--------------------------------------------------------------- |\n| `description` | `string`                                     | Yes      | Natural language description of when to use this agent           |\n| `prompt`      | `string`                                     | Yes      | The agent's system prompt defining its role and behavior         |\n| `tools`       | `string[]`                                   | No       | Array of allowed tool names. If omitted, inherits all tools      |\n| `model`       | `'sonnet' \\| 'opus' \\| 'haiku' \\| 'inherit'` | No       | Model override for this agent. Defaults to main model if omitted |\n\n### Filesystem-Based Definition (Alternative)\n\nYou can also define subagents as markdown files in specific directories:\n\n* **Project-level**: `.claude/agents/*.md` - Available only in the current project\n* **User-level**: `~/.claude/agents/*.md` - Available across all projects\n\nEach subagent is a markdown file with YAML frontmatter:\n\n```markdown  theme={null}\n---\nname: code-reviewer\ndescription: Expert code review specialist. Use for quality, security, and maintainability reviews.\ntools: Read, Grep, Glob, Bash\n---\n\nYour subagent's system prompt goes here. This defines the subagent's\nrole, capabilities, and approach to solving problems.\n```\n\n**Note:** Programmatically defined agents (via the `agents` parameter) take precedence over filesystem-based agents with the same name.\n\n## How the SDK Uses Subagents\n\nWhen using the Claude Agent SDK, subagents can be defined programmatically or loaded from the filesystem. Claude will:\n\n1. **Load programmatic agents** from the `agents` parameter in your options\n2. **Auto-detect filesystem agents** from `.claude/agents/` directories (if not overridden)\n3. **Invoke them automatically** based on task matching and the agent's `description`\n4. **Use their specialized prompts** and tool restrictions\n5. **Maintain separate context** for each subagent invocation\n\nProgrammatically defined agents (via `agents` parameter) take precedence over filesystem-based agents with the same name.\n\n## Example Subagents\n\nFor comprehensive examples of subagents including code reviewers, test runners, debuggers, and security auditors, see the [main Subagents guide](https://code.claude.com/docs/en/sub-agents#example-subagents). The guide includes detailed configurations and best practices for creating effective subagents.\n\n## SDK Integration Patterns\n\n### Automatic Invocation\n\nThe SDK will automatically invoke appropriate subagents based on the task context. Ensure your agent's `description` field clearly indicates when it should be used:\n\n```typescript  theme={null}\nconst result = query({\n  prompt: \"Optimize the database queries in the API layer\",\n  options: {\n    agents: {\n      'performance-optimizer': {\n        description: 'Use PROACTIVELY when code changes might impact performance. MUST BE USED for optimization tasks.',\n        prompt: 'You are a performance optimization specialist...',\n        tools: ['Read', 'Edit', 'Bash', 'Grep'],\n        model: 'sonnet'\n      }\n    }\n  }\n});\n```\n\n### Explicit Invocation\n\nUsers can request specific subagents in their prompts:\n\n```typescript  theme={null}\nconst result = query({\n  prompt: \"Use the code-reviewer agent to check the authentication module\",\n  options: {\n    agents: {\n      'code-reviewer': {\n        description: 'Expert code review specialist',\n        prompt: 'You are a security-focused code reviewer...',\n        tools: ['Read', 'Grep', 'Glob']\n      }\n    }\n  }\n});\n```\n\n### Dynamic Agent Configuration\n\nYou can dynamically configure agents based on your application's needs:\n\n```typescript  theme={null}\nimport { query, type AgentDefinition } from '@anthropic-ai/claude-agent-sdk';\n\nfunction createSecurityAgent(securityLevel: 'basic' | 'strict'): AgentDefinition {\n  return {\n    description: 'Security code reviewer',\n    prompt: `You are a ${securityLevel === 'strict' ? 'strict' : 'balanced'} security reviewer...`,\n    tools: ['Read', 'Grep', 'Glob'],\n    model: securityLevel === 'strict' ? 'opus' : 'sonnet'\n  };\n}\n\nconst result = query({\n  prompt: \"Review this PR for security issues\",\n  options: {\n    agents: {\n      'security-reviewer': createSecurityAgent('strict')\n    }\n  }\n});\n```\n\n## Tool Restrictions\n\nSubagents can have restricted tool access via the `tools` field:\n\n* **Omit the field** - Agent inherits all available tools (default)\n* **Specify tools** - Agent can only use listed tools\n\nExample of a read-only analysis agent:\n\n```typescript  theme={null}\nconst result = query({\n  prompt: \"Analyze the architecture of this codebase\",\n  options: {\n    agents: {\n      'code-analyzer': {\n        description: 'Static code analysis and architecture review',\n        prompt: `You are a code architecture analyst. Analyze code structure,\nidentify patterns, and suggest improvements without making changes.`,\n        tools: ['Read', 'Grep', 'Glob']  // No write or execute permissions\n      }\n    }\n  }\n});\n```\n\n### Common Tool Combinations\n\n**Read-only agents** (analysis, review):\n\n```typescript  theme={null}\ntools: ['Read', 'Grep', 'Glob']\n```\n\n**Test execution agents**:\n\n```typescript  theme={null}\ntools: ['Bash', 'Read', 'Grep']\n```\n\n**Code modification agents**:\n\n```typescript  theme={null}\ntools: ['Read', 'Edit', 'Write', 'Grep', 'Glob']\n```\n\n## Related Documentation\n\n* [Main Subagents Guide](https://code.claude.com/docs/en/sub-agents) - Comprehensive subagent documentation\n* [SDK Overview](/en/docs/agent-sdk/overview) - Overview of Claude Agent SDK\n* [Settings](https://code.claude.com/docs/en/settings) - Configuration file reference\n* [Slash Commands](https://code.claude.com/docs/en/slash-commands) - Custom command creation",
  "content_length": 9520
}