{
  "title": "Using the Messages API",
  "source_url": "https://docs.claude.com/en/docs/build-with-claude/working-with-messages",
  "content": "Practical patterns and examples for using the Messages API effectively\n\nThis guide covers common patterns for working with the Messages API, including basic requests, multi-turn conversations, prefill techniques, and vision capabilities. For complete API specifications, see the [Messages API reference](/en/api/messages).\n\n## Basic request and response\n\n<CodeGroup>\n  ```bash Shell theme={null}\n  #!/bin/sh\n  curl https://api.anthropic.com/v1/messages \\\n       --header \"x-api-key: $ANTHROPIC_API_KEY\" \\\n       --header \"anthropic-version: 2023-06-01\" \\\n       --header \"content-type: application/json\" \\\n       --data \\\n  '{\n      \"model\": \"claude-sonnet-4-5\",\n      \"max_tokens\": 1024,\n      \"messages\": [\n          {\"role\": \"user\", \"content\": \"Hello, Claude\"}\n      ]\n  }'\n  ```\n\n  ```Python Python theme={null}\n  import anthropic\n\n  message = anthropic.Anthropic().messages.create(\n      model=\"claude-sonnet-4-5\",\n      max_tokens=1024,\n      messages=[\n          {\"role\": \"user\", \"content\": \"Hello, Claude\"}\n      ]\n  )\n  print(message)\n  ```\n\n  ```TypeScript TypeScript theme={null}\n  import Anthropic from '@anthropic-ai/sdk';\n\n  const anthropic = new Anthropic();\n\n  const message = await anthropic.messages.create({\n    model: 'claude-sonnet-4-5',\n    max_tokens: 1024,\n    messages: [\n      {\"role\": \"user\", \"content\": \"Hello, Claude\"}\n    ]\n  });\n  console.log(message);\n  ```\n</CodeGroup>\n\n```JSON JSON theme={null}\n{\n  \"id\": \"msg_01XFDUDYJgAACzvnptvVoYEL\",\n  \"type\": \"message\",\n  \"role\": \"assistant\",\n  \"content\": [\n    {\n      \"type\": \"text\",\n      \"text\": \"Hello!\"\n    }\n  ],\n  \"model\": \"claude-sonnet-4-5\",\n  \"stop_reason\": \"end_turn\",\n  \"stop_sequence\": null,\n  \"usage\": {\n    \"input_tokens\": 12,\n    \"output_tokens\": 6\n  }\n}\n```\n\n## Multiple conversational turns\n\nThe Messages API is stateless, which means that you always send the full conversational history to the API. You can use this pattern to build up a conversation over time. Earlier conversational turns don't necessarily need to actually originate from Claude â€” you can use synthetic `assistant` messages.\n\n<CodeGroup>\n  ```bash Shell theme={null}\n  #!/bin/sh\n  curl https://api.anthropic.com/v1/messages \\\n       --header \"x-api-key: $ANTHROPIC_API_KEY\" \\\n       --header \"anthropic-version: 2023-06-01\" \\\n       --header \"content-type: application/json\" \\\n       --data \\\n  '{\n      \"model\": \"claude-sonnet-4-5\",\n      \"max_tokens\": 1024,\n      \"messages\": [\n          {\"role\": \"user\", \"content\": \"Hello, Claude\"},\n          {\"role\": \"assistant\", \"content\": \"Hello!\"},\n          {\"role\": \"user\", \"content\": \"Can you describe LLMs to me?\"}\n\n      ]\n  }'\n  ```\n\n  ```Python Python theme={null}\n  import anthropic\n\n  message = anthropic.Anthropic().messages.create(\n      model=\"claude-sonnet-4-5\",\n      max_tokens=1024,\n      messages=[\n          {\"role\": \"user\", \"content\": \"Hello, Claude\"},\n          {\"role\": \"assistant\", \"content\": \"Hello!\"},\n          {\"role\": \"user\", \"content\": \"Can you describe LLMs to me?\"}\n      ],\n  )\n  print(message)\n\n  ```\n\n  ```TypeScript TypeScript theme={null}\n  import Anthropic from '@anthropic-ai/sdk';\n\n  const anthropic = new Anthropic();\n\n  await anthropic.messages.create({\n    model: 'claude-sonnet-4-5',\n    max_tokens: 1024,\n    messages: [\n      {\"role\": \"user\", \"content\": \"Hello, Claude\"},\n      {\"role\": \"assistant\", \"content\": \"Hello!\"},\n      {\"role\": \"user\", \"content\": \"Can you describe LLMs to me?\"}\n    ]\n  });\n  ```\n</CodeGroup>\n\n```JSON JSON theme={null}\n{\n    \"id\": \"msg_018gCsTGsXkYJVqYPxTgDHBU\",\n    \"type\": \"message\",\n    \"role\": \"assistant\",\n    \"content\": [\n        {\n            \"type\": \"text\",\n            \"text\": \"Sure, I'd be happy to provide...\"\n        }\n    ],\n    \"stop_reason\": \"end_turn\",\n    \"stop_sequence\": null,\n    \"usage\": {\n      \"input_tokens\": 30,\n      \"output_tokens\": 309\n    }\n}\n```\n\n## Putting words in Claude's mouth\n\nYou can pre-fill part of Claude's response in the last position of the input messages list. This can be used to shape Claude's response. The example below uses `\"max_tokens\": 1` to get a single multiple choice answer from Claude.\n\n<CodeGroup>\n  ```bash Shell theme={null}\n  #!/bin/sh\n  curl https://api.anthropic.com/v1/messages \\\n       --header \"x-api-key: $ANTHROPIC_API_KEY\" \\\n       --header \"anthropic-version: 2023-06-01\" \\\n       --header \"content-type: application/json\" \\\n       --data \\\n  '{\n      \"model\": \"claude-sonnet-4-5\",\n      \"max_tokens\": 1,\n      \"messages\": [\n          {\"role\": \"user\", \"content\": \"What is latin for Ant? (A) Apoidea, (B) Rhopalocera, (C) Formicidae\"},\n          {\"role\": \"assistant\", \"content\": \"The answer is (\"}\n      ]\n  }'\n  ```\n\n  ```Python Python theme={null}\n  import anthropic\n\n  message = anthropic.Anthropic().messages.create(\n      model=\"claude-sonnet-4-5\",\n      max_tokens=1,\n      messages=[\n          {\"role\": \"user\", \"content\": \"What is latin for Ant? (A) Apoidea, (B) Rhopalocera, (C) Formicidae\"},\n          {\"role\": \"assistant\", \"content\": \"The answer is (\"}\n      ]\n  )\n  print(message)\n  ```\n\n  ```TypeScript TypeScript theme={null}\n  import Anthropic from '@anthropic-ai/sdk';\n\n  const anthropic = new Anthropic();\n\n  const message = await anthropic.messages.create({\n    model: 'claude-sonnet-4-5',\n    max_tokens: 1,\n    messages: [\n      {\"role\": \"user\", \"content\": \"What is latin for Ant? (A) Apoidea, (B) Rhopalocera, (C) Formicidae\"},\n      {\"role\": \"assistant\", \"content\": \"The answer is (\"}\n    ]\n  });\n  console.log(message);\n  ```\n</CodeGroup>\n\n```JSON JSON theme={null}\n{\n  \"id\": \"msg_01Q8Faay6S7QPTvEUUQARt7h\",\n  \"type\": \"message\",\n  \"role\": \"assistant\",\n  \"content\": [\n    {\n      \"type\": \"text\",\n      \"text\": \"C\"\n    }\n  ],\n  \"model\": \"claude-sonnet-4-5\",\n  \"stop_reason\": \"max_tokens\",\n  \"stop_sequence\": null,\n  \"usage\": {\n    \"input_tokens\": 42,\n    \"output_tokens\": 1\n  }\n}\n```\n\nFor more information on prefill techniques, see our [prefill guide](/en/docs/build-with-claude/prompt-engineering/prefill-claudes-response).\n\n## Vision\n\nClaude can read both text and images in requests. We support both `base64` and `url` source types for images, and the `image/jpeg`, `image/png`, `image/gif`, and `image/webp` media types. See our [vision guide](/en/docs/build-with-claude/vision) for more details.\n\n<CodeGroup>\n  ```bash Shell theme={null}\n  #!/bin/sh\n\n  # Option 1: Base64-encoded image\n  IMAGE_URL=\"https://upload.wikimedia.org/wikipedia/commons/a/a7/Camponotus_flavomarginatus_ant.jpg\"\n  IMAGE_MEDIA_TYPE=\"image/jpeg\"\n  IMAGE_BASE64=$(curl \"$IMAGE_URL\" | base64)\n\n  curl https://api.anthropic.com/v1/messages \\\n       --header \"x-api-key: $ANTHROPIC_API_KEY\" \\\n       --header \"anthropic-version: 2023-06-01\" \\\n       --header \"content-type: application/json\" \\\n       --data \\\n  '{\n      \"model\": \"claude-sonnet-4-5\",\n      \"max_tokens\": 1024,\n      \"messages\": [\n          {\"role\": \"user\", \"content\": [\n              {\"type\": \"image\", \"source\": {\n                  \"type\": \"base64\",\n                  \"media_type\": \"'$IMAGE_MEDIA_TYPE'\",\n                  \"data\": \"'$IMAGE_BASE64'\"\n              }},\n              {\"type\": \"text\", \"text\": \"What is in the above image?\"}\n          ]}\n      ]\n  }'\n\n  # Option 2: URL-referenced image\n  curl https://api.anthropic.com/v1/messages \\\n       --header \"x-api-key: $ANTHROPIC_API_KEY\" \\\n       --header \"anthropic-version: 2023-06-01\" \\\n       --header \"content-type: application/json\" \\\n       --data \\\n  '{\n      \"model\": \"claude-sonnet-4-5\",\n      \"max_tokens\": 1024,\n      \"messages\": [\n          {\"role\": \"user\", \"content\": [\n              {\"type\": \"image\", \"source\": {\n                  \"type\": \"url\",\n                  \"url\": \"https://upload.wikimedia.org/wikipedia/commons/a/a7/Camponotus_flavomarginatus_ant.jpg\"\n              }},\n              {\"type\": \"text\", \"text\": \"What is in the above image?\"}\n          ]}\n      ]\n  }'\n  ```\n\n  ```Python Python theme={null}\n  import anthropic\n  import base64\n  import httpx\n\n  # Option 1: Base64-encoded image\n  image_url = \"https://upload.wikimedia.org/wikipedia/commons/a/a7/Camponotus_flavomarginatus_ant.jpg\"\n  image_media_type = \"image/jpeg\"\n  image_data = base64.standard_b64encode(httpx.get(image_url).content).decode(\"utf-8\")\n\n  message = anthropic.Anthropic().messages.create(\n      model=\"claude-sonnet-4-5\",\n      max_tokens=1024,\n      messages=[\n          {\n              \"role\": \"user\",\n              \"content\": [\n                  {\n                      \"type\": \"image\",\n                      \"source\": {\n                          \"type\": \"base64\",\n                          \"media_type\": image_media_type,\n                          \"data\": image_data,\n                      },\n                  },\n                  {\n                      \"type\": \"text\",\n                      \"text\": \"What is in the above image?\"\n                  }\n              ],\n          }\n      ],\n  )\n  print(message)\n\n  # Option 2: URL-referenced image\n  message_from_url = anthropic.Anthropic().messages.create(\n      model=\"claude-sonnet-4-5\",\n      max_tokens=1024,\n      messages=[\n          {\n              \"role\": \"user\",\n              \"content\": [\n                  {\n                      \"type\": \"image\",\n                      \"source\": {\n                          \"type\": \"url\",\n                          \"url\": \"https://upload.wikimedia.org/wikipedia/commons/a/a7/Camponotus_flavomarginatus_ant.jpg\",\n                      },\n                  },\n                  {\n                      \"type\": \"text\",\n                      \"text\": \"What is in the above image?\"\n                  }\n              ],\n          }\n      ],\n  )\n  print(message_from_url)\n  ```\n\n  ```TypeScript TypeScript theme={null}\n  import Anthropic from '@anthropic-ai/sdk';\n\n  const anthropic = new Anthropic();\n\n  // Option 1: Base64-encoded image\n  const image_url = \"https://upload.wikimedia.org/wikipedia/commons/a/a7/Camponotus_flavomarginatus_ant.jpg\"\n  const image_media_type = \"image/jpeg\"\n  const image_array_buffer = await ((await fetch(image_url)).arrayBuffer());\n  const image_data = Buffer.from(image_array_buffer).toString('base64');\n\n  const message = await anthropic.messages.create({\n    model: 'claude-sonnet-4-5',\n    max_tokens: 1024,\n    messages: [\n          {\n              \"role\": \"user\",\n              \"content\": [\n                  {\n                      \"type\": \"image\",\n                      \"source\": {\n                          \"type\": \"base64\",\n                          \"media_type\": image_media_type,\n                          \"data\": image_data,\n                      },\n                  },\n                  {\n                      \"type\": \"text\",\n                      \"text\": \"What is in the above image?\"\n                  }\n              ],\n          }\n        ]\n  });\n  console.log(message);\n\n  // Option 2: URL-referenced image\n  const messageFromUrl = await anthropic.messages.create({\n    model: 'claude-sonnet-4-5',\n    max_tokens: 1024,\n    messages: [\n          {\n              \"role\": \"user\",\n              \"content\": [\n                  {\n                      \"type\": \"image\",\n                      \"source\": {\n                          \"type\": \"url\",\n                          \"url\": \"https://upload.wikimedia.org/wikipedia/commons/a/a7/Camponotus_flavomarginatus_ant.jpg\",\n                      },\n                  },\n                  {\n                      \"type\": \"text\",\n                      \"text\": \"What is in the above image?\"\n                  }\n              ],\n          }\n        ]\n  });\n  console.log(messageFromUrl);\n  ```\n</CodeGroup>\n\n```JSON JSON theme={null}\n{\n  \"id\": \"msg_01EcyWo6m4hyW8KHs2y2pei5\",\n  \"type\": \"message\",\n  \"role\": \"assistant\",\n  \"content\": [\n    {\n      \"type\": \"text\",\n      \"text\": \"This image shows an ant, specifically a close-up view of an ant. The ant is shown in detail, with its distinct head, antennae, and legs clearly visible. The image is focused on capturing the intricate details and features of the ant, likely taken with a macro lens to get an extreme close-up perspective.\"\n    }\n  ],\n  \"model\": \"claude-sonnet-4-5\",\n  \"stop_reason\": \"end_turn\",\n  \"stop_sequence\": null,\n  \"usage\": {\n    \"input_tokens\": 1551,\n    \"output_tokens\": 71\n  }\n}\n```\n\n## Tool use, JSON mode, and computer use\n\nSee our [guide](/en/docs/agents-and-tools/tool-use/overview) for examples for how to use tools with the Messages API.\nSee our [computer use guide](/en/docs/agents-and-tools/tool-use/computer-use-tool) for examples of how to control desktop computer environments with the Messages API.",
  "content_length": 12521
}