{
  "title": "Streaming Input",
  "source_url": "https://docs.claude.com/en/docs/agent-sdk/streaming-vs-single-mode",
  "content": "Understanding the two input modes for Claude Agent SDK and when to use each\n\n## Overview\n\nThe Claude Agent SDK supports two distinct input modes for interacting with agents:\n\n* **Streaming Input Mode** (Default & Recommended) - A persistent, interactive session\n* **Single Message Input** - One-shot queries that use session state and resuming\n\nThis guide explains the differences, benefits, and use cases for each mode to help you choose the right approach for your application.\n\n## Streaming Input Mode (Recommended)\n\nStreaming input mode is the **preferred** way to use the Claude Agent SDK. It provides full access to the agent's capabilities and enables rich, interactive experiences.\n\nIt allows the agent to operate as a long lived process that takes in user input, handles interruptions, surfaces permission requests, and handles session management.\n\n### How It Works\n\n```mermaid  theme={null}\n%%{init: {\"theme\": \"base\", \"themeVariables\": {\"edgeLabelBackground\": \"#F0F0EB\", \"lineColor\": \"#91918D\", \"primaryColor\": \"#F0F0EB\", \"primaryTextColor\": \"#191919\", \"primaryBorderColor\": \"#D9D8D5\", \"secondaryColor\": \"#F5E6D8\", \"tertiaryColor\": \"#CC785C\", \"noteBkgColor\": \"#FAF0E6\", \"noteBorderColor\": \"#91918D\"}, \"sequence\": {\"actorMargin\": 50, \"width\": 150, \"height\": 65, \"boxMargin\": 10, \"boxTextMargin\": 5, \"noteMargin\": 10, \"messageMargin\": 35}}}%%\nsequenceDiagram\n    participant App as Your Application\n    participant Agent as Claude Agent\n    participant Tools as Tools/Hooks\n    participant FS as Environment/<br/>File System\n    \n    App->>Agent: Initialize with AsyncGenerator\n    activate Agent\n    \n    App->>Agent: Yield Message 1\n    Agent->>Tools: Execute tools\n    Tools->>FS: Read files\n    FS-->>Tools: File contents\n    Tools->>FS: Write/Edit files\n    FS-->>Tools: Success/Error\n    Agent-->>App: Stream partial response\n    Agent-->>App: Stream more content...\n    Agent->>App: Complete Message 1\n    \n    App->>Agent: Yield Message 2 + Image\n    Agent->>Tools: Process image & execute\n    Tools->>FS: Access filesystem\n    FS-->>Tools: Operation results\n    Agent-->>App: Stream response 2\n    \n    App->>Agent: Queue Message 3\n    App->>Agent: Interrupt/Cancel\n    Agent->>App: Handle interruption\n    \n    Note over App,Agent: Session stays alive\n    Note over Tools,FS: Persistent file system<br/>state maintained\n    \n    deactivate Agent\n```\n\n### Benefits\n\n<CardGroup cols={2}>\n  <Card title=\"Image Uploads\" icon=\"image\">\n    Attach images directly to messages for visual analysis and understanding\n  </Card>\n\n  <Card title=\"Queued Messages\" icon=\"layer-group\">\n    Send multiple messages that process sequentially, with ability to interrupt\n  </Card>\n\n  <Card title=\"Tool Integration\" icon=\"wrench\">\n    Full access to all tools and custom MCP servers during the session\n  </Card>\n\n  <Card title=\"Hooks Support\" icon=\"link\">\n    Use lifecycle hooks to customize behavior at various points\n  </Card>\n\n  <Card title=\"Real-time Feedback\" icon=\"bolt\">\n    See responses as they're generated, not just final results\n  </Card>\n\n  <Card title=\"Context Persistence\" icon=\"database\">\n    Maintain conversation context across multiple turns naturally\n  </Card>\n</CardGroup>\n\n### Implementation Example\n\n<CodeGroup>\n  ```typescript TypeScript theme={null}\n  import { query } from \"@anthropic-ai/claude-agent-sdk\";\n  import { readFileSync } from \"fs\";\n\n  async function* generateMessages() {\n    // First message\n    yield {\n      type: \"user\" as const,\n      message: {\n        role: \"user\" as const,\n        content: \"Analyze this codebase for security issues\"\n      }\n    };\n    \n    // Wait for conditions or user input\n    await new Promise(resolve => setTimeout(resolve, 2000));\n    \n    // Follow-up with image\n    yield {\n      type: \"user\" as const,\n      message: {\n        role: \"user\" as const,\n        content: [\n          {\n            type: \"text\",\n            text: \"Review this architecture diagram\"\n          },\n          {\n            type: \"image\",\n            source: {\n              type: \"base64\",\n              media_type: \"image/png\",\n              data: readFileSync(\"diagram.png\", \"base64\")\n            }\n          }\n        ]\n      }\n    };\n  }\n\n  // Process streaming responses\n  for await (const message of query({\n    prompt: generateMessages(),\n    options: {\n      maxTurns: 10,\n      allowedTools: [\"Read\", \"Grep\"]\n    }\n  })) {\n    if (message.type === \"result\") {\n      console.log(message.result);\n    }\n  }\n  ```\n\n  ```python Python theme={null}\n  from claude_agent_sdk import ClaudeSDKClient, ClaudeAgentOptions, AssistantMessage, TextBlock\n  import asyncio\n  import base64\n\n  async def streaming_analysis():\n      async def message_generator():\n          # First message\n          yield {\n              \"type\": \"user\",\n              \"message\": {\n                  \"role\": \"user\",\n                  \"content\": \"Analyze this codebase for security issues\"\n              }\n          }\n\n          # Wait for conditions\n          await asyncio.sleep(2)\n\n          # Follow-up with image\n          with open(\"diagram.png\", \"rb\") as f:\n              image_data = base64.b64encode(f.read()).decode()\n\n          yield {\n              \"type\": \"user\",\n              \"message\": {\n                  \"role\": \"user\",\n                  \"content\": [\n                      {\n                          \"type\": \"text\",\n                          \"text\": \"Review this architecture diagram\"\n                      },\n                      {\n                          \"type\": \"image\",\n                          \"source\": {\n                              \"type\": \"base64\",\n                              \"media_type\": \"image/png\",\n                              \"data\": image_data\n                          }\n                      }\n                  ]\n              }\n          }\n\n      # Use ClaudeSDKClient for streaming input\n      options = ClaudeAgentOptions(\n          max_turns=10,\n          allowed_tools=[\"Read\", \"Grep\"]\n      )\n\n      async with ClaudeSDKClient(options) as client:\n          # Send streaming input\n          await client.query(message_generator())\n\n          # Process responses\n          async for message in client.receive_response():\n              if isinstance(message, AssistantMessage):\n                  for block in message.content:\n                      if isinstance(block, TextBlock):\n                          print(block.text)\n\n  asyncio.run(streaming_analysis())\n  ```\n</CodeGroup>\n\n## Single Message Input\n\nSingle message input is simpler but more limited.\n\n### When to Use Single Message Input\n\nUse single message input when:\n\n* You need a one-shot response\n* You do not need image attachments, hooks, etc.\n* You need to operate in a stateless environment, such as a lambda function\n\n### Limitations\n\n<Warning>\n  Single message input mode does **not** support:\n\n  * Direct image attachments in messages\n  * Dynamic message queueing\n  * Real-time interruption\n  * Hook integration\n  * Natural multi-turn conversations\n</Warning>\n\n### Implementation Example\n\n<CodeGroup>\n  ```typescript TypeScript theme={null}\n  import { query } from \"@anthropic-ai/claude-agent-sdk\";\n\n  // Simple one-shot query\n  for await (const message of query({\n    prompt: \"Explain the authentication flow\",\n    options: {\n      maxTurns: 1,\n      allowedTools: [\"Read\", \"Grep\"]\n    }\n  })) {\n    if (message.type === \"result\") {\n      console.log(message.result);\n    }\n  }\n\n  // Continue conversation with session management\n  for await (const message of query({\n    prompt: \"Now explain the authorization process\",\n    options: {\n      continue: true,\n      maxTurns: 1\n    }\n  })) {\n    if (message.type === \"result\") {\n      console.log(message.result);\n    }\n  }\n  ```\n\n  ```python Python theme={null}\n  from claude_agent_sdk import query, ClaudeAgentOptions, ResultMessage\n  import asyncio\n\n  async def single_message_example():\n      # Simple one-shot query using query() function\n      async for message in query(\n          prompt=\"Explain the authentication flow\",\n          options=ClaudeAgentOptions(\n              max_turns=1,\n              allowed_tools=[\"Read\", \"Grep\"]\n          )\n      ):\n          if isinstance(message, ResultMessage):\n              print(message.result)\n\n      # Continue conversation with session management\n      async for message in query(\n          prompt=\"Now explain the authorization process\",\n          options=ClaudeAgentOptions(\n              continue_conversation=True,\n              max_turns=1\n          )\n      ):\n          if isinstance(message, ResultMessage):\n              print(message.result)\n\n  asyncio.run(single_message_example())\n  ```\n</CodeGroup>",
  "content_length": 8650
}