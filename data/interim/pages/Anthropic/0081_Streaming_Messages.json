{
  "title": "Streaming Messages",
  "source_url": "https://docs.claude.com/en/docs/build-with-claude/streaming",
  "content": "When creating a Message, you can set `\"stream\": true` to incrementally stream the response using [server-sent events](https://developer.mozilla.org/en-US/docs/Web/API/Server-sent%5Fevents/Using%5Fserver-sent%5Fevents) (SSE).\n\n## Streaming with SDKs\n\nOur [Python](https://github.com/anthropics/anthropic-sdk-python) and [TypeScript](https://github.com/anthropics/anthropic-sdk-typescript) SDKs offer multiple ways of streaming. The Python SDK allows both sync and async streams. See the documentation in each SDK for details.\n\n<CodeGroup>\n  ```Python Python theme={null}\n  import anthropic\n\n  client = anthropic.Anthropic()\n\n  with client.messages.stream(\n      max_tokens=1024,\n      messages=[{\"role\": \"user\", \"content\": \"Hello\"}],\n      model=\"claude-sonnet-4-5\",\n  ) as stream:\n    for text in stream.text_stream:\n        print(text, end=\"\", flush=True)\n  ```\n\n  ```TypeScript TypeScript theme={null}\n  import Anthropic from '@anthropic-ai/sdk';\n\n  const client = new Anthropic();\n\n  await client.messages.stream({\n      messages: [{role: 'user', content: \"Hello\"}],\n      model: 'claude-sonnet-4-5',\n      max_tokens: 1024,\n  }).on('text', (text) => {\n      console.log(text);\n  });\n  ```\n</CodeGroup>\n\n## Event types\n\nEach server-sent event includes a named event type and associated JSON data. Each event will use an SSE event name (e.g. `event: message_stop`), and include the matching event `type` in its data.\n\nEach stream uses the following event flow:\n\n1. `message_start`: contains a `Message` object with empty `content`.\n2. A series of content blocks, each of which have a `content_block_start`, one or more `content_block_delta` events, and a `content_block_stop` event. Each content block will have an `index` that corresponds to its index in the final Message `content` array.\n3. One or more `message_delta` events, indicating top-level changes to the final `Message` object.\n4. A final `message_stop` event.\n\n<Warning>\n  The token counts shown in the `usage` field of the `message_delta` event are *cumulative*.\n</Warning>\n\n### Ping events\n\nEvent streams may also include any number of `ping` events.\n\n### Error events\n\nWe may occasionally send [errors](/en/api/errors) in the event stream. For example, during periods of high usage, you may receive an `overloaded_error`, which would normally correspond to an HTTP 529 in a non-streaming context:\n\n```json Example error theme={null}\nevent: error\ndata: {\"type\": \"error\", \"error\": {\"type\": \"overloaded_error\", \"message\": \"Overloaded\"}}\n```\n\n### Other events\n\nIn accordance with our [versioning policy](/en/api/versioning), we may add new event types, and your code should handle unknown event types gracefully.\n\n## Content block delta types\n\nEach `content_block_delta` event contains a `delta` of a type that updates the `content` block at a given `index`.\n\n### Text delta\n\nA `text` content block delta looks like:\n\n```JSON Text delta theme={null}\nevent: content_block_delta\ndata: {\"type\": \"content_block_delta\",\"index\": 0,\"delta\": {\"type\": \"text_delta\", \"text\": \"ello frien\"}}\n```\n\n### Input JSON delta\n\nThe deltas for `tool_use` content blocks correspond to updates for the `input` field of the block. To support maximum granularity, the deltas are *partial JSON strings*, whereas the final `tool_use.input` is always an *object*.\n\nYou can accumulate the string deltas and parse the JSON once you receive a `content_block_stop` event, by using a library like [Pydantic](https://docs.pydantic.dev/latest/concepts/json/#partial-json-parsing) to do partial JSON parsing, or by using our [SDKs](/en/api/client-sdks), which provide helpers to access parsed incremental values.\n\nA `tool_use` content block delta looks like:\n\n```JSON Input JSON delta theme={null}\nevent: content_block_delta\ndata: {\"type\": \"content_block_delta\",\"index\": 1,\"delta\": {\"type\": \"input_json_delta\",\"partial_json\": \"{\\\"location\\\": \\\"San Fra\"}}}\n```\n\nNote: Our current models only support emitting one complete key and value property from `input` at a time. As such, when using tools, there may be delays between streaming events while the model is working. Once an `input` key and value are accumulated, we emit them as multiple `content_block_delta` events with chunked partial json so that the format can automatically support finer granularity in future models.\n\n### Thinking delta\n\nWhen using [extended thinking](/en/docs/build-with-claude/extended-thinking#streaming-thinking) with streaming enabled, you'll receive thinking content via `thinking_delta` events. These deltas correspond to the `thinking` field of the `thinking` content blocks.\n\nFor thinking content, a special `signature_delta` event is sent just before the `content_block_stop` event. This signature is used to verify the integrity of the thinking block.\n\nA typical thinking delta looks like:\n\n```JSON Thinking delta theme={null}\nevent: content_block_delta\ndata: {\"type\": \"content_block_delta\", \"index\": 0, \"delta\": {\"type\": \"thinking_delta\", \"thinking\": \"Let me solve this step by step:\\n\\n1. First break down 27 * 453\"}}\n```\n\nThe signature delta looks like:\n\n```JSON Signature delta theme={null}\nevent: content_block_delta\ndata: {\"type\": \"content_block_delta\", \"index\": 0, \"delta\": {\"type\": \"signature_delta\", \"signature\": \"EqQBCgIYAhIM1gbcDa9GJwZA2b3hGgxBdjrkzLoky3dl1pkiMOYds...\"}}\n```\n\n## Full HTTP Stream response\n\nWe strongly recommend that you use our [client SDKs](/en/api/client-sdks) when using streaming mode. However, if you are building a direct API integration, you will need to handle these events yourself.\n\nA stream response is comprised of:\n\n1. A `message_start` event\n2. Potentially multiple content blocks, each of which contains:\n   * A `content_block_start` event\n   * Potentially multiple `content_block_delta` events\n   * A `content_block_stop` event\n3. A `message_delta` event\n4. A `message_stop` event\n\nThere may be `ping` events dispersed throughout the response as well. See [Event types](#event-types) for more details on the format.\n\n### Basic streaming request\n\n<CodeGroup>\n  ```bash Shell theme={null}\n  curl https://api.anthropic.com/v1/messages \\\n       --header \"anthropic-version: 2023-06-01\" \\\n       --header \"content-type: application/json\" \\\n       --header \"x-api-key: $ANTHROPIC_API_KEY\" \\\n       --data \\\n  '{\n    \"model\": \"claude-sonnet-4-5\",\n    \"messages\": [{\"role\": \"user\", \"content\": \"Hello\"}],\n    \"max_tokens\": 256,\n    \"stream\": true\n  }'\n  ```\n\n  ```python Python theme={null}\n  import anthropic\n\n  client = anthropic.Anthropic()\n\n  with client.messages.stream(\n      model=\"claude-sonnet-4-5\",\n      messages=[{\"role\": \"user\", \"content\": \"Hello\"}],\n      max_tokens=256,\n  ) as stream:\n      for text in stream.text_stream:\n          print(text, end=\"\", flush=True)\n  ```\n</CodeGroup>\n\n```json Response theme={null}\nevent: message_start\ndata: {\"type\": \"message_start\", \"message\": {\"id\": \"msg_1nZdL29xx5MUA1yADyHTEsnR8uuvGzszyY\", \"type\": \"message\", \"role\": \"assistant\", \"content\": [], \"model\": \"claude-sonnet-4-5-20250929\", \"stop_reason\": null, \"stop_sequence\": null, \"usage\": {\"input_tokens\": 25, \"output_tokens\": 1}}}\n\nevent: content_block_start\ndata: {\"type\": \"content_block_start\", \"index\": 0, \"content_block\": {\"type\": \"text\", \"text\": \"\"}}\n\nevent: ping\ndata: {\"type\": \"ping\"}\n\nevent: content_block_delta\ndata: {\"type\": \"content_block_delta\", \"index\": 0, \"delta\": {\"type\": \"text_delta\", \"text\": \"Hello\"}}\n\nevent: content_block_delta\ndata: {\"type\": \"content_block_delta\", \"index\": 0, \"delta\": {\"type\": \"text_delta\", \"text\": \"!\"}}\n\nevent: content_block_stop\ndata: {\"type\": \"content_block_stop\", \"index\": 0}\n\nevent: message_delta\ndata: {\"type\": \"message_delta\", \"delta\": {\"stop_reason\": \"end_turn\", \"stop_sequence\":null}, \"usage\": {\"output_tokens\": 15}}\n\nevent: message_stop\ndata: {\"type\": \"message_stop\"}\n\n```\n\n### Streaming request with tool use\n\n<Tip>\n  Tool use now supports fine-grained streaming for parameter values as a beta feature. For more details, see [Fine-grained tool streaming](/en/docs/agents-and-tools/tool-use/fine-grained-tool-streaming).\n</Tip>\n\nIn this request, we ask Claude to use a tool to tell us the weather.\n\n<CodeGroup>\n  ```bash Shell theme={null}\n    curl https://api.anthropic.com/v1/messages \\\n      -H \"content-type: application/json\" \\\n      -H \"x-api-key: $ANTHROPIC_API_KEY\" \\\n      -H \"anthropic-version: 2023-06-01\" \\\n      -d '{\n        \"model\": \"claude-sonnet-4-5\",\n        \"max_tokens\": 1024,\n        \"tools\": [\n          {\n            \"name\": \"get_weather\",\n            \"description\": \"Get the current weather in a given location\",\n            \"input_schema\": {\n              \"type\": \"object\",\n              \"properties\": {\n                \"location\": {\n                  \"type\": \"string\",\n                  \"description\": \"The city and state, e.g. San Francisco, CA\"\n                }\n              },\n              \"required\": [\"location\"]\n            }\n          }\n        ],\n        \"tool_choice\": {\"type\": \"any\"},\n        \"messages\": [\n          {\n            \"role\": \"user\",\n            \"content\": \"What is the weather like in San Francisco?\"\n          }\n        ],\n        \"stream\": true\n      }'\n  ```\n\n  ```python Python theme={null}\n  import anthropic\n\n  client = anthropic.Anthropic()\n\n  tools = [\n      {\n          \"name\": \"get_weather\",\n          \"description\": \"Get the current weather in a given location\",\n          \"input_schema\": {\n              \"type\": \"object\",\n              \"properties\": {\n                  \"location\": {\n                      \"type\": \"string\",\n                      \"description\": \"The city and state, e.g. San Francisco, CA\"\n                  }\n              },\n              \"required\": [\"location\"]\n          }\n      }\n  ]\n\n  with client.messages.stream(\n      model=\"claude-sonnet-4-5\",\n      max_tokens=1024,\n      tools=tools,\n      tool_choice={\"type\": \"any\"},\n      messages=[\n          {\n              \"role\": \"user\",\n              \"content\": \"What is the weather like in San Francisco?\"\n          }\n      ],\n  ) as stream:\n      for text in stream.text_stream:\n          print(text, end=\"\", flush=True)\n  ```\n</CodeGroup>\n\n```json Response theme={null}\nevent: message_start\ndata: {\"type\":\"message_start\",\"message\":{\"id\":\"msg_014p7gG3wDgGV9EUtLvnow3U\",\"type\":\"message\",\"role\":\"assistant\",\"model\":\"claude-sonnet-4-5-20250929\",\"stop_sequence\":null,\"usage\":{\"input_tokens\":472,\"output_tokens\":2},\"content\":[],\"stop_reason\":null}}\n\nevent: content_block_start\ndata: {\"type\":\"content_block_start\",\"index\":0,\"content_block\":{\"type\":\"text\",\"text\":\"\"}}\n\nevent: ping\ndata: {\"type\": \"ping\"}\n\nevent: content_block_delta\ndata: {\"type\":\"content_block_delta\",\"index\":0,\"delta\":{\"type\":\"text_delta\",\"text\":\"Okay\"}}\n\nevent: content_block_delta\ndata: {\"type\":\"content_block_delta\",\"index\":0,\"delta\":{\"type\":\"text_delta\",\"text\":\",\"}}\n\nevent: content_block_delta\ndata: {\"type\":\"content_block_delta\",\"index\":0,\"delta\":{\"type\":\"text_delta\",\"text\":\" let\"}}\n\nevent: content_block_delta\ndata: {\"type\":\"content_block_delta\",\"index\":0,\"delta\":{\"type\":\"text_delta\",\"text\":\"'s\"}}\n\nevent: content_block_delta\ndata: {\"type\":\"content_block_delta\",\"index\":0,\"delta\":{\"type\":\"text_delta\",\"text\":\" check\"}}\n\nevent: content_block_delta\ndata: {\"type\":\"content_block_delta\",\"index\":0,\"delta\":{\"type\":\"text_delta\",\"text\":\" the\"}}\n\nevent: content_block_delta\ndata: {\"type\":\"content_block_delta\",\"index\":0,\"delta\":{\"type\":\"text_delta\",\"text\":\" weather\"}}\n\nevent: content_block_delta\ndata: {\"type\":\"content_block_delta\",\"index\":0,\"delta\":{\"type\":\"text_delta\",\"text\":\" for\"}}\n\nevent: content_block_delta\ndata: {\"type\":\"content_block_delta\",\"index\":0,\"delta\":{\"type\":\"text_delta\",\"text\":\" San\"}}\n\nevent: content_block_delta\ndata: {\"type\":\"content_block_delta\",\"index\":0,\"delta\":{\"type\":\"text_delta\",\"text\":\" Francisco\"}}\n\nevent: content_block_delta\ndata: {\"type\":\"content_block_delta\",\"index\":0,\"delta\":{\"type\":\"text_delta\",\"text\":\",\"}}\n\nevent: content_block_delta\ndata: {\"type\":\"content_block_delta\",\"index\":0,\"delta\":{\"type\":\"text_delta\",\"text\":\" CA\"}}\n\nevent: content_block_delta\ndata: {\"type\":\"content_block_delta\",\"index\":0,\"delta\":{\"type\":\"text_delta\",\"text\":\":\"}}\n\nevent: content_block_stop\ndata: {\"type\":\"content_block_stop\",\"index\":0}\n\nevent: content_block_start\ndata: {\"type\":\"content_block_start\",\"index\":1,\"content_block\":{\"type\":\"tool_use\",\"id\":\"toolu_01T1x1fJ34qAmk2tNTrN7Up6\",\"name\":\"get_weather\",\"input\":{}}}\n\nevent: content_block_delta\ndata: {\"type\":\"content_block_delta\",\"index\":1,\"delta\":{\"type\":\"input_json_delta\",\"partial_json\":\"\"}}\n\nevent: content_block_delta\ndata: {\"type\":\"content_block_delta\",\"index\":1,\"delta\":{\"type\":\"input_json_delta\",\"partial_json\":\"{\\\"location\\\":\"}}\n\nevent: content_block_delta\ndata: {\"type\":\"content_block_delta\",\"index\":1,\"delta\":{\"type\":\"input_json_delta\",\"partial_json\":\" \\\"San\"}}\n\nevent: content_block_delta\ndata: {\"type\":\"content_block_delta\",\"index\":1,\"delta\":{\"type\":\"input_json_delta\",\"partial_json\":\" Francisc\"}}\n\nevent: content_block_delta\ndata: {\"type\":\"content_block_delta\",\"index\":1,\"delta\":{\"type\":\"input_json_delta\",\"partial_json\":\"o,\"}}\n\nevent: content_block_delta\ndata: {\"type\":\"content_block_delta\",\"index\":1,\"delta\":{\"type\":\"input_json_delta\",\"partial_json\":\" CA\\\"\"}}\n\nevent: content_block_delta\ndata: {\"type\":\"content_block_delta\",\"index\":1,\"delta\":{\"type\":\"input_json_delta\",\"partial_json\":\", \"}}\n\nevent: content_block_delta\ndata: {\"type\":\"content_block_delta\",\"index\":1,\"delta\":{\"type\":\"input_json_delta\",\"partial_json\":\"\\\"unit\\\": \\\"fah\"}}\n\nevent: content_block_delta\ndata: {\"type\":\"content_block_delta\",\"index\":1,\"delta\":{\"type\":\"input_json_delta\",\"partial_json\":\"renheit\\\"}\"}}\n\nevent: content_block_stop\ndata: {\"type\":\"content_block_stop\",\"index\":1}\n\nevent: message_delta\ndata: {\"type\":\"message_delta\",\"delta\":{\"stop_reason\":\"tool_use\",\"stop_sequence\":null},\"usage\":{\"output_tokens\":89}}\n\nevent: message_stop\ndata: {\"type\":\"message_stop\"}\n```\n\n### Streaming request with extended thinking\n\nIn this request, we enable extended thinking with streaming to see Claude's step-by-step reasoning.\n\n<CodeGroup>\n  ```bash Shell theme={null}\n  curl https://api.anthropic.com/v1/messages \\\n       --header \"x-api-key: $ANTHROPIC_API_KEY\" \\\n       --header \"anthropic-version: 2023-06-01\" \\\n       --header \"content-type: application/json\" \\\n       --data \\\n  '{\n      \"model\": \"claude-sonnet-4-5\",\n      \"max_tokens\": 20000,\n      \"stream\": true,\n      \"thinking\": {\n          \"type\": \"enabled\",\n          \"budget_tokens\": 16000\n      },\n      \"messages\": [\n          {\n              \"role\": \"user\",\n              \"content\": \"What is 27 * 453?\"\n          }\n      ]\n  }'\n  ```\n\n  ```python Python theme={null}\n  import anthropic\n\n  client = anthropic.Anthropic()\n\n  with client.messages.stream(\n      model=\"claude-sonnet-4-5\",\n      max_tokens=20000,\n      thinking={\n          \"type\": \"enabled\",\n          \"budget_tokens\": 16000\n      },\n      messages=[\n          {\n              \"role\": \"user\",\n              \"content\": \"What is 27 * 453?\"\n          }\n      ],\n  ) as stream:\n      for event in stream:\n          if event.type == \"content_block_delta\":\n              if event.delta.type == \"thinking_delta\":\n                  print(event.delta.thinking, end=\"\", flush=True)\n              elif event.delta.type == \"text_delta\":\n                  print(event.delta.text, end=\"\", flush=True)\n  ```\n</CodeGroup>\n\n```json Response theme={null}\nevent: message_start\ndata: {\"type\": \"message_start\", \"message\": {\"id\": \"msg_01...\", \"type\": \"message\", \"role\": \"assistant\", \"content\": [], \"model\": \"claude-sonnet-4-5-20250929\", \"stop_reason\": null, \"stop_sequence\": null}}\n\nevent: content_block_start\ndata: {\"type\": \"content_block_start\", \"index\": 0, \"content_block\": {\"type\": \"thinking\", \"thinking\": \"\"}}\n\nevent: content_block_delta\ndata: {\"type\": \"content_block_delta\", \"index\": 0, \"delta\": {\"type\": \"thinking_delta\", \"thinking\": \"Let me solve this step by step:\\n\\n1. First break down 27 * 453\"}}\n\nevent: content_block_delta\ndata: {\"type\": \"content_block_delta\", \"index\": 0, \"delta\": {\"type\": \"thinking_delta\", \"thinking\": \"\\n2. 453 = 400 + 50 + 3\"}}\n\nevent: content_block_delta\ndata: {\"type\": \"content_block_delta\", \"index\": 0, \"delta\": {\"type\": \"thinking_delta\", \"thinking\": \"\\n3. 27 * 400 = 10,800\"}}\n\nevent: content_block_delta\ndata: {\"type\": \"content_block_delta\", \"index\": 0, \"delta\": {\"type\": \"thinking_delta\", \"thinking\": \"\\n4. 27 * 50 = 1,350\"}}\n\nevent: content_block_delta\ndata: {\"type\": \"content_block_delta\", \"index\": 0, \"delta\": {\"type\": \"thinking_delta\", \"thinking\": \"\\n5. 27 * 3 = 81\"}}\n\nevent: content_block_delta\ndata: {\"type\": \"content_block_delta\", \"index\": 0, \"delta\": {\"type\": \"thinking_delta\", \"thinking\": \"\\n6. 10,800 + 1,350 + 81 = 12,231\"}}\n\nevent: content_block_delta\ndata: {\"type\": \"content_block_delta\", \"index\": 0, \"delta\": {\"type\": \"signature_delta\", \"signature\": \"EqQBCgIYAhIM1gbcDa9GJwZA2b3hGgxBdjrkzLoky3dl1pkiMOYds...\"}}\n\nevent: content_block_stop\ndata: {\"type\": \"content_block_stop\", \"index\": 0}\n\nevent: content_block_start\ndata: {\"type\": \"content_block_start\", \"index\": 1, \"content_block\": {\"type\": \"text\", \"text\": \"\"}}\n\nevent: content_block_delta\ndata: {\"type\": \"content_block_delta\", \"index\": 1, \"delta\": {\"type\": \"text_delta\", \"text\": \"27 * 453 = 12,231\"}}\n\nevent: content_block_stop\ndata: {\"type\": \"content_block_stop\", \"index\": 1}\n\nevent: message_delta\ndata: {\"type\": \"message_delta\", \"delta\": {\"stop_reason\": \"end_turn\", \"stop_sequence\": null}}\n\nevent: message_stop\ndata: {\"type\": \"message_stop\"}\n```\n\n### Streaming request with web search tool use\n\nIn this request, we ask Claude to search the web for current weather information.\n\n<CodeGroup>\n  ```bash Shell theme={null}\n  curl https://api.anthropic.com/v1/messages \\\n       --header \"x-api-key: $ANTHROPIC_API_KEY\" \\\n       --header \"anthropic-version: 2023-06-01\" \\\n       --header \"content-type: application/json\" \\\n       --data \\\n  '{\n      \"model\": \"claude-sonnet-4-5\",\n      \"max_tokens\": 1024,\n      \"stream\": true,\n      \"tools\": [\n          {\n              \"type\": \"web_search_20250305\",\n              \"name\": \"web_search\",\n              \"max_uses\": 5\n          }\n      ],\n      \"messages\": [\n          {\n              \"role\": \"user\",\n              \"content\": \"What is the weather like in New York City today?\"\n          }\n      ]\n  }'\n  ```\n\n  ```python Python theme={null}\n  import anthropic\n\n  client = anthropic.Anthropic()\n\n  with client.messages.stream(\n      model=\"claude-sonnet-4-5\",\n      max_tokens=1024,\n      tools=[\n          {\n              \"type\": \"web_search_20250305\",\n              \"name\": \"web_search\",\n              \"max_uses\": 5\n          }\n      ],\n      messages=[\n          {\n              \"role\": \"user\",\n              \"content\": \"What is the weather like in New York City today?\"\n          }\n      ],\n  ) as stream:\n      for text in stream.text_stream:\n          print(text, end=\"\", flush=True)\n  ```\n</CodeGroup>\n\n```json Response theme={null}\nevent: message_start\ndata: {\"type\":\"message_start\",\"message\":{\"id\":\"msg_01G...\",\"type\":\"message\",\"role\":\"assistant\",\"model\":\"claude-sonnet-4-5-20250929\",\"content\":[],\"stop_reason\":null,\"stop_sequence\":null,\"usage\":{\"input_tokens\":2679,\"cache_creation_input_tokens\":0,\"cache_read_input_tokens\":0,\"output_tokens\":3}}}\n\nevent: content_block_start\ndata: {\"type\":\"content_block_start\",\"index\":0,\"content_block\":{\"type\":\"text\",\"text\":\"\"}}\n\nevent: content_block_delta\ndata: {\"type\":\"content_block_delta\",\"index\":0,\"delta\":{\"type\":\"text_delta\",\"text\":\"I'll check\"}}\n\nevent: content_block_delta\ndata: {\"type\":\"content_block_delta\",\"index\":0,\"delta\":{\"type\":\"text_delta\",\"text\":\" the current weather in New York City for you\"}}\n\nevent: ping\ndata: {\"type\": \"ping\"}\n\nevent: content_block_delta\ndata: {\"type\":\"content_block_delta\",\"index\":0,\"delta\":{\"type\":\"text_delta\",\"text\":\".\"}}\n\nevent: content_block_stop\ndata: {\"type\":\"content_block_stop\",\"index\":0}\n\nevent: content_block_start\ndata: {\"type\":\"content_block_start\",\"index\":1,\"content_block\":{\"type\":\"server_tool_use\",\"id\":\"srvtoolu_014hJH82Qum7Td6UV8gDXThB\",\"name\":\"web_search\",\"input\":{}}}\n\nevent: content_block_delta\ndata: {\"type\":\"content_block_delta\",\"index\":1,\"delta\":{\"type\":\"input_json_delta\",\"partial_json\":\"\"}}\n\nevent: content_block_delta\ndata: {\"type\":\"content_block_delta\",\"index\":1,\"delta\":{\"type\":\"input_json_delta\",\"partial_json\":\"{\\\"query\"}}\n\nevent: content_block_delta\ndata: {\"type\":\"content_block_delta\",\"index\":1,\"delta\":{\"type\":\"input_json_delta\",\"partial_json\":\"\\\":\"}}\n\nevent: content_block_delta\ndata: {\"type\":\"content_block_delta\",\"index\":1,\"delta\":{\"type\":\"input_json_delta\",\"partial_json\":\" \\\"weather\"}}\n\nevent: content_block_delta\ndata: {\"type\":\"content_block_delta\",\"index\":1,\"delta\":{\"type\":\"input_json_delta\",\"partial_json\":\" NY\"}}\n\nevent: content_block_delta\ndata: {\"type\":\"content_block_delta\",\"index\":1,\"delta\":{\"type\":\"input_json_delta\",\"partial_json\":\"C to\"}}\n\nevent: content_block_delta\ndata: {\"type\":\"content_block_delta\",\"index\":1,\"delta\":{\"type\":\"input_json_delta\",\"partial_json\":\"day\\\"}\"}}\n\nevent: content_block_stop\ndata: {\"type\":\"content_block_stop\",\"index\":1 }\n\nevent: content_block_start\ndata: {\"type\":\"content_block_start\",\"index\":2,\"content_block\":{\"type\":\"web_search_tool_result\",\"tool_use_id\":\"srvtoolu_014hJH82Qum7Td6UV8gDXThB\",\"content\":[{\"type\":\"web_search_result\",\"title\":\"Weather in New York City in May 2025 (New York) - detailed Weather Forecast for a month\",\"url\":\"https://world-weather.info/forecast/usa/new_york/may-2025/\",\"encrypted_content\":\"Ev0DCioIAxgCIiQ3NmU4ZmI4OC1k...\",\"page_age\":null},...]}}\n\nevent: content_block_stop\ndata: {\"type\":\"content_block_stop\",\"index\":2}\n\nevent: content_block_start\ndata: {\"type\":\"content_block_start\",\"index\":3,\"content_block\":{\"type\":\"text\",\"text\":\"\"}}\n\nevent: content_block_delta\ndata: {\"type\":\"content_block_delta\",\"index\":3,\"delta\":{\"type\":\"text_delta\",\"text\":\"Here's the current weather information for New York\"}}\n\nevent: content_block_delta\ndata: {\"type\":\"content_block_delta\",\"index\":3,\"delta\":{\"type\":\"text_delta\",\"text\":\" City:\\n\\n# Weather\"}}\n\nevent: content_block_delta\ndata: {\"type\":\"content_block_delta\",\"index\":3,\"delta\":{\"type\":\"text_delta\",\"text\":\" in New York City\"}}\n\nevent: content_block_delta\ndata: {\"type\":\"content_block_delta\",\"index\":3,\"delta\":{\"type\":\"text_delta\",\"text\":\"\\n\\n\"}}\n\n...\n\nevent: content_block_stop\ndata: {\"type\":\"content_block_stop\",\"index\":17}\n\nevent: message_delta\ndata: {\"type\":\"message_delta\",\"delta\":{\"stop_reason\":\"end_turn\",\"stop_sequence\":null},\"usage\":{\"input_tokens\":10682,\"cache_creation_input_tokens\":0,\"cache_read_input_tokens\":0,\"output_tokens\":510,\"server_tool_use\":{\"web_search_requests\":1}}}\n\nevent: message_stop\ndata: {\"type\":\"message_stop\"}\n```\n\n## Error recovery\n\nWhen a streaming request is interrupted due to network issues, timeouts, or other errors, you can recover by resuming from where the stream was interrupted. This approach saves you from re-processing the entire response.\n\nThe basic recovery strategy involves:\n\n1. **Capture the partial response**: Save all content that was successfully received before the error occurred\n2. **Construct a continuation request**: Create a new API request that includes the partial assistant response as the beginning of a new assistant message\n3. **Resume streaming**: Continue receiving the rest of the response from where it was interrupted\n\n### Error recovery best practices\n\n1. **Use SDK features**: Leverage the SDK's built-in message accumulation and error handling capabilities\n2. **Handle content types**: Be aware that messages can contain multiple content blocks (`text`, `tool_use`, `thinking`). Tool use and extended thinking blocks cannot be partially recovered. You can resume streaming from the most recent text block.",
  "content_length": 23621
}