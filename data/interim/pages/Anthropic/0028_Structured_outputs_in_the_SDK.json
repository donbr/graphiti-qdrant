{
  "title": "Structured outputs in the SDK",
  "source_url": "https://docs.claude.com/en/docs/agent-sdk/structured-outputs",
  "content": "Get validated JSON results from agent workflows\n\nGet structured, validated JSON from agent workflows. The Agent SDK supports structured outputs through JSON Schemas, ensuring your agents return data in exactly the format you need.\n\n<Note>\n  **When to use structured outputs**\n\n  Use structured outputs when you need validated JSON after an agent completes a multi-turn workflow with tools (file searches, command execution, web research, etc.).\n\n  For single API calls without tool use, see [API Structured Outputs](/en/docs/build-with-claude/structured-outputs).\n</Note>\n\n## Why use structured outputs\n\nStructured outputs provide reliable, type-safe integration with your applications:\n\n* **Validated structure**: Always receive valid JSON matching your schema\n* **Simplified integration**: No parsing or validation code needed\n* **Type safety**: Use with TypeScript or Python type hints for end-to-end safety\n* **Clean separation**: Define output requirements separately from task instructions\n* **Tool autonomy**: Agent chooses which tools to use while guaranteeing output format\n\n<Tabs>\n  <Tab title=\"TypeScript\">\n    ## Quick start\n\n    ```typescript  theme={null}\n    import { query } from '@anthropic-ai/claude-agent-sdk'\n\n    const schema = {\n      type: 'object',\n      properties: {\n        company_name: { type: 'string' },\n        founded_year: { type: 'number' },\n        headquarters: { type: 'string' }\n      },\n      required: ['company_name']\n    }\n\n    for await (const message of query({\n      prompt: 'Research Anthropic and provide key company information',\n      options: {\n        outputFormat: {\n          type: 'json_schema',\n          schema: schema\n        }\n      }\n    })) {\n      if (message.type === 'result' && message.structured_output) {\n        console.log(message.structured_output)\n        // { company_name: \"Anthropic\", founded_year: 2021, headquarters: \"San Francisco, CA\" }\n      }\n    }\n    ```\n\n    ## Defining schemas with Zod\n\n    For TypeScript projects, use Zod for type-safe schema definition and validation:\n\n    ```typescript  theme={null}\n    import { z } from 'zod'\n    import { zodToJsonSchema } from 'zod-to-json-schema'\n\n    // Define schema with Zod\n    const AnalysisResult = z.object({\n      summary: z.string(),\n      issues: z.array(z.object({\n        severity: z.enum(['low', 'medium', 'high']),\n        description: z.string(),\n        file: z.string()\n      })),\n      score: z.number().min(0).max(100)\n    })\n\n    type AnalysisResult = z.infer<typeof AnalysisResult>\n\n    // Convert to JSON Schema\n    const schema = zodToJsonSchema(AnalysisResult, { $refStrategy: 'root' })\n\n    // Use in query\n    for await (const message of query({\n      prompt: 'Analyze the codebase for security issues',\n      options: {\n        outputFormat: {\n          type: 'json_schema',\n          schema: schema\n        }\n      }\n    })) {\n      if (message.type === 'result' && message.structured_output) {\n        // Validate and get fully typed result\n        const parsed = AnalysisResult.safeParse(message.structured_output)\n        if (parsed.success) {\n          const data: AnalysisResult = parsed.data\n          console.log(`Score: ${data.score}`)\n          console.log(`Found ${data.issues.length} issues`)\n          data.issues.forEach(issue => {\n            console.log(`[${issue.severity}] ${issue.file}: ${issue.description}`)\n          })\n        }\n      }\n    }\n    ```\n\n    **Benefits of Zod:**\n\n    * Full TypeScript type inference\n    * Runtime validation with `safeParse()`\n    * Better error messages\n    * Composable schemas\n  </Tab>\n\n  <Tab title=\"Python\">\n    ## Quick start\n\n    ```python  theme={null}\n    from claude_agent_sdk import query\n\n    schema = {\n        \"type\": \"object\",\n        \"properties\": {\n            \"company_name\": {\"type\": \"string\"},\n            \"founded_year\": {\"type\": \"number\"},\n            \"headquarters\": {\"type\": \"string\"}\n        },\n        \"required\": [\"company_name\"]\n    }\n\n    async for message in query(\n        prompt=\"Research Anthropic and provide key company information\",\n        options={\n            \"output_format\": {\n                \"type\": \"json_schema\",\n                \"schema\": schema\n            }\n        }\n    ):\n        if hasattr(message, 'structured_output'):\n            print(message.structured_output)\n            # {'company_name': 'Anthropic', 'founded_year': 2021, 'headquarters': 'San Francisco, CA'}\n    ```\n\n    ## Defining schemas with Pydantic\n\n    For Python projects, use Pydantic for type-safe schema definition and validation:\n\n    ```python  theme={null}\n    from pydantic import BaseModel\n    from claude_agent_sdk import query\n\n    class Issue(BaseModel):\n        severity: str  # 'low', 'medium', 'high'\n        description: str\n        file: str\n\n    class AnalysisResult(BaseModel):\n        summary: str\n        issues: list[Issue]\n        score: int\n\n    # Use in query\n    async for message in query(\n        prompt=\"Analyze the codebase for security issues\",\n        options={\n            \"output_format\": {\n                \"type\": \"json_schema\",\n                \"schema\": AnalysisResult.model_json_schema()\n            }\n        }\n    ):\n        if hasattr(message, 'structured_output'):\n            # Validate and get fully typed result\n            result = AnalysisResult.model_validate(message.structured_output)\n            print(f\"Score: {result.score}\")\n            print(f\"Found {len(result.issues)} issues\")\n            for issue in result.issues:\n                print(f\"[{issue.severity}] {issue.file}: {issue.description}\")\n    ```\n\n    **Benefits of Pydantic:**\n\n    * Full Python type hints\n    * Runtime validation with `model_validate()`\n    * Better error messages\n    * Data class functionality\n  </Tab>\n</Tabs>\n\n## How structured outputs work\n\n<Steps>\n  <Step title=\"Define your JSON schema\">\n    Create a JSON Schema that describes the structure you want the agent to return. The schema uses standard JSON Schema format.\n  </Step>\n\n  <Step title=\"Add the outputFormat parameter\">\n    Include the `outputFormat` parameter in your query options with `type: \"json_schema\"` and your schema definition.\n  </Step>\n\n  <Step title=\"Run your query\">\n    The agent uses any tools it needs to complete the task (file operations, commands, web search, etc.).\n  </Step>\n\n  <Step title=\"Access validated output\">\n    The agent's final result will be valid JSON matching your schema, available in `message.structured_output`.\n  </Step>\n</Steps>\n\n## Supported JSON Schema features\n\nThe Agent SDK supports the same JSON Schema features and limitations as [API Structured Outputs](/en/docs/build-with-claude/structured-outputs#json-schema-limitations).\n\nKey supported features:\n\n* All basic types: object, array, string, integer, number, boolean, null\n* `enum`, `const`, `required`, `additionalProperties` (must be `false`)\n* String formats: `date-time`, `date`, `email`, `uri`, `uuid`, etc.\n* `$ref`, `$def`, and `definitions`\n\nFor complete details on supported features, limitations, and regex pattern support, see [JSON Schema limitations](/en/docs/build-with-claude/structured-outputs#json-schema-limitations) in the API documentation.\n\n## Example: TODO tracking agent\n\nHere's a complete example showing an agent that searches code for TODOs and extracts git blame information:\n\n<CodeGroup>\n  ```typescript TypeScript theme={null}\n  import { query } from '@anthropic-ai/claude-agent-sdk'\n\n  // Define structure for TODO extraction\n  const todoSchema = {\n    type: 'object',\n    properties: {\n      todos: {\n        type: 'array',\n        items: {\n          type: 'object',\n          properties: {\n            text: { type: 'string' },\n            file: { type: 'string' },\n            line: { type: 'number' },\n            author: { type: 'string' },\n            date: { type: 'string' }\n          },\n          required: ['text', 'file', 'line']\n        }\n      },\n      total_count: { type: 'number' }\n    },\n    required: ['todos', 'total_count']\n  }\n\n  // Agent uses Grep to find TODOs, Bash to get git blame info\n  for await (const message of query({\n    prompt: 'Find all TODO comments in src/ and identify who added them',\n    options: {\n      outputFormat: {\n        type: 'json_schema',\n        schema: todoSchema\n      }\n    }\n  })) {\n    if (message.type === 'result' && message.structured_output) {\n      const data = message.structured_output\n      console.log(`Found ${data.total_count} TODOs`)\n      data.todos.forEach(todo => {\n        console.log(`${todo.file}:${todo.line} - ${todo.text}`)\n        if (todo.author) {\n          console.log(`  Added by ${todo.author} on ${todo.date}`)\n        }\n      })\n    }\n  }\n  ```\n\n  ```python Python theme={null}\n  from claude_agent_sdk import query\n\n  # Define structure for TODO extraction\n  todo_schema = {\n      \"type\": \"object\",\n      \"properties\": {\n          \"todos\": {\n              \"type\": \"array\",\n              \"items\": {\n                  \"type\": \"object\",\n                  \"properties\": {\n                      \"text\": {\"type\": \"string\"},\n                      \"file\": {\"type\": \"string\"},\n                      \"line\": {\"type\": \"number\"},\n                      \"author\": {\"type\": \"string\"},\n                      \"date\": {\"type\": \"string\"}\n                  },\n                  \"required\": [\"text\", \"file\", \"line\"]\n              }\n          },\n          \"total_count\": {\"type\": \"number\"}\n      },\n      \"required\": [\"todos\", \"total_count\"]\n  }\n\n  # Agent uses Grep to find TODOs, Bash to get git blame info\n  async for message in query(\n      prompt=\"Find all TODO comments in src/ and identify who added them\",\n      options={\n          \"output_format\": {\n              \"type\": \"json_schema\",\n              \"schema\": todo_schema\n          }\n      }\n  ):\n      if hasattr(message, 'structured_output'):\n          data = message.structured_output\n          print(f\"Found {data['total_count']} TODOs\")\n          for todo in data['todos']:\n              print(f\"{todo['file']}:{todo['line']} - {todo['text']}\")\n              if 'author' in todo:\n                  print(f\"  Added by {todo['author']} on {todo['date']}\")\n  ```\n</CodeGroup>\n\nThe agent autonomously uses the right tools (Grep, Bash) to gather information and returns validated data.\n\n## Error handling\n\nIf the agent cannot produce valid output matching your schema, you'll receive an error result:\n\n```typescript  theme={null}\nfor await (const msg of query({\n  prompt: 'Analyze the data',\n  options: {\n    outputFormat: {\n      type: 'json_schema',\n      schema: mySchema\n    }\n  }\n})) {\n  if (msg.type === 'result') {\n    if (msg.subtype === 'success' && msg.structured_output) {\n      console.log(msg.structured_output)\n    } else if (msg.subtype === 'error_max_structured_output_retries') {\n      console.error('Could not produce valid output')\n    }\n  }\n}\n```\n\n## Related resources\n\n* [JSON Schema documentation](https://json-schema.org/)\n* [API Structured Outputs](/en/docs/build-with-claude/structured-outputs) - For single API calls\n* [Custom tools](/en/docs/agent-sdk/custom-tools) - Define tools for your agents\n* [TypeScript SDK reference](/en/docs/agent-sdk/typescript) - Full TypeScript API\n* [Python SDK reference](/en/docs/agent-sdk/python) - Full Python API",
  "content_length": 11255
}