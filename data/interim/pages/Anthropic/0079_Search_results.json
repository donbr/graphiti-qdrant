{
  "title": "Search results",
  "source_url": "https://docs.claude.com/en/docs/build-with-claude/search-results",
  "content": "Enable natural citations for RAG applications by providing search results with source attribution\n\nSearch result content blocks enable natural citations with proper source attribution, bringing web search-quality citations to your custom applications. This feature is particularly powerful for RAG (Retrieval-Augmented Generation) applications where you need Claude to cite sources accurately.\n\nThe search results feature is available on the following models:\n\n* Claude Opus 4.1 (`claude-opus-4-1-20250805`)\n* Claude Opus 4 (`claude-opus-4-20250514`)\n* Claude Sonnet 4.5 (`claude-sonnet-4-5-20250929`)\n* Claude Sonnet 4 (`claude-sonnet-4-20250514`)\n* Claude Sonnet 3.7 ([deprecated](/en/docs/about-claude/model-deprecations)) (`claude-3-7-sonnet-20250219`)\n* Claude 3.5 Haiku (`claude-3-5-haiku-20241022`)\n\n## Key benefits\n\n* **Natural citations** - Achieve the same citation quality as web search for any content\n* **Flexible integration** - Use in tool returns for dynamic RAG or as top-level content for pre-fetched data\n* **Proper source attribution** - Each result includes source and title information for clear attribution\n* **No document workarounds needed** - Eliminates the need for document-based workarounds\n* **Consistent citation format** - Matches the citation quality and format of Claude's web search functionality\n\n## How it works\n\nSearch results can be provided in two ways:\n\n1. **From tool calls** - Your custom tools return search results, enabling dynamic RAG applications\n2. **As top-level content** - You provide search results directly in user messages for pre-fetched or cached content\n\nIn both cases, Claude can automatically cite information from the search results with proper source attribution.\n\n### Search result schema\n\nSearch results use the following structure:\n\n```json  theme={null}\n{\n  \"type\": \"search_result\",\n  \"source\": \"https://example.com/article\",  // Required: Source URL or identifier\n  \"title\": \"Article Title\",                  // Required: Title of the result\n  \"content\": [                               // Required: Array of text blocks\n    {\n      \"type\": \"text\",\n      \"text\": \"The actual content of the search result...\"\n    }\n  ],\n  \"citations\": {                             // Optional: Citation configuration\n    \"enabled\": true                          // Enable/disable citations for this result\n  }\n}\n```\n\n### Required fields\n\n| Field     | Type   | Description                                           |\n| --------- | ------ | ----------------------------------------------------- |\n| `type`    | string | Must be `\"search_result\"`                             |\n| `source`  | string | The source URL or identifier for the content          |\n| `title`   | string | A descriptive title for the search result             |\n| `content` | array  | An array of text blocks containing the actual content |\n\n### Optional fields\n\n| Field           | Type   | Description                                            |\n| --------------- | ------ | ------------------------------------------------------ |\n| `citations`     | object | Citation configuration with `enabled` boolean field    |\n| `cache_control` | object | Cache control settings (e.g., `{\"type\": \"ephemeral\"}`) |\n\nEach item in the `content` array must be a text block with:\n\n* `type`: Must be `\"text\"`\n* `text`: The actual text content (non-empty string)\n\n## Method 1: Search results from tool calls\n\nThe most powerful use case is returning search results from your custom tools. This enables dynamic RAG applications where tools fetch and return relevant content with automatic citations.\n\n### Example: Knowledge base tool\n\n<CodeGroup>\n  ```python Python theme={null}\n  from anthropic import Anthropic\n  from anthropic.types import (\n      MessageParam,\n      TextBlockParam,\n      SearchResultBlockParam,\n      ToolResultBlockParam\n  )\n\n  client = Anthropic()\n\n  # Define a knowledge base search tool\n  knowledge_base_tool = {\n      \"name\": \"search_knowledge_base\",\n      \"description\": \"Search the company knowledge base for information\",\n      \"input_schema\": {\n          \"type\": \"object\",\n          \"properties\": {\n              \"query\": {\n                  \"type\": \"string\",\n                  \"description\": \"The search query\"\n              }\n          },\n          \"required\": [\"query\"]\n      }\n  }\n\n  # Function to handle the tool call\n  def search_knowledge_base(query):\n      # Your search logic here\n      # Returns search results in the correct format\n      return [\n          SearchResultBlockParam(\n              type=\"search_result\",\n              source=\"https://docs.company.com/product-guide\",\n              title=\"Product Configuration Guide\",\n              content=[\n                  TextBlockParam(\n                      type=\"text\",\n                      text=\"To configure the product, navigate to Settings > Configuration. The default timeout is 30 seconds, but can be adjusted between 10-120 seconds based on your needs.\"\n                  )\n              ],\n              citations={\"enabled\": True}\n          ),\n          SearchResultBlockParam(\n              type=\"search_result\",\n              source=\"https://docs.company.com/troubleshooting\",\n              title=\"Troubleshooting Guide\",\n              content=[\n                  TextBlockParam(\n                      type=\"text\",\n                      text=\"If you encounter timeout errors, first check the configuration settings. Common causes include network latency and incorrect timeout values.\"\n                  )\n              ],\n              citations={\"enabled\": True}\n          )\n      ]\n\n  # Create a message with the tool\n  response = client.messages.create(\n      model=\"claude-sonnet-4-5\",  # Works with all supported models\n      max_tokens=1024,\n      tools=[knowledge_base_tool],\n      messages=[\n          MessageParam(\n              role=\"user\",\n              content=\"How do I configure the timeout settings?\"\n          )\n      ]\n  )\n\n  # When Claude calls the tool, provide the search results\n  if response.content[0].type == \"tool_use\":\n      tool_result = search_knowledge_base(response.content[0].input[\"query\"])\n      \n      # Send the tool result back\n      final_response = client.messages.create(\n          model=\"claude-sonnet-4-5\",  # Works with all supported models\n          max_tokens=1024,\n          messages=[\n              MessageParam(role=\"user\", content=\"How do I configure the timeout settings?\"),\n              MessageParam(role=\"assistant\", content=response.content),\n              MessageParam(\n                  role=\"user\",\n                  content=[\n                      ToolResultBlockParam(\n                          type=\"tool_result\",\n                          tool_use_id=response.content[0].id,\n                          content=tool_result  # Search results go here\n                      )\n                  ]\n              )\n          ]\n      )\n  ```\n\n  ```typescript TypeScript theme={null}\n  import { Anthropic } from '@anthropic-ai/sdk';\n\n  const anthropic = new Anthropic();\n\n  // Define a knowledge base search tool\n  const knowledgeBaseTool = {\n    name: \"search_knowledge_base\",\n    description: \"Search the company knowledge base for information\",\n    input_schema: {\n      type: \"object\",\n      properties: {\n        query: {\n          type: \"string\",\n          description: \"The search query\"\n        }\n      },\n      required: [\"query\"]\n    }\n  };\n\n  // Function to handle the tool call\n  function searchKnowledgeBase(query: string) {\n    // Your search logic here\n    // Returns search results in the correct format\n    return [\n      {\n        type: \"search_result\" as const,\n        source: \"https://docs.company.com/product-guide\",\n        title: \"Product Configuration Guide\",\n        content: [\n          {\n            type: \"text\" as const,\n            text: \"To configure the product, navigate to Settings > Configuration. The default timeout is 30 seconds, but can be adjusted between 10-120 seconds based on your needs.\"\n          }\n        ],\n        citations: { enabled: true }\n      },\n      {\n        type: \"search_result\" as const,\n        source: \"https://docs.company.com/troubleshooting\",\n        title: \"Troubleshooting Guide\",\n        content: [\n          {\n            type: \"text\" as const,\n            text: \"If you encounter timeout errors, first check the configuration settings. Common causes include network latency and incorrect timeout values.\"\n          }\n        ],\n        citations: { enabled: true }\n      }\n    ];\n  }\n\n  // Create a message with the tool\n  const response = await anthropic.messages.create({\n    model: \"claude-sonnet-4-5\", // Works with all supported models\n    max_tokens: 1024,\n    tools: [knowledgeBaseTool],\n    messages: [\n      {\n        role: \"user\",\n        content: \"How do I configure the timeout settings?\"\n      }\n    ]\n  });\n\n  // Handle tool use and provide results\n  if (response.content[0].type === \"tool_use\") {\n    const toolResult = searchKnowledgeBase(response.content[0].input.query);\n    \n    const finalResponse = await anthropic.messages.create({\n      model: \"claude-sonnet-4-5\", // Works with all supported models\n      max_tokens: 1024,\n        messages: [\n        { role: \"user\", content: \"How do I configure the timeout settings?\" },\n        { role: \"assistant\", content: response.content },\n        {\n          role: \"user\",\n          content: [\n            {\n              type: \"tool_result\" as const,\n              tool_use_id: response.content[0].id,\n              content: toolResult  // Search results go here\n            }\n          ]\n        }\n      ]\n    });\n  }\n  ```\n</CodeGroup>\n\n## Method 2: Search results as top-level content\n\nYou can also provide search results directly in user messages. This is useful for:\n\n* Pre-fetched content from your search infrastructure\n* Cached search results from previous queries\n* Content from external search services\n* Testing and development\n\n### Example: Direct search results\n\n<CodeGroup>\n  ```python Python theme={null}\n  from anthropic import Anthropic\n  from anthropic.types import (\n      MessageParam,\n      TextBlockParam,\n      SearchResultBlockParam\n  )\n\n  client = Anthropic()\n\n  # Provide search results directly in the user message\n  response = client.messages.create(\n      model=\"claude-sonnet-4-5\",\n      max_tokens=1024,\n      messages=[\n          MessageParam(\n              role=\"user\",\n              content=[\n                  SearchResultBlockParam(\n                      type=\"search_result\",\n                      source=\"https://docs.company.com/api-reference\",\n                      title=\"API Reference - Authentication\",\n                      content=[\n                          TextBlockParam(\n                              type=\"text\",\n                              text=\"All API requests must include an API key in the Authorization header. Keys can be generated from the dashboard. Rate limits: 1000 requests per hour for standard tier, 10000 for premium.\"\n                          )\n                      ],\n                      citations={\"enabled\": True}\n                  ),\n                  SearchResultBlockParam(\n                      type=\"search_result\",\n                      source=\"https://docs.company.com/quickstart\",\n                      title=\"Getting Started Guide\",\n                      content=[\n                          TextBlockParam(\n                              type=\"text\",\n                              text=\"To get started: 1) Sign up for an account, 2) Generate an API key from the dashboard, 3) Install our SDK using pip install company-sdk, 4) Initialize the client with your API key.\"\n                          )\n                      ],\n                      citations={\"enabled\": True}\n                  ),\n                  TextBlockParam(\n                      type=\"text\",\n                      text=\"Based on these search results, how do I authenticate API requests and what are the rate limits?\"\n                  )\n              ]\n          )\n      ]\n  )\n\n  print(response.model_dump_json(indent=2))\n  ```\n\n  ```typescript TypeScript theme={null}\n  import { Anthropic } from '@anthropic-ai/sdk';\n\n  const anthropic = new Anthropic();\n\n  // Provide search results directly in the user message\n  const response = await anthropic.messages.create({\n    model: \"claude-sonnet-4-5\",\n    max_tokens: 1024,\n    messages: [\n      {\n        role: \"user\",\n        content: [\n          {\n            type: \"search_result\" as const,\n            source: \"https://docs.company.com/api-reference\",\n            title: \"API Reference - Authentication\",\n            content: [\n              {\n                type: \"text\" as const,\n                text: \"All API requests must include an API key in the Authorization header. Keys can be generated from the dashboard. Rate limits: 1000 requests per hour for standard tier, 10000 for premium.\"\n              }\n            ],\n            citations: { enabled: true }\n          },\n          {\n            type: \"search_result\" as const,\n            source: \"https://docs.company.com/quickstart\",\n            title: \"Getting Started Guide\",\n            content: [\n              {\n                type: \"text\" as const,\n                text: \"To get started: 1) Sign up for an account, 2) Generate an API key from the dashboard, 3) Install our SDK using pip install company-sdk, 4) Initialize the client with your API key.\"\n              }\n            ],\n            citations: { enabled: true }\n          },\n          {\n            type: \"text\" as const,\n            text: \"Based on these search results, how do I authenticate API requests and what are the rate limits?\"\n          }\n        ]\n      }\n    ]\n  });\n\n  console.log(response);\n  ```\n\n  ```bash Shell theme={null}\n  #!/bin/sh\n  curl https://api.anthropic.com/v1/messages \\\n       --header \"x-api-key: $ANTHROPIC_API_KEY\" \\\n       --header \"anthropic-version: 2023-06-01\" \\\n       --header \"content-type: application/json\" \\\n       --data \\\n  '{\n      \"model\": \"claude-sonnet-4-5\",\n      \"max_tokens\": 1024,\n      \"messages\": [\n          {\n              \"role\": \"user\",\n              \"content\": [\n                  {\n                      \"type\": \"search_result\",\n                      \"source\": \"https://docs.company.com/api-reference\",\n                      \"title\": \"API Reference - Authentication\",\n                      \"content\": [\n                          {\n                              \"type\": \"text\",\n                              \"text\": \"All API requests must include an API key in the Authorization header. Keys can be generated from the dashboard. Rate limits: 1000 requests per hour for standard tier, 10000 for premium.\"\n                          }\n                      ],\n                      \"citations\": {\n                          \"enabled\": true\n                      }\n                  },\n                  {\n                      \"type\": \"search_result\",\n                      \"source\": \"https://docs.company.com/quickstart\",\n                      \"title\": \"Getting Started Guide\",\n                      \"content\": [\n                          {\n                              \"type\": \"text\",\n                              \"text\": \"To get started: 1) Sign up for an account, 2) Generate an API key from the dashboard, 3) Install our SDK using pip install company-sdk, 4) Initialize the client with your API key.\"\n                          }\n                      ],\n                      \"citations\": {\n                          \"enabled\": true\n                      }\n                  },\n                  {\n                      \"type\": \"text\",\n                      \"text\": \"Based on these search results, how do I authenticate API requests and what are the rate limits?\"\n                  }\n              ]\n          }\n      ]\n  }'\n  ```\n</CodeGroup>\n\n## Claude's response with citations\n\nRegardless of how search results are provided, Claude automatically includes citations when using information from them:\n\n```json  theme={null}\n{\n  \"role\": \"assistant\",\n  \"content\": [\n    {\n      \"type\": \"text\",\n      \"text\": \"To authenticate API requests, you need to include an API key in the Authorization header\",\n      \"citations\": [\n        {\n          \"type\": \"search_result_location\",\n          \"source\": \"https://docs.company.com/api-reference\",\n          \"title\": \"API Reference - Authentication\",\n          \"cited_text\": \"All API requests must include an API key in the Authorization header\",\n          \"search_result_index\": 0,\n          \"start_block_index\": 0,\n          \"end_block_index\": 0\n        }\n      ]\n    },\n    {\n      \"type\": \"text\",\n      \"text\": \". You can generate API keys from your dashboard\",\n      \"citations\": [\n        {\n          \"type\": \"search_result_location\",\n          \"source\": \"https://docs.company.com/api-reference\",\n          \"title\": \"API Reference - Authentication\",\n          \"cited_text\": \"Keys can be generated from the dashboard\",\n          \"search_result_index\": 0,\n          \"start_block_index\": 0,\n          \"end_block_index\": 0\n        }\n      ]\n    },\n    {\n      \"type\": \"text\",\n      \"text\": \". The rate limits are 1,000 requests per hour for the standard tier and 10,000 requests per hour for the premium tier.\",\n      \"citations\": [\n        {\n          \"type\": \"search_result_location\",\n          \"source\": \"https://docs.company.com/api-reference\",\n          \"title\": \"API Reference - Authentication\",\n          \"cited_text\": \"Rate limits: 1000 requests per hour for standard tier, 10000 for premium\",\n          \"search_result_index\": 0,\n          \"start_block_index\": 0,\n          \"end_block_index\": 0\n        }\n      ]\n    }\n  ]\n}\n```\n\n### Citation fields\n\nEach citation includes:\n\n| Field                 | Type           | Description                                                   |\n| --------------------- | -------------- | ------------------------------------------------------------- |\n| `type`                | string         | Always `\"search_result_location\"` for search result citations |\n| `source`              | string         | The source from the original search result                    |\n| `title`               | string or null | The title from the original search result                     |\n| `cited_text`          | string         | The exact text being cited                                    |\n| `search_result_index` | integer        | Index of the search result (0-based)                          |\n| `start_block_index`   | integer        | Starting position in the content array                        |\n| `end_block_index`     | integer        | Ending position in the content array                          |\n\nNote: The `search_result_index` refers to the index of the search result content block (0-based), regardless of how the search results were provided (tool call or top-level content).\n\n## Multiple content blocks\n\nSearch results can contain multiple text blocks in the `content` array:\n\n```json  theme={null}\n{\n  \"type\": \"search_result\",\n  \"source\": \"https://docs.company.com/api-guide\",\n  \"title\": \"API Documentation\",\n  \"content\": [\n    {\n      \"type\": \"text\",\n      \"text\": \"Authentication: All API requests require an API key.\"\n    },\n    {\n      \"type\": \"text\",\n      \"text\": \"Rate Limits: The API allows 1000 requests per hour per key.\"\n    },\n    {\n      \"type\": \"text\",\n      \"text\": \"Error Handling: The API returns standard HTTP status codes.\"\n    }\n  ]\n}\n```\n\nClaude can cite specific blocks using the `start_block_index` and `end_block_index` fields.\n\n## Advanced usage\n\n### Combining both methods\n\nYou can use both tool-based and top-level search results in the same conversation:\n\n```python  theme={null}\n# First message with top-level search results\nmessages = [\n    MessageParam(\n        role=\"user\",\n        content=[\n            SearchResultBlockParam(\n                type=\"search_result\",\n                source=\"https://docs.company.com/overview\",\n                title=\"Product Overview\",\n                content=[\n                    TextBlockParam(type=\"text\", text=\"Our product helps teams collaborate...\")\n                ],\n                citations={\"enabled\": True}\n            ),\n            TextBlockParam(\n                type=\"text\",\n                text=\"Tell me about this product and search for pricing information\"\n            )\n        ]\n    )\n]\n\n# Claude might respond and call a tool to search for pricing\n# Then you provide tool results with more search results\n```\n\n### Combining with other content types\n\nBoth methods support mixing search results with other content:\n\n```python  theme={null}\n# In tool results\ntool_result = [\n    SearchResultBlockParam(\n        type=\"search_result\",\n        source=\"https://docs.company.com/guide\",\n        title=\"User Guide\",\n        content=[TextBlockParam(type=\"text\", text=\"Configuration details...\")],\n        citations={\"enabled\": True}\n    ),\n    TextBlockParam(\n        type=\"text\",\n        text=\"Additional context: This applies to version 2.0 and later.\"\n    )\n]\n\n# In top-level content\nuser_content = [\n    SearchResultBlockParam(\n        type=\"search_result\",\n        source=\"https://research.com/paper\",\n        title=\"Research Paper\",\n        content=[TextBlockParam(type=\"text\", text=\"Key findings...\")],\n        citations={\"enabled\": True}\n    ),\n    {\n        \"type\": \"image\",\n        \"source\": {\"type\": \"url\", \"url\": \"https://example.com/chart.png\"}\n    },\n    TextBlockParam(\n        type=\"text\",\n        text=\"How does the chart relate to the research findings?\"\n    )\n]\n```\n\n### Cache control\n\nAdd cache control for better performance:\n\n```json  theme={null}\n{\n  \"type\": \"search_result\",\n  \"source\": \"https://docs.company.com/guide\",\n  \"title\": \"User Guide\",\n  \"content\": [{\"type\": \"text\", \"text\": \"...\"}],\n  \"cache_control\": {\n    \"type\": \"ephemeral\"\n  }\n}\n```\n\n### Citation control\n\nBy default, citations are disabled for search results. You can enable citations by explicitly setting the `citations` configuration:\n\n```json  theme={null}\n{\n  \"type\": \"search_result\",\n  \"source\": \"https://docs.company.com/guide\",\n  \"title\": \"User Guide\",\n  \"content\": [{\"type\": \"text\", \"text\": \"Important documentation...\"}],\n  \"citations\": {\n    \"enabled\": true  // Enable citations for this result\n  }\n}\n```\n\nWhen `citations.enabled` is set to `true`, Claude will include citation references when using information from the search result. This enables:\n\n* Natural citations for your custom RAG applications\n* Source attribution when interfacing with proprietary knowledge bases\n* Web search-quality citations for any custom tool that returns search results\n\nIf the `citations` field is omitted, citations are disabled by default.\n\n<Warning>\n  Citations are all-or-nothing: either all search results in a request must have citations enabled, or all must have them disabled. Mixing search results with different citation settings will result in an error. If you need to disable citations for some sources, you must disable them for all search results in that request.\n</Warning>\n\n## Best practices\n\n### For tool-based search (Method 1)\n\n* **Dynamic content**: Use for real-time searches and dynamic RAG applications\n* **Error handling**: Return appropriate messages when searches fail\n* **Result limits**: Return only the most relevant results to avoid context overflow\n\n### For top-level search (Method 2)\n\n* **Pre-fetched content**: Use when you already have search results\n* **Batch processing**: Ideal for processing multiple search results at once\n* **Testing**: Great for testing citation behavior with known content\n\n### General best practices\n\n1. **Structure results effectively**\n   * Use clear, permanent source URLs\n   * Provide descriptive titles\n   * Break long content into logical text blocks\n\n2. **Maintain consistency**\n   * Use consistent source formats across your application\n   * Ensure titles accurately reflect content\n   * Keep formatting consistent\n\n3. **Handle errors gracefully**\n   ```python  theme={null}\n   def search_with_fallback(query):\n       try:\n           results = perform_search(query)\n           if not results:\n               return {\"type\": \"text\", \"text\": \"No results found.\"}\n           return format_as_search_results(results)\n       except Exception as e:\n           return {\"type\": \"text\", \"text\": f\"Search error: {str(e)}\"}\n   ```\n\n## Limitations\n\n* Search result content blocks are available on Claude API and Google Cloud's Vertex AI\n* Only text content is supported within search results (no images or other media)\n* The `content` array must contain at least one text block",
  "content_length": 24595
}