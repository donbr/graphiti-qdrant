{
  "title": "Bash tool",
  "source_url": "https://docs.claude.com/en/docs/agents-and-tools/tool-use/bash-tool",
  "content": "The bash tool enables Claude to execute shell commands in a persistent bash session, allowing system operations, script execution, and command-line automation.\n\n## Overview\n\nThe bash tool provides Claude with:\n\n* Persistent bash session that maintains state\n* Ability to run any shell command\n* Access to environment variables and working directory\n* Command chaining and scripting capabilities\n\n## Model compatibility\n\n| Model                                                                                   | Tool Version    |\n| --------------------------------------------------------------------------------------- | --------------- |\n| Claude 4 models and Sonnet 3.7 ([deprecated](/en/docs/about-claude/model-deprecations)) | `bash_20250124` |\n\n<Warning>\n  Older tool versions are not guaranteed to be backwards-compatible with newer models. Always use the tool version that corresponds to your model version.\n</Warning>\n\n## Use cases\n\n* **Development workflows**: Run build commands, tests, and development tools\n* **System automation**: Execute scripts, manage files, automate tasks\n* **Data processing**: Process files, run analysis scripts, manage datasets\n* **Environment setup**: Install packages, configure environments\n\n## Quick start\n\n<CodeGroup>\n  ```python Python theme={null}\n  import anthropic\n\n  client = anthropic.Anthropic()\n\n  response = client.messages.create(\n      model=\"claude-sonnet-4-5\",\n      max_tokens=1024,\n      tools=[\n          {\n              \"type\": \"bash_20250124\",\n              \"name\": \"bash\"\n          }\n      ],\n      messages=[\n          {\"role\": \"user\", \"content\": \"List all Python files in the current directory.\"}\n      ]\n  )\n  ```\n\n  ```bash Shell theme={null}\n  curl https://api.anthropic.com/v1/messages \\\n    -H \"content-type: application/json\" \\\n    -H \"x-api-key: $ANTHROPIC_API_KEY\" \\\n    -H \"anthropic-version: 2023-06-01\" \\\n    -d '{\n      \"model\": \"claude-sonnet-4-5\",\n      \"max_tokens\": 1024,\n      \"tools\": [\n        {\n          \"type\": \"bash_20250124\",\n          \"name\": \"bash\"\n        }\n      ],\n      \"messages\": [\n        {\n          \"role\": \"user\",\n          \"content\": \"List all Python files in the current directory.\"\n        }\n      ]\n    }'\n  ```\n</CodeGroup>\n\n## How it works\n\nThe bash tool maintains a persistent session:\n\n1. Claude determines what command to run\n2. You execute the command in a bash shell\n3. Return the output (stdout and stderr) to Claude\n4. Session state persists between commands (environment variables, working directory)\n\n## Parameters\n\n| Parameter | Required | Description                               |\n| --------- | -------- | ----------------------------------------- |\n| `command` | Yes\\*    | The bash command to run                   |\n| `restart` | No       | Set to `true` to restart the bash session |\n\n\\*Required unless using `restart`\n\n<Accordion title=\"Example usage\">\n  ```json  theme={null}\n  // Run a command\n  {\n    \"command\": \"ls -la *.py\"\n  }\n\n  // Restart the session\n  {\n    \"restart\": true\n  }\n  ```\n</Accordion>\n\n## Example: Multi-step automation\n\nClaude can chain commands to complete complex tasks:\n\n```python  theme={null}\n# User request\n\"Install the requests library and create a simple Python script that fetches a joke from an API, then run it.\"\n\n# Claude's tool uses:\n# 1. Install package\n{\"command\": \"pip install requests\"}\n\n# 2. Create script\n{\"command\": \"cat > fetch_joke.py << 'EOF'\\nimport requests\\nresponse = requests.get('https://official-joke-api.appspot.com/random_joke')\\njoke = response.json()\\nprint(f\\\"Setup: {joke['setup']}\\\")\\nprint(f\\\"Punchline: {joke['punchline']}\\\")\\nEOF\"}\n\n# 3. Run script\n{\"command\": \"python fetch_joke.py\"}\n```\n\nThe session maintains state between commands, so files created in step 2 are available in step 3.\n\n***\n\n## Implement the bash tool\n\nThe bash tool is implemented as a schema-less tool. When using this tool, you don't need to provide an input schema as with other tools; the schema is built into Claude's model and can't be modified.\n\n<Steps>\n  <Step title=\"Set up a bash environment\">\n    Create a persistent bash session that Claude can interact with:\n\n    ```python  theme={null}\n    import subprocess\n    import threading\n    import queue\n\n    class BashSession:\n        def __init__(self):\n            self.process = subprocess.Popen(\n                ['/bin/bash'],\n                stdin=subprocess.PIPE,\n                stdout=subprocess.PIPE,\n                stderr=subprocess.PIPE,\n                text=True,\n                bufsize=0\n            )\n            self.output_queue = queue.Queue()\n            self.error_queue = queue.Queue()\n            self._start_readers()\n    ```\n  </Step>\n\n  <Step title=\"Handle command execution\">\n    Create a function to execute commands and capture output:\n\n    ```python  theme={null}\n    def execute_command(self, command):\n        # Send command to bash\n        self.process.stdin.write(command + '\\n')\n        self.process.stdin.flush()\n        \n        # Capture output with timeout\n        output = self._read_output(timeout=10)\n        return output\n    ```\n  </Step>\n\n  <Step title=\"Process Claude's tool calls\">\n    Extract and execute commands from Claude's responses:\n\n    ```python  theme={null}\n    for content in response.content:\n        if content.type == \"tool_use\" and content.name == \"bash\":\n            if content.input.get(\"restart\"):\n                bash_session.restart()\n                result = \"Bash session restarted\"\n            else:\n                command = content.input.get(\"command\")\n                result = bash_session.execute_command(command)\n            \n            # Return result to Claude\n            tool_result = {\n                \"type\": \"tool_result\",\n                \"tool_use_id\": content.id,\n                \"content\": result\n            }\n    ```\n  </Step>\n\n  <Step title=\"Implement safety measures\">\n    Add validation and restrictions:\n\n    ```python  theme={null}\n    def validate_command(command):\n        # Block dangerous commands\n        dangerous_patterns = ['rm -rf /', 'format', ':(){:|:&};:']\n        for pattern in dangerous_patterns:\n            if pattern in command:\n                return False, f\"Command contains dangerous pattern: {pattern}\"\n        \n        # Add more validation as needed\n        return True, None\n    ```\n  </Step>\n</Steps>\n\n### Handle errors\n\nWhen implementing the bash tool, handle various error scenarios:\n\n<AccordionGroup>\n  <Accordion title=\"Command execution timeout\">\n    If a command takes too long to execute:\n\n    ```json  theme={null}\n    {\n      \"role\": \"user\",\n      \"content\": [\n        {\n          \"type\": \"tool_result\",\n          \"tool_use_id\": \"toolu_01A09q90qw90lq917835lq9\",\n          \"content\": \"Error: Command timed out after 30 seconds\",\n          \"is_error\": true\n        }\n      ]\n    }\n    ```\n  </Accordion>\n\n  <Accordion title=\"Command not found\">\n    If a command doesn't exist:\n\n    ```json  theme={null}\n    {\n      \"role\": \"user\",\n      \"content\": [\n        {\n          \"type\": \"tool_result\",\n          \"tool_use_id\": \"toolu_01A09q90qw90lq917835lq9\",\n          \"content\": \"bash: nonexistentcommand: command not found\",\n          \"is_error\": true\n        }\n      ]\n    }\n    ```\n  </Accordion>\n\n  <Accordion title=\"Permission denied\">\n    If there are permission issues:\n\n    ```json  theme={null}\n    {\n      \"role\": \"user\",\n      \"content\": [\n        {\n          \"type\": \"tool_result\",\n          \"tool_use_id\": \"toolu_01A09q90qw90lq917835lq9\",\n          \"content\": \"bash: /root/sensitive-file: Permission denied\",\n          \"is_error\": true\n        }\n      ]\n    }\n    ```\n  </Accordion>\n</AccordionGroup>\n\n### Follow implementation best practices\n\n<AccordionGroup>\n  <Accordion title=\"Use command timeouts\">\n    Implement timeouts to prevent hanging commands:\n\n    ```python  theme={null}\n    def execute_with_timeout(command, timeout=30):\n        try:\n            result = subprocess.run(\n                command, \n                shell=True, \n                capture_output=True, \n                text=True, \n                timeout=timeout\n            )\n            return result.stdout + result.stderr\n        except subprocess.TimeoutExpired:\n            return f\"Command timed out after {timeout} seconds\"\n    ```\n  </Accordion>\n\n  <Accordion title=\"Maintain session state\">\n    Keep the bash session persistent to maintain environment variables and working directory:\n\n    ```python  theme={null}\n    # Commands run in the same session maintain state\n    commands = [\n        \"cd /tmp\",\n        \"echo 'Hello' > test.txt\",\n        \"cat test.txt\"  # This works because we're still in /tmp\n    ]\n    ```\n  </Accordion>\n\n  <Accordion title=\"Handle large outputs\">\n    Truncate very large outputs to prevent token limit issues:\n\n    ```python  theme={null}\n    def truncate_output(output, max_lines=100):\n        lines = output.split('\\n')\n        if len(lines) > max_lines:\n            truncated = '\\n'.join(lines[:max_lines])\n            return f\"{truncated}\\n\\n... Output truncated ({len(lines)} total lines) ...\"\n        return output\n    ```\n  </Accordion>\n\n  <Accordion title=\"Log all commands\">\n    Keep an audit trail of executed commands:\n\n    ```python  theme={null}\n    import logging\n\n    def log_command(command, output, user_id):\n        logging.info(f\"User {user_id} executed: {command}\")\n        logging.info(f\"Output: {output[:200]}...\")  # Log first 200 chars\n    ```\n  </Accordion>\n\n  <Accordion title=\"Sanitize outputs\">\n    Remove sensitive information from command outputs:\n\n    ```python  theme={null}\n    def sanitize_output(output):\n        # Remove potential secrets or credentials\n        import re\n        # Example: Remove AWS credentials\n        output = re.sub(r'aws_access_key_id\\s*=\\s*\\S+', 'aws_access_key_id=***', output)\n        output = re.sub(r'aws_secret_access_key\\s*=\\s*\\S+', 'aws_secret_access_key=***', output)\n        return output\n    ```\n  </Accordion>\n</AccordionGroup>\n\n## Security\n\n<Warning>\n  The bash tool provides direct system access. Implement these essential safety measures:\n\n  * Running in isolated environments (Docker/VM)\n  * Implementing command filtering and allowlists\n  * Setting resource limits (CPU, memory, disk)\n  * Logging all executed commands\n</Warning>\n\n### Key recommendations\n\n* Use `ulimit` to set resource constraints\n* Filter dangerous commands (`sudo`, `rm -rf`, etc.)\n* Run with minimal user permissions\n* Monitor and log all command execution\n\n## Pricing\n\nThe bash tool adds **245 input tokens** to your API calls.\n\nAdditional tokens are consumed by:\n\n* Command outputs (stdout/stderr)\n* Error messages\n* Large file contents\n\nSee [tool use pricing](/en/docs/agents-and-tools/tool-use/overview#pricing) for complete pricing details.\n\n## Common patterns\n\n### Development workflows\n\n* Running tests: `pytest && coverage report`\n* Building projects: `npm install && npm run build`\n* Git operations: `git status && git add . && git commit -m \"message\"`\n\n### File operations\n\n* Processing data: `wc -l *.csv && ls -lh *.csv`\n* Searching files: `find . -name \"*.py\" | xargs grep \"pattern\"`\n* Creating backups: `tar -czf backup.tar.gz ./data`\n\n### System tasks\n\n* Checking resources: `df -h && free -m`\n* Process management: `ps aux | grep python`\n* Environment setup: `export PATH=$PATH:/new/path && echo $PATH`\n\n## Limitations\n\n* **No interactive commands**: Cannot handle `vim`, `less`, or password prompts\n* **No GUI applications**: Command-line only\n* **Session scope**: Persists within conversation, lost between API calls\n* **Output limits**: Large outputs may be truncated\n* **No streaming**: Results returned after completion\n\n## Combining with other tools\n\nThe bash tool is most powerful when combined with the [text editor](/en/docs/agents-and-tools/tool-use/text-editor-tool) and other tools.\n\n## Next steps\n\n<CardGroup cols={2}>\n  <Card title=\"Tool use overview\" icon=\"toolbox\" href=\"/en/docs/agents-and-tools/tool-use/overview\">\n    Learn about tool use with Claude\n  </Card>\n\n  <Card title=\"Text editor tool\" icon=\"file-code\" href=\"/en/docs/agents-and-tools/tool-use/text-editor-tool\">\n    View and edit text files with Claude\n  </Card>\n</CardGroup>",
  "content_length": 12183
}