{
  "title": "Custom Tools",
  "source_url": "https://docs.claude.com/en/docs/agent-sdk/custom-tools",
  "content": "Build and integrate custom tools to extend Claude Agent SDK functionality\n\nCustom tools allow you to extend Claude Code's capabilities with your own functionality through in-process MCP servers, enabling Claude to interact with external services, APIs, or perform specialized operations.\n\n## Creating Custom Tools\n\nUse the `createSdkMcpServer` and `tool` helper functions to define type-safe custom tools:\n\n<CodeGroup>\n  ```typescript TypeScript theme={null}\n  import { query, tool, createSdkMcpServer } from \"@anthropic-ai/claude-agent-sdk\";\n  import { z } from \"zod\";\n\n  // Create an SDK MCP server with custom tools\n  const customServer = createSdkMcpServer({\n    name: \"my-custom-tools\",\n    version: \"1.0.0\",\n    tools: [\n      tool(\n        \"get_weather\",\n        \"Get current temperature for a location using coordinates\",\n        {\n          latitude: z.number().describe(\"Latitude coordinate\"),\n          longitude: z.number().describe(\"Longitude coordinate\")\n        },\n        async (args) => {\n          const response = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${args.latitude}&longitude=${args.longitude}&current=temperature_2m&temperature_unit=fahrenheit`);\n          const data = await response.json();\n\n          return {\n            content: [{\n              type: \"text\",\n              text: `Temperature: ${data.current.temperature_2m}°F`\n            }]\n          };\n        }\n      )\n    ]\n  });\n  ```\n\n  ```python Python theme={null}\n  from claude_agent_sdk import tool, create_sdk_mcp_server, ClaudeSDKClient, ClaudeAgentOptions\n  from typing import Any\n  import aiohttp\n\n  # Define a custom tool using the @tool decorator\n  @tool(\"get_weather\", \"Get current temperature for a location using coordinates\", {\"latitude\": float, \"longitude\": float})\n  async def get_weather(args: dict[str, Any]) -> dict[str, Any]:\n      # Call weather API\n      async with aiohttp.ClientSession() as session:\n          async with session.get(\n              f\"https://api.open-meteo.com/v1/forecast?latitude={args['latitude']}&longitude={args['longitude']}&current=temperature_2m&temperature_unit=fahrenheit\"\n          ) as response:\n              data = await response.json()\n\n      return {\n          \"content\": [{\n              \"type\": \"text\",\n              \"text\": f\"Temperature: {data['current']['temperature_2m']}°F\"\n          }]\n      }\n\n  # Create an SDK MCP server with the custom tool\n  custom_server = create_sdk_mcp_server(\n      name=\"my-custom-tools\",\n      version=\"1.0.0\",\n      tools=[get_weather]  # Pass the decorated function\n  )\n  ```\n</CodeGroup>\n\n## Using Custom Tools\n\nPass the custom server to the `query` function via the `mcpServers` option as a dictionary/object.\n\n<Note>\n  **Important:** Custom MCP tools require streaming input mode. You must use an async generator/iterable for the `prompt` parameter - a simple string will not work with MCP servers.\n</Note>\n\n### Tool Name Format\n\nWhen MCP tools are exposed to Claude, their names follow a specific format:\n\n* Pattern: `mcp__{server_name}__{tool_name}`\n* Example: A tool named `get_weather` in server `my-custom-tools` becomes `mcp__my-custom-tools__get_weather`\n\n### Configuring Allowed Tools\n\nYou can control which tools Claude can use via the `allowedTools` option:\n\n<CodeGroup>\n  ```typescript TypeScript theme={null}\n  import { query } from \"@anthropic-ai/claude-agent-sdk\";\n\n  // Use the custom tools in your query with streaming input\n  async function* generateMessages() {\n    yield {\n      type: \"user\" as const,\n      message: {\n        role: \"user\" as const,\n        content: \"What's the weather in San Francisco?\"\n      }\n    };\n  }\n\n  for await (const message of query({\n    prompt: generateMessages(),  // Use async generator for streaming input\n    options: {\n      mcpServers: {\n        \"my-custom-tools\": customServer  // Pass as object/dictionary, not array\n      },\n      // Optionally specify which tools Claude can use\n      allowedTools: [\n        \"mcp__my-custom-tools__get_weather\",  // Allow the weather tool\n        // Add other tools as needed\n      ],\n      maxTurns: 3\n    }\n  })) {\n    if (message.type === \"result\" && message.subtype === \"success\") {\n      console.log(message.result);\n    }\n  }\n  ```\n\n  ```python Python theme={null}\n  from claude_agent_sdk import ClaudeSDKClient, ClaudeAgentOptions\n  import asyncio\n\n  # Use the custom tools with Claude\n  options = ClaudeAgentOptions(\n      mcp_servers={\"my-custom-tools\": custom_server},\n      allowed_tools=[\n          \"mcp__my-custom-tools__get_weather\",  # Allow the weather tool\n          # Add other tools as needed\n      ]\n  )\n\n  async def main():\n      async with ClaudeSDKClient(options=options) as client:\n          await client.query(\"What's the weather in San Francisco?\")\n\n          # Extract and print response\n          async for msg in client.receive_response():\n              print(msg)\n\n  asyncio.run(main())\n  ```\n</CodeGroup>\n\n### Multiple Tools Example\n\nWhen your MCP server has multiple tools, you can selectively allow them:\n\n<CodeGroup>\n  ```typescript TypeScript theme={null}\n  const multiToolServer = createSdkMcpServer({\n    name: \"utilities\",\n    version: \"1.0.0\",\n    tools: [\n      tool(\"calculate\", \"Perform calculations\", { /* ... */ }, async (args) => { /* ... */ }),\n      tool(\"translate\", \"Translate text\", { /* ... */ }, async (args) => { /* ... */ }),\n      tool(\"search_web\", \"Search the web\", { /* ... */ }, async (args) => { /* ... */ })\n    ]\n  });\n\n  // Allow only specific tools with streaming input\n  async function* generateMessages() {\n    yield {\n      type: \"user\" as const,\n      message: {\n        role: \"user\" as const,\n        content: \"Calculate 5 + 3 and translate 'hello' to Spanish\"\n      }\n    };\n  }\n\n  for await (const message of query({\n    prompt: generateMessages(),  // Use async generator for streaming input\n    options: {\n      mcpServers: {\n        utilities: multiToolServer\n      },\n      allowedTools: [\n        \"mcp__utilities__calculate\",   // Allow calculator\n        \"mcp__utilities__translate\",   // Allow translator\n        // \"mcp__utilities__search_web\" is NOT allowed\n      ]\n    }\n  })) {\n    // Process messages\n  }\n  ```\n\n  ```python Python theme={null}\n  from claude_agent_sdk import ClaudeSDKClient, ClaudeAgentOptions, tool, create_sdk_mcp_server\n  from typing import Any\n  import asyncio\n\n  # Define multiple tools using the @tool decorator\n  @tool(\"calculate\", \"Perform calculations\", {\"expression\": str})\n  async def calculate(args: dict[str, Any]) -> dict[str, Any]:\n      result = eval(args[\"expression\"])  # Use safe eval in production\n      return {\"content\": [{\"type\": \"text\", \"text\": f\"Result: {result}\"}]}\n\n  @tool(\"translate\", \"Translate text\", {\"text\": str, \"target_lang\": str})\n  async def translate(args: dict[str, Any]) -> dict[str, Any]:\n      # Translation logic here\n      return {\"content\": [{\"type\": \"text\", \"text\": f\"Translated: {args['text']}\"}]}\n\n  @tool(\"search_web\", \"Search the web\", {\"query\": str})\n  async def search_web(args: dict[str, Any]) -> dict[str, Any]:\n      # Search logic here\n      return {\"content\": [{\"type\": \"text\", \"text\": f\"Search results for: {args['query']}\"}]}\n\n  multi_tool_server = create_sdk_mcp_server(\n      name=\"utilities\",\n      version=\"1.0.0\",\n      tools=[calculate, translate, search_web]  # Pass decorated functions\n  )\n\n  # Allow only specific tools with streaming input\n  async def message_generator():\n      yield {\n          \"type\": \"user\",\n          \"message\": {\n              \"role\": \"user\",\n              \"content\": \"Calculate 5 + 3 and translate 'hello' to Spanish\"\n          }\n      }\n\n  async for message in query(\n      prompt=message_generator(),  # Use async generator for streaming input\n      options=ClaudeAgentOptions(\n          mcp_servers={\"utilities\": multi_tool_server},\n          allowed_tools=[\n              \"mcp__utilities__calculate\",   # Allow calculator\n              \"mcp__utilities__translate\",   # Allow translator\n              # \"mcp__utilities__search_web\" is NOT allowed\n          ]\n      )\n  ):\n      if hasattr(message, 'result'):\n          print(message.result)\n  ```\n</CodeGroup>\n\n## Type Safety with Python\n\nThe `@tool` decorator supports various schema definition approaches for type safety:\n\n<CodeGroup>\n  ```typescript TypeScript theme={null}\n  import { z } from \"zod\";\n\n  tool(\n    \"process_data\",\n    \"Process structured data with type safety\",\n    {\n      // Zod schema defines both runtime validation and TypeScript types\n      data: z.object({\n        name: z.string(),\n        age: z.number().min(0).max(150),\n        email: z.string().email(),\n        preferences: z.array(z.string()).optional()\n      }),\n      format: z.enum([\"json\", \"csv\", \"xml\"]).default(\"json\")\n    },\n    async (args) => {\n      // args is fully typed based on the schema\n      // TypeScript knows: args.data.name is string, args.data.age is number, etc.\n      console.log(`Processing ${args.data.name}'s data as ${args.format}`);\n      \n      // Your processing logic here\n      return {\n        content: [{\n          type: \"text\",\n          text: `Processed data for ${args.data.name}`\n        }]\n      };\n    }\n  )\n  ```\n\n  ```python Python theme={null}\n  from typing import Any\n\n  # Simple type mapping - recommended for most cases\n  @tool(\n      \"process_data\",\n      \"Process structured data with type safety\",\n      {\n          \"name\": str,\n          \"age\": int,\n          \"email\": str,\n          \"preferences\": list  # Optional parameters can be handled in the function\n      }\n  )\n  async def process_data(args: dict[str, Any]) -> dict[str, Any]:\n      # Access arguments with type hints for IDE support\n      name = args[\"name\"]\n      age = args[\"age\"]\n      email = args[\"email\"]\n      preferences = args.get(\"preferences\", [])\n      \n      print(f\"Processing {name}'s data (age: {age})\")\n      \n      return {\n          \"content\": [{\n              \"type\": \"text\",\n              \"text\": f\"Processed data for {name}\"\n          }]\n      }\n\n  # For more complex schemas, you can use JSON Schema format\n  @tool(\n      \"advanced_process\",\n      \"Process data with advanced validation\",\n      {\n          \"type\": \"object\",\n          \"properties\": {\n              \"name\": {\"type\": \"string\"},\n              \"age\": {\"type\": \"integer\", \"minimum\": 0, \"maximum\": 150},\n              \"email\": {\"type\": \"string\", \"format\": \"email\"},\n              \"format\": {\"type\": \"string\", \"enum\": [\"json\", \"csv\", \"xml\"], \"default\": \"json\"}\n          },\n          \"required\": [\"name\", \"age\", \"email\"]\n      }\n  )\n  async def advanced_process(args: dict[str, Any]) -> dict[str, Any]:\n      # Process with advanced schema validation\n      return {\n          \"content\": [{\n              \"type\": \"text\",\n              \"text\": f\"Advanced processing for {args['name']}\"\n          }]\n      }\n  ```\n</CodeGroup>\n\n## Error Handling\n\nHandle errors gracefully to provide meaningful feedback:\n\n<CodeGroup>\n  ```typescript TypeScript theme={null}\n  tool(\n    \"fetch_data\",\n    \"Fetch data from an API\",\n    {\n      endpoint: z.string().url().describe(\"API endpoint URL\")\n    },\n    async (args) => {\n      try {\n        const response = await fetch(args.endpoint);\n        \n        if (!response.ok) {\n          return {\n            content: [{\n              type: \"text\",\n              text: `API error: ${response.status} ${response.statusText}`\n            }]\n          };\n        }\n        \n        const data = await response.json();\n        return {\n          content: [{\n            type: \"text\",\n            text: JSON.stringify(data, null, 2)\n          }]\n        };\n      } catch (error) {\n        return {\n          content: [{\n            type: \"text\",\n            text: `Failed to fetch data: ${error.message}`\n          }]\n        };\n      }\n    }\n  )\n  ```\n\n  ```python Python theme={null}\n  import json\n  import aiohttp\n  from typing import Any\n\n  @tool(\n      \"fetch_data\",\n      \"Fetch data from an API\",\n      {\"endpoint\": str}  # Simple schema\n  )\n  async def fetch_data(args: dict[str, Any]) -> dict[str, Any]:\n      try:\n          async with aiohttp.ClientSession() as session:\n              async with session.get(args[\"endpoint\"]) as response:\n                  if response.status != 200:\n                      return {\n                          \"content\": [{\n                              \"type\": \"text\",\n                              \"text\": f\"API error: {response.status} {response.reason}\"\n                          }]\n                      }\n                  \n                  data = await response.json()\n                  return {\n                      \"content\": [{\n                          \"type\": \"text\",\n                          \"text\": json.dumps(data, indent=2)\n                      }]\n                  }\n      except Exception as e:\n          return {\n              \"content\": [{\n                  \"type\": \"text\",\n                  \"text\": f\"Failed to fetch data: {str(e)}\"\n              }]\n          }\n  ```\n</CodeGroup>\n\n## Example Tools\n\n### Database Query Tool\n\n<CodeGroup>\n  ```typescript TypeScript theme={null}\n  const databaseServer = createSdkMcpServer({\n    name: \"database-tools\",\n    version: \"1.0.0\",\n    tools: [\n      tool(\n        \"query_database\",\n        \"Execute a database query\",\n        {\n          query: z.string().describe(\"SQL query to execute\"),\n          params: z.array(z.any()).optional().describe(\"Query parameters\")\n        },\n        async (args) => {\n          const results = await db.query(args.query, args.params || []);\n          return {\n            content: [{\n              type: \"text\",\n              text: `Found ${results.length} rows:\\n${JSON.stringify(results, null, 2)}`\n            }]\n          };\n        }\n      )\n    ]\n  });\n  ```\n\n  ```python Python theme={null}\n  from typing import Any\n  import json\n\n  @tool(\n      \"query_database\",\n      \"Execute a database query\",\n      {\"query\": str, \"params\": list}  # Simple schema with list type\n  )\n  async def query_database(args: dict[str, Any]) -> dict[str, Any]:\n      results = await db.query(args[\"query\"], args.get(\"params\", []))\n      return {\n          \"content\": [{\n              \"type\": \"text\",\n              \"text\": f\"Found {len(results)} rows:\\n{json.dumps(results, indent=2)}\"\n          }]\n      }\n\n  database_server = create_sdk_mcp_server(\n      name=\"database-tools\",\n      version=\"1.0.0\",\n      tools=[query_database]  # Pass the decorated function\n  )\n  ```\n</CodeGroup>\n\n### API Gateway Tool\n\n<CodeGroup>\n  ```typescript TypeScript theme={null}\n  const apiGatewayServer = createSdkMcpServer({\n    name: \"api-gateway\",\n    version: \"1.0.0\",\n    tools: [\n      tool(\n        \"api_request\",\n        \"Make authenticated API requests to external services\",\n        {\n          service: z.enum([\"stripe\", \"github\", \"openai\", \"slack\"]).describe(\"Service to call\"),\n          endpoint: z.string().describe(\"API endpoint path\"),\n          method: z.enum([\"GET\", \"POST\", \"PUT\", \"DELETE\"]).describe(\"HTTP method\"),\n          body: z.record(z.any()).optional().describe(\"Request body\"),\n          query: z.record(z.string()).optional().describe(\"Query parameters\")\n        },\n        async (args) => {\n          const config = {\n            stripe: { baseUrl: \"https://api.stripe.com/v1\", key: process.env.STRIPE_KEY },\n            github: { baseUrl: \"https://api.github.com\", key: process.env.GITHUB_TOKEN },\n            openai: { baseUrl: \"https://api.openai.com/v1\", key: process.env.OPENAI_KEY },\n            slack: { baseUrl: \"https://slack.com/api\", key: process.env.SLACK_TOKEN }\n          };\n          \n          const { baseUrl, key } = config[args.service];\n          const url = new URL(`${baseUrl}${args.endpoint}`);\n          \n          if (args.query) {\n            Object.entries(args.query).forEach(([k, v]) => url.searchParams.set(k, v));\n          }\n          \n          const response = await fetch(url, {\n            method: args.method,\n            headers: { Authorization: `Bearer ${key}`, \"Content-Type\": \"application/json\" },\n            body: args.body ? JSON.stringify(args.body) : undefined\n          });\n          \n          const data = await response.json();\n          return {\n            content: [{\n              type: \"text\",\n              text: JSON.stringify(data, null, 2)\n            }]\n          };\n        }\n      )\n    ]\n  });\n  ```\n\n  ```python Python theme={null}\n  import os\n  import json\n  import aiohttp\n  from typing import Any\n\n  # For complex schemas with enums, use JSON Schema format\n  @tool(\n      \"api_request\",\n      \"Make authenticated API requests to external services\",\n      {\n          \"type\": \"object\",\n          \"properties\": {\n              \"service\": {\"type\": \"string\", \"enum\": [\"stripe\", \"github\", \"openai\", \"slack\"]},\n              \"endpoint\": {\"type\": \"string\"},\n              \"method\": {\"type\": \"string\", \"enum\": [\"GET\", \"POST\", \"PUT\", \"DELETE\"]},\n              \"body\": {\"type\": \"object\"},\n              \"query\": {\"type\": \"object\"}\n          },\n          \"required\": [\"service\", \"endpoint\", \"method\"]\n      }\n  )\n  async def api_request(args: dict[str, Any]) -> dict[str, Any]:\n      config = {\n          \"stripe\": {\"base_url\": \"https://api.stripe.com/v1\", \"key\": os.environ[\"STRIPE_KEY\"]},\n          \"github\": {\"base_url\": \"https://api.github.com\", \"key\": os.environ[\"GITHUB_TOKEN\"]},\n          \"openai\": {\"base_url\": \"https://api.openai.com/v1\", \"key\": os.environ[\"OPENAI_KEY\"]},\n          \"slack\": {\"base_url\": \"https://slack.com/api\", \"key\": os.environ[\"SLACK_TOKEN\"]}\n      }\n      \n      service_config = config[args[\"service\"]]\n      url = f\"{service_config['base_url']}{args['endpoint']}\"\n      \n      if args.get(\"query\"):\n          params = \"&\".join([f\"{k}={v}\" for k, v in args[\"query\"].items()])\n          url += f\"?{params}\"\n      \n      headers = {\"Authorization\": f\"Bearer {service_config['key']}\", \"Content-Type\": \"application/json\"}\n      \n      async with aiohttp.ClientSession() as session:\n          async with session.request(\n              args[\"method\"], url, headers=headers, json=args.get(\"body\")\n          ) as response:\n              data = await response.json()\n              return {\n                  \"content\": [{\n                      \"type\": \"text\",\n                      \"text\": json.dumps(data, indent=2)\n                  }]\n              }\n\n  api_gateway_server = create_sdk_mcp_server(\n      name=\"api-gateway\",\n      version=\"1.0.0\",\n      tools=[api_request]  # Pass the decorated function\n  )\n  ```\n</CodeGroup>\n\n### Calculator Tool\n\n<CodeGroup>\n  ```typescript TypeScript theme={null}\n  const calculatorServer = createSdkMcpServer({\n    name: \"calculator\",\n    version: \"1.0.0\",\n    tools: [\n      tool(\n        \"calculate\",\n        \"Perform mathematical calculations\",\n        {\n          expression: z.string().describe(\"Mathematical expression to evaluate\"),\n          precision: z.number().optional().default(2).describe(\"Decimal precision\")\n        },\n        async (args) => {\n          try {\n            // Use a safe math evaluation library in production\n            const result = eval(args.expression); // Example only!\n            const formatted = Number(result).toFixed(args.precision);\n            \n            return {\n              content: [{\n                type: \"text\",\n                text: `${args.expression} = ${formatted}`\n              }]\n            };\n          } catch (error) {\n            return {\n              content: [{\n                type: \"text\",\n                text: `Error: Invalid expression - ${error.message}`\n              }]\n            };\n          }\n        }\n      ),\n      tool(\n        \"compound_interest\",\n        \"Calculate compound interest for an investment\",\n        {\n          principal: z.number().positive().describe(\"Initial investment amount\"),\n          rate: z.number().describe(\"Annual interest rate (as decimal, e.g., 0.05 for 5%)\"),\n          time: z.number().positive().describe(\"Investment period in years\"),\n          n: z.number().positive().default(12).describe(\"Compounding frequency per year\")\n        },\n        async (args) => {\n          const amount = args.principal * Math.pow(1 + args.rate / args.n, args.n * args.time);\n          const interest = amount - args.principal;\n          \n          return {\n            content: [{\n              type: \"text\",\n              text: `Investment Analysis:\\n` +\n                    `Principal: $${args.principal.toFixed(2)}\\n` +\n                    `Rate: ${(args.rate * 100).toFixed(2)}%\\n` +\n                    `Time: ${args.time} years\\n` +\n                    `Compounding: ${args.n} times per year\\n\\n` +\n                    `Final Amount: $${amount.toFixed(2)}\\n` +\n                    `Interest Earned: $${interest.toFixed(2)}\\n` +\n                    `Return: ${((interest / args.principal) * 100).toFixed(2)}%`\n            }]\n          };\n        }\n      )\n    ]\n  });\n  ```\n\n  ```python Python theme={null}\n  import math\n  from typing import Any\n\n  @tool(\n      \"calculate\",\n      \"Perform mathematical calculations\",\n      {\"expression\": str, \"precision\": int}  # Simple schema\n  )\n  async def calculate(args: dict[str, Any]) -> dict[str, Any]:\n      try:\n          # Use a safe math evaluation library in production\n          result = eval(args[\"expression\"], {\"__builtins__\": {}})\n          precision = args.get(\"precision\", 2)\n          formatted = round(result, precision)\n          \n          return {\n              \"content\": [{\n                  \"type\": \"text\",\n                  \"text\": f\"{args['expression']} = {formatted}\"\n              }]\n          }\n      except Exception as e:\n          return {\n              \"content\": [{\n                  \"type\": \"text\",\n                  \"text\": f\"Error: Invalid expression - {str(e)}\"\n              }]\n          }\n\n  @tool(\n      \"compound_interest\",\n      \"Calculate compound interest for an investment\",\n      {\"principal\": float, \"rate\": float, \"time\": float, \"n\": int}\n  )\n  async def compound_interest(args: dict[str, Any]) -> dict[str, Any]:\n      principal = args[\"principal\"]\n      rate = args[\"rate\"]\n      time = args[\"time\"]\n      n = args.get(\"n\", 12)\n      \n      amount = principal * (1 + rate / n) ** (n * time)\n      interest = amount - principal\n      \n      return {\n          \"content\": [{\n              \"type\": \"text\",\n              \"text\": f\"\"\"Investment Analysis:\n  Principal: ${principal:.2f}\n  Rate: {rate * 100:.2f}%\n  Time: {time} years\n  Compounding: {n} times per year\n\n  Final Amount: ${amount:.2f}\n  Interest Earned: ${interest:.2f}\n  Return: {(interest / principal) * 100:.2f}%\"\"\"\n          }]\n      }\n\n  calculator_server = create_sdk_mcp_server(\n      name=\"calculator\",\n      version=\"1.0.0\",\n      tools=[calculate, compound_interest]  # Pass decorated functions\n  )\n  ```\n</CodeGroup>\n\n## Related Documentation\n\n* [TypeScript SDK Reference](/en/docs/agent-sdk/typescript)\n* [Python SDK Reference](/en/docs/agent-sdk/python)\n* [MCP Documentation](https://modelcontextprotocol.io)\n* [SDK Overview](/en/docs/agent-sdk/overview)",
  "content_length": 23034
}