{
  "title": "Reject Concurrent",
  "source_url": "https://docs.langchain.com/langsmith/reject-concurrent",
  "content": "This guide assumes knowledge of what double-texting is, which you can learn about in the [double-texting conceptual guide](/langsmith/double-texting).\n\nThe guide covers the `reject` option for double texting, which rejects the new run of the graph by throwing an error and continues with the original run until completion. Below is a quick example of using the `reject` option.\n\n## Setup\n\nFirst, we will define a quick helper function for printing out JS and CURL model outputs (you can skip this if using Python):\n\n<Tabs>\n  <Tab title=\"Javascript\">\n    ```js  theme={null}\n    function prettyPrint(m) {\n      const padded = \" \" + m['type'] + \" \";\n      const sepLen = Math.floor((80 - padded.length) / 2);\n      const sep = \"=\".repeat(sepLen);\n      const secondSep = sep + (padded.length % 2 ? \"=\" : \"\");\n\n      console.log(`${sep}${padded}${secondSep}`);\n      console.log(\"\\n\\n\");\n      console.log(m.content);\n    }\n    ```\n  </Tab>\n\n  <Tab title=\"CURL\">\n    ```bash  theme={null}\n    # PLACE THIS IN A FILE CALLED pretty_print.sh\n    pretty_print() {\n      local type=\"$1\"\n      local content=\"$2\"\n      local padded=\" $type \"\n      local total_width=80\n      local sep_len=$(( (total_width - ${#padded}) / 2 ))\n      local sep=$(printf '=%.0s' $(eval \"echo {1..\"${sep_len}\"}\"))\n      local second_sep=$sep\n      if (( (total_width - ${#padded}) % 2 )); then\n        second_sep=\"${second_sep}=\"\n      fi\n\n      echo \"${sep}${padded}${second_sep}\"\n      echo\n      echo \"$content\"\n    }\n    ```\n  </Tab>\n</Tabs>\n\nNow, let's import our required packages and instantiate our client, assistant, and thread.\n\n<Tabs>\n  <Tab title=\"Python\">\n    ```python  theme={null}\n    import httpx\n    from langchain_core.messages import convert_to_messages\n    from langgraph_sdk import get_client\n\n    client = get_client(url=<DEPLOYMENT_URL>)\n    # Using the graph deployed with the name \"agent\"\n    assistant_id = \"agent\"\n    thread = await client.threads.create()\n    ```\n  </Tab>\n\n  <Tab title=\"Javascript\">\n    ```js  theme={null}\n    import { Client } from \"@langchain/langgraph-sdk\";\n\n    const client = new Client({ apiUrl: <DEPLOYMENT_URL> });\n    // Using the graph deployed with the name \"agent\"\n    const assistantId = \"agent\";\n    const thread = await client.threads.create();\n    ```\n  </Tab>\n\n  <Tab title=\"CURL\">\n    ```bash  theme={null}\n    curl --request POST \\\n      --url <DEPLOYMENT_URL>/threads \\\n      --header 'Content-Type: application/json' \\\n      --data '{}'\n    ```\n  </Tab>\n</Tabs>\n\n## Create runs\n\nNow we can run a thread and try to run a second one with the \"reject\" option, which should fail since we have already started a run:\n\n<Tabs>\n  <Tab title=\"Python\">\n    ```python  theme={null}\n    run = await client.runs.create(\n        thread[\"thread_id\"],\n        assistant_id,\n        input={\"messages\": [{\"role\": \"user\", \"content\": \"what's the weather in sf?\"}]},\n    )\n    try:\n        await client.runs.create(\n            thread[\"thread_id\"],\n            assistant_id,\n            input={\n                \"messages\": [{\"role\": \"user\", \"content\": \"what's the weather in nyc?\"}]\n            },\n            multitask_strategy=\"reject\",\n        )\n    except httpx.HTTPStatusError as e:\n        print(\"Failed to start concurrent run\", e)\n    ```\n  </Tab>\n\n  <Tab title=\"Javascript\">\n    ```js  theme={null}\n    const run = await client.runs.create(\n      thread[\"thread_id\"],\n      assistantId,\n      input={\"messages\": [{\"role\": \"user\", \"content\": \"what's the weather in sf?\"}]},\n    );\n\n    try {\n      await client.runs.create(\n        thread[\"thread_id\"],\n        assistantId,\n        {\n          input: {\"messages\": [{\"role\": \"user\", \"content\": \"what's the weather in nyc?\"}]},\n          multitask_strategy:\"reject\"\n        },\n      );\n    } catch (e) {\n      console.error(\"Failed to start concurrent run\", e);\n    }\n    ```\n  </Tab>\n\n  <Tab title=\"CURL\">\n    ```bash  theme={null}\n    curl --request POST \\\n    --url <DEPLOY<ENT_URL>>/threads/<THREAD_ID>/runs \\\n    --header 'Content-Type: application/json' \\\n    --data \"{\n      \\\"assistant_id\\\": \\\"agent\\\",\n      \\\"input\\\": {\\\"messages\\\": [{\\\"role\\\": \\\"human\\\", \\\"content\\\": \\\"what\\'s the weather in sf?\\\"}]},\n    }\" && curl --request POST \\\n    --url <DEPLOY<ENT_URL>>/threads/<THREAD_ID>/runs \\\n    --header 'Content-Type: application/json' \\\n    --data \"{\n      \\\"assistant_id\\\": \\\"agent\\\",\n      \\\"input\\\": {\\\"messages\\\": [{\\\"role\\\": \\\"human\\\", \\\"content\\\": \\\"what\\'s the weather in nyc?\\\"}]},\n      \\\"multitask_strategy\\\": \\\"reject\\\"\n    }\" || { echo \"Failed to start concurrent run\"; echo \"Error: $?\" >&2; }\n    ```\n  </Tab>\n</Tabs>\n\nOutput:\n\n```\nFailed to start concurrent run Client error '409 Conflict' for url 'http://localhost:8123/threads/f9e7088b-8028-4e5c-88d2-9cc9a2870e50/runs'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/409\n```\n\n## View run results\n\nWe can verify that the original thread finished executing:\n\n<Tabs>\n  <Tab title=\"Python\">\n    ```python  theme={null}\n    # wait until the original run completes\n    await client.runs.join(thread[\"thread_id\"], run[\"run_id\"])\n\n    state = await client.threads.get_state(thread[\"thread_id\"])\n\n    for m in convert_to_messages(state[\"values\"][\"messages\"]):\n        m.pretty_print()\n    ```\n  </Tab>\n\n  <Tab title=\"Javascript\">\n    ```js  theme={null}\n    await client.runs.join(thread[\"thread_id\"], run[\"run_id\"]);\n\n    const state = await client.threads.getState(thread[\"thread_id\"]);\n\n    for (const m of state[\"values\"][\"messages\"]) {\n      prettyPrint(m);\n    }\n    ```\n  </Tab>\n\n  <Tab title=\"CURL\">\n    ```bash  theme={null}\n    source pretty_print.sh && curl --request GET \\\n    --url <DEPLOYMENT_URL>/threads/<THREAD_ID>/runs/<RUN_ID>/join && \\\n    curl --request GET --url <DEPLOYMENT_URL>/threads/<THREAD_ID>/state | \\\n    jq -c '.values.messages[]' | while read -r element; do\n        type=$(echo \"$element\" | jq -r '.type')\n        content=$(echo \"$element\" | jq -r '.content | if type == \"array\" then tostring else . end')\n        pretty_print \"$type\" \"$content\"\n    done\n    ```\n  </Tab>\n</Tabs>\n\nOutput:\n\n```\n================================ Human Message =================================\n\nwhat's the weather in sf?\n================================== Ai Message ==================================\n\n[{'id': 'toolu_01CyewEifV2Kmi7EFKHbMDr1', 'input': {'query': 'weather in san francisco'}, 'name': 'tavily_search_results_json', 'type': 'tool_use'}]\nTool Calls:\ntavily_search_results_json (toolu_01CyewEifV2Kmi7EFKHbMDr1)\nCall ID: toolu_01CyewEifV2Kmi7EFKHbMDr1\nArgs:\nquery: weather in san francisco\n================================= Tool Message =================================\nName: tavily_search_results_json\n\n[{\"url\": \"https://www.accuweather.com/en/us/san-francisco/94103/june-weather/347629\", \"content\": \"Get the monthly weather forecast for San Francisco, CA, including daily high/low, historical averages, to help you plan ahead.\"}]\n================================== Ai Message ==================================\n\nAccording to the search results from Tavily, the current weather in San Francisco is:\n\nThe average high temperature in San Francisco in June is around 65째F (18째C), with average lows around 54째F (12째C). June tends to be one of the cooler and foggier months in San Francisco due to the marine layer of fog that often blankets the city during the summer months.\n\nSome key points about the typical June weather in San Francisco:\n\n* Mild temperatures with highs in the 60s F and lows in the 50s F\n* Foggy mornings that often burn off to sunny afternoons\n* Little to no rainfall, as June falls in the dry season\n* Breezy conditions, with winds off the Pacific Ocean\n* Layers are recommended for changing weather conditions\n\nSo in summary, you can expect mild, foggy mornings giving way to sunny but cool afternoons in San Francisco this time of year. The marine layer keeps temperatures moderate compared to other parts of California in June.\n```\n\n***\n\n<Callout icon=\"pen-to-square\" iconType=\"regular\">\n  [Edit the source of this page on GitHub.](https://github.com/langchain-ai/docs/edit/main/src/langsmith/reject-concurrent.mdx)\n</Callout>\n\n<Tip icon=\"terminal\" iconType=\"regular\">\n  [Connect these docs programmatically](/use-these-docs) to Claude, VSCode, and more via MCP for real-time answers.\n</Tip>",
  "content_length": 8323
}