{
  "title": "How to kick off background runs",
  "source_url": "https://docs.langchain.com/langsmith/background-run",
  "content": "This guide covers how to kick off background runs for your agent.\nThis can be useful for long running jobs.\n\n## Setup\n\nFirst let's set up our client and thread:\n\n<Tabs>\n  <Tab title=\"Python\">\n    ```python  theme={null}\n    from langgraph_sdk import get_client\n\n    client = get_client(url=<DEPLOYMENT_URL>)\n    # Using the graph deployed with the name \"agent\"\n    assistant_id = \"agent\"\n    # create thread\n    thread = await client.threads.create()\n    print(thread)\n    ```\n  </Tab>\n\n  <Tab title=\"Javascript\">\n    ```js  theme={null}\n    import { Client } from \"@langchain/langgraph-sdk\";\n\n    const client = new Client({ apiUrl: <DEPLOYMENT_URL> });\n    // Using the graph deployed with the name \"agent\"\n    const assistantID = \"agent\";\n    // create thread\n    const thread = await client.threads.create();\n    console.log(thread);\n    ```\n  </Tab>\n\n  <Tab title=\"CURL\">\n    ```bash  theme={null}\n    curl --request POST \\\n      --url <DEPLOYMENT_URL>/threads \\\n      --header 'Content-Type: application/json' \\\n      --data '{}'\n    ```\n  </Tab>\n</Tabs>\n\nOutput:\n\n```\n{\n'thread_id': '5cb1e8a1-34b3-4a61-a34e-71a9799bd00d',\n'created_at': '2024-08-30T20:35:52.062934+00:00',\n'updated_at': '2024-08-30T20:35:52.062934+00:00',\n'metadata': {},\n'status': 'idle',\n'config': {},\n'values': None\n}\n```\n\n## Check runs on thread\n\nIf we list the current runs on this thread, we will see that it's empty:\n\n<Tabs>\n  <Tab title=\"Python\">\n    ```python  theme={null}\n    runs = await client.runs.list(thread[\"thread_id\"])\n    print(runs)\n    ```\n  </Tab>\n\n  <Tab title=\"Javascript\">\n    ```js  theme={null}\n    let runs = await client.runs.list(thread['thread_id']);\n    console.log(runs);\n    ```\n  </Tab>\n\n  <Tab title=\"CURL\">\n    ```bash  theme={null}\n    curl --request GET \\\n        --url <DEPLOYMENT_URL>/threads/<THREAD_ID>/runs\n    ```\n  </Tab>\n</Tabs>\n\nOutput:\n\n```\n[]\n```\n\n## Start runs on thread\n\nNow let's kick off a run:\n\n<Tabs>\n  <Tab title=\"Python\">\n    ```python  theme={null}\n    input = {\"messages\": [{\"role\": \"user\", \"content\": \"what's the weather in sf\"}]}\n    run = await client.runs.create(thread[\"thread_id\"], assistant_id, input=input)\n    ```\n  </Tab>\n\n  <Tab title=\"Javascript\">\n    ```js  theme={null}\n    let input = {\"messages\": [{\"role\": \"user\", \"content\": \"what's the weather in sf\"}]};\n    let run = await client.runs.create(thread[\"thread_id\"], assistantID, { input });\n    ```\n  </Tab>\n\n  <Tab title=\"CURL\">\n    ```bash  theme={null}\n    curl --request POST \\\n        --url <DEPLOYMENT_URL>/threads/<THREAD_ID>/runs \\\n        --header 'Content-Type: application/json' \\\n        --data '{\n            \"assistant_id\": <ASSISTANT_ID>\n        }'\n    ```\n  </Tab>\n</Tabs>\n\nThe first time we poll it, we can see `status=pending`:\n\n<Tabs>\n  <Tab title=\"Python\">\n    ```python  theme={null}\n    print(await client.runs.get(thread[\"thread_id\"], run[\"run_id\"]))\n    ```\n  </Tab>\n\n  <Tab title=\"Javascript\">\n    ```js  theme={null}\n    console.log(await client.runs.get(thread[\"thread_id\"], run[\"run_id\"]));\n    ```\n  </Tab>\n\n  <Tab title=\"CURL\">\n    ```bash  theme={null}\n    curl --request GET \\\n        --url <DEPLOYMENT_URL>/threads/<THREAD_ID>/runs/<RUN_ID>\n    ```\n  </Tab>\n</Tabs>\n\nOutput:\n\n```\n{\n\"run_id\": \"1ef6a5f8-bd86-6763-bbd6-bff042db7b1b\",\n\"thread_id\": \"7885f0cf-94ad-4040-91d7-73f7ba007c8a\",\n\"assistant_id\": \"fe096781-5601-53d2-b2f6-0d3403f7e9ca\",\n\"created_at\": \"2024-09-04T01:46:47.244887+00:00\",\n\"updated_at\": \"2024-09-04T01:46:47.244887+00:00\",\n\"metadata\": {},\n\"status\": \"pending\",\n\"kwargs\": {\n\"input\": {\n\"messages\": [\n{\n\"role\": \"user\",\n\"content\": \"what's the weather in sf\"\n}\n]\n},\n\"config\": {\n\"metadata\": {\n\"created_by\": \"system\"\n},\n\"configurable\": {\n\"run_id\": \"1ef6a5f8-bd86-6763-bbd6-bff042db7b1b\",\n\"user_id\": \"\",\n\"graph_id\": \"agent\",\n\"thread_id\": \"7885f0cf-94ad-4040-91d7-73f7ba007c8a\",\n\"assistant_id\": \"fe096781-5601-53d2-b2f6-0d3403f7e9ca\",\n\"checkpoint_id\": null\n}\n},\n\"webhook\": null,\n\"temporary\": false,\n\"stream_mode\": [\n\"values\"\n],\n\"feedback_keys\": null,\n\"interrupt_after\": null,\n\"interrupt_before\": null\n},\n\"multitask_strategy\": \"reject\"\n}\n```\n\nNow we can join the run, wait for it to finish and check that status again:\n\n<Tabs>\n  <Tab title=\"Python\">\n    ```python  theme={null}\n    await client.runs.join(thread[\"thread_id\"], run[\"run_id\"])\n    print(await client.runs.get(thread[\"thread_id\"], run[\"run_id\"]))\n    ```\n  </Tab>\n\n  <Tab title=\"Javascript\">\n    ```js  theme={null}\n    await client.runs.join(thread[\"thread_id\"], run[\"run_id\"]);\n    console.log(await client.runs.get(thread[\"thread_id\"], run[\"run_id\"]));\n    ```\n  </Tab>\n\n  <Tab title=\"CURL\">\n    ```bash  theme={null}\n    curl --request GET \\\n        --url <DEPLOYMENT_URL>/threads/<THREAD_ID>/runs/<RUN_ID>/join &&\n    curl --request GET \\\n        --url <DEPLOYMENT_URL>/threads/<THREAD_ID>/runs/<RUN_ID>\n    ```\n  </Tab>\n</Tabs>\n\nOutput:\n\n```\n{\n\"run_id\": \"1ef6a5f8-bd86-6763-bbd6-bff042db7b1b\",\n\"thread_id\": \"7885f0cf-94ad-4040-91d7-73f7ba007c8a\",\n\"assistant_id\": \"fe096781-5601-53d2-b2f6-0d3403f7e9ca\",\n\"created_at\": \"2024-09-04T01:46:47.244887+00:00\",\n\"updated_at\": \"2024-09-04T01:46:47.244887+00:00\",\n\"metadata\": {},\n\"status\": \"success\",\n\"kwargs\": {\n\"input\": {\n\"messages\": [\n{\n\"role\": \"user\",\n\"content\": \"what's the weather in sf\"\n}\n]\n},\n\"config\": {\n\"metadata\": {\n\"created_by\": \"system\"\n},\n\"configurable\": {\n\"run_id\": \"1ef6a5f8-bd86-6763-bbd6-bff042db7b1b\",\n\"user_id\": \"\",\n\"graph_id\": \"agent\",\n\"thread_id\": \"7885f0cf-94ad-4040-91d7-73f7ba007c8a\",\n\"assistant_id\": \"fe096781-5601-53d2-b2f6-0d3403f7e9ca\",\n\"checkpoint_id\": null\n}\n},\n\"webhook\": null,\n\"temporary\": false,\n\"stream_mode\": [\n\"values\"\n],\n\"feedback_keys\": null,\n\"interrupt_after\": null,\n\"interrupt_before\": null\n},\n\"multitask_strategy\": \"reject\"\n}\n```\n\nPerfect! The run succeeded as we would expect. We can double check that the run worked as expected by printing out the final state:\n\n<Tabs>\n  <Tab title=\"Python\">\n    ```python  theme={null}\n    final_result = await client.threads.get_state(thread[\"thread_id\"])\n    print(final_result)\n    ```\n  </Tab>\n\n  <Tab title=\"Javascript\">\n    ```js  theme={null}\n    let finalResult = await client.threads.getState(thread[\"thread_id\"]);\n    console.log(finalResult);\n    ```\n  </Tab>\n\n  <Tab title=\"CURL\">\n    ```bash  theme={null}\n    curl --request GET \\\n        --url <DEPLOYMENT_URL>/threads/<THREAD_ID>/state\n    ```\n  </Tab>\n</Tabs>\n\nOutput:\n\n```\n{\n\"values\": {\n\"messages\": [\n{\n\"content\": \"what's the weather in sf\",\n\"additional_kwargs\": {},\n\"response_metadata\": {},\n\"type\": \"human\",\n\"name\": null,\n\"id\": \"beba31bf-320d-4125-9c37-cadf526ac47a\",\n\"example\": false\n},\n{\n\"content\": [\n{\n\"id\": \"toolu_01AaNPSPzqia21v7aAKwbKYm\",\n\"input\": {},\n\"name\": \"tavily_search_results_json\",\n\"type\": \"tool_use\",\n\"index\": 0,\n\"partial_json\": \"{\\\"query\\\": \\\"weather in san francisco\\\"}\"\n}\n],\n\"additional_kwargs\": {},\n\"response_metadata\": {\n\"stop_reason\": \"tool_use\",\n\"stop_sequence\": null\n},\n\"type\": \"ai\",\n\"name\": null,\n\"id\": \"run-f220faf8-1d27-4f73-ad91-6bb3f47e8639\",\n\"example\": false,\n\"tool_calls\": [\n{\n\"name\": \"tavily_search_results_json\",\n\"args\": {\n\"query\": \"weather in san francisco\"\n},\n\"id\": \"toolu_01AaNPSPzqia21v7aAKwbKYm\",\n\"type\": \"tool_call\"\n}\n],\n\"invalid_tool_calls\": [],\n\"usage_metadata\": {\n\"input_tokens\": 273,\n\"output_tokens\": 61,\n\"total_tokens\": 334\n}\n},\n{\n\"content\": \"[{\\\"url\\\": \\\"https://www.weatherapi.com/\\\", \\\"content\\\": \\\"{'location': {'name': 'San Francisco', 'region': 'California', 'country': 'United States of America', 'lat': 37.78, 'lon': -122.42, 'tz_id': 'America/Los_Angeles', 'localtime_epoch': 1725052131, 'localtime': '2024-08-30 14:08'}, 'current': {'last_updated_epoch': 1725051600, 'last_updated': '2024-08-30 14:00', 'temp_c': 21.1, 'temp_f': 70.0, 'is_day': 1, 'condition': {'text': 'Partly cloudy', 'icon': '//cdn.weatherapi.com/weather/64x64/day/116.png', 'code': 1003}, 'wind_mph': 11.9, 'wind_kph': 19.1, 'wind_degree': 290, 'wind_dir': 'WNW', 'pressure_mb': 1018.0, 'pressure_in': 30.07, 'precip_mm': 0.0, 'precip_in': 0.0, 'humidity': 59, 'cloud': 25, 'feelslike_c': 21.1, 'feelslike_f': 70.0, 'windchill_c': 18.6, 'windchill_f': 65.5, 'heatindex_c': 18.6, 'heatindex_f': 65.5, 'dewpoint_c': 12.2, 'dewpoint_f': 54.0, 'vis_km': 16.0, 'vis_miles': 9.0, 'uv': 5.0, 'gust_mph': 15.0, 'gust_kph': 24.2}}\\\"}]\",\n\"additional_kwargs\": {},\n\"response_metadata\": {},\n\"type\": \"tool\",\n\"name\": \"tavily_search_results_json\",\n\"id\": \"686b2487-f332-4e58-9508-89b3a814cd81\",\n\"tool_call_id\": \"toolu_01AaNPSPzqia21v7aAKwbKYm\",\n\"artifact\": {\n\"query\": \"weather in san francisco\",\n\"follow_up_questions\": null,\n\"answer\": null,\n\"images\": [],\n\"results\": [\n{\n\"title\": \"Weather in San Francisco\",\n\"url\": \"https://www.weatherapi.com/\",\n\"content\": \"{'location': {'name': 'San Francisco', 'region': 'California', 'country': 'United States of America', 'lat': 37.78, 'lon': -122.42, 'tz_id': 'America/Los_Angeles', 'localtime_epoch': 1725052131, 'localtime': '2024-08-30 14:08'}, 'current': {'last_updated_epoch': 1725051600, 'last_updated': '2024-08-30 14:00', 'temp_c': 21.1, 'temp_f': 70.0, 'is_day': 1, 'condition': {'text': 'Partly cloudy', 'icon': '//cdn.weatherapi.com/weather/64x64/day/116.png', 'code': 1003}, 'wind_mph': 11.9, 'wind_kph': 19.1, 'wind_degree': 290, 'wind_dir': 'WNW', 'pressure_mb': 1018.0, 'pressure_in': 30.07, 'precip_mm': 0.0, 'precip_in': 0.0, 'humidity': 59, 'cloud': 25, 'feelslike_c': 21.1, 'feelslike_f': 70.0, 'windchill_c': 18.6, 'windchill_f': 65.5, 'heatindex_c': 18.6, 'heatindex_f': 65.5, 'dewpoint_c': 12.2, 'dewpoint_f': 54.0, 'vis_km': 16.0, 'vis_miles': 9.0, 'uv': 5.0, 'gust_mph': 15.0, 'gust_kph': 24.2}}\",\n\"score\": 0.976148,\n\"raw_content\": null\n}\n],\n\"response_time\": 3.07\n},\n\"status\": \"success\"\n},\n{\n\"content\": [\n{\n\"text\": \"\\n\\nThe search results provide the current weather conditions in San Francisco. According to the data, as of 2:00 PM on August 30, 2024, the temperature in San Francisco is 70\\u00b0F (21.1\\u00b0C) with partly cloudy skies. The wind is blowing from the west-northwest at around 12 mph (19 km/h). The humidity is 59% and visibility is 9 miles (16 km). Overall, it looks like a nice late summer day in San Francisco with comfortable temperatures and partly sunny conditions.\",\n\"type\": \"text\",\n\"index\": 0\n}\n],\n\"additional_kwargs\": {},\n\"response_metadata\": {\n\"stop_reason\": \"end_turn\",\n\"stop_sequence\": null\n},\n\"type\": \"ai\",\n\"name\": null,\n\"id\": \"run-8fecc61d-3d9f-4e16-8e8a-92f702be498a\",\n\"example\": false,\n\"tool_calls\": [],\n\"invalid_tool_calls\": [],\n\"usage_metadata\": {\n\"input_tokens\": 837,\n\"output_tokens\": 124,\n\"total_tokens\": 961\n}\n}\n]\n},\n\"next\": [],\n\"tasks\": [],\n\"metadata\": {\n\"step\": 3,\n\"run_id\": \"1ef67140-eb23-684b-8253-91d4c90bb05e\",\n\"source\": \"loop\",\n\"writes\": {\n\"agent\": {\n\"messages\": [\n{\n\"id\": \"run-8fecc61d-3d9f-4e16-8e8a-92f702be498a\",\n\"name\": null,\n\"type\": \"ai\",\n\"content\": [\n{\n\"text\": \"\\n\\nThe search results provide the current weather conditions in San Francisco. According to the data, as of 2:00 PM on August 30, 2024, the temperature in San Francisco is 70\\u00b0F (21.1\\u00b0C) with partly cloudy skies. The wind is blowing from the west-northwest at around 12 mph (19 km/h). The humidity is 59% and visibility is 9 miles (16 km). Overall, it looks like a nice late summer day in San Francisco with comfortable temperatures and partly sunny conditions.\",\n\"type\": \"text\",\n\"index\": 0\n}\n],\n\"example\": false,\n\"tool_calls\": [],\n\"usage_metadata\": {\n\"input_tokens\": 837,\n\"total_tokens\": 961,\n\"output_tokens\": 124\n},\n\"additional_kwargs\": {},\n\"response_metadata\": {\n\"stop_reason\": \"end_turn\",\n\"stop_sequence\": null\n},\n\"invalid_tool_calls\": []\n}\n]\n}\n},\n\"user_id\": \"\",\n\"graph_id\": \"agent\",\n\"thread_id\": \"5cb1e8a1-34b3-4a61-a34e-71a9799bd00d\",\n\"created_by\": \"system\",\n\"assistant_id\": \"fe096781-5601-53d2-b2f6-0d3403f7e9ca\"\n},\n\"created_at\": \"2024-08-30T21:09:00.079909+00:00\",\n\"checkpoint_id\": \"1ef67141-3ca2-6fae-8003-fe96832e57d6\",\n\"parent_checkpoint_id\": \"1ef67141-2129-6b37-8002-61fc3bf69cb5\"\n}\n```\n\nWe can also just print the content of the last AIMessage:\n\n<Tabs>\n  <Tab title=\"Python\">\n    ```python  theme={null}\n    print(final_result['values']['messages'][-1]['content'][0]['text'])\n    ```\n  </Tab>\n\n  <Tab title=\"Javascript\">\n    ```js  theme={null}\n    console.log(finalResult['values']['messages'][finalResult['values']['messages'].length-1]['content'][0]['text']);\n    ```\n  </Tab>\n\n  <Tab title=\"CURL\">\n    ```bash  theme={null}\n    curl --request GET \\\n        --url <DEPLOYMENT_URL>/threads/<THREAD_ID>/state | jq -r '.values.messages[-1].content.[0].text'\n    ```\n  </Tab>\n</Tabs>\n\nOutput:\n\n```\nThe search results provide the current weather conditions in San Francisco. According to the data, as of 2:00 PM on August 30, 2024, the temperature in San Francisco is 70°F (21.1°C) with partly cloudy skies. The wind is blowing from the west-northwest at around 12 mph (19 km/h). The humidity is 59% and visibility is 9 miles (16 km). Overall, it looks like a nice late summer day in San Francisco with comfortable temperatures and partly sunny conditions.\n```\n\n***\n\n<Callout icon=\"pen-to-square\" iconType=\"regular\">\n  [Edit the source of this page on GitHub.](https://github.com/langchain-ai/docs/edit/main/src/langsmith/background-run.mdx)\n</Callout>\n\n<Tip icon=\"terminal\" iconType=\"regular\">\n  [Connect these docs programmatically](/use-these-docs) to Claude, VSCode, and more via MCP for real-time answers.\n</Tip>",
  "content_length": 13316
}