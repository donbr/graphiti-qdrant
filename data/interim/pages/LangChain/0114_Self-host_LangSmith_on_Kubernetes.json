{
  "title": "Self-host LangSmith on Kubernetes",
  "source_url": "https://docs.langchain.com/langsmith/kubernetes",
  "content": "<Info>\n  Self-hosting LangSmith is an add-on to the Enterprise Plan designed for our largest, most security-conscious customers. See our [pricing page](https://www.langchain.com/pricing) for more detail, and [contact our sales team](https://www.langchain.com/contact-sales) if you want to get a license key to trial LangSmith in your environment.\n</Info>\n\nThis page describes how to set up **LangSmith** (observability, tracing, and evaluation) in a Kubernetes cluster. You'll use Helm to install LangSmith and its dependencies.\n\nAfter completing this page, you'll have:\n\n* **LangSmith UI and APIs**: for [observability](/langsmith/observability), tracing, and [evaluation](/langsmith/evaluation).\n* **Backend services**: (queue, playground, ACE).\n* **Datastores**: (PostgreSQL, Redis, ClickHouse, optional blob storage).\n\nFor [agent deployment](/langsmith/deployments): To add deployment capabilities, complete this guide first, then follow [Enable LangSmith Deployment](/langsmith/deploy-self-hosted-full-platform).\n\nLangChain has successfully tested LangSmith on the following Kubernetes distributions:\n\n* Google Kubernetes Engine (GKE)\n* Amazon Elastic Kubernetes Service (EKS): For architecture patterns and best practices, refer to [self-hosting on AWS](/langsmith/aws-self-hosted).\n* Azure Kubernetes Service (AKS): For architecture patterns and best practices, refer to [self-hosting on AWS](/langsmith/azure-self-hosted).\n* OpenShift (4.14+)\n* Minikube and Kind (for development purposes)\n\n<Note>\n  LangChain provides Terraform modules to help provision infrastructure for LangSmith. These modules can quickly set up Kubernetes clusters, storage, and networking for your deployment.\n\n  Available modules:\n\n  * [AWS Terraform modules](https://github.com/langchain-ai/terraform/tree/main/modules/aws)\n  * [Azure Terraform modules](https://github.com/langchain-ai/terraform/tree/main/modules/azure)\n\n  View the [full Terraform repository](https://github.com/langchain-ai/terraform) for documentation and additional resources.\n</Note>\n\n## Prerequisites\n\nEnsure you have the following tools/items ready. Some items are marked optional:\n\n1. LangSmith License Key\n\n   1. You can get this from your LangChain representative. [Contact our sales team](https://www.langchain.com/contact-sales) for more information.\n\n2. Api Key Salt\n\n   1. This is a secret key that you can generate. It should be a random string of characters.\n   2. You can generate this using the following command:\n\n   ```bash  theme={null}\n   openssl rand -base64 32\n   ```\n\n3. JWT Secret (Optional but used for basic auth)\n\n   1. This is a secret key that you can generate. It should be a random string of characters.\n   2. You can generate this using the following command:\n\n   ```bash  theme={null}\n   openssl rand -base64 32\n   ```\n\n### Databases\n\nLangSmith uses a PostgreSQL database, a Redis cache, and a ClickHouse database to store traces. By default, these services are installed inside your Kubernetes cluster. However, we highly recommend using external databases instead. For PostgreSQL and Redis, the best option is your cloud provider’s managed services.\n\nFor more information, refer to the following setup guides for external services:\n\n* [PostgreSQL](/langsmith/self-host-external-postgres)\n* [Redis](/langsmith/self-host-external-redis)\n* [ClickHouse](/langsmith/self-host-external-clickhouse)\n\n### Kubernetes cluster requirements\n\n1. You will need a working Kubernetes cluster that you can access via `kubectl`. Your cluster should have the following minimum requirements:\n\n   1. Recommended: At least 16 vCPUs, 64GB Memory available\n\n      * You may need to tune resource requests/limits for all of our different services based off of organization size/usage. Our recommendations can be found [here](/langsmith/self-host-scale).\n      * We recommend using a cluster autoscaler to handle scaling up/down of nodes based on resource usage.\n      * We recommend setting up the metrics server so that autoscaling can be turned on.\n      * If you are running Clickhouse in-cluster, you must have a node with at least 4 vCPUs and 16GB of memory **allocatable** as ClickHouse will request this amount of resources by default.\n\n   2. Valid Dynamic PV provisioner or PVs available on your cluster (required only if you are running databases in-cluster)\n\n      * To enable persistence, we will try to provision volumes for any database running in-cluster.\n      * If using PVs in your cluster, we highly recommend setting up backups in a production environment.\n      * **We strongly encourage using a storage class backed by SSDs for better performance. We recommend 7000 IOPS and 1000 MiB/s throughput.**\n      * On EKS, you may need to ensure you have the `ebs-csi-driver` installed and configured for dynamic provisioning. Refer to the [EBS CSI Driver documentation](https://docs.aws.amazon.com/eks/latest/userguide/ebs-csi.html) for more information.\n\n      You can verify this by running:\n\n      ```bash  theme={null}\n      kubectl get storageclass\n      ```\n\n      The output should show at least one storage class with a provisioner that supports dynamic provisioning. For example:\n\n      ```bash  theme={null}\n      NAME            PROVISIONER                 RECLAIMPOLICY   VOLUMEBINDINGMODE      ALLOWVOLUMEEXPANSION   AGE\n      gp2 (default)   ebs.csi.eks.amazonaws.com   Delete          WaitForFirstConsumer   true                   161d\n      ```\n\n      <Note>\n        We highly recommend using a storage class that supports volume expansion. This is because traces can potentially require a lot of disk space and your volumes may need to be resized over time.\n      </Note>\n\n      Refer to the [Kubernetes documentation](https://kubernetes.io/do/langsmith/observability-concepts/storage/storage-classes/) for more information on storage classes.\n\n2. Helm\n\n   1. To install `helm` refer to the [Helm documentation](https://helm.sh/docs/intro/install/)\n\n3. Egress to `https://beacon.langchain.com` (if not running in offline mode)\n\n   1. LangSmith requires egress to `https://beacon.langchain.com` for license verification and usage reporting. This is required for LangSmith to function properly. You can find more information on egress requirements in the [Egress](/langsmith/self-host-egress) section.\n\n## Configure your Helm Charts:\n\n1. Create a new file called `langsmith_config.yaml` with the configuration options from the previous step.\n   1. There are several configuration options that you can set in the `langsmith_config.yaml` file. You can find more information on specific configuration options in the [Configuration](/langsmith/self-hosted) section.\n   2. If you are new to Kubernetes or Helm, we’d recommend starting with one of the example configurations in the examples directory of the Helm Chart repository here: [LangSmith helm chart examples](https://github.com/langchain-ai/helm/tree/main/charts/langsmith/examples).\n   3. You can see a full list of configuration options in the `values.yaml` file in the Helm Chart repository here: [LangSmith Helm Chart](https://github.com/langchain-ai/helm/tree/main/charts/langsmith/values.yaml)\n\n<Warning>\n  Only override the settings you need in `langsmith_config.yaml`; don’t copy the entire `values.yaml`.\n  Keeping your config minimal ensures you continue to inherit new defaults and upgrades from the Helm chart.\n</Warning>\n\n2. At a minimum, you will need to set the following configuration options (using basic auth):\n\n   ```yaml  theme={null}\n   config:\n     langsmithLicenseKey: \"<your license key>\"\n     apiKeySalt: \"<your api key salt>\"\n     authType: mixed\n     basicAuth:\n       enabled: true\n       initialOrgAdminEmail: \"admin@langchain.dev\" # Change this to your admin email address\n       initialOrgAdminPassword: \"secure-password\" # Must be at least 12 characters long and have at least one lowercase, uppercase, and symbol\n       jwtSecret: <your jwt salt> # A random string of characters used to sign JWT tokens for basic auth.\n   ```\n\nYou will also need to specify connection details for any external databases you are using.\n\n## Deploying to Kubernetes:\n\n1. Verify that you can connect to your Kubernetes cluster(note: We highly suggest installing into an empty namespace)\n\n   1. Run `kubectl get pods`\n\n      Output should look something like:\n\n      ```bash  theme={null}\n      kubectl get pods                                                                                                                                                                     ⎈ langsmith-eks-2vauP7wf 21:07:46No resources found in default namespace.\n      ```\n\n   <Note>\n     If you are using a namespace other than the default namespace, you will need to specify the namespace in the `helm` and `kubectl` commands by using the `-n <namespace>` flag.\n   </Note>\n\n2. Ensure you have the LangChain Helm repo added. (skip this step if you are using local charts)\n\n   ```bash  theme={null}\n   helm repo add langchain https://langchain-ai.github.io/helm/\"langchain\" has been added to your repositories\n   ```\n\n3. Find the latest version of the chart. You can find the available versions in the [Helm Chart repository](https://github.com/langchain-ai/helm/releases).\n\n   * We generally recommend using the latest version.\n   * You can also run `helm search repo langchain/langsmith --versions` to see the available versions. The output will look something like this:\n\n   ```\n   langchain/langsmith     0.10.14         0.10.32         Helm chart to deploy the langsmith application ...\n   langchain/langsmith     0.10.13         0.10.32         Helm chart to deploy the langsmith application ...\n   langchain/langsmith     0.10.12         0.10.32         Helm chart to deploy the langsmith application ...\n   langchain/langsmith     0.10.11         0.10.29         Helm chart to deploy the langsmith application ...\n   langchain/langsmith     0.10.10         0.10.29         Helm chart to deploy the langsmith application ...\n   ```\n\n4. Run `helm upgrade -i langsmith langchain/langsmith --values langsmith_config.yaml --version <version> -n <namespace> --wait --debug`\n\n   * Replace `<namespace>` with the namespace you want to deploy LangSmith to.\n   * Replace `<version>` with the version of LangSmith you want to install from the previous step. Most users should install the latest version available.\n\n   Once the `helm install` command runs and finishes successfully, you should see output similar to this:\n\n   ```\n   NAME: langsmith\n   LAST DEPLOYED: Fri Sep 17 21:08:47 2021\n   NAMESPACE: langsmith\n   STATUS: deployed\n   REVISION: 1\n   TEST SUITE: None\n   ```\n\n   This may take a few minutes to complete as it will create several Kubernetes resources and run several jobs to initialize the database and other services.\n\n5. Run `kubectl get pods` Output should now look something like this (note the exact pod names may vary based on the version and configuration you used):\n\n   ```\n   langsmith-backend-6ff46c99c4-wz22d       1/1     Running   0          3h2m\n   langsmith-frontend-6bbb94c5df-8xrlr      1/1     Running   0          3h2m\n   langsmith-hub-backend-5cc68c888c-vppjj   1/1     Running   0          3h2m\n   langsmith-playground-6d95fd8dc6-x2d9b    1/1     Running   0          3h2m\n   langsmith-postgres-0                     1/1     Running   0          9h\n   langsmith-queue-5898b9d566-tv6q8         1/1     Running   0          3h2m\n   langsmith-redis-0                        1/1     Running   0          9h\n   ```\n\n## Validate your deployment:\n\n1. Run `kubectl get services`\n\n   Output should look something like:\n\n   ```\n   NAME                    TYPE           CLUSTER-IP       EXTERNAL-IP                                                               PORT(S)        AGE\n   langsmith-backend       ClusterIP      172.20.140.77    <none>                                                                    1984/TCP       35h\n   langsmith-frontend      LoadBalancer   172.20.253.251   <external ip>                                                             80:31591/TCP   35h\n   langsmith-hub-backend   ClusterIP      172.20.112.234   <none>                                                                    1985/TCP       35h\n   langsmith-playground    ClusterIP      172.20.153.194   <none>                                                                    3001/TCP       9h\n   langsmith-postgres      ClusterIP      172.20.244.82    <none>                                                                    5432/TCP       35h\n   langsmith-redis         ClusterIP      172.20.81.217    <none>                                                                    6379/TCP       35h\n   ```\n\n2. Curl the external ip of the `langsmith-frontend` service:\n\n   ```bash  theme={null}\n   curl <external ip>/api/tenants\n   ```\n\n   Expected output:\n\n   ```json  theme={null}\n   [{\"id\":\"00000000-0000-0000-0000-000000000000\",\"has_waitlist_access\":true,\"created_at\":\"2023-09-13T18:25:10.488407\",\"display_name\":\"Personal\",\"config\":{\"is_personal\":true,\"max_identities\":1},\"tenant_handle\":\"default\"}]\n   ```\n\n3. Visit the external ip for the `langsmith-frontend` service on your browser\n\n   The LangSmith UI should be visible/operational\n\n   <img src=\"https://mintcdn.com/langchain-5e9cc07a/4kN8yiLrZX_amfFn/langsmith/images/langsmith-ui.png?fit=max&auto=format&n=4kN8yiLrZX_amfFn&q=85&s=5310f686e7b9eebaaee4fe2a152a8675\" alt=\"\" data-og-width=\"2886\" width=\"2886\" data-og-height=\"1698\" height=\"1698\" data-path=\"langsmith/images/langsmith-ui.png\" data-optimize=\"true\" data-opv=\"3\" srcset=\"https://mintcdn.com/langchain-5e9cc07a/4kN8yiLrZX_amfFn/langsmith/images/langsmith-ui.png?w=280&fit=max&auto=format&n=4kN8yiLrZX_amfFn&q=85&s=5f155ce778ca848f89fefff237b69bcb 280w, https://mintcdn.com/langchain-5e9cc07a/4kN8yiLrZX_amfFn/langsmith/images/langsmith-ui.png?w=560&fit=max&auto=format&n=4kN8yiLrZX_amfFn&q=85&s=1d55d4068a9f53387c129b4688b0971e 560w, https://mintcdn.com/langchain-5e9cc07a/4kN8yiLrZX_amfFn/langsmith/images/langsmith-ui.png?w=840&fit=max&auto=format&n=4kN8yiLrZX_amfFn&q=85&s=feb20198d67249ece559e5fd0e6d8e98 840w, https://mintcdn.com/langchain-5e9cc07a/4kN8yiLrZX_amfFn/langsmith/images/langsmith-ui.png?w=1100&fit=max&auto=format&n=4kN8yiLrZX_amfFn&q=85&s=3e5eba764d911e567d5aaa9e5702327b 1100w, https://mintcdn.com/langchain-5e9cc07a/4kN8yiLrZX_amfFn/langsmith/images/langsmith-ui.png?w=1650&fit=max&auto=format&n=4kN8yiLrZX_amfFn&q=85&s=d45af56632578a8d1b05e546dfc8d01d 1650w, https://mintcdn.com/langchain-5e9cc07a/4kN8yiLrZX_amfFn/langsmith/images/langsmith-ui.png?w=2500&fit=max&auto=format&n=4kN8yiLrZX_amfFn&q=85&s=16a49517a6c224930fdb81c9ccde5527 2500w\" />\n\n## Using LangSmith\n\nNow that LangSmith is running, you can start using it to trace your code. You can find more information on how to use self-hosted LangSmith in the [self-hosted usage guide](/langsmith/self-hosted).\n\nYour LangSmith instance is now running but may not be fully setup yet.\n\nIf you used one of the basic configs, you will have a default admin user account created for you. You can log in with the email address and password you specified in the `langsmith_config.yaml` file.\n\nAs a next step, it is strongly recommended you work with your infrastructure administrators to:\n\n* Setup DNS for your LangSmith instance to enable easier access\n* Configure SSL to ensure in-transit encryption of traces submitted to LangSmith\n* Configure LangSmith with [Single Sign-On](/langsmith/self-host-sso) to secure your LangSmith instance\n* Connect LangSmith to external Postgres and Redis instances\n* Set up [Blob Storage](/langsmith/self-host-blob-storage) for storing large files\n\nReview our [configuration section](/langsmith/self-hosted) for more information on how to configure these options.\n\n***\n\n<Callout icon=\"pen-to-square\" iconType=\"regular\">\n  [Edit the source of this page on GitHub.](https://github.com/langchain-ai/docs/edit/main/src/langsmith/kubernetes.mdx)\n</Callout>\n\n<Tip icon=\"terminal\" iconType=\"regular\">\n  [Connect these docs programmatically](/use-these-docs) to Claude, VSCode, and more via MCP for real-time answers.\n</Tip>",
  "content_length": 16096
}