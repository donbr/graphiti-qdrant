{
  "title": "Run support queries against ClickHouse",
  "source_url": "https://docs.langchain.com/langsmith/script-running-ch-support-queries",
  "content": "This Helm repository contains queries to produce output that the LangSmith UI does not currently support directly (e.g. obtaining query exception logs from Clickhouse).\n\nThis command takes a clickhouse connection string that contains an embedded name and password (which can be passed in from a call to a secrets manager) and executes a query from an input file. In the example below, we are using the `ch_get_query_exceptions.sql` input file in the `support_queries/clickhouse` directory.\n\n### Prerequisites\n\nEnsure you have the following tools/items ready.\n\n1. kubectl\n\n   * [https://kubernetes.io/docs/tasks/tools/](https://kubernetes.io/docs/tasks/tools/)\n\n2. Clickhouse database credentials\n\n   * Host\n   * Port\n   * Username\n     * If using the bundled version, this is `default`\n   * Password\n     * If using the bundled version, this is `password`\n   * Database name\n     * If using the bundled version, this is `default`\n\n3. Connectivity to the Clickhouse database from the machine you will be running the migration script on.\n\n   * If you are using the bundled version, you may need to port forward the clickhouse service to your local machine.\n   * Run `kubectl port-forward svc/langsmith-clickhouse 8123:8123` to port forward the clickhouse service to your local machine.\n\n4. The script to run a support query\n\n   * You can download the script from [here](https://github.com/langchain-ai/helm/blob/main/charts/langsmith/scripts/run_support_query_ch.sh)\n\n### Running the query script\n\nRun the following command to run the desired query:\n\n```bash  theme={null}\nsh run_support_query_ch.sh <clickhouse_url> --input path/to/query.sql\n```\n\nFor example, if you are using the bundled version with port-forwarding, the command might look like:\n\n```bash  theme={null}\nsh run_support_query_ch.sh \"clickhouse://default:password@localhost:8123/default\" --input support_queries/clickhouse/ch_get_query_exceptions.sql\n```\n\nwhich will output query logs for all queries that have thrown exceptions in Clickhouse in the last 7 days. To extract this to a file add the flag `--output path/to/file.csv`\n\n***\n\n<Callout icon=\"pen-to-square\" iconType=\"regular\">\n  [Edit the source of this page on GitHub.](https://github.com/langchain-ai/docs/edit/main/src/langsmith/script-running-ch-support-queries.mdx)\n</Callout>\n\n<Tip icon=\"terminal\" iconType=\"regular\">\n  [Connect these docs programmatically](/use-these-docs) to Claude, VSCode, and more via MCP for real-time answers.\n</Tip>",
  "content_length": 2469
}