{
  "title": "Log retriever traces",
  "source_url": "https://docs.langchain.com/langsmith/log-retriever-trace",
  "content": "<Note>\n  Nothing will break if you don't log retriever traces in the correct format and data will still be logged. However, the data will not be rendered in a way that is specific to retriever steps.\n</Note>\n\nMany LLM applications require looking up documents from vector databases, knowledge graphs, or other types of indexes. Retriever traces are a way to log the documents that are retrieved by the retriever. LangSmith provides special rendering for retrieval steps in traces to make it easier to understand and diagnose retrieval issues. In order for retrieval steps to be rendered correctly, a few small steps need to be taken.\n\n1. Annotate the retriever step with `run_type=\"retriever\"`.\n\n2. Return a list of Python dictionaries or TypeScript objects from the retriever step. Each dictionary should contain the following keys:\n\n   * `page_content`: The text of the document.\n   * `type`: This should always be \"Document\".\n   * `metadata`: A python dictionary or TypeScript object containing metadata about the document. This metadata will be displayed in the trace.\n\nThe following code snippets show how to log a retrieval steps in Python and TypeScript.\n\n<CodeGroup>\n  ```python Python theme={null}\n  from langsmith import traceable\n\n  def _convert_docs(results):\n      return [\n          {\n              \"page_content\": r,\n              \"type\": \"Document\",\n              \"metadata\": {\"foo\": \"bar\"}\n          }\n          for r in results\n      ]\n\n  @traceable(run_type=\"retriever\")\n  def retrieve_docs(query):\n      # Foo retriever returning hardcoded dummy documents.\n      # In production, this could be a real vector datatabase or other document index.\n      contents = [\"Document contents 1\", \"Document contents 2\", \"Document contents 3\"]\n      return _convert_docs(contents)\n\n  retrieve_docs(\"User query\")\n  ```\n\n  ```typescript TypeScript theme={null}\n  import { traceable } from \"langsmith/traceable\";\n\n  interface Document {\n      page_content: string;\n      type: string;\n      metadata: { foo: string };\n  }\n\n  function convertDocs(results: string[]): Document[] {\n      return results.map((r) => ({\n          page_content: r,\n          type: \"Document\",\n          metadata: { foo: \"bar\" }\n      }));\n  }\n\n  const retrieveDocs = traceable((query: string): Document[] => {\n      // Foo retriever returning hardcoded dummy documents.\n      // In production, this could be a real vector database or other document index.\n      const contents = [\"Document contents 1\", \"Document contents 2\", \"Document contents 3\"];\n      return convertDocs(contents);\n  },{\n      name: \"retrieveDocs\",\n      run_type: \"retriever\"\n  } // Configuration for traceable\n  );\n\n  await retrieveDocs(\"User query\");\n  ```\n</CodeGroup>\n\nThe following image shows how a retriever step is rendered in a trace. The contents along with the metadata are displayed with each document.\n\n<img src=\"https://mintcdn.com/langchain-5e9cc07a/Fr2lazPB4XVeEA7l/langsmith/images/retriever-trace.png?fit=max&auto=format&n=Fr2lazPB4XVeEA7l&q=85&s=786c74f63e4c94d35535aa46ac9f38f4\" alt=\"\" data-og-width=\"1614\" width=\"1614\" data-og-height=\"736\" height=\"736\" data-path=\"langsmith/images/retriever-trace.png\" data-optimize=\"true\" data-opv=\"3\" srcset=\"https://mintcdn.com/langchain-5e9cc07a/Fr2lazPB4XVeEA7l/langsmith/images/retriever-trace.png?w=280&fit=max&auto=format&n=Fr2lazPB4XVeEA7l&q=85&s=c2e2720a208cc2402e869e214609ec21 280w, https://mintcdn.com/langchain-5e9cc07a/Fr2lazPB4XVeEA7l/langsmith/images/retriever-trace.png?w=560&fit=max&auto=format&n=Fr2lazPB4XVeEA7l&q=85&s=8949f5484519221d159191e9437a862f 560w, https://mintcdn.com/langchain-5e9cc07a/Fr2lazPB4XVeEA7l/langsmith/images/retriever-trace.png?w=840&fit=max&auto=format&n=Fr2lazPB4XVeEA7l&q=85&s=7f376f3ca4575ffc08eb7fc6bdc0db4c 840w, https://mintcdn.com/langchain-5e9cc07a/Fr2lazPB4XVeEA7l/langsmith/images/retriever-trace.png?w=1100&fit=max&auto=format&n=Fr2lazPB4XVeEA7l&q=85&s=06ac1c1dfa24dab91376f2d641fe9aa2 1100w, https://mintcdn.com/langchain-5e9cc07a/Fr2lazPB4XVeEA7l/langsmith/images/retriever-trace.png?w=1650&fit=max&auto=format&n=Fr2lazPB4XVeEA7l&q=85&s=5046d388f4583d270740adfbd1e58539 1650w, https://mintcdn.com/langchain-5e9cc07a/Fr2lazPB4XVeEA7l/langsmith/images/retriever-trace.png?w=2500&fit=max&auto=format&n=Fr2lazPB4XVeEA7l&q=85&s=aa3aae9c839dd00ca450cfeb7b285371 2500w\" />\n\n***\n\n<Callout icon=\"pen-to-square\" iconType=\"regular\">\n  [Edit the source of this page on GitHub.](https://github.com/langchain-ai/docs/edit/main/src/langsmith/log-retriever-trace.mdx)\n</Callout>\n\n<Tip icon=\"terminal\" iconType=\"regular\">\n  [Connect these docs programmatically](/use-these-docs) to Claude, VSCode, and more via MCP for real-time answers.\n</Tip>",
  "content_length": 4691
}