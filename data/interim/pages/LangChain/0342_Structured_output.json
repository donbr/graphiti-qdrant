{
  "title": "Structured output",
  "source_url": "https://docs.langchain.com/oss/javascript/langchain/structured-output",
  "content": "Structured output allows agents to return data in a specific, predictable format. Instead of parsing natural language responses, you get typed structured data.\n\nLangChain's prebuilt ReAct agent `createAgent` handles structured output automatically. The user sets their desired structured output schema, and when the model generates the structured data, it's captured, validated, and returned in the `structuredResponse` key of the agent's state.\n\n```ts  theme={null}\ntype ResponseFormat = (\n    | ZodSchema<StructuredResponseT> // a Zod schema\n    | Record<string, unknown> // a JSON Schema\n)\n\nconst agent = createAgent({\n    // ...\n    responseFormat: ResponseFormat | ResponseFormat[]\n})\n```\n\n## Response Format\n\nControls how the agent returns structured data. You can provide either a Zod object or JSON schema. By default, the agent uses a tool calling strategy, in which the output is created by an additional tool call. Certain models support native structured output, in which case the agent will use that strategy instead.\n\nYou can control the behavior by wrapping `ResponseFormat` in a `toolStrategy` or `providerStrategy` function call:\n\n```ts  theme={null}\nimport { toolStrategy, providerStrategy } from \"langchain\";\n\nconst agent = createAgent({\n    // use a provider strategy if supported by the model\n    responseFormat: providerStrategy(z.object({ ... }))\n    // or enforce a tool strategy\n    responseFormat: toolStrategy(z.object({ ... }))\n})\n```\n\nThe structured response is returned in the `structuredResponse` key of the agent's final state.\n\n<Tip>\n  Support for native structured output features is read dynamically from the model's [profile data](/oss/javascript/langchain/models#model-profiles) if using `langchain>=1.1`. If data are not available, use another condition or specify manually:\n\n  ```typescript  theme={null}\n  const customProfile: ModelProfile = {\n      structuredOutput: true,\n      // ...\n  }\n  const model = await initChatModel(\"...\", { profile: customProfile });\n  ```\n\n  If tools are specified, the model must support simultaneous use of tools and structured output.\n</Tip>\n\n## Provider strategy\n\nSome model providers support structured output natively through their APIs (e.g. OpenAI, Grok, Gemini). This is the most reliable method when available.\n\nTo use this strategy, configure a `ProviderStrategy`:\n\n```ts  theme={null}\nfunction providerStrategy<StructuredResponseT>(\n    schema: ZodSchema<StructuredResponseT> | JsonSchemaFormat\n): ProviderStrategy<StructuredResponseT>\n```\n\n<ParamField path=\"schema\" required>\n  The schema defining the structured output format. Supports:\n\n  * **Zod Schema**: A zod schema\n  * **JSON Schema**: A JSON schema object\n</ParamField>\n\nLangChain automatically uses `ProviderStrategy` when you pass a schema type directly to `createAgent.responseFormat` and the model supports native structured output:\n\n<CodeGroup>\n  ```ts Zod Schema theme={null}\n  import * as z from \"zod\";\n  import { createAgent, providerStrategy } from \"langchain\";\n\n  const ContactInfo = z.object({\n      name: z.string().describe(\"The name of the person\"),\n      email: z.string().describe(\"The email address of the person\"),\n      phone: z.string().describe(\"The phone number of the person\"),\n  });\n\n  const agent = createAgent({\n      model: \"gpt-5\",\n      tools: [],\n      responseFormat: providerStrategy(ContactInfo)\n  });\n\n  const result = await agent.invoke({\n      messages: [{\"role\": \"user\", \"content\": \"Extract contact info from: John Doe, john@example.com, (555) 123-4567\"}]\n  });\n\n  console.log(result.structuredResponse);\n  // { name: \"John Doe\", email: \"john@example.com\", phone: \"(555) 123-4567\" }\n  ```\n\n  ```ts JSON Schema theme={null}\n  import { createAgent, providerStrategy } from \"langchain\";\n\n  const contactInfoSchema = {\n      \"type\": \"object\",\n      \"description\": \"Contact information for a person.\",\n      \"properties\": {\n          \"name\": {\"type\": \"string\", \"description\": \"The name of the person\"},\n          \"email\": {\"type\": \"string\", \"description\": \"The email address of the person\"},\n          \"phone\": {\"type\": \"string\", \"description\": \"The phone number of the person\"}\n      },\n      \"required\": [\"name\", \"email\", \"phone\"]\n  }\n\n  const agent = createAgent({\n      model: \"gpt-5\",\n      tools: [],\n      responseFormat: providerStrategy(contactInfoSchema)\n  });\n\n  const result = await agent.invoke({\n      messages: [{\"role\": \"user\", \"content\": \"Extract contact info from: John Doe, john@example.com, (555) 123-4567\"}]\n  });\n\n  console.log(result.structuredResponse);\n  // { name: \"John Doe\", email: \"john@example.com\", phone: \"(555) 123-4567\" }\n  ```\n</CodeGroup>\n\nProvider-native structured output provides high reliability and strict validation because the model provider enforces the schema. Use it when available.\n\n<Note>\n  If the provider natively supports structured output for your model choice, it is functionally equivalent to write `responseFormat: contactInfoSchema` instead of `responseFormat: providerStrategy(contactInfoSchema)`. In either case, if structured output is not supported, the agent will fall back to a tool calling strategy.\n</Note>\n\n## Tool calling strategy\n\nFor models that don't support native structured output, LangChain uses tool calling to achieve the same result. This works with all models that support tool calling, which is most modern models.\n\nTo use this strategy, configure a `ToolStrategy`:\n\n```ts  theme={null}\nfunction toolStrategy<StructuredResponseT>(\n    responseFormat:\n        | JsonSchemaFormat\n        | ZodSchema<StructuredResponseT>\n        | (ZodSchema<StructuredResponseT> | JsonSchemaFormat)[]\n    options?: ToolStrategyOptions\n): ToolStrategy<StructuredResponseT>\n```\n\n<ParamField path=\"schema\" required>\n  The schema defining the structured output format. Supports:\n\n  * **Zod Schema**: A zod schema\n  * **JSON Schema**: A JSON schema object\n</ParamField>\n\n<ParamField path=\"options.toolMessageContent\">\n  Custom content for the tool message returned when structured output is generated.\n  If not provided, defaults to a message showing the structured response data.\n</ParamField>\n\n<ParamField path=\"options.handleError\">\n  Options parameter containing an optional `handleError` parameter for customizing the error handling strategy.\n\n  * **`true`**: Catch all errors with default error template (default)\n  * **`False`**: No retry, let exceptions propagate\n  * **`(error: ToolStrategyError) => string | Promise<string>`**: retry with the provided message or throw the error\n</ParamField>\n\n<CodeGroup>\n  ```ts Zod Schema theme={null}\n  import * as z from \"zod\";\n  import { createAgent, toolStrategy } from \"langchain\";\n\n  const ProductReview = z.object({\n      rating: z.number().min(1).max(5).optional(),\n      sentiment: z.enum([\"positive\", \"negative\"]),\n      keyPoints: z.array(z.string()).describe(\"The key points of the review. Lowercase, 1-3 words each.\"),\n  });\n\n  const agent = createAgent({\n      model: \"gpt-5\",\n      tools: [],\n      responseFormat: toolStrategy(ProductReview)\n  })\n\n  const result = await agent.invoke({\n      \"messages\": [{\"role\": \"user\", \"content\": \"Analyze this review: 'Great product: 5 out of 5 stars. Fast shipping, but expensive'\"}]\n  })\n\n  console.log(result.structuredResponse);\n  // { \"rating\": 5, \"sentiment\": \"positive\", \"keyPoints\": [\"fast shipping\", \"expensive\"] }\n  ```\n\n  ```ts JSON Schema theme={null}\n  import { createAgent, toolStrategy } from \"langchain\";\n\n  const productReviewSchema = {\n      \"type\": \"object\",\n      \"description\": \"Analysis of a product review.\",\n      \"properties\": {\n          \"rating\": {\n              \"type\": [\"integer\", \"null\"],\n              \"description\": \"The rating of the product (1-5)\",\n              \"minimum\": 1,\n              \"maximum\": 5\n          },\n          \"sentiment\": {\n              \"type\": \"string\",\n              \"enum\": [\"positive\", \"negative\"],\n              \"description\": \"The sentiment of the review\"\n          },\n          \"key_points\": {\n              \"type\": \"array\",\n              \"items\": {\"type\": \"string\"},\n              \"description\": \"The key points of the review\"\n          }\n      },\n      \"required\": [\"sentiment\", \"key_points\"]\n  }\n\n  const agent = createAgent({\n      model: \"gpt-5\",\n      tools: [],\n      responseFormat: toolStrategy(productReviewSchema)\n  });\n\n  const result = await agent.invoke({\n      messages: [{\"role\": \"user\", \"content\": \"Analyze this review: 'Great product: 5 out of 5 stars. Fast shipping, but expensive'\"}]\n  })\n\n  console.log(result.structuredResponse);\n  // { \"rating\": 5, \"sentiment\": \"positive\", \"keyPoints\": [\"fast shipping\", \"expensive\"] }\n  ```\n\n  ```ts Union Types theme={null}\n  import * as z from \"zod\";\n  import { createAgent, toolStrategy } from \"langchain\";\n\n  const ProductReview = z.object({\n      rating: z.number().min(1).max(5).optional(),\n      sentiment: z.enum([\"positive\", \"negative\"]),\n      keyPoints: z.array(z.string()).describe(\"The key points of the review. Lowercase, 1-3 words each.\"),\n  });\n\n  const CustomerComplaint = z.object({\n      issueType: z.enum([\"product\", \"service\", \"shipping\", \"billing\"]),\n      severity: z.enum([\"low\", \"medium\", \"high\"]),\n      description: z.string().describe(\"Brief description of the complaint\"),\n  });\n\n  const agent = createAgent({\n      model: \"gpt-5\",\n      tools: [],\n      responseFormat: toolStrategy([ProductReview, CustomerComplaint])\n  });\n\n  const result = await agent.invoke({\n      messages: [{\"role\": \"user\", \"content\": \"Analyze this review: 'Great product: 5 out of 5 stars. Fast shipping, but expensive'\"}]\n  })\n\n  console.log(result.structuredResponse);\n  // { \"rating\": 5, \"sentiment\": \"positive\", \"keyPoints\": [\"fast shipping\", \"expensive\"] }\n  ```\n</CodeGroup>\n\n### Custom tool message content\n\nThe `toolMessageContent` parameter allows you to customize the message that appears in the conversation history when structured output is generated:\n\n```ts  theme={null}\nimport * as z from \"zod\";\nimport { createAgent, toolStrategy } from \"langchain\";\n\nconst MeetingAction = z.object({\n    task: z.string().describe(\"The specific task to be completed\"),\n    assignee: z.string().describe(\"Person responsible for the task\"),\n    priority: z.enum([\"low\", \"medium\", \"high\"]).describe(\"Priority level\"),\n});\n\nconst agent = createAgent({\n    model: \"gpt-5\",\n    tools: [],\n    responseFormat: toolStrategy(MeetingAction, {\n        toolMessageContent: \"Action item captured and added to meeting notes!\"\n    })\n});\n\nconst result = await agent.invoke({\n    messages: [{\"role\": \"user\", \"content\": \"From our meeting: Sarah needs to update the project timeline as soon as possible\"}]\n});\n\nconsole.log(result);\n/**\n * {\n *   messages: [\n *     { role: \"user\", content: \"From our meeting: Sarah needs to update the project timeline as soon as possible\" },\n *     { role: \"assistant\", content: \"Action item captured and added to meeting notes!\", tool_calls: [ { name: \"MeetingAction\", args: { task: \"update the project timeline\", assignee: \"Sarah\", priority: \"high\" }, id: \"call_456\" } ] },\n *     { role: \"tool\", content: \"Action item captured and added to meeting notes!\", tool_call_id: \"call_456\", name: \"MeetingAction\" }\n *   ],\n *   structuredResponse: { task: \"update the project timeline\", assignee: \"Sarah\", priority: \"high\" }\n * }\n */\n```\n\nWithout `toolMessageContent`, we'd see:\n\n```ts  theme={null}\n# console.log(result);\n/**\n * {\n *   messages: [\n *     ...\n *     { role: \"tool\", content: \"Returning structured response: {'task': 'update the project timeline', 'assignee': 'Sarah', 'priority': 'high'}\", tool_call_id: \"call_456\", name: \"MeetingAction\" }\n *   ],\n *   structuredResponse: { task: \"update the project timeline\", assignee: \"Sarah\", priority: \"high\" }\n * }\n */\n```\n\n### Error handling\n\nModels can make mistakes when generating structured output via tool calling. LangChain provides intelligent retry mechanisms to handle these errors automatically.\n\n#### Multiple structured outputs error\n\nWhen a model incorrectly calls multiple structured output tools, the agent provides error feedback in a [`ToolMessage`](https://reference.langchain.com/javascript/classes/_langchain_core.messages.ToolMessage.html) and prompts the model to retry:\n\n```ts  theme={null}\nimport * as z from \"zod\";\nimport { createAgent, toolStrategy } from \"langchain\";\n\nconst ContactInfo = z.object({\n    name: z.string().describe(\"Person's name\"),\n    email: z.string().describe(\"Email address\"),\n});\n\nconst EventDetails = z.object({\n    event_name: z.string().describe(\"Name of the event\"),\n    date: z.string().describe(\"Event date\"),\n});\n\nconst agent = createAgent({\n    model: \"gpt-5\",\n    tools: [],\n    responseFormat: toolStrategy([ContactInfo, EventDetails]),\n});\n\nconst result = await agent.invoke({\n    messages: [\n        {\n        role: \"user\",\n        content:\n            \"Extract info: John Doe (john@email.com) is organizing Tech Conference on March 15th\",\n        },\n    ],\n});\n\nconsole.log(result);\n\n/**\n * {\n *   messages: [\n *     { role: \"user\", content: \"Extract info: John Doe (john@email.com) is organizing Tech Conference on March 15th\" },\n *     { role: \"assistant\", content: \"\", tool_calls: [ { name: \"ContactInfo\", args: { name: \"John Doe\", email: \"john@email.com\" }, id: \"call_1\" }, { name: \"EventDetails\", args: { event_name: \"Tech Conference\", date: \"March 15th\" }, id: \"call_2\" } ] },\n *     { role: \"tool\", content: \"Error: Model incorrectly returned multiple structured responses (ContactInfo, EventDetails) when only one is expected.\\n Please fix your mistakes.\", tool_call_id: \"call_1\", name: \"ContactInfo\" },\n *     { role: \"tool\", content: \"Error: Model incorrectly returned multiple structured responses (ContactInfo, EventDetails) when only one is expected.\\n Please fix your mistakes.\", tool_call_id: \"call_2\", name: \"EventDetails\" },\n *     { role: \"assistant\", content: \"\", tool_calls: [ { name: \"ContactInfo\", args: { name: \"John Doe\", email: \"john@email.com\" }, id: \"call_3\" } ] },\n *     { role: \"tool\", content: \"Returning structured response: {'name': 'John Doe', 'email': 'john@email.com'}\", tool_call_id: \"call_3\", name: \"ContactInfo\" }\n *   ],\n *   structuredResponse: { name: \"John Doe\", email: \"john@email.com\" }\n * }\n */\n```\n\n#### Schema validation error\n\nWhen structured output doesn't match the expected schema, the agent provides specific error feedback:\n\n```ts  theme={null}\nimport * as z from \"zod\";\nimport { createAgent, toolStrategy } from \"langchain\";\n\nconst ProductRating = z.object({\n    rating: z.number().min(1).max(5).describe(\"Rating from 1-5\"),\n    comment: z.string().describe(\"Review comment\"),\n});\n\nconst agent = createAgent({\n    model: \"gpt-5\",\n    tools: [],\n    responseFormat: toolStrategy(ProductRating),\n});\n\nconst result = await agent.invoke({\n    messages: [\n        {\n        role: \"user\",\n        content: \"Parse this: Amazing product, 10/10!\",\n        },\n    ],\n});\n\nconsole.log(result);\n\n/**\n * {\n *   messages: [\n *     { role: \"user\", content: \"Parse this: Amazing product, 10/10!\" },\n *     { role: \"assistant\", content: \"\", tool_calls: [ { name: \"ProductRating\", args: { rating: 10, comment: \"Amazing product\" }, id: \"call_1\" } ] },\n *     { role: \"tool\", content: \"Error: Failed to parse structured output for tool 'ProductRating': 1 validation error for ProductRating\\nrating\\n  Input should be less than or equal to 5 [type=less_than_equal, input_value=10, input_type=int].\\n Please fix your mistakes.\", tool_call_id: \"call_1\", name: \"ProductRating\" },\n *     { role: \"assistant\", content: \"\", tool_calls: [ { name: \"ProductRating\", args: { rating: 5, comment: \"Amazing product\" }, id: \"call_2\" } ] },\n *     { role: \"tool\", content: \"Returning structured response: {'rating': 5, 'comment': 'Amazing product'}\", tool_call_id: \"call_2\", name: \"ProductRating\" }\n *   ],\n *   structuredResponse: { rating: 5, comment: \"Amazing product\" }\n * }\n */\n```\n\n#### Error handling strategies\n\nYou can customize how errors are handled using the `handleErrors` parameter:\n\n**Custom error message:**\n\n```ts  theme={null}\nconst responseFormat = toolStrategy(ProductRating, {\n    handleError: \"Please provide a valid rating between 1-5 and include a comment.\"\n)\n\n// Error message becomes:\n// { role: \"tool\", content: \"Please provide a valid rating between 1-5 and include a comment.\" }\n```\n\n**Handle specific exceptions only:**\n\n```ts  theme={null}\nimport { ToolInputParsingException } from \"@langchain/core/tools\";\n\nconst responseFormat = toolStrategy(ProductRating, {\n    handleError: (error: ToolStrategyError) => {\n        if (error instanceof ToolInputParsingException) {\n        return \"Please provide a valid rating between 1-5 and include a comment.\";\n        }\n        return error.message;\n    }\n)\n\n// Only validation errors get retried with default message:\n// { role: \"tool\", content: \"Error: Failed to parse structured output for tool 'ProductRating': ...\\n Please fix your mistakes.\" }\n```\n\n**Handle multiple exception types:**\n\n```ts  theme={null}\nconst responseFormat = toolStrategy(ProductRating, {\n    handleError: (error: ToolStrategyError) => {\n        if (error instanceof ToolInputParsingException) {\n        return \"Please provide a valid rating between 1-5 and include a comment.\";\n        }\n        if (error instanceof CustomUserError) {\n        return \"This is a custom user error.\";\n        }\n        return error.message;\n    }\n)\n```\n\n**No error handling:**\n\n```ts  theme={null}\nconst responseFormat = toolStrategy(ProductRating, {\n    handleError: false  // All errors raised\n)\n```\n\n***\n\n<Callout icon=\"pen-to-square\" iconType=\"regular\">\n  [Edit the source of this page on GitHub.](https://github.com/langchain-ai/docs/edit/main/src/oss/langchain/structured-output.mdx)\n</Callout>\n\n<Tip icon=\"terminal\" iconType=\"regular\">\n  [Connect these docs programmatically](/use-these-docs) to Claude, VSCode, and more via MCP for real-time answers.\n</Tip>",
  "content_length": 17895
}