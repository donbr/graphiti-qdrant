{
  "title": "Trace with CrewAI",
  "source_url": "https://docs.langchain.com/langsmith/trace-with-crewai",
  "content": "LangSmith can capture traces generated by [CrewAI](https://github.com/crewAIInc/crewAI) using OpenInference's CrewAI instrumentation. This guide shows you how to automatically capture traces from your CrewAI multi-agent workflows and send them to LangSmith for monitoring and analysis.\n\n## Installation\n\nInstall the required packages using your preferred package manager:\n\n<CodeGroup>\n  ```bash pip theme={null}\n  pip install langsmith crewai openinference-instrumentation-crewai openinference-instrumentation-openai\n  ```\n\n  ```bash uv theme={null}\n  uv add langsmith crewai openinference-instrumentation-crewai openinference-instrumentation-openai\n  ```\n</CodeGroup>\n\n## Setup\n\n### 1. Configure environment variables\n\nSet your API keys and project name:\n\n<CodeGroup>\n  ```bash Shell theme={null}\n  export LANGSMITH_API_KEY=<your_langsmith_api_key>\n  export LANGSMITH_PROJECT=<your_project_name>\n  export OPENAI_API_KEY=<your_openai_api_key>\n  ```\n</CodeGroup>\n\n### 2. Configure OpenTelemetry integration\n\nIn your CrewAI application, import and configure the LangSmith OpenTelemetry integration along with the CrewAI and OpenAI instrumentors:\n\n```python  theme={null}\nfrom langsmith.integrations.otel import OtelSpanProcessor\nfrom opentelemetry import trace\nfrom opentelemetry.sdk.trace import TracerProvider\nfrom openinference.instrumentation.crewai import CrewAIInstrumentor\nfrom openinference.instrumentation.openai import OpenAIInstrumentor\n\n# Get or create tracer provider\ntracer_provider = trace.get_tracer_provider()\nif not isinstance(tracer_provider, TracerProvider):\n    tracer_provider = TracerProvider()\n    trace.set_tracer_provider(tracer_provider)\n\n# Add OtelSpanProcessor to the tracer provider\ntracer_provider.add_span_processor(OtelSpanProcessor())\n\n# Instrument CrewAI and OpenAI\nCrewAIInstrumentor().instrument()\nOpenAIInstrumentor().instrument()\n```\n\n### 3. Create and run your CrewAI application\n\nOnce configured, your CrewAI application will automatically send traces to LangSmith:\n\nThis example includes a minimal app that defines agents and tasks, creates a crew, and runs it to produce traced activity.\n\n```python  theme={null}\nfrom crewai import Agent, Task, Crew\nfrom langsmith.integrations.otel import OtelSpanProcessor\nfrom opentelemetry import trace\nfrom opentelemetry.sdk.trace import TracerProvider\nfrom openinference.instrumentation.crewai import CrewAIInstrumentor\nfrom openinference.instrumentation.openai import OpenAIInstrumentor\nimport dotenv\n\n# Load environment variables\ndotenv.load_dotenv(\".env.local\")\n\n# Configure OpenTelemetry\ntracer_provider = trace.get_tracer_provider()\nif not isinstance(tracer_provider, TracerProvider):\n    tracer_provider = TracerProvider()\n    trace.set_tracer_provider(tracer_provider)\n\n# Add OtelSpanProcessor to the tracer provider\ntracer_provider.add_span_processor(OtelSpanProcessor())\n\n# Instrument CrewAI and OpenAI\nCrewAIInstrumentor().instrument()\nOpenAIInstrumentor().instrument()\n\n# Define your agents\nmarket_researcher = Agent(\n    role=\"Senior Market Researcher\",\n    goal=\"Analyze market trends and consumer behavior in the tech industry\",\n    backstory=\"\"\"You are an experienced market researcher with 10+ years of experience\n    analyzing technology markets. You excel at identifying emerging trends and\n    understanding consumer needs.\"\"\",\n    verbose=True,\n    allow_delegation=False,\n)\n\ncontent_strategist = Agent(\n    role=\"Content Marketing Strategist\",\n    goal=\"Create compelling marketing content based on research insights\",\n    backstory=\"\"\"You are a creative content strategist who transforms complex market\n    research into engaging marketing materials. You understand how to communicate\n    technical concepts to different audiences.\"\"\",\n    verbose=True,\n    allow_delegation=False,\n)\n\ndata_analyst = Agent(\n    role=\"Data Analyst\",\n    goal=\"Provide statistical analysis and data-driven insights\",\n    backstory=\"\"\"You are a skilled data analyst who can interpret complex datasets\n    and provide actionable insights. You excel at finding patterns and trends\n    in data that others might miss.\"\"\",\n    verbose=True,\n    allow_delegation=False,\n)\n\n# Define your tasks\nresearch_task = Task(\n    description=\"\"\"Conduct comprehensive research on the current state of AI adoption\n    in small to medium businesses. Focus on:\n    1. Current adoption rates and trends\n    2. Main barriers to adoption\n    3. Most popular AI tools and use cases\n    4. ROI and business impact metrics\n\n    Provide a detailed analysis with supporting data and statistics.\"\"\",\n    agent=market_researcher,\n    expected_output=\"A comprehensive market research report on AI adoption in SMBs with data, trends, and insights.\",\n)\n\nanalysis_task = Task(\n    description=\"\"\"Analyze the research findings and identify key statistical patterns.\n    Create data visualizations and provide quantitative insights on:\n    1. Adoption rate trends over time\n    2. Industry-specific adoption patterns\n    3. ROI correlation analysis\n    4. Barrier impact assessment\n\n    Present findings in a clear, data-driven format.\"\"\",\n    agent=data_analyst,\n    expected_output=\"Statistical analysis report with key metrics, trends, and data-driven insights.\",\n    context=[research_task],\n)\n\ncontent_task = Task(\n    description=\"\"\"Based on the research and analysis, create a compelling marketing\n    strategy document that includes:\n    1. Executive summary of key findings\n    2. Target audience personas based on adoption patterns\n    3. Key messaging framework addressing main barriers\n    4. Content recommendations for different business segments\n    5. Campaign strategy to drive AI adoption\n\n    Make the content actionable and business-focused.\"\"\",\n    agent=content_strategist,\n    expected_output=\"Complete marketing strategy document with personas, messaging, and campaign recommendations.\",\n    context=[research_task, analysis_task],\n)\n\n# Create and run the crew\ncrew = Crew(\n    agents=[market_researcher, data_analyst, content_strategist],\n    tasks=[research_task, analysis_task, content_task],\n    verbose=True,\n    process=\"sequential\"  # Tasks will be executed in order\n)\n\ndef run_market_research_crew():\n    \"\"\"Run the market research crew and return results.\"\"\"\n    result = crew.kickoff()\n    return result\n\nif __name__ == \"__main__\":\n    print(\"Running CrewAI market research process...\")\n    output = run_market_research_crew()\n    print(\"\\n\" + \"=\"*50)\n    print(\"CrewAI Process Output:\")\n    print(\"=\"*50)\n    print(output)\n```\n\n## Advanced usage\n\n### Custom metadata and tags\n\nYou can add custom metadata to your traces by setting span attributes in your CrewAI application:\n\n```python  theme={null}\nfrom opentelemetry import trace\n\n# Get the current tracer\ntracer = trace.get_tracer(__name__)\n\ndef run_market_research_crew():\n    with tracer.start_as_current_span(\"crewai_market_research\") as span:\n        # Add custom metadata\n        span.set_attribute(\"langsmith.metadata.crew_type\", \"market_research\")\n        span.set_attribute(\"langsmith.metadata.agent_count\", \"3\")\n        span.set_attribute(\"langsmith.metadata.task_complexity\", \"high\")\n        span.set_attribute(\"langsmith.span.tags\", \"crewai,market-research,multi-agent\")\n\n        # Run your crew\n        result = crew.kickoff()\n        return result\n```\n\n### Combining with other instrumentors\n\nYou can combine CrewAI instrumentation with other instrumentors by adding them to your setup:\n\n```python  theme={null}\nfrom openinference.instrumentation.crewai import CrewAIInstrumentor\nfrom openinference.instrumentation.openai import OpenAIInstrumentor\nfrom openinference.instrumentation.dspy import DSPyInstrumentor\n\n# Initialize multiple instrumentors\nCrewAIInstrumentor().instrument()\nOpenAIInstrumentor().instrument()\nDSPyInstrumentor().instrument()\n```\n\n***\n\n<Callout icon=\"pen-to-square\" iconType=\"regular\">\n  [Edit the source of this page on GitHub.](https://github.com/langchain-ai/docs/edit/main/src/langsmith/trace-with-crewai.mdx)\n</Callout>\n\n<Tip icon=\"terminal\" iconType=\"regular\">\n  [Connect these docs programmatically](/use-these-docs) to Claude, VSCode, and more via MCP for real-time answers.\n</Tip>",
  "content_length": 8159
}