{
  "title": "LangSmith Tool Server",
  "source_url": "https://docs.langchain.com/langsmith/agent-builder-mcp-framework",
  "content": "The LangSmith Tool Server is our MCP Framework that powers the tools available in the LangSmith Agent Builder. This framework enables you to build and deploy custom tools that can be integrated with your agents. It provides a standardized way to create, deploy, and manage tools with built-in authentication and authorization.\n\nThe PyPi package that defines the framework is available [here](https://pypi.org/project/langsmith-tool-server/).\n\n## Quick start\n\nInstall the LangSmith Tool Server and LangChain CLI:\n\n```bash  theme={null}\npip install langsmith-tool-server\npip install langchain-cli-v2\n```\n\nCreate a new toolkit:\n\n```bash  theme={null}\nlangchain tools new my-toolkit\ncd my-toolkit\n```\n\nThis creates a toolkit with the following structure:\n\n```\nmy-toolkit/\n├── pyproject.toml\n├── toolkit.toml\n└── my_toolkit/\n    ├── __init__.py\n    ├── auth.py\n    └── tools/\n        ├── __init__.py\n        └── ...\n```\n\nDefine your tools using the `@tool` decorator:\n\n```python  theme={null}\nfrom langsmith_tool_server import tool\n\n@tool\ndef hello(name: str) -> str:\n    \"\"\"Greet someone by name.\"\"\"\n    return f\"Hello, {name}!\"\n\n@tool\ndef add(x: int, y: int) -> int:\n    \"\"\"Add two numbers.\"\"\"\n    return x + y\n\nTOOLS = [hello, add]\n```\n\nRun the server:\n\n```bash  theme={null}\nlangchain tools serve\n```\n\nYour tool server will start on `http://localhost:8000`.\n\n## Simple client example\n\nHere's a simple example that lists available tools and calls the `add` tool:\n\n```python  theme={null}\nimport asyncio\nimport aiohttp\n\nasync def mcp_request(url: str, method: str, params: dict = None):\n    async with aiohttp.ClientSession() as session:\n        payload = {\"jsonrpc\": \"2.0\", \"method\": method, \"params\": params or {}, \"id\": 1}\n        async with session.post(f\"{url}/mcp\", json=payload) as response:\n            return await response.json()\n\nasync def main():\n    url = \"http://localhost:8000\"\n\n    tools = await mcp_request(url, \"tools/list\")\n    print(f\"Tools: {tools}\")\n\n    result = await mcp_request(url, \"tools/call\", {\"name\": \"add\", \"arguments\": {\"a\": 5, \"b\": 3}})\n    print(f\"Result: {result}\")\n\nasyncio.run(main())\n```\n\n## Adding OAuth authentication\n\nFor tools that need to access third-party APIs (like Google, GitHub, Slack, etc.), you can use OAuth authentication with [Agent Auth](/langsmith/agent-auth).\n\nBefore using OAuth in your tools, you'll need to configure an OAuth provider in your LangSmith workspace settings. See the [Agent Auth documentation](/langsmith/agent-auth) for setup instructions.\n\nOnce configured, specify the `auth_provider` in your tool decorator:\n\n```python  theme={null}\nfrom langsmith_tool_server import tool, Context\nfrom google.oauth2.credentials import Credentials\nfrom googleapiclient.discovery import build\n\n@tool(\n    auth_provider=\"google\",\n    scopes=[\"https://www.googleapis.com/auth/gmail.readonly\"],\n    integration=\"gmail\"\n)\nasync def read_emails(context: Context, max_results: int = 10) -> str:\n    \"\"\"Read recent emails from Gmail.\"\"\"\n    credentials = Credentials(token=context.token)\n    service = build('gmail', 'v1', credentials=credentials)\n    # ... Gmail API calls\n    return f\"Retrieved {max_results} emails\"\n```\n\nTools with `auth_provider` must:\n\n* Have `context: Context` as the first parameter\n* Specify at least one scope\n* Use `context.token` to make authenticated API calls\n\n## Using as an MCP gateway\n\nThe LangSmith Tool Server can act as an MCP gateway, aggregating tools from multiple MCP servers into a single endpoint. Configure MCP servers in your `toolkit.toml`:\n\n```toml  theme={null}\n[toolkit]\nname = \"my-toolkit\"\ntools = \"./my_toolkit/__init__.py:TOOLS\"\n\n[[mcp_servers]]\nname = \"weather\"\ntransport = \"streamable_http\"\nurl = \"http://localhost:8001/mcp/\"\n\n[[mcp_servers]]\nname = \"math\"\ntransport = \"stdio\"\ncommand = \"python\"\nargs = [\"-m\", \"mcp_server_math\"]\n```\n\nAll tools from connected MCP servers are exposed through your server's `/mcp` endpoint. MCP tools are prefixed with their server name to avoid conflicts (e.g., `weather.get_forecast`, `math.add`).\n\n## Custom authentication\n\nCustom authentication allows you to validate requests and integrate with your identity provider. Define an authentication handler in your `auth.py` file:\n\n```python  theme={null}\nfrom langsmith_tool_server import Auth\n\nauth = Auth()\n\n@auth.authenticate\nasync def authenticate(authorization: str = None) -> dict:\n    \"\"\"Validate requests and return user identity.\"\"\"\n    if not authorization or not authorization.startswith(\"Bearer \"):\n        raise auth.exceptions.HTTPException(\n            status_code=401,\n            detail=\"Unauthorized\"\n        )\n\n    token = authorization.replace(\"Bearer \", \"\")\n    # Validate token with your identity provider\n    user = await verify_token_with_idp(token)\n\n    return {\"identity\": user.id}\n```\n\nThe handler runs on every request and must return a dict with `identity` (and optionally `permissions`).\n\n***\n\n<Callout icon=\"pen-to-square\" iconType=\"regular\">\n  [Edit the source of this page on GitHub.](https://github.com/langchain-ai/docs/edit/main/src/langsmith/agent-builder-mcp-framework.mdx)\n</Callout>\n\n<Tip icon=\"terminal\" iconType=\"regular\">\n  [Connect these docs programmatically](/use-these-docs) to Claude, VSCode, and more via MCP for real-time answers.\n</Tip>",
  "content_length": 5272
}