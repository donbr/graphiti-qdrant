{
  "title": "Enqueue concurrent",
  "source_url": "https://docs.langchain.com/langsmith/enqueue-concurrent",
  "content": "This guide assumes knowledge of what double-texting is, which you can learn about in the [double-texting conceptual guide](/langsmith/double-texting).\n\nThe guide covers the `enqueue` option for double texting, which adds the interruptions to a queue and executes them in the order they are received by the client. Below is a quick example of using the `enqueue` option.\n\n## Setup\n\nFirst, we will define a quick helper function for printing out JS and CURL model outputs (you can skip this if using Python):\n\n<Tabs>\n  <Tab title=\"Javascript\">\n    ```js  theme={null}\n    function prettyPrint(m) {\n      const padded = \" \" + m['type'] + \" \";\n      const sepLen = Math.floor((80 - padded.length) / 2);\n      const sep = \"=\".repeat(sepLen);\n      const secondSep = sep + (padded.length % 2 ? \"=\" : \"\");\n\n      console.log(`${sep}${padded}${secondSep}`);\n      console.log(\"\\n\\n\");\n      console.log(m.content);\n    }\n    ```\n  </Tab>\n\n  <Tab title=\"CURL\">\n    ```bash  theme={null}\n    # PLACE THIS IN A FILE CALLED pretty_print.sh\n    pretty_print() {\n      local type=\"$1\"\n      local content=\"$2\"\n      local padded=\" $type \"\n      local total_width=80\n      local sep_len=$(( (total_width - ${#padded}) / 2 ))\n      local sep=$(printf '=%.0s' $(eval \"echo {1..\"${sep_len}\"}\"))\n      local second_sep=$sep\n      if (( (total_width - ${#padded}) % 2 )); then\n        second_sep=\"${second_sep}=\"\n      fi\n\n      echo \"${sep}${padded}${second_sep}\"\n      echo\n      echo \"$content\"\n    }\n    ```\n  </Tab>\n</Tabs>\n\nThen, let's import our required packages and instantiate our client, assistant, and thread.\n\n<Tabs>\n  <Tab title=\"Python\">\n    ```python  theme={null}\n    import asyncio\n\n    import httpx\n    from langchain_core.messages import convert_to_messages\n    from langgraph_sdk import get_client\n\n    client = get_client(url=<DEPLOYMENT_URL>)\n    # Using the graph deployed with the name \"agent\"\n    assistant_id = \"agent\"\n    thread = await client.threads.create()\n    ```\n  </Tab>\n\n  <Tab title=\"Javascript\">\n    ```js  theme={null}\n    import { Client } from \"@langchain/langgraph-sdk\";\n\n\n    const client = new Client({ apiUrl: <DEPLOYMENT_URL> });\n    // Using the graph deployed with the name \"agent\"\n    const assistantId = \"agent\";\n    const thread = await client.threads.create();\n    ```\n  </Tab>\n\n  <Tab title=\"CURL\">\n    ```bash  theme={null}\n    curl --request POST \\\n      --url <DEPLOYMENT_URL>/threads \\\n      --header 'Content-Type: application/json' \\\n      --data '{}'\n    ```\n  </Tab>\n</Tabs>\n\n## Create runs\n\nNow let's start two runs, with the second interrupting the first one with a multitask strategy of \"enqueue\":\n\n<Tabs>\n  <Tab title=\"Python\">\n    ```python  theme={null}\n    first_run = await client.runs.create(\n        thread[\"thread_id\"],\n        assistant_id,\n        input={\"messages\": [{\"role\": \"user\", \"content\": \"what's the weather in sf?\"}]},\n    )\n    second_run = await client.runs.create(\n        thread[\"thread_id\"],\n        assistant_id,\n        input={\"messages\": [{\"role\": \"user\", \"content\": \"what's the weather in nyc?\"}]},\n        multitask_strategy=\"enqueue\",\n    )\n    ```\n  </Tab>\n\n  <Tab title=\"Javascript\">\n    ```js  theme={null}\n    const firstRun = await client.runs.create(\n      thread[\"thread_id\"],\n      assistantId,\n      input={\"messages\": [{\"role\": \"user\", \"content\": \"what's the weather in sf?\"}]},\n    )\n\n    const secondRun = await client.runs.create(\n      thread[\"thread_id\"],\n      assistantId,\n      input={\"messages\": [{\"role\": \"user\", \"content\": \"what's the weather in nyc?\"}]},\n      multitask_strategy=\"enqueue\",\n    )\n    ```\n  </Tab>\n\n  <Tab title=\"CURL\">\n    ```bash  theme={null}\n    curl --request POST \\\n    --url <DEPLOY<ENT_URL>>/threads/<THREAD_ID>/runs \\\n    --header 'Content-Type: application/json' \\\n    --data \"{\n      \\\"assistant_id\\\": \\\"agent\\\",\n      \\\"input\\\": {\\\"messages\\\": [{\\\"role\\\": \\\"human\\\", \\\"content\\\": \\\"what\\'s the weather in sf?\\\"}]},\n    }\" && curl --request POST \\\n    --url <DEPLOY<ENT_URL>>/threads/<THREAD_ID>/runs \\\n    --header 'Content-Type: application/json' \\\n    --data \"{\n      \\\"assistant_id\\\": \\\"agent\\\",\n      \\\"input\\\": {\\\"messages\\\": [{\\\"role\\\": \\\"human\\\", \\\"content\\\": \\\"what\\'s the weather in nyc?\\\"}]},\n      \\\"multitask_strategy\\\": \\\"enqueue\\\"\n    }\"\n    ```\n  </Tab>\n</Tabs>\n\n## View run results\n\nVerify that the thread has data from both runs:\n\n<Tabs>\n  <Tab title=\"Python\">\n    ```python  theme={null}\n    # wait until the second run completes\n    await client.runs.join(thread[\"thread_id\"], second_run[\"run_id\"])\n\n    state = await client.threads.get_state(thread[\"thread_id\"])\n\n    for m in convert_to_messages(state[\"values\"][\"messages\"]):\n        m.pretty_print()\n    ```\n  </Tab>\n\n  <Tab title=\"Javascript\">\n    ```js  theme={null}\n    await client.runs.join(thread[\"thread_id\"], secondRun[\"run_id\"]);\n\n    const state = await client.threads.getState(thread[\"thread_id\"]);\n\n    for (const m of state[\"values\"][\"messages\"]) {\n      prettyPrint(m);\n    }\n    ```\n  </Tab>\n\n  <Tab title=\"CURL\">\n    ```bash  theme={null}\n    source pretty_print.sh && curl --request GET \\\n    --url <DEPLOYMENT_URL>/threads/<THREAD_ID>/runs/<RUN_ID>/join && \\\n    curl --request GET --url <DEPLOYMENT_URL>/threads/<THREAD_ID>/state | \\\n    jq -c '.values.messages[]' | while read -r element; do\n        type=$(echo \"$element\" | jq -r '.type')\n        content=$(echo \"$element\" | jq -r '.content | if type == \"array\" then tostring else . end')\n        pretty_print \"$type\" \"$content\"\n    done\n    ```\n  </Tab>\n</Tabs>\n\nOutput:\n\n```\n================================ Human Message =================================\n\nwhat's the weather in sf?\n================================== Ai Message ==================================\n\n[{'id': 'toolu_01Dez1sJre4oA2Y7NsKJV6VT', 'input': {'query': 'weather in san francisco'}, 'name': 'tavily_search_results_json', 'type': 'tool_use'}]\nTool Calls:\ntavily_search_results_json (toolu_01Dez1sJre4oA2Y7NsKJV6VT)\nCall ID: toolu_01Dez1sJre4oA2Y7NsKJV6VT\nArgs:\nquery: weather in san francisco\n================================= Tool Message =================================\nName: tavily_search_results_json\n\n[{\"url\": \"https://www.accuweather.com/en/us/san-francisco/94103/weather-forecast/347629\", \"content\": \"Get the current and future weather conditions for San Francisco, CA, including temperature, precipitation, wind, air quality and more. See the hourly and 10-day outlook, radar maps, alerts and allergy information.\"}]\n================================== Ai Message ==================================\n\nAccording to AccuWeather, the current weather conditions in San Francisco are:\n\nTemperature: 57°F (14°C)\nConditions: Mostly Sunny\nWind: WSW 10 mph\nHumidity: 72%\n\nThe forecast for the next few days shows partly sunny skies with highs in the upper 50s to mid 60s F (14-18°C) and lows in the upper 40s to low 50s F (9-11°C). Typical mild, dry weather for San Francisco this time of year.\n\nSome key details from the AccuWeather forecast:\n\nToday: Mostly sunny, high of 62°F (17°C)\nTonight: Partly cloudy, low of 49°F (9°C)\nTomorrow: Partly sunny, high of 59°F (15°C)\nSaturday: Mostly sunny, high of 64°F (18°C)\nSunday: Partly sunny, high of 61°F (16°C)\n\nSo in summary, expect seasonable spring weather in San Francisco over the next several days, with a mix of sun and clouds and temperatures ranging from the upper 40s at night to the low 60s during the days. Typical dry conditions with no rain in the forecast.\n================================ Human Message =================================\n\nwhat's the weather in nyc?\n================================== Ai Message ==================================\n\n[{'text': 'Here are the current weather conditions and forecast for New York City:', 'type': 'text'}, {'id': 'toolu_01FFft5Sx9oS6AdVJuRWWcGp', 'input': {'query': 'weather in new york city'}, 'name': 'tavily_search_results_json', 'type': 'tool_use'}]\nTool Calls:\ntavily_search_results_json (toolu_01FFft5Sx9oS6AdVJuRWWcGp)\nCall ID: toolu_01FFft5Sx9oS6AdVJuRWWcGp\nArgs:\nquery: weather in new york city\n================================= Tool Message =================================\nName: tavily_search_results_json\n\n[{\"url\": \"https://www.weatherapi.com/\", \"content\": \"{'location': {'name': 'New York', 'region': 'New York', 'country': 'United States of America', 'lat': 40.71, 'lon': -74.01, 'tz_id': 'America/New_York', 'localtime_epoch': 1718734479, 'localtime': '2024-06-18 14:14'}, 'current': {'last_updated_epoch': 1718733600, 'last_updated': '2024-06-18 14:00', 'temp_c': 29.4, 'temp_f': 84.9, 'is_day': 1, 'condition': {'text': 'Sunny', 'icon': '//cdn.weatherapi.com/weather/64x64/day/113.png', 'code': 1000}, 'wind_mph': 2.2, 'wind_kph': 3.6, 'wind_degree': 158, 'wind_dir': 'SSE', 'pressure_mb': 1025.0, 'pressure_in': 30.26, 'precip_mm': 0.0, 'precip_in': 0.0, 'humidity': 63, 'cloud': 0, 'feelslike_c': 31.3, 'feelslike_f': 88.3, 'windchill_c': 28.3, 'windchill_f': 82.9, 'heatindex_c': 29.6, 'heatindex_f': 85.3, 'dewpoint_c': 18.4, 'dewpoint_f': 65.2, 'vis_km': 16.0, 'vis_miles': 9.0, 'uv': 7.0, 'gust_mph': 16.5, 'gust_kph': 26.5}}\"}]\n================================== Ai Message ==================================\n\nAccording to the weather data from WeatherAPI:\n\nCurrent Conditions in New York City (as of 2:00 PM local time):\n\n* Temperature: 85°F (29°C)\n* Conditions: Sunny\n* Wind: 2 mph (4 km/h) from the SSE\n* Humidity: 63%\n* Heat Index: 85°F (30°C)\n\nThe forecast shows sunny and warm conditions persisting over the next few days:\n\nToday: Sunny, high of 85°F (29°C)\nTonight: Clear, low of 68°F (20°C)\nTomorrow: Sunny, high of 88°F (31°C)\nThursday: Mostly sunny, high of 90°F (32°C)\nFriday: Partly cloudy, high of 87°F (31°C)\n\nSo New York City is experiencing beautiful sunny weather with seasonably warm temperatures in the mid-to-upper 80s Fahrenheit (around 30°C). Humidity is moderate in the 60% range. Overall, ideal late spring/early summer conditions for being outdoors in the city over the next several days.\n```\n\n***\n\n<Callout icon=\"pen-to-square\" iconType=\"regular\">\n  [Edit the source of this page on GitHub.](https://github.com/langchain-ai/docs/edit/main/src/langsmith/enqueue-concurrent.mdx)\n</Callout>\n\n<Tip icon=\"terminal\" iconType=\"regular\">\n  [Connect these docs programmatically](/use-these-docs) to Claude, VSCode, and more via MCP for real-time answers.\n</Tip>",
  "content_length": 10348
}