{
  "title": "Interrupt concurrent",
  "source_url": "https://docs.langchain.com/langsmith/interrupt-concurrent",
  "content": "This guide assumes knowledge of what double-texting is, which you can learn about in the [double-texting conceptual guide](/langsmith/double-texting).\n\nThe guide covers the `interrupt` option for double texting, which interrupts the prior run of the graph and starts a new one with the double-text. This option does not delete the first run, but rather keeps it in the database but sets its status to `interrupted`. Below is a quick example of using the `interrupt` option.\n\n## Setup\n\nFirst, we will define a quick helper function for printing out JS and CURL model outputs (you can skip this if using Python):\n\n<Tabs>\n  <Tab title=\"Javascript\">\n    ```js  theme={null}\n    function prettyPrint(m) {\n      const padded = \" \" + m['type'] + \" \";\n      const sepLen = Math.floor((80 - padded.length) / 2);\n      const sep = \"=\".repeat(sepLen);\n      const secondSep = sep + (padded.length % 2 ? \"=\" : \"\");\n\n      console.log(`${sep}${padded}${secondSep}`);\n      console.log(\"\\n\\n\");\n      console.log(m.content);\n    }\n    ```\n  </Tab>\n\n  <Tab title=\"CURL\">\n    ```bash  theme={null}\n    # PLACE THIS IN A FILE CALLED pretty_print.sh\n    pretty_print() {\n      local type=\"$1\"\n      local content=\"$2\"\n      local padded=\" $type \"\n      local total_width=80\n      local sep_len=$(( (total_width - ${#padded}) / 2 ))\n      local sep=$(printf '=%.0s' $(eval \"echo {1..\"${sep_len}\"}\"))\n      local second_sep=$sep\n      if (( (total_width - ${#padded}) % 2 )); then\n        second_sep=\"${second_sep}=\"\n      fi\n\n      echo \"${sep}${padded}${second_sep}\"\n      echo\n      echo \"$content\"\n    }\n    ```\n  </Tab>\n</Tabs>\n\nNow, let's import our required packages and instantiate our client, assistant, and thread.\n\n<Tabs>\n  <Tab title=\"Python\">\n    ```python  theme={null}\n    import asyncio\n\n    from langchain_core.messages import convert_to_messages\n    from langgraph_sdk import get_client\n\n    client = get_client(url=<DEPLOYMENT_URL>)\n    # Using the graph deployed with the name \"agent\"\n    assistant_id = \"agent\"\n    thread = await client.threads.create()\n    ```\n  </Tab>\n\n  <Tab title=\"Javascript\">\n    ```js  theme={null}\n    import { Client } from \"@langchain/langgraph-sdk\";\n\n    const client = new Client({ apiUrl: <DEPLOYMENT_URL> });\n    // Using the graph deployed with the name \"agent\"\n    const assistantId = \"agent\";\n    const thread = await client.threads.create();\n    ```\n  </Tab>\n\n  <Tab title=\"CURL\">\n    ```bash  theme={null}\n    curl --request POST \\\n      --url <DEPLOYMENT_URL>/threads \\\n      --header 'Content-Type: application/json' \\\n      --data '{}'\n    ```\n  </Tab>\n</Tabs>\n\n## Create runs\n\nNow we can start our two runs and join the second one until it has completed:\n\n<Tabs>\n  <Tab title=\"Python\">\n    ```python  theme={null}\n    # the first run will be interrupted\n    interrupted_run = await client.runs.create(\n        thread[\"thread_id\"],\n        assistant_id,\n        input={\"messages\": [{\"role\": \"user\", \"content\": \"what's the weather in sf?\"}]},\n    )\n    # sleep a bit to get partial outputs from the first run\n    await asyncio.sleep(2)\n    run = await client.runs.create(\n        thread[\"thread_id\"],\n        assistant_id,\n        input={\"messages\": [{\"role\": \"user\", \"content\": \"what's the weather in nyc?\"}]},\n        multitask_strategy=\"interrupt\",\n    )\n    # wait until the second run completes\n    await client.runs.join(thread[\"thread_id\"], run[\"run_id\"])\n    ```\n  </Tab>\n\n  <Tab title=\"Javascript\">\n    ```js  theme={null}\n    // the first run will be interrupted\n    let interruptedRun = await client.runs.create(\n      thread[\"thread_id\"],\n      assistantId,\n      { input: { messages: [{ role: \"human\", content: \"what's the weather in sf?\" }] } }\n    );\n    // sleep a bit to get partial outputs from the first run\n    await new Promise(resolve => setTimeout(resolve, 2000));\n\n    let run = await client.runs.create(\n      thread[\"thread_id\"],\n      assistantId,\n      {\n        input: { messages: [{ role: \"human\", content: \"what's the weather in nyc?\" }] },\n        multitaskStrategy: \"interrupt\"\n      }\n    );\n\n    // wait until the second run completes\n    await client.runs.join(thread[\"thread_id\"], run[\"run_id\"]);\n    ```\n  </Tab>\n\n  <Tab title=\"CURL\">\n    ```bash  theme={null}\n    curl --request POST \\\n    --url <DEPLOY<ENT_URL>>/threads/<THREAD_ID>/runs \\\n    --header 'Content-Type: application/json' \\\n    --data \"{\n      \\\"assistant_id\\\": \\\"agent\\\",\n      \\\"input\\\": {\\\"messages\\\": [{\\\"role\\\": \\\"human\\\", \\\"content\\\": \\\"what\\'s the weather in sf?\\\"}]},\n    }\" && sleep 2 && curl --request POST \\\n    --url <DEPLOY<ENT_URL>>/threads/<THREAD_ID>/runs \\\n    --header 'Content-Type: application/json' \\\n    --data \"{\n      \\\"assistant_id\\\": \\\"agent\\\",\n      \\\"input\\\": {\\\"messages\\\": [{\\\"role\\\": \\\"human\\\", \\\"content\\\": \\\"what\\'s the weather in nyc?\\\"}]},\n      \\\"multitask_strategy\\\": \\\"interrupt\\\"\n    }\" && curl --request GET \\\n    --url <DEPLOYMENT_URL>/threads/<THREAD_ID>/runs/<RUN_ID>/join\n    ```\n  </Tab>\n</Tabs>\n\n## View run results\n\nWe can see that the thread has partial data from the first run + data from the second run\n\n<Tabs>\n  <Tab title=\"Python\">\n    ```python  theme={null}\n    state = await client.threads.get_state(thread[\"thread_id\"])\n\n    for m in convert_to_messages(state[\"values\"][\"messages\"]):\n        m.pretty_print()\n    ```\n  </Tab>\n\n  <Tab title=\"Javascript\">\n    ```js  theme={null}\n    const state = await client.threads.getState(thread[\"thread_id\"]);\n\n    for (const m of state['values']['messages']) {\n      prettyPrint(m);\n    }\n    ```\n  </Tab>\n\n  <Tab title=\"CURL\">\n    ```bash  theme={null}\n    source pretty_print.sh && curl --request GET \\\n    --url <DEPLOYMENT_URL>/threads/<THREAD_ID>/state | \\\n    jq -c '.values.messages[]' | while read -r element; do\n        type=$(echo \"$element\" | jq -r '.type')\n        content=$(echo \"$element\" | jq -r '.content | if type == \"array\" then tostring else . end')\n        pretty_print \"$type\" \"$content\"\n    done\n    ```\n  </Tab>\n</Tabs>\n\nOutput:\n\n```\n================================ Human Message =================================\n\nwhat's the weather in sf?\n================================== Ai Message ==================================\n\n[{'id': 'toolu_01MjNtVJwEcpujRGrf3x6Pih', 'input': {'query': 'weather in san francisco'}, 'name': 'tavily_search_results_json', 'type': 'tool_use'}]\nTool Calls:\ntavily_search_results_json (toolu_01MjNtVJwEcpujRGrf3x6Pih)\nCall ID: toolu_01MjNtVJwEcpujRGrf3x6Pih\nArgs:\nquery: weather in san francisco\n================================= Tool Message =================================\nName: tavily_search_results_json\n\n[{\"url\": \"https://www.wunderground.com/hourly/us/ca/san-francisco/KCASANFR2002/date/2024-6-18\", \"content\": \"High 64F. Winds W at 10 to 20 mph. A few clouds from time to time. Low 49F. Winds W at 10 to 20 mph. Temp. San Francisco Weather Forecasts. Weather Underground provides local & long-range weather ...\"}]\n================================ Human Message =================================\n\nwhat's the weather in nyc?\n================================== Ai Message ==================================\n\n[{'id': 'toolu_01KtE1m1ifPLQAx4fQLyZL9Q', 'input': {'query': 'weather in new york city'}, 'name': 'tavily_search_results_json', 'type': 'tool_use'}]\nTool Calls:\ntavily_search_results_json (toolu_01KtE1m1ifPLQAx4fQLyZL9Q)\nCall ID: toolu_01KtE1m1ifPLQAx4fQLyZL9Q\nArgs:\nquery: weather in new york city\n================================= Tool Message =================================\nName: tavily_search_results_json\n\n[{\"url\": \"https://www.accuweather.com/en/us/new-york/10021/june-weather/349727\", \"content\": \"Get the monthly weather forecast for New York, NY, including daily high/low, historical averages, to help you plan ahead.\"}]\n================================== Ai Message ==================================\n\nThe search results provide weather forecasts and information for New York City. Based on the top result from AccuWeather, here are some key details about the weather in NYC:\n\n* This is a monthly weather forecast for New York City for the month of June.\n* It includes daily high and low temperatures to help plan ahead.\n* Historical averages for June in NYC are also provided as a reference point.\n* More detailed daily or hourly forecasts with precipitation chances, humidity, wind, etc. can be found by visiting the AccuWeather page.\n\nSo in summary, the search provides a convenient overview of the expected weather conditions in New York City over the next month to give you an idea of what to prepare for if traveling or making plans there. Let me know if you need any other details!\n```\n\nVerify that the original, interrupted run was interrupted\n\n<Tabs>\n  <Tab title=\"Python\">\n    ```python  theme={null}\n    print((await client.runs.get(thread[\"thread_id\"], interrupted_run[\"run_id\"]))[\"status\"])\n    ```\n  </Tab>\n\n  <Tab title=\"Javascript\">\n    ```js  theme={null}\n    console.log((await client.runs.get(thread['thread_id'], interruptedRun[\"run_id\"]))[\"status\"])\n    ```\n  </Tab>\n</Tabs>\n\nOutput:\n\n```\n'interrupted'\n```\n\n***\n\n<Callout icon=\"pen-to-square\" iconType=\"regular\">\n  [Edit the source of this page on GitHub.](https://github.com/langchain-ai/docs/edit/main/src/langsmith/interrupt-concurrent.mdx)\n</Callout>\n\n<Tip icon=\"terminal\" iconType=\"regular\">\n  [Connect these docs programmatically](/use-these-docs) to Claude, VSCode, and more via MCP for real-time answers.\n</Tip>",
  "content_length": 9403
}