{
  "title": "Configure LangSmith for scale",
  "source_url": "https://docs.langchain.com/langsmith/self-host-scale",
  "content": "A self-hosted LangSmith instance can handle a large number of traces and users. The default configuration for the self-hosted deployment can handle substantial load, and you can configure your deployment to be able to achieve higher scale. This page describes scaling considerations and provides some examples to help configure your self-hosted instance.\n\nFor example configurations, refer to [Example LangSmith configurations for scale](#example-langsmith-configurations-for-scale).\n\n## Summary\n\nThe table below provides an overview comparing different LangSmith configurations for various load patterns (reads / writes):\n\n|                                                                                                                                                                  | **[Low / low](#low-reads-low-writes)**              | **[Low / high](#low-reads-high-writes)**            | **[High / low](#high-reads-low-writes)**                                                                                                                                                                                                 | [Medium / medium](#medium-reads-medium-writes)      | [High / high](#high-reads-high-writes)                                                                                                                                                                                                   |\n| :--------------------------------------------------------------------------------------------------------------------------------------------------------------- | :-------------------------------------------------- | :-------------------------------------------------- | :--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :-------------------------------------------------- | :--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |\n| <Tooltip tip=\"Number of users actively viewing traces on the frontend\">Concurrent frontend users</Tooltip>                                                       | 5                                                   | 5                                                   | 50                                                                                                                                                                                                                                       | 20                                                  | 50                                                                                                                                                                                                                                       |\n| <Tooltip tip=\"Number of traces being ingested via SDKs or API endpoints\">Traces submitted per second</Tooltip>                                                   | 10                                                  | 1000                                                | 10                                                                                                                                                                                                                                       | 100                                                 | 1000                                                                                                                                                                                                                                     |\n| **Frontend replicas**<br />(500m CPU, 1Gi per replica)                                                                                                           | 1 (default)                                         | 4                                                   | 2                                                                                                                                                                                                                                        | 2                                                   | 4                                                                                                                                                                                                                                        |\n| **Platform backend replicas**<br />(1 CPU, 2Gi per replica)                                                                                                      | 3 (default)                                         | 20                                                  | 3 (default)                                                                                                                                                                                                                              | 3 (default)                                         | 20                                                                                                                                                                                                                                       |\n| **Queue replicas**<br />(1 CPU, 2Gi per replica)                                                                                                                 | 3 (default)                                         | 160                                                 | 6                                                                                                                                                                                                                                        | 10                                                  | 160                                                                                                                                                                                                                                      |\n| **Backend replicas**<br />(1 CPU, 2Gi per replica)                                                                                                               | 2 (default)                                         | 5                                                   | 40                                                                                                                                                                                                                                       | 16                                                  | 50                                                                                                                                                                                                                                       |\n| **Redis resources**                                                                                                                                              | 8 Gi (default)                                      | 200 Gi external                                     | 8 Gi (default)                                                                                                                                                                                                                           | 13Gi external                                       | 200 Gi external                                                                                                                                                                                                                          |\n| **ClickHouse resources**                                                                                                                                         | 4 CPU<br />16 Gi (default)                          | 10 CPU<br />32Gi memory                             | 8 CPU<br />16 Gi per replica                                                                                                                                                                                                             | 16 CPU<br />24Gi memory                             | 14 CPU<br />24 Gi per replica                                                                                                                                                                                                            |\n| **ClickHouse setup**                                                                                                                                             | Single instance                                     | Single instance                                     | 3-node <Tooltip tip=\"Recommended for high read loads to prevent degraded performance. Another option would be [managed clickhouse](/langsmith/self-host-external-clickhouse#langsmith-managed-clickhouse).\">replicated cluster</Tooltip> | Single instance                                     | 3-node <Tooltip tip=\"Recommended for high read loads to prevent degraded performance. Another option would be [managed clickhouse](/langsmith/self-host-external-clickhouse#langsmith-managed-clickhouse).\">replicated cluster</Tooltip> |\n| <Tooltip tip=\"We recommend using an external instance and enabling autoexpansion for the disk to handle growing data requirements.\">Postgres resources</Tooltip> | 2 CPU<br />8 GB memory<br />10GB storage (external) | 2 CPU<br />8 GB memory<br />10GB storage (external) | 2 CPU<br />8 GB memory<br />10GB storage (external)                                                                                                                                                                                      | 2 CPU<br />8 GB memory<br />10GB storage (external) | 2 CPU<br />8 GB memory<br />10GB storage (external)                                                                                                                                                                                      |\n| **Blob storage**                                                                                                                                                 | Disabled                                            | Enabled                                             | Enabled                                                                                                                                                                                                                                  | Enabled                                             | Enabled                                                                                                                                                                                                                                  |\n\nBelow we go into more details about the read and write paths as well as provide a `values.yaml` snippet for you to start with for your self-hosted LangSmith instance.\n\n## Trace ingestion (write path)\n\nCommon usage that put load on the write path:\n\n* Ingesting traces via the Python or JavaScript LangSmith SDK\n* Ingesting traces via the `@traceable` wrapper\n* Submitting traces via the `/runs/multipart` endpoint\n\nServices that play a large role in trace ingestion:\n\n* Platform backend service: Receives initial request to ingest traces and places traces on a Redis queue\n* Redis cache: Used to queue traces that need to be persisted\n* Queue service: Persists traces for querying\n* ClickHouse: Persistent storage used for traces\n\nWhen scaling up the write path (trace ingestion), it is helpful to monitor the four services/resources listed above. Here are some typical changes that can help increase performance of trace ingestion:\n\n* Give ClickHouse more resources (CPU and memory) if it is approaching resource limits.\n* Increase the number of platform-backend pods if ingest requests are taking long to respond.\n* Increase queue service pod replicas if traces are not being processed from Redis fast enough.\n* Use a larger Redis cache if you notice that the current Redis instance is reaching resource limits. This could also be a reason why ingest requests take a long time.\n\n## Trace querying (read path)\n\nCommon usage that puts load on the read path:\n\n* Users on the frontend looking at tracing projects or individual traces\n* Scripts used to query for trace info\n* Hitting either the `/runs/query` or `/runs/<run-id>` api endpoints\n\nServices that play a large role in querying traces:\n\n* Backend service: Receives the request and submits a query to ClickHouse to then respond to the request\n* ClickHouse: Persistent storage for traces. This is the main database that is queried when requesting trace info.\n\nWhen scaling up the read path (trace querying), it is helpful to monitor the two services/resources listed above. Here are some typical changes that can help improve performance of trace querying:\n\n* Increase the number of backend service pods. This would be most impactful if backend service pods are reaching 1 core CPU usage.\n* Give ClickHouse more resources (CPU or Memory). ClickHouse can be very resource intensive, but it should lead to better performance.\n* Move to a [replicated ClickHouse cluster](/langsmith/self-host-external-clickhouse#ha-replicated-clickhouse-cluster). Adding replicas of ClickHouse helps with read performance, but we recommend staying below 5 replicas (start with 3).\n\nFor more precise guidance on how this translates to helm chart values, refer to the examples the following [section](#example-langsmith-configurations-for-scale). If you are unsure why your LangSmith instance cannot handle a certain load pattern, contact the LangChain team.\n\n## Example LangSmith configurations for scale\n\nBelow we provide some example LangSmith configurations based on expected read and write loads.\n\nFor read load (trace querying):\n\n* Low means roughly 5 users looking at traces at a time (about 10 requests per second)\n* Medium means roughly 20 users looking at traces at a time (about 40 requests per second)\n* High means roughly 50 users looking at traces at a time (about 100 requests per second)\n\nFor write load (trace ingestion):\n\n* Low means up to 10 traces submitted per second\n* Medium means up to 100 traces submitted per second\n* High means up to 1000 traces submitted per second\n\n<Note>\n  The exact optimal configuration depends on your usage and trace payloads. Use the examples below in combination with the information above and your specific usage to update your LangSmith configuration as you see fit. If you have any questions, please reach out to the LangChain team.\n</Note>\n\n### Low reads, low writes <a name=\"low-reads-low-writes\" />\n\nThe default LangSmith configuration will handle this load. No custom resource configuration is needed here.\n\n### Low reads, high writes <a name=\"low-reads-high-writes\" />\n\nYou have a very high scale of trace ingestions, but single digit number of users on the frontend querying traces at any one time.\n\nFor this, we recommend a configuration like this:\n\n```yaml  theme={null}\nconfig:\n  blobStorage:\n    # Please also set the other keys to connect to your blob storage. See configuration section.\n    enabled: true\n  settings:\n    redisRunsExpirySeconds: \"3600\"\n# ttl:\n#   enabled: true\n#   ttl_period_seconds:\n#     longlived: \"7776000\"  # 90 days (default is 400 days)\n#     shortlived: \"604800\"  # 7 days (default is 14 days)\n\nfrontend:\n  deployment:\n    replicas: 4 # OR enable autoscaling to this level (example below)\n# autoscaling:\n#   enabled: true\n#   maxReplicas: 4\n#   minReplicas: 2\n\nplatformBackend:\n  deployment:\n    replicas: 20 # OR enable autoscaling to this level (example below)\n# autoscaling:\n#   enabled: true\n#   maxReplicas: 20\n#   minReplicas: 8\n\n## Note that we are actively working on improving performance of this service to reduce the number of replicas.\nqueue:\n  deployment:\n    replicas: 160 # OR enable autoscaling to this level (example below)\n# autoscaling:\n#   enabled: true\n#   maxReplicas: 160\n#   minReplicas: 40\n\nbackend:\n  deployment:\n    replicas: 5 # OR enable autoscaling to this level (example below)\n# autoscaling:\n#   enabled: true\n#   maxReplicas: 5\n#   minReplicas: 3\n\n## Ensure your Redis cache is at least 200 GB\nredis:\n  external:\n    enabled: true\n    existingSecretName: langsmith-redis-secret # Set the connection url for your external Redis instance (200+ GB)\n\nclickhouse:\n  statefulSet:\n    persistence:\n      # This may depend on your configured TTL (see config section).\n      # We recommend 600Gi for every shortlived TTL day if operating at this scale constantly.\n      size: 4200Gi # This assumes 7 days TTL and operating a this scale constantly.\n    resources:\n      requests:\n        cpu: \"10\"\n        memory: \"32Gi\"\n      limits:\n        cpu: \"16\"\n        memory: \"48Gi\"\n\ncommonEnv:\n  - name: \"CLICKHOUSE_ASYNC_INSERT_WAIT_PCT_FLOAT\"\n    value: \"0\"\n```\n\n### High reads, low writes <a name=\"high-reads-low-writes\" />\n\nYou have a relatively low scale of trace ingestions, but many frontend users querying traces and/or have scripts that hit the `/runs/query` or `/runs/<run-id>` endpoints frequently.\n\n**For this, we strongly recommend setting up a replicated ClickHouse cluster to enable high read scale at low latency.** See our [external ClickHouse doc](/langsmith/self-host-external-clickhouse#ha-replicated-clickhouse-cluster) for more guidance on how to setup a replicated ClickHouse cluster. For this load pattern, we recommend using a 3 node replicated setup, where each replica in the cluster should have resource requests of 8+ cores and 16+ GB memory, and resource limit of 12 cores and 32 GB memory.\n\nFor this, we recommend a configuration like this:\n\n```yaml  theme={null}\nconfig:\n  blobStorage:\n    # Please also set the other keys to connect to your blob storage. See configuration section.\n    enabled: true\n\nfrontend:\n  deployment:\n    replicas: 2\n\nqueue:\n  deployment:\n    replicas: 6 # OR enable autoscaling to this level (example below)\n# autoscaling:\n#   enabled: true\n#   maxReplicas: 6\n#   minReplicas: 4\n\nbackend:\n  deployment:\n    replicas: 40 # OR enable autoscaling to this level (example below)\n# autoscaling:\n#   enabled: true\n#   maxReplicas: 40\n#   minReplicas: 16\n\n# We strongly recommend setting up a replicated clickhouse cluster for this load.\n# Update these values as needed to connect to your replicated clickhouse cluster.\nclickhouse:\n  external:\n    # If using a 3 node replicated setup, each replica in the cluster should have resource requests of 8+ cores and 16+ GB memory, and resource limit of 12 cores and 32 GB memory.\n    enabled: true\n    host: langsmith-ch-clickhouse-replicated.default.svc.cluster.local\n    port: \"8123\"\n    nativePort: \"9000\"\n    user: \"default\"\n    password: \"password\"\n    database: \"default\"\n    cluster: \"replicated\"\n```\n\n### Medium reads, medium writes <a name=\"medium-reads-medium-writes\" />\n\nThis is a good all around configuration that should be able to handle most usage patterns of LangSmith. In internal testing, this configuration allowed us to scale to 100 traces ingested per second and 40 read requests per second.\n\nFor this, we recommend a configuration like this:\n\n```yaml  theme={null}\nconfig:\n  blobStorage:\n    # Please also set the other keys to connect to your blob storage. See configuration section.\n    enabled: true\n  settings:\n    redisRunsExpirySeconds: \"3600\"\n\nfrontend:\n  deployment:\n    replicas: 2\n\nqueue:\n  deployment:\n    replicas: 10 # OR enable autoscaling to this level (example below)\n# autoscaling:\n#   enabled: true\n#   maxReplicas: 10\n#   minReplicas: 5\n\nbackend:\n  deployment:\n    replicas: 16 # OR enable autoscaling to this level (example below)\n# autoscaling:\n#   enabled: true\n#   maxReplicas: 16\n#   minReplicas: 8\n\nredis:\n  statefulSet:\n    resources:\n      requests:\n        memory: 13Gi\n      limits:\n        memory: 13Gi\n\n  # -- For external redis instead use something like below --\n  # external:\n  #   enabled: true\n  #   connectionUrl: \"<URL>\" OR existingSecretName: \"<SECRET-NAME>\"\n\nclickhouse:\n  statefulSet:\n    persistence:\n      # This may depend on your configured TTL.\n      # We recommend 60Gi for every shortlived TTL day if operating at this scale constantly.\n      size: 420Gi # This assumes 7 days TTL and operating a this scale constantly.\n    resources:\n      requests:\n        cpu: \"16\"\n        memory: \"24Gi\"\n      limits:\n        cpu: \"28\"\n        memory: \"40Gi\"\n\ncommonEnv:\n  - name: \"CLICKHOUSE_ASYNC_INSERT_WAIT_PCT_FLOAT\"\n    value: \"0\"\n```\n\n<Warning>\n  If you still notice slow reads with the above configuration, we recommend moving to a [replicated Clickhouse cluster setup](/langsmith/self-host-external-clickhouse#ha-replicated-clickhouse-cluster)\n</Warning>\n\n### High reads, high writes <a name=\"high-reads-high-writes\" />\n\nYou have a very high rate of trace ingestion (approaching 1000 traces submitted per second) and also have many users querying traces on the frontend (over 50 users) and/or scripts that are consistently making requests to `/runs/query` or `/runs/<run-id>` endpoints.\n\n**For this, we very strongly recommend setting up a replicated ClickHouse cluster to prevent degraded read performance at high write scale.** See our [external ClickHouse doc](/langsmith/self-host-external-clickhouse#ha-replicated-clickhouse-cluster) for more guidance on how to set up a replicated ClickHouse cluster. For this load pattern, we recommend using a 3 node replicated setup, where each replica in the cluster should have resource requests of 14+ cores and 24+ GB memory, and resource limit of 20 cores and 48 GB memory. We also recommend that each node/instance of ClickHouse has 600 Gi of volume storage for each day of TTL that you enable (as per the configuration below).\n\nOverall, we recommend a configuration like this:\n\n```yaml  theme={null}\nconfig:\n  blobStorage:\n    # Please also set the other keys to connect to your blob storage. See configuration section.\n    enabled: true\n  settings:\n    redisRunsExpirySeconds: \"3600\"\n# ttl:\n#   enabled: true\n#   ttl_period_seconds:\n#     longlived: \"7776000\"  # 90 days (default is 400 days)\n#     shortlived: \"604800\"  # 7 days (default is 14 days)\n\nfrontend:\n  deployment:\n    replicas: 4 # OR enable autoscaling to this level (example below)\n# autoscaling:\n#   enabled: true\n#   maxReplicas: 4\n#   minReplicas: 2\n\nplatformBackend:\n  deployment:\n    replicas: 20 # OR enable autoscaling to this level (example below)\n# autoscaling:\n#   enabled: true\n#   maxReplicas: 20\n#   minReplicas: 8\n\n## Note that we are actively working on improving performance of this service to reduce the number of replicas.\nqueue:\n  deployment:\n    replicas: 160 # OR enable autoscaling to this level (example below)\n# autoscaling:\n#   enabled: true\n#   maxReplicas: 160\n#   minReplicas: 40\n\nbackend:\n  deployment:\n    replicas: 50 # OR enable autoscaling to this level (example below)\n# autoscaling:\n#   enabled: true\n#   maxReplicas: 50\n#   minReplicas: 20\n\n## Ensure your Redis cache is at least 200 GB\nredis:\n  external:\n    enabled: true\n    existingSecretName: langsmith-redis-secret # Set the connection url for your external Redis instance (200+ GB)\n\n# We strongly recommend setting up a replicated clickhouse cluster for this load.\n# Update these values as needed to connect to your replicated clickhouse cluster.\nclickhouse:\n  external:\n    # If using a 3 node replicated setup, each replica in the cluster should have resource requests of 14+ cores and 24+ GB memory, and resource limit of 20 cores and 48 GB memory.\n    enabled: true\n    host: langsmith-ch-clickhouse-replicated.default.svc.cluster.local\n    port: \"8123\"\n    nativePort: \"9000\"\n    user: \"default\"\n    password: \"password\"\n    database: \"default\"\n    cluster: \"replicated\"\n\ncommonEnv:\n  - name: \"CLICKHOUSE_ASYNC_INSERT_WAIT_PCT_FLOAT\"\n    value: \"0\"\n```\n\n<Note>\n  Ensure that the Kubernetes cluster is configured with sufficient resources to scale to the recommended size. After deployment, all of the pods in the Kubernetes cluster should be in a `Running` state. Pods stuck in `Pending` may indicate that you are reaching node pool limits or need larger nodes.\n\n  Also, ensure that any ingress controller deployed on the cluster is able to handle the desired load to prevent bottlenecks.\n</Note>\n\n***\n\n<Callout icon=\"pen-to-square\" iconType=\"regular\">\n  [Edit the source of this page on GitHub.](https://github.com/langchain-ai/docs/edit/main/src/langsmith/self-host-scale.mdx)\n</Callout>\n\n<Tip icon=\"terminal\" iconType=\"regular\">\n  [Connect these docs programmatically](/use-these-docs) to Claude, VSCode, and more via MCP for real-time answers.\n</Tip>",
  "content_length": 24855
}