{
  "title": "Set up custom authentication",
  "source_url": "https://docs.langchain.com/langsmith/set-up-custom-auth",
  "content": "In this tutorial, we will build a chatbot that only lets specific users access it. We'll start with the LangGraph template and add token-based security step by step. By the end, you'll have a working chatbot that checks for valid tokens before allowing access.\n\nThis is part 1 of our authentication series:\n\n1. Set up custom authentication (you are here) - Control who can access your bot\n2. [Make conversations private](/langsmith/resource-auth) - Let users have private conversations\n3. [Connect an authentication provider](/langsmith/add-auth-server) - Add real user accounts and validate using OAuth2 for production\n\nThis guide assumes basic familiarity with the following concepts:\n\n* [**Authentication & Access Control**](/langsmith/auth)\n* [**LangSmith**](/langsmith/home)\n\n<Note>\n  Custom auth is only available for LangSmith SaaS deployments or Enterprise Self-Hosted deployments.\n</Note>\n\n## 1. Create your app\n\nCreate a new chatbot using the LangGraph starter template:\n\n<CodeGroup>\n  ```bash pip theme={null}\n  pip install -U \"langgraph-cli[inmem]\"\n  langgraph new --template=new-langgraph-project-python custom-auth\n  cd custom-auth\n  ```\n\n  ```bash uv theme={null}\n  uv add langgraph-cli[inmem]\n  langgraph new --template=new-langgraph-project-python custom-auth\n  cd custom-auth\n  ```\n</CodeGroup>\n\nThe template gives us a placeholder LangGraph app. Try it out by installing the local dependencies and running the development server:\n\n<CodeGroup>\n  ```bash pip theme={null}\n  pip install -e .\n  langgraph dev\n  ```\n\n  ```bash uv theme={null}\n  uv add .\n  langgraph dev\n  ```\n\n  ```bash npm theme={null}\n  npx @langchain/langgraph-cli dev\n  ```\n</CodeGroup>\n\nThe server will start and open [Studio](/langsmith/studio) in your browser:\n\n```\n> - üöÄ API: http://127.0.0.1:2024\n> - üé® Studio UI: https://smith.langchain.com/studio/?baseUrl=http://127.0.0.1:2024\n> - üìö API Docs: http://127.0.0.1:2024/docs\n>\n> This in-memory server is designed for development and testing.\n> For production use, please use LangSmith.\n```\n\nIf you were to self-host this on the public internet, anyone could access it.\n\n<img src=\"https://mintcdn.com/langchain-5e9cc07a/N1xJUsnxxRqnrjxV/langsmith/images/no-auth.png?fit=max&auto=format&n=N1xJUsnxxRqnrjxV&q=85&s=3ca2c9a8d65891ef71abfb7ad0aae7d3\" alt=\"No authentication: the dev server is publicly reachable, anyone can access the bot if exposed to the internet.\" data-og-width=\"1974\" width=\"1974\" data-og-height=\"1412\" height=\"1412\" data-path=\"langsmith/images/no-auth.png\" data-optimize=\"true\" data-opv=\"3\" srcset=\"https://mintcdn.com/langchain-5e9cc07a/N1xJUsnxxRqnrjxV/langsmith/images/no-auth.png?w=280&fit=max&auto=format&n=N1xJUsnxxRqnrjxV&q=85&s=67bfe450ee04d2432e5e1b86cfa0af1c 280w, https://mintcdn.com/langchain-5e9cc07a/N1xJUsnxxRqnrjxV/langsmith/images/no-auth.png?w=560&fit=max&auto=format&n=N1xJUsnxxRqnrjxV&q=85&s=087f8083981ae85eeca794bdca3e0e05 560w, https://mintcdn.com/langchain-5e9cc07a/N1xJUsnxxRqnrjxV/langsmith/images/no-auth.png?w=840&fit=max&auto=format&n=N1xJUsnxxRqnrjxV&q=85&s=7967264c0243918be1a8561d4db89586 840w, https://mintcdn.com/langchain-5e9cc07a/N1xJUsnxxRqnrjxV/langsmith/images/no-auth.png?w=1100&fit=max&auto=format&n=N1xJUsnxxRqnrjxV&q=85&s=fd9d62383850b137834bfc7e35bc4533 1100w, https://mintcdn.com/langchain-5e9cc07a/N1xJUsnxxRqnrjxV/langsmith/images/no-auth.png?w=1650&fit=max&auto=format&n=N1xJUsnxxRqnrjxV&q=85&s=66100323459f51596c53b3d941e3f85d 1650w, https://mintcdn.com/langchain-5e9cc07a/N1xJUsnxxRqnrjxV/langsmith/images/no-auth.png?w=2500&fit=max&auto=format&n=N1xJUsnxxRqnrjxV&q=85&s=a7b9157f67b3094370cc5399d917a164 2500w\" />\n\n## 2. Add authentication\n\nNow that you have a base LangGraph app, add authentication to it.\n\n<Note>\n  In this tutorial, you will start with a hard-coded token for example purposes. You will get to a \"production-ready\" authentication scheme in the third tutorial.\n</Note>\n\nThe [Auth](https://reference.langchain.com/python/langsmith/deployment/sdk/#langgraph_sdk.auth.Auth) object lets you register an authentication function that the LangSmith deployment will run on every request. This function receives each request and decides whether to accept or reject.\n\nCreate a new file `src/security/auth.py`. This is where your code will live to check if users are allowed to access your bot:\n\n```python {highlight={10,15-16}} title=\"src/security/auth.py\" theme={null}\nfrom langgraph_sdk import Auth\n\n# This is our toy user database. Do not do this in production\nVALID_TOKENS = {\n    \"user1-token\": {\"id\": \"user1\", \"name\": \"Alice\"},\n    \"user2-token\": {\"id\": \"user2\", \"name\": \"Bob\"},\n}\n\n# The \"Auth\" object is a container that LangGraph will use to mark our authentication function\nauth = Auth()\n\n\n# The `authenticate` decorator tells LangGraph to call this function as middleware\n# for every request. This will determine whether the request is allowed or not\n@auth.authenticate\nasync def get_current_user(authorization: str | None) -> Auth.types.MinimalUserDict:\n    \"\"\"Check if the user's token is valid.\"\"\"\n    assert authorization\n    scheme, token = authorization.split()\n    assert scheme.lower() == \"bearer\"\n    # Check if token is valid\n    if token not in VALID_TOKENS:\n        raise Auth.exceptions.HTTPException(status_code=401, detail=\"Invalid token\")\n\n    # Return user info if valid\n    user_data = VALID_TOKENS[token]\n    return {\n        \"identity\": user_data[\"id\"],\n    }\n```\n\nNotice that your [Auth.authenticate](https://reference.langchain.com/python/langsmith/deployment/sdk/#langgraph_sdk.auth.Auth.authenticate) handler does two important things:\n\n1. Checks if a valid token is provided in the request's [Authorization header](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Authorization)\n2. Returns the user's [MinimalUserDict](https://reference.langchain.com/python/langsmith/deployment/sdk/#langgraph_sdk.auth.types.MinimalUserDict)\n\nNow tell LangGraph to use authentication by adding the following to the [langgraph.json](https://reference.langchain.com/python/cloud/reference/cli/#configuration-file) configuration:\n\n```json {highlight={7-9}} title=\"langgraph.json\" theme={null}\n{\n  \"dependencies\": [\".\"],\n  \"graphs\": {\n    \"agent\": \"./src/agent/graph.py:graph\"\n  },\n  \"env\": \".env\",\n  \"auth\": {\n    \"path\": \"src/security/auth.py:auth\"\n  }\n}\n```\n\n## 3. Test your bot\n\nStart the server again to test everything out:\n\n```bash  theme={null}\nlanggraph dev --no-browser\n```\n\nIf you didn't add the `--no-browser`, the Studio UI will open in the browser. By default, we also permit access from Studio, even when using custom auth. This makes it easier to develop and test your bot in Studio. You can remove this alternative authentication option by setting `disable_studio_auth: true` in your auth configuration:\n\n```json  theme={null}\n{\n    \"auth\": {\n        \"path\": \"src/security/auth.py:auth\",\n        \"disable_studio_auth\": true\n    }\n}\n```\n\n## 4. Chat with your bot\n\nYou should now only be able to access the bot if you provide a valid token in the request header. Users will still, however, be able to access each other's resources until you add [resource authorization handlers](/langsmith/auth#resource-specific-handlers) in the next section of the tutorial.\n\n<img src=\"https://mintcdn.com/langchain-5e9cc07a/IMK8wJkjSpMCGODD/langsmith/images/authentication.png?fit=max&auto=format&n=IMK8wJkjSpMCGODD&q=85&s=3ccfa86789baea630b8f418e9eb5b648\" alt=\"Auth gate passes requests with a valid token, but no per-resource filters are applied yet‚Äîso users share visibility until authorization handlers are added in the next step.\" data-og-width=\"2617\" width=\"2617\" data-og-height=\"1673\" height=\"1673\" data-path=\"langsmith/images/authentication.png\" data-optimize=\"true\" data-opv=\"3\" srcset=\"https://mintcdn.com/langchain-5e9cc07a/IMK8wJkjSpMCGODD/langsmith/images/authentication.png?w=280&fit=max&auto=format&n=IMK8wJkjSpMCGODD&q=85&s=0216c0cf0cb74f67f43e65561a787c96 280w, https://mintcdn.com/langchain-5e9cc07a/IMK8wJkjSpMCGODD/langsmith/images/authentication.png?w=560&fit=max&auto=format&n=IMK8wJkjSpMCGODD&q=85&s=c4a9ab37e2413a38dc61ef6f4288c1b1 560w, https://mintcdn.com/langchain-5e9cc07a/IMK8wJkjSpMCGODD/langsmith/images/authentication.png?w=840&fit=max&auto=format&n=IMK8wJkjSpMCGODD&q=85&s=d1146dee549ab13c949efae260706988 840w, https://mintcdn.com/langchain-5e9cc07a/IMK8wJkjSpMCGODD/langsmith/images/authentication.png?w=1100&fit=max&auto=format&n=IMK8wJkjSpMCGODD&q=85&s=e430d8ebe4534d20c1d4d3d887f0c938 1100w, https://mintcdn.com/langchain-5e9cc07a/IMK8wJkjSpMCGODD/langsmith/images/authentication.png?w=1650&fit=max&auto=format&n=IMK8wJkjSpMCGODD&q=85&s=3aeaa334e3ff1457c165821966721f94 1650w, https://mintcdn.com/langchain-5e9cc07a/IMK8wJkjSpMCGODD/langsmith/images/authentication.png?w=2500&fit=max&auto=format&n=IMK8wJkjSpMCGODD&q=85&s=74d6dd4c73baa0182624085d13f08530 2500w\" />\n\nRun the following code in a file or notebook:\n\n```python  theme={null}\nfrom langgraph_sdk import get_client\n\n# Try without a token (should fail)\nclient = get_client(url=\"http://localhost:2024\")\ntry:\n    thread = await client.threads.create()\n    print(\"‚ùå Should have failed without token!\")\nexcept Exception as e:\n    print(\"‚úÖ Correctly blocked access:\", e)\n\n# Try with a valid token\nclient = get_client(\n    url=\"http://localhost:2024\", headers={\"Authorization\": \"Bearer user1-token\"}\n)\n\n# Create a thread and chat\nthread = await client.threads.create()\nprint(f\"‚úÖ Created thread as Alice: {thread['thread_id']}\")\n\nresponse = await client.runs.create(\n    thread_id=thread[\"thread_id\"],\n    assistant_id=\"agent\",\n    input={\"messages\": [{\"role\": \"user\", \"content\": \"Hello!\"}]},\n)\nprint(\"‚úÖ Bot responded:\")\nprint(response)\n```\n\nYou should see that:\n\n1. Without a valid token, we can't access the bot\n2. With a valid token, we can create threads and chat\n\nCongratulations! You've built a chatbot that only lets \"authenticated\" users access it. While this system doesn't (yet) implement a production-ready security scheme, we've learned the basic mechanics of how to control access to our bot. In the next tutorial, we'll learn how to give each user their own private conversations.\n\n## Next steps\n\nNow that you can control who accesses your bot, you might want to:\n\n1. Continue the tutorial by going to [Make conversations private](/langsmith/resource-auth) to learn about resource authorization.\n2. Read more about [authentication concepts](/langsmith/auth).\n3. Check out the API reference for [Auth](https://reference.langchain.com/python/langsmith/deployment/sdk/#langgraph_sdk.auth.Auth), [Auth.authenticate](https://reference.langchain.com/python/langsmith/deployment/sdk/#langgraph_sdk.auth.Auth.authenticate), and [MinimalUserDict](https://reference.langchain.com/python/langsmith/deployment/sdk/#langgraph_sdk.auth.types.MinimalUserDict) for more authentication details.\n\n***\n\n<Callout icon=\"pen-to-square\" iconType=\"regular\">\n  [Edit the source of this page on GitHub.](https://github.com/langchain-ai/docs/edit/main/src/langsmith/set-up-custom-auth.mdx)\n</Callout>\n\n<Tip icon=\"terminal\" iconType=\"regular\">\n  [Connect these docs programmatically](/use-these-docs) to Claude, VSCode, and more via MCP for real-time answers.\n</Tip>",
  "content_length": 11177
}