{
  "title": "CrewAI integration",
  "source_url": null,
  "content": "> Add persistent memory and knowledge graphs to CrewAI agents\n\nCrewAI agents equipped with Zep's memory platform can maintain context across conversations, access shared knowledge bases, and make more informed decisions. This integration provides persistent memory storage and intelligent knowledge retrieval for your CrewAI workflows.\n\n## Core benefits\n\n* **Persistent Memory**: Conversations and knowledge persist across sessions\n* **Context-Aware Agents**: Agents automatically retrieve relevant context during execution\n* **Dual Storage**: User-specific memories and shared organizational knowledge\n* **Intelligent Tools**: Search and data addition tools for dynamic knowledge management\n\n## How External Memory Works in CrewAI\n\nExternal memory in CrewAI operates automatically during crew execution, providing seamless context retrieval and persistence across tasks and executions.\n\n### Automatic Memory Operations\n\n| Operation        | When It Happens            | What Gets Stored/Retrieved                                       |\n| ---------------- | -------------------------- | ---------------------------------------------------------------- |\n| Memory Retrieval | At the start of each task  | Relevant context based on task description + accumulated context |\n| Memory Storage   | After each task completion | Task output text + metadata (task description, messages)         |\n\n**Key Behaviors:**\n\n* **Automatic Retrieval**: When an agent starts a task, CrewAI automatically queries external memory using the query \"\\{task.description} \\{context}\" to find relevant historical context\n* **Automatic Storage**: When an agent completes a task, CrewAI automatically saves the task output to external memory (if external memory is configured)\n* **Cross-Execution Persistence**: External memory persists between crew runs, enabling agents to learn from previous executions\n* **Manual Operations**: Developers can also manually add data to external memory or query it directly using the storage interface\n\nThis automatic behavior means that once you configure Zep as your external memory provider, your CrewAI agents will seamlessly build context from past interactions and contribute new learnings without additional code.\n\n## Installation\n\n```bash\npip install zep-crewai\n```\n\n<Callout intent=\"info\">\n  Requires Python 3.10+, Zep CrewAI >=1.1.1, CrewAI >=0.186.0, and a Zep Cloud API key. Get your API key from [app.getzep.com](https://app.getzep.com).\n</Callout>\n\nSet up your environment variables:\n\n```bash\nexport ZEP_API_KEY=\"your-zep-api-key\"\n```\n\n## Storage types\n\n### User storage\n\nUse `ZepUserStorage` for personal context and conversation history:\n\n<CodeBlocks>\n  ```python Python\n  import os\n  from zep_cloud.client import Zep\n  from zep_crewai import ZepUserStorage\n  from crewai import Agent, Crew, Task\n  from crewai.memory.external.external_memory import ExternalMemory\n\n  # Initialize Zep client\n  zep_client = Zep(api_key=os.getenv(\"ZEP_API_KEY\"))\n\n  # Create user and thread\n  zep_client.user.add(user_id=\"alice_123\", first_name=\"Alice\")\n  zep_client.thread.create(user_id=\"alice_123\", thread_id=\"project_456\")\n\n  # Set up user storage\n  user_storage = ZepUserStorage(\n      client=zep_client,\n      user_id=\"alice_123\",\n      thread_id=\"project_456\"\n  )\n\n  # Create crew with user memory\n  crew = Crew(\n      agents=[your_agent],\n      tasks=[your_task],\n      external_memory=ExternalMemory(storage=user_storage)\n  )\n  ```\n</CodeBlocks>\n\nUser storage automatically routes data:\n\n* **Messages** (`type: \"message\"`) → Thread API for conversation context\n* **JSON/Text** (`type: \"json\"` or `type: \"text\"`) → User Graph for preferences\n\n### Graph storage\n\nUse `ZepGraphStorage` for organizational knowledge that multiple agents can access:\n\n<CodeBlocks>\n  ```python Python\n  from zep_crewai import ZepGraphStorage\n\n  # Create a graph first\n  graph = zep_client.graph.create(\n      graph_id=\"company_knowledge\", \n      name=\"Company Knowledge Graph\",\n      description=\"Shared organizational knowledge and insights.\"\n  )\n\n  # Create graph storage for shared knowledge\n  graph_storage = ZepGraphStorage(\n      client=zep_client,\n      graph_id=\"company_knowledge\",\n      search_filters={\"node_labels\": [\"Technology\", \"Project\"]}\n  )\n\n  # Create crew with graph memory\n  crew = Crew(\n      agents=[your_agent],\n      tasks=[your_task],\n      external_memory=ExternalMemory(storage=graph_storage)\n  )\n  ```\n</CodeBlocks>\n\n## Tool integration\n\nEquip your agents with Zep tools for dynamic knowledge management:\n\n<CodeBlocks>\n  ```python Python\n  from zep_crewai import create_search_tool, create_add_data_tool\n\n  # Create tools for user storage\n  user_search_tool = create_search_tool(zep_client, user_id=\"alice_123\")\n  user_add_tool = create_add_data_tool(zep_client, user_id=\"alice_123\")\n\n  # Create tools for graph storage\n  graph_search_tool = create_search_tool(zep_client, graph_id=\"knowledge_base\")\n  graph_add_tool = create_add_data_tool(zep_client, graph_id=\"knowledge_base\")\n\n  # Create agent with tools\n  knowledge_agent = Agent(\n      role=\"Knowledge Assistant\",\n      goal=\"Manage and retrieve information efficiently\",\n      tools=[user_search_tool, graph_add_tool],\n      backstory=\"You help maintain and search through relevant knowledge\",\n      llm=\"gpt-4o-mini\"\n  )\n  ```\n</CodeBlocks>\n\n**Tool parameters:**\n\nSearch tool:\n\n* `query`: Natural language search query\n* `limit`: Maximum results (default: 10)\n* `scope`: Search scope - \"edges\", \"nodes\", \"episodes\", or \"all\"\n\nAdd data tool:\n\n* `data`: Content to store (text, JSON, or message)\n* `data_type`: Explicit type - \"text\", \"json\", or \"message\"\n\n## Advanced patterns\n\n### Structured data with ontologies\n\nDefine entity models for better knowledge organization:\n\n<CodeBlocks>\n  ```python Python\n  from pydantic import Field\n  from zep_cloud.external_clients.ontology import EntityModel, EntityText\n\n  class ProjectEntity(EntityModel):\n      status: EntityText = Field(description=\"project status\")\n      priority: EntityText = Field(description=\"priority level\")\n      team_size: EntityText = Field(description=\"team size\")\n\n  # Set graph ontology\n  zep_client.graph.set_ontology(\n      graph_id=\"projects\",\n      entities={\"Project\": ProjectEntity},\n      edges={}\n  )\n\n  # Use graph with structured entities\n  graph_storage = ZepGraphStorage(\n      client=zep_client,\n      graph_id=\"projects\",\n      search_filters={\"node_labels\": [\"Project\"]},\n      facts_limit=20,\n      entity_limit=5\n  )\n  ```\n</CodeBlocks>\n\n### Multi-agent with mixed storage\n\nCombine user and graph storage for comprehensive memory:\n\n<CodeBlocks>\n  ```python Python\n  # Personal assistant with user-specific memory\n  personal_storage = ZepUserStorage(\n      client=zep_client,\n      user_id=\"alice_123\",\n      thread_id=\"conversation_456\"\n  )\n\n  personal_agent = Agent(\n      role=\"Personal Assistant\",\n      tools=[create_search_tool(zep_client, user_id=\"alice_123\")],\n      backstory=\"You know Alice's preferences and conversation history\"\n  )\n\n  # Team coordinator with shared knowledge\n  team_storage = ZepGraphStorage(\n      client=zep_client,\n      graph_id=\"team_knowledge\"\n  )\n\n  team_agent = Agent(\n      role=\"Team Coordinator\",\n      tools=[create_search_tool(zep_client, graph_id=\"team_knowledge\")],\n      backstory=\"You maintain the team's shared knowledge base\"\n  )\n\n  # Create crews with different storage types\n  personal_crew = Crew(\n      agents=[personal_agent],\n      tasks=[personal_task],\n      external_memory=ExternalMemory(storage=personal_storage)\n  )\n\n  team_crew = Crew(\n      agents=[team_agent],\n      tasks=[team_task],\n      external_memory=ExternalMemory(storage=team_storage)\n  )\n  ```\n</CodeBlocks>\n\n### Research and curation workflow\n\nAgents can search existing knowledge and add new discoveries:\n\n<CodeBlocks>\n  ```python Python\n  # Research agent with search capabilities\n  researcher = Agent(\n      role=\"Research Analyst\",\n      goal=\"Analyze information from multiple knowledge sources\",\n      tools=[\n          create_search_tool(zep_client, user_id=\"alice_123\"),\n          create_search_tool(zep_client, graph_id=\"research_data\")\n      ],\n      backstory=\"You analyze both personal and organizational data\"\n  )\n\n  # Knowledge curator with write access\n  curator = Agent(\n      role=\"Knowledge Curator\",\n      goal=\"Maintain the organization's knowledge base\",\n      tools=[\n          create_search_tool(zep_client, graph_id=\"knowledge_base\"),\n          create_add_data_tool(zep_client, graph_id=\"knowledge_base\")\n      ],\n      backstory=\"You maintain and organize company knowledge\"\n  )\n\n  # Task that demonstrates search and add workflow\n  research_task = Task(\n      description=\"\"\"Research current trends in AI frameworks:\n      1. Search existing knowledge about AI frameworks\n      2. Identify gaps in current knowledge\n      3. Add new insights to the knowledge base\"\"\",\n      expected_output=\"Summary of research findings and new knowledge added\",\n      agent=curator\n  )\n  ```\n</CodeBlocks>\n\n## Configuration options\n\n### ZepUserStorage parameters\n\n* `client`: Zep client instance (required)\n* `user_id`: User identifier (required)\n* `thread_id`: Thread identifier (optional, enables conversation context)\n* `search_filters`: Filter search results by node labels or attributes\n* `facts_limit`: Maximum facts for context (default: 20)\n* `entity_limit`: Maximum entities for context (default: 5)\n\n### ZepGraphStorage parameters\n\n* `client`: Zep client instance (required)\n* `graph_id`: Graph identifier (required)\n* `search_filters`: Filter by node labels (e.g., `{\"node_labels\": [\"Technology\"]}`)\n* `facts_limit`: Maximum facts for context (default: 20)\n* `entity_limit`: Maximum entities for context (default: 5)\n\n## Memory routing\n\nThe integration automatically routes different data types to appropriate storage:\n\n<CodeBlocks>\n  ```python Python\n  # Messages go to thread (if thread_id is configured)\n  external_memory.save(\n      \"How can I help you today?\",\n      metadata={\"type\": \"message\", \"role\": \"assistant\", \"name\": \"Helper\"}\n  )\n\n  # JSON data goes to graph\n  external_memory.save(\n      '{\"project\": \"Alpha\", \"status\": \"active\", \"budget\": 50000}',\n      metadata={\"type\": \"json\"}\n  )\n\n  # Text data goes to graph\n  external_memory.save(\n      \"Project Alpha requires Python and React expertise\",\n      metadata={\"type\": \"text\"}\n  )\n  ```\n</CodeBlocks>\n\n## Complete example\n\nHere's a complete example showing personal assistance with conversation memory:\n\n<CodeBlocks>\n  ```python Python\n  import os\n  import time\n  from zep_cloud.client import Zep\n  from zep_crewai import ZepUserStorage\n  from crewai import Agent, Crew, Task, Process\n  from crewai.memory.external.external_memory import ExternalMemory\n\n  # Initialize Zep\n  zep_client = Zep(api_key=os.getenv(\"ZEP_API_KEY\"))\n\n  # Set up user and thread\n  user_id = \"alice_123\"\n  thread_id = \"project_planning\"\n\n  zep_client.user.add(user_id=user_id, first_name=\"Alice\")\n  zep_client.thread.create(user_id=user_id, thread_id=thread_id)\n\n  # Configure user storage\n  user_storage = ZepUserStorage(\n      client=zep_client,\n      user_id=user_id,\n      thread_id=thread_id\n  )\n  external_memory = ExternalMemory(storage=user_storage)\n\n  # Store conversation context\n  external_memory.save(\n      \"I need help planning our Q4 product roadmap with focus on mobile features\",\n      metadata={\"type\": \"message\", \"role\": \"user\", \"name\": \"Alice\"}\n  )\n\n  external_memory.save(\n      '{\"budget\": 500000, \"team_size\": 12, \"deadline\": \"Q4 2024\"}',\n      metadata={\"type\": \"json\"}\n  )\n\n  # Allow time for indexing\n  time.sleep(20)\n\n  # Create agent with memory\n  planning_agent = Agent(\n      role=\"Product Planning Assistant\",\n      goal=\"Help create data-driven product roadmaps\",\n      backstory=\"You understand Alice's preferences and project context\",\n      llm=\"gpt-4o-mini\"\n  )\n\n  planning_task = Task(\n      description=\"Create a Q4 roadmap based on Alice's requirements and context\",\n      expected_output=\"Detailed roadmap with timeline and resource allocation\",\n      agent=planning_agent\n  )\n\n  # Execute with automatic memory retrieval\n  crew = Crew(\n      agents=[planning_agent],\n      tasks=[planning_task],\n      process=Process.sequential,\n      external_memory=external_memory\n  )\n\n  result = crew.kickoff()\n\n  # Save results back to memory\n  external_memory.save(\n      str(result),\n      metadata={\"type\": \"message\", \"role\": \"assistant\", \"name\": \"Planning Agent\"}\n  )\n  ```\n</CodeBlocks>\n\n## Best practices\n\n### Storage selection\n\n* **Use ZepUserStorage** for personal preferences, conversation history, and user-specific context\n* **Use ZepGraphStorage** for shared knowledge, organizational data, and collaborative information\n\n### Memory management\n\n* **Set up ontologies** for structured data organization\n* **Use search filters** to target specific node types and improve relevance\n* **Combine storage types** for comprehensive memory coverage\n\n### Tool usage\n\n* **Bind tools** to specific users or graphs at creation time\n* **Use search scope \"all\"** sparingly as it's more expensive\n* **Add data with appropriate types** (message, json, text) for correct routing\n* **Limit search results** appropriately to avoid context bloat\n\n## Next steps\n\n* Explore [customizing graph structure](/customizing-graph-structure) for advanced knowledge organization\n* Learn about [searching the graph](/searching-the-graph) and how to search the graph\n* See [code examples](https://github.com/getzep/zep/tree/main/integrations/python/zep_crewai/examples) for additional patterns",
  "content_length": 13553
}