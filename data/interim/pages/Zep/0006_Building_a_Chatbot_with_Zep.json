{
  "title": "Building a Chatbot with Zep",
  "source_url": null,
  "content": "> Familiarize yourself with Zep and the Zep SDKs, culminating in building a simple chatbot.\n\n<Tip>\n  For an introduction to Zep's memory layer, Knowledge Graph, and other key concepts, see the [Concepts Guide](/concepts).\n</Tip>\n\n<Note>\n  A Jupyter notebook version of this guide is [available here](https://github.com/getzep/zep/blob/main/examples/python/quickstart/quickstart.ipynb).\n</Note>\n\nIn this guide, we'll walk through a simple example of how to use Zep Cloud to build a user-facing chatbot. We're going to upload a number of datasets to Zep, building a graph of data about a user.\n\nThen we'll use the Zep Python SDK to retrieve and search the data.\n\nFinally, we'll build a simple chatbot that uses Zep to retrieve and search data to respond to a user.\n\n## Set Up Your Environment\n\n1. Sign up for a [Zep Cloud](https://www.getzep.com/) account.\n\n2. Ensure you install required dependencies into your Python environment before running this notebook. See [Installing Zep SDKs](sdks.mdx) for more information. Optionally create your environment in a `virtualenv`.\n\n```bash\npip install zep-cloud openai rich python-dotenv\n```\n\n3. Ensure that you have a `.env` file in your working directory that includes your `ZEP_API_KEY` and `OPENAI_API_KEY`:\n\n<Note>\n  Zep API keys are specific to a project. You can create multiple keys for a\n  single project. Visit `Project Settings` in the Zep dashboard to manage your\n  API keys.\n</Note>\n\n```text\nZEP_API_KEY=<key>\nOPENAI_API_KEY=<key>\n```\n\n<CodeBlocks>\n  ```python Python\n  import os\n  import json\n  import uuid\n\n  from openai import OpenAI\n  import rich\n\n  from dotenv import load_dotenv\n  from zep_cloud.client import Zep\n  from zep_cloud import Message\n\n  load_dotenv()\n\n  zep = Zep(api_key=os.environ.get(\"ZEP_API_KEY\"))\n\n  oai_client = OpenAI(\n      api_key=os.getenv(\"OPENAI_API_KEY\"),\n  )\n  ```\n\n  ```typescript TypeScript\n  import { ZepClient } from \"@getzep/zep-cloud\";\n  import * as dotenv from \"dotenv\";\n  import { v4 as uuidv4 } from 'uuid';\n  import OpenAI from 'openai';\n\n  dotenv.config();\n\n  const zep = new ZepClient({ apiKey: process.env.ZEP_API_KEY });\n\n  const oai_client = new OpenAI({\n    apiKey: process.env.OPENAI_API_KEY,\n  });\n  ```\n</CodeBlocks>\n\n<Info>\n  We also provide an \n\n  [Asynchronous Python client](/install-sdks#initialize-the-client)\n\n  .\n</Info>\n\n## Create User and Add a Thread\n\nUsers in Zep may have one or more chat threads. These are threads of messages between the user and an agent.\n\n<Tip>\n  Include the user's **full name** and **email address** when creating a user.\n  This improves Zep's ability to associate data, such as emails or documents,\n  with a user.\n</Tip>\n\n<CodeBlocks>\n  ```python Python\n  bot_name = \"SupportBot\"\n  user_name = \"Emily\"\n  user_id = user_name + str(uuid.uuid4())[:4]\n  thread_id = str(uuid.uuid4())\n\n  zep.user.add(\n      user_id=user_id,\n      email=f\"{user_name}@painters.com\",\n      first_name=user_name,\n      last_name=\"Painter\",\n  )\n\n  zep.thread.create(\n      user_id=user_id,\n      thread_id=thread_id,\n  )\n  ```\n\n  ```typescript TypeScript\n  const bot_name = \"SupportBot\";\n  const user_name = \"Emily\";\n  const user_id = user_name + uuidv4().substring(0, 4);\n  const thread_id = uuidv4();\n\n  await zep.user.add({\n    userId: user_id,\n    email: `${user_name}@painters.com`,\n    firstName: user_name,\n    lastName: \"Painter\",\n  });\n\n  await zep.thread.create({\n    userId: user_id,\n    threadId: thread_id,\n  });\n  ```\n</CodeBlocks>\n\n## Datasets\n\nWe're going to use the [memory](/adding-memory#adding-messages) and [graph](/adding-data-to-the-graph) APIs to upload an assortment of data to Zep. These include past dialog with the agent, CRM support cases, and billing data.\n\n<CodeBlocks>\n  ```python Python\n  support_cases = [\n      {\n          \"subject\": \"Bug: Magic Pen Tool Drawing Goats Instead of Boats\",\n          \"messages\": [\n              {\n                  \"role\": \"user\",\n                  \"content\": \"Whenever I use the magic pen tool to draw boats, it ends up drawing goats instead.\",\n                  \"timestamp\": \"2024-03-16T14:20:00Z\",\n              },\n              {\n                  \"role\": \"support_agent\",\n                  \"content\": f\"Hi {user_name}, that sounds like a bug! Thanks for reporting it. Could you let me know exactly how you're using the tool when this happens?\",\n                  \"timestamp\": \"2024-03-16T14:22:00Z\",\n              },\n              {\n                  \"role\": \"user\",\n                  \"content\": \"Sure, I select the magic pen, draw a boat shape, and it just replaces the shape with goats.\",\n                  \"timestamp\": \"2024-03-16T14:25:00Z\",\n              },\n              {\n                  \"role\": \"support_agent\",\n                  \"content\": \"Got it! We'll escalate this to our engineering team. In the meantime, you can manually select the boat shape from the options rather than drawing it with the pen.\",\n                  \"timestamp\": \"2024-03-16T14:27:00Z\",\n              },\n              {\n                  \"role\": \"user\",\n                  \"content\": \"Okay, thanks. I hope it gets fixed soon!\",\n                  \"timestamp\": \"2024-03-16T14:30:00Z\",\n              },\n          ],\n          \"status\": \"escalated\",\n      },\n  ]\n\n  chat_history = [\n      {\n          \"role\": \"assistant\",\n          \"name\": bot_name,\n          \"content\": f\"Hello {user_name}, welcome to PaintWiz support. How can I assist you today?\",\n          \"timestamp\": \"2024-03-15T10:00:00Z\",\n      },\n      {\n          \"role\": \"user\",\n          \"name\": user_name,\n          \"content\": \"I'm absolutely furious! Your AI art generation is completely broken!\",\n          \"timestamp\": \"2024-03-15T10:02:00Z\",\n      },\n      {\n          \"role\": \"assistant\",\n          \"name\": bot_name,\n          \"content\": f\"I'm sorry to hear that you're experiencing issues, {user_name}. Can you please provide more details about what's going wrong?\",\n          \"timestamp\": \"2024-03-15T10:03:00Z\",\n      },\n      {\n          \"role\": \"user\",\n          \"name\": user_name,\n          \"content\": \"Every time I try to draw mountains, your stupid app keeps turning them into fountains! And what's worse, all the people in my drawings have six fingers! It's ridiculous!\",\n          \"timestamp\": \"2024-03-15T10:05:00Z\",\n      },\n      {\n          \"role\": \"assistant\",\n          \"name\": bot_name,\n          \"content\": f\"I sincerely apologize for the frustration this is causing you, {user_name}. That certainly sounds like a significant glitch in our system. I understand how disruptive this can be to your artistic process. Can you tell me which specific tool or feature you're using when this occurs?\",\n          \"timestamp\": \"2024-03-15T10:06:00Z\",\n      },\n      {\n          \"role\": \"user\",\n          \"name\": user_name,\n          \"content\": \"I'm using the landscape generator and the character creator. Both are completely messed up. How could you let this happen?\",\n          \"timestamp\": \"2024-03-15T10:08:00Z\",\n      },\n  ]\n\n  transactions = [\n      {\n          \"date\": \"2024-07-30\",\n          \"amount\": 99.99,\n          \"status\": \"Success\",\n          \"account_id\": user_id,\n          \"card_last_four\": \"1234\",\n      },\n      {\n          \"date\": \"2024-08-30\",\n          \"amount\": 99.99,\n          \"status\": \"Failed\",\n          \"account_id\": user_id,\n          \"card_last_four\": \"1234\",\n          \"failure_reason\": \"Card expired\",\n      },\n      {\n          \"date\": \"2024-09-15\",\n          \"amount\": 99.99,\n          \"status\": \"Failed\",\n          \"account_id\": user_id,\n          \"card_last_four\": \"1234\",\n          \"failure_reason\": \"Card expired\",\n      },\n  ]\n\n  account_status = {\n      \"user_id\": user_id,\n      \"account\": {\n          \"account_id\": user_id,\n          \"account_status\": {\n              \"status\": \"suspended\",\n              \"reason\": \"payment failure\",\n          },\n      },\n  }\n\n  def convert_to_zep_messages(chat_history: list[dict[str, str | None]]) -> list[Message]:\n      \"\"\"\n      Convert chat history to Zep messages.\n\n      Args:\n      chat_history (list): List of dictionaries containing chat messages.\n\n      Returns:\n      list: List of Zep Message objects.\n      \"\"\"\n      return [\n          Message(\n              role=msg[\"role\"],\n              name=msg.get(\"name\", None),\n              content=msg[\"content\"],\n          )\n          for msg in chat_history\n      ]\n\n  # Zep's high-level API allows us to add a list of messages to a thread.\n  zep.thread.add_messages(\n      thread_id=thread_id, messages=convert_to_zep_messages(chat_history)\n  )\n\n  # The lower-level data API allows us to add arbitrary data to a user's Knowledge Graph.\n  for tx in transactions:\n      zep.graph.add(user_id=user_id, data=json.dumps(tx), type=\"json\")\n\n      zep.graph.add(\n          user_id=user_id, data=json.dumps(account_status), type=\"json\"\n      )\n\n  for case in support_cases:\n      zep.graph.add(user_id=user_id, data=json.dumps(case), type=\"json\")\n  ```\n\n  ```typescript TypeScript\n  const support_cases = [\n    {\n      subject: \"Bug: Magic Pen Tool Drawing Goats Instead of Boats\",\n      messages: [\n        {\n          role: \"user\",\n          content: \"Whenever I use the magic pen tool to draw boats, it ends up drawing goats instead.\",\n          timestamp: \"2024-03-16T14:20:00Z\",\n        },\n        {\n          role: \"support_agent\",\n          content: `Hi ${user_name}, that sounds like a bug! Thanks for reporting it. Could you let me know exactly how you're using the tool when this happens?`,\n          timestamp: \"2024-03-16T14:22:00Z\",\n        },\n        {\n          role: \"user\",\n          content: \"Sure, I select the magic pen, draw a boat shape, and it just replaces the shape with goats.\",\n          timestamp: \"2024-03-16T14:25:00Z\",\n        },\n        {\n          role: \"support_agent\",\n          content: \"Got it! We'll escalate this to our engineering team. In the meantime, you can manually select the boat shape from the options rather than drawing it with the pen.\",\n          timestamp: \"2024-03-16T14:27:00Z\",\n        },\n        {\n          role: \"user\",\n          content: \"Okay, thanks. I hope it gets fixed soon!\",\n          timestamp: \"2024-03-16T14:30:00Z\",\n        },\n      ],\n      status: \"escalated\",\n    },\n  ];\n\n  const chat_history = [\n    {\n      role: \"assistant\",\n      name: bot_name,\n      content: `Hello ${user_name}, welcome to PaintWiz support. How can I assist you today?`,\n      timestamp: \"2024-03-15T10:00:00Z\",\n    },\n    {\n      role: \"user\",\n      name: user_name,\n      content: \"I'm absolutely furious! Your AI art generation is completely broken!\",\n      timestamp: \"2024-03-15T10:02:00Z\",\n    },\n    {\n      role: \"assistant\",\n      name: bot_name,\n      content: `I'm sorry to hear that you're experiencing issues, ${user_name}. Can you please provide more details about what's going wrong?`,\n      timestamp: \"2024-03-15T10:03:00Z\",\n    },\n    {\n      role: \"user\",\n      name: user_name,\n      content: \"Every time I try to draw mountains, your stupid app keeps turning them into fountains! And what's worse, all the people in my drawings have six fingers! It's ridiculous!\",\n      timestamp: \"2024-03-15T10:05:00Z\",\n    },\n    {\n      role: \"assistant\",\n      name: bot_name,\n      content: `I sincerely apologize for the frustration this is causing you, ${user_name}. That certainly sounds like a significant glitch in our system. I understand how disruptive this can be to your artistic process. Can you tell me which specific tool or feature you're using when this occurs?`,\n      timestamp: \"2024-03-15T10:06:00Z\",\n    },\n    {\n      role: \"user\",\n      name: user_name,\n      content: \"I'm using the landscape generator and the character creator. Both are completely messed up. How could you let this happen?\",\n      timestamp: \"2024-03-15T10:08:00Z\",\n    },\n  ];\n\n  const transactions = [\n    {\n      date: \"2024-07-30\",\n      amount: 99.99,\n      status: \"Success\",\n      account_id: user_id,\n      card_last_four: \"1234\",\n    },\n    {\n      date: \"2024-08-30\",\n      amount: 99.99,\n      status: \"Failed\",\n      account_id: user_id,\n      card_last_four: \"1234\",\n      failure_reason: \"Card expired\",\n    },\n    {\n      date: \"2024-09-15\",\n      amount: 99.99,\n      status: \"Failed\",\n      account_id: user_id,\n      card_last_four: \"1234\",\n      failure_reason: \"Card expired\",\n    },\n  ];\n\n  const account_status = {\n    user_id: user_id,\n    account: {\n      account_id: user_id,\n      account_status: {\n        status: \"suspended\",\n        reason: \"payment failure\",\n      },\n    },\n  };\n\n  /**\n   * Convert chat history to Zep messages.\n   * \n   * Args:\n   * chatHistory (array): Array of objects containing chat messages.\n   * \n   * Returns:\n   * array: Array of Zep message objects.\n   */\n  const convertToZepMessages = (chatHistory: any[]) => {\n    return chatHistory.map(msg => ({\n      role: msg.role,\n      name: msg.name || null,\n      content: msg.content,\n    }));\n  };\n\n  // Zep's high-level API allows us to add a list of messages to a thread.\n  await zep.thread.addMessages(thread_id, {\n    messages: convertToZepMessages(chat_history)\n  });\n\n  // The lower-level data API allows us to add arbitrary data to a user's Knowledge Graph.\n  for (const tx of transactions) {\n    await zep.graph.add({\n      userId: user_id,\n      type: \"json\",\n      data: JSON.stringify(tx)\n    });\n\n    await zep.graph.add({\n      userId: user_id,\n      type: \"json\",\n      data: JSON.stringify(account_status)\n    });\n  }\n\n  for (const case_data of support_cases) {\n    await zep.graph.add({\n      userId: user_id,\n      type: \"json\",\n      data: JSON.stringify(case_data)\n    });\n  }\n  ```\n</CodeBlocks>\n\n### Wait a minute or two!\n\n<Tip>\n  We've batch uploaded a number of datasets that need to be ingested into Zep's\n  graph before they can be queried. In ordinary operation, this data would\n  stream into Zep and ingestion latency would be negligible.\n</Tip>\n\n## Retrieve Data From Zep\n\nWe'll start with getting a list of facts, which are stored on the edges of the graph. We'll see the temporal data associated with facts as well as the graph nodes the fact is related to.\n\n<Tip>\n  This data is also viewable in the Zep Web application.\n</Tip>\n\n<CodeBlocks>\n  ```python Python\n  all_user_edges = zep.graph.edge.get_by_user_id(user_id=user_id)\n  rich.print(all_user_edges[:3])\n  ```\n\n  ```typescript TypeScript\n  const all_user_edges = await zep.graph.edge.getByUserId(user_id);\n  console.log(all_user_edges.slice(0, 3));\n  ```\n</CodeBlocks>\n\n```text\n[\n    EntityEdge(\n        created_at='2025-02-20T20:31:01.769332Z',\n        episodes=['0d3a35c7-ebd3-427d-89a6-1a8dabd2df64'],\n        expired_at='2025-02-20T20:31:18.742184Z',\n        fact='The transaction failed because the card expired.',\n        invalid_at='2024-09-15T00:00:00Z',\n        name='HAS_FAILURE_REASON',\n        source_node_uuid='06c61c00-9101-474f-9bca-42b4308ec378',\n        target_node_uuid='07efd834-f07a-4c3c-9b32-d2fd9362afd5',\n        uuid_='fb5ee0df-3aa0-44f3-889d-5bb163971b07',\n        valid_at='2024-08-30T00:00:00Z',\n        graph_id='8e5686fc-f175-4da9-8778-ad8d60fc469a'\n    ),\n    EntityEdge(\n        created_at='2025-02-20T20:31:33.771557Z',\n        episodes=['60d1d20e-ed6c-4966-b1da-3f4ca274a524'],\n        expired_at=None,\n        fact='Emily uses the magic pen tool to draw boats.',\n        invalid_at=None,\n        name='USES_TOOL',\n        source_node_uuid='36f5c5c6-eb16-4ebb-9db0-fd34809482f5',\n        target_node_uuid='e337522d-3a62-4c45-975d-904e1ba25667',\n        uuid_='f9eb0a98-1624-4932-86ca-be75a3c248e5',\n        valid_at='2025-02-20T20:29:40.217412Z',\n        graph_id='8e5686fc-f175-4da9-8778-ad8d60fc469a'\n    ),\n    EntityEdge(\n        created_at='2025-02-20T20:30:28.499178Z',\n        episodes=['b8e4da4c-dd5e-4c48-bdbc-9e6568cd2d2e'],\n        expired_at=None,\n        fact=\"SupportBot understands how disruptive the glitch in the AI art generation can be to Emily's artistic process.\",\n        invalid_at=None,\n        name='UNDERSTANDS',\n        source_node_uuid='fd4ab1f0-e19e-40b7-aaec-78bd97571725',\n        target_node_uuid='8e5686fc-f175-4da9-8778-ad8d60fc469a',\n        uuid_='f8c52a21-e938-46a3-b930-04671d0c018a',\n        valid_at='2025-02-20T20:29:39.08846Z',\n        graph_id='8e5686fc-f175-4da9-8778-ad8d60fc469a'\n    )\n]\n```\n\nThe [`thread.get_user_context` method](/retrieving-memory#zeps-context-block) provides an easy way to retrieve memory relevant to the current conversation by using the last 4 messages and their proximity to the User node.\n\n<Tip>\n  The `thread.get_user_context` method is a good starting point for retrieving relevant conversation context. It shortcuts passing recent messages to the `graph.search` API and returns a [context block](/retrieving-memory#zeps-context-block), raw facts, and historical chat messages, providing everything needed for your agent's prompts.\n</Tip>\n\n<CodeBlocks>\n  ```python Python\n  memory = zep.thread.get_user_context(thread_id=thread_id)\n  rich.print(memory.context)\n  ```\n\n  ```typescript TypeScript\n  const memory = await zep.thread.getUserContext(thread_id);\n  console.log(memory.context);\n  ```\n</CodeBlocks>\n\n```text\nFACTS and ENTITIES represent relevant context to the current conversation.\n\n### These are the most relevant facts and their valid date ranges\n### format: FACT (Date range: from - to)\n<FACTS>\n  - SupportBot understands how disruptive the glitch in the AI art generation can be to Emily's artistic process. (2025-02-20 20:29:39 - present)\n  - SupportBot sincerely apologizes to Emily for the frustration caused by the issues with the AI art generation. (2025-02-20 20:29:39 - present)\n  - Emily has contacted SupportBot for assistance regarding issues she is experiencing. (2025-02-20 20:29:39 - present)\n  - The user Emily reported a bug regarding the magic pen tool drawing goats instead of boats. (2024-03-16 14:20:00 - present)\n  - The bug report has been escalated to the engineering team. (2024-03-16 14:27:00 - present)\n  - Emily is a user of the AI art generation. (2025-02-20 20:29:39 - present)\n  - user has the name of Emily Painter (2025-02-20 20:29:39 - present)\n  - Emily5e57 is using the landscape generator. (2025-02-20 20:29:39 - 2025-02-20 20:29:39)\n  - user has the id of Emily5e57 (2025-02-20 20:29:39 - present)\n  - user has the email of Emily@painters.com (2025-02-20 20:29:39 - present)\n  - Emily is furious about the stupid app. (2025-02-20 20:29:39 - present)\n  - Emily claims that the AI art generation is completely broken. (2025-02-20 20:29:39 - present)\n</FACTS>\n\n### These are the most relevant entities\n### ENTITY_NAME: entity summary\n<ENTITIES>\n  - Emily Painter: Emily Painter contacted PaintWiz support for assistance, where she was welcomed by the support bot that inquired about the specific issues she was facing to provide better help.\n  - Emily@painters.com: user with the email of Emily@painters.com\n  - Emily5e57: Emily5e57, a user of the PaintWiz AI art generation tool, successfully processed a transaction of $99.99 on July 30, 2024, using a card ending in '1234'. However, she is experiencing\nsignificant frustration with the application due to malfunctions, such as the landscape generator incorrectly transforming mountains into fountains and characters being depicted with six fingers. \nThese issues have led her to question the reliability of the tool, and she considers it to be completely broken. Emily has reached out to PaintWiz support for assistance, as these problems are \nseverely disrupting her artistic process.\n  - PaintWiz support: PaintWiz is an AI art generation platform that provides tools for users to create art. Recently, a user named Emily reported significant issues with the service, claiming that\nthe AI art generation is not functioning properly. The support bot responded to her concerns, apologizing for the disruption to her artistic process and asking for more details about the specific \ntool or feature she was using. This interaction highlights PaintWiz's commitment to customer support, as they actively seek to assist users with their inquiries and problems related to their \nproducts.\n  - SupportBot: A support agent named Emily addressed a user's report about a bug in a drawing application where the magic pen tool incorrectly produced goats instead of boats. After confirming the\nissue, she escalated it to the engineering team and suggested a temporary workaround of manually selecting the boat shape. Meanwhile, SupportBot, a virtual assistant for PaintWiz, also assisted \nanother user named Emily who was frustrated with the AI art generation feature, acknowledging her concerns and requesting more details to help resolve the problem.\n  - AI art generation: Emily, a user, expressed her frustration regarding the AI art generation, stating that it is completely broken.\n  - options: The user reported a bug with the magic pen tool, stating that when attempting to draw boats, the tool instead draws goats. The support agent acknowledged the issue and requested more \ndetails about how the user was utilizing the tool. The user explained that they select the magic pen and draw a boat shape, but it gets replaced with goats. The support agent confirmed they would \nescalate the issue to the engineering team and suggested that the user manually select the boat shape from the options instead of drawing it with the pen. The user expressed hope for a quick \nresolution.\n</ENTITIES>\n```\n\n<CodeBlocks>\n  ```python Python\n  rich.print(memory.messages)\n  ```\n\n  ```typescript TypeScript\n  console.log(memory.messages);\n  ```\n</CodeBlocks>\n\n```text\n[\n    Message(\n        content='Hello Emily, welcome to PaintWiz support. How can I assist you today?',\n        created_at='2025-02-20T20:29:39.08846Z',\n        metadata=None,\n        name='SupportBot',\n        role='assistant',\n        token_count=0,\n        updated_at='0001-01-01T00:00:00Z',\n        uuid_='e2b86f93-84d6-4270-adbc-e421f39b6f90'\n    ),\n    Message(\n        content=\"I'm absolutely furious! Your AI art generation is completely broken!\",\n        created_at='2025-02-20T20:29:39.08846Z',\n        metadata=None,\n        name='Emily',\n        role='user',\n        token_count=0,\n        updated_at='0001-01-01T00:00:00Z',\n        uuid_='ec39e501-6dcc-4f8c-b300-f586d66005d8'\n    )\n]\n```\n\nWe can also use the [graph API](/searching-the-graph) to search edges/facts for arbitrary text. This API offers more options, including the ability to search node summaries and various re-rankers.\n\n<CodeBlocks>\n  ```python Python\n  r = zep.graph.search(user_id=user_id, query=\"Why are there so many goats?\", limit=4, scope=\"edges\")\n  rich.print(r.edges)\n  ```\n\n  ```typescript TypeScript\n  const r = await zep.graph.search({\n    userId: user_id,\n    query: \"Why are there so many goats?\",\n    limit: 4,\n    scope: \"edges\"\n  });\n  console.log(r.edges);\n  ```\n</CodeBlocks>\n\n```text\n[\n    EntityEdge(\n        created_at='2025-02-20T20:31:33.771566Z',\n        episodes=['60d1d20e-ed6c-4966-b1da-3f4ca274a524'],\n        expired_at=None,\n        fact='The magic pen tool draws goats instead of boats when used by Emily.',\n        invalid_at=None,\n        name='DRAWS_INSTEAD_OF',\n        source_node_uuid='e337522d-3a62-4c45-975d-904e1ba25667',\n        target_node_uuid='9814a57f-53a4-4d4a-ad5a-15331858ce18',\n        uuid_='022687b6-ae08-4fef-9d6e-17afb07acdea',\n        valid_at='2025-02-20T20:29:40.217412Z',\n        graph_id='8e5686fc-f175-4da9-8778-ad8d60fc469a'\n    ),\n    EntityEdge(\n        created_at='2025-02-20T20:31:33.771528Z',\n        episodes=['60d1d20e-ed6c-4966-b1da-3f4ca274a524'],\n        expired_at=None,\n        fact='The user Emily reported a bug regarding the magic pen tool drawing goats instead of boats.',\n        invalid_at=None,\n        name='REPORTED_BY',\n        source_node_uuid='36f5c5c6-eb16-4ebb-9db0-fd34809482f5',\n        target_node_uuid='cff4e758-d1a4-4910-abe7-20101a1f0d77',\n        uuid_='5c3124ec-b4a3-4564-a38f-02338e3db4c4',\n        valid_at='2024-03-16T14:20:00Z',\n        graph_id='8e5686fc-f175-4da9-8778-ad8d60fc469a'\n    ),\n    EntityEdge(\n        created_at='2025-02-20T20:30:19.910797Z',\n        episodes=['ff9eba8b-9e90-4765-a0ce-15eb44410f70'],\n        expired_at=None,\n        fact='The stupid app generates mountains.',\n        invalid_at=None,\n        name='GENERATES',\n        source_node_uuid='b6e5a0ee-8823-4647-b536-5e6af0ba113a',\n        target_node_uuid='43aaf7c9-628c-4bf0-b7cb-02d3e9c1a49c',\n        uuid_='3514a3ad-1ed5-42c7-9f70-02834e8904bf',\n        valid_at='2025-02-20T20:29:39.08846Z',\n        graph_id='8e5686fc-f175-4da9-8778-ad8d60fc469a'\n    ),\n    EntityEdge(\n        created_at='2025-02-20T20:30:19.910816Z',\n        episodes=['ff9eba8b-9e90-4765-a0ce-15eb44410f70'],\n        expired_at=None,\n        fact='The stupid app keeps turning mountains into fountains.',\n        invalid_at=None,\n        name='TRANSFORMS_INTO',\n        source_node_uuid='43aaf7c9-628c-4bf0-b7cb-02d3e9c1a49c',\n        target_node_uuid='0c90b42c-2b9f-4998-aa67-cc968f9002d3',\n        uuid_='2f113810-3597-47a4-93c5-96d8002366fa',\n        valid_at='2025-02-20T20:29:39.08846Z',\n        graph_id='8e5686fc-f175-4da9-8778-ad8d60fc469a'\n    )\n]\n```\n\n## Creating a Simple Chatbot\n\nIn the next cells, Emily starts a new chat thread with a support agent and complains that she can't log in. Our simple chatbot will, given relevant facts retrieved from Zep's graph, respond accordingly.\n\nHere, the support agent is provided with Emily's billing information and account status, which Zep retrieves as most relevant to Emily's login issue.\n\n<CodeBlocks>\n  ```python Python\n  new_thread_id = str(uuid.uuid4())\n\n  emily_message = \"Hi, I can't log in!\"\n\n  # We start a new thread indicating that Emily has started a new chat with the support agent.\n  zep.thread.create(user_id=user_id, thread_id=new_thread_id)\n\n  # We need to add the Emily's message to the thread in order for thread.get_user_context to return\n  # relevant facts related to the message\n  zep.thread.add_messages(\n      thread_id=new_thread_id,\n      messages=[Message(role=\"user\", name=user_name, content=emily_message)],\n  )\n  ```\n\n  ```typescript TypeScript\n  const new_thread_id = uuidv4();\n  const emily_message = \"Hi, I can't log in!\";\n\n  // We start a new thread indicating that Emily has started a new chat with the support agent.\n  await zep.thread.create({\n    userId: user_id,\n    threadId: new_thread_id\n  });\n\n  // We need to add the Emily's message to the thread in order for thread.get_user_context to return\n  // relevant facts related to the message\n  await zep.thread.addMessages(new_thread_id, {\n    messages: [{\n      role: \"user\",\n      name: user_name,\n      content: emily_message\n    }]\n  });\n  ```\n</CodeBlocks>\n\n<CodeBlocks>\n  ```python Python\n  system_message = \"\"\"\n  You are a customer support agent. Carefully review the facts about the user below and respond to the user's question.\n  Be helpful and friendly.\n  \"\"\"\n\n  memory = zep.thread.get_user_context(thread_id=new_thread_id)\n\n  messages = [\n      {\n          \"role\": \"system\",\n          \"content\": system_message,\n      },\n      {\n          \"role\": \"assistant\",\n          # The context field is an opinionated string that contains facts and entities relevant to the current conversation.\n          \"content\": memory.context,\n      },\n      {\n          \"role\": \"user\",\n          \"content\": emily_message,\n      },\n  ]\n\n  response = oai_client.chat.completions.create(\n      model=\"gpt-4o-mini\",\n      messages=messages,\n      temperature=0,\n  )\n\n  print(response.choices[0].message.content)\n  ```\n\n  ```typescript TypeScript\n  const system_message = `\n  You are a customer support agent. Carefully review the facts about the user below and respond to the user's question.\n  Be helpful and friendly.\n  `;\n\n  const new_memory = await zep.thread.getUserContext(new_thread_id);\n\n  const messages = [\n    {\n      role: \"system\" as const,\n      content: system_message,\n    },\n    {\n      role: \"assistant\" as const,\n      // The context field is an opinionated string that contains facts and entities relevant to the current conversation.\n      content: new_memory.context || \"\",\n    },\n    {\n      role: \"user\" as const,\n      content: emily_message,\n    },\n  ];\n\n  const response = await oai_client.chat.completions.create({\n    model: \"gpt-4o-mini\",\n    messages: messages,\n    temperature: 0,\n  });\n\n  console.log(response.choices[0].message.content);\n  ```\n</CodeBlocks>\n\n```text\nHi Emily! I'm here to help you. It looks like your account is currently suspended due to a payment failure. This might be the reason you're unable to log in. \n\nThe last transaction on your account failed because the card you were using has expired. If you update your payment information, we can help you get your account reactivated. Would you like assistance with that?\n```\n\nLet's look at the Context Block Zep retrieved for the above `thread.get_user_context` call.\n\n<CodeBlocks>\n  ```python Python\n  rich.print(memory.context)\n  ```\n\n  ```typescript TypeScript\n  console.log(new_memory.context);\n  ```\n</CodeBlocks>\n\n```text\nFACTS and ENTITIES represent relevant context to the current conversation.\n\n### These are the most relevant facts and their valid date ranges\n### format: FACT (Date range: from - to)\n<FACTS>\n  - Account with ID 'Emily1c2e' has a status of 'suspended'. (2025-02-24 23:24:29 - present)\n  - user has the id of Emily1c2e (2025-02-24 23:24:29 - present)\n  - User with ID 'Emily1c2e' has an account with ID 'Emily1c2e'. (2025-02-24 23:24:29 - present)\n  - The bug report has been escalated to the engineering team. (2024-03-16 14:27:00 - present)\n  - user has the name of Emily Painter (2025-02-24 23:24:29 - present)\n  - Emily is the person being assisted by SupportBot. (2025-02-24 23:24:28 - present)\n  - Emily1c2e is using the character creator. (2025-02-24 23:24:28 - present)\n  - The reason for the account status 'suspended' is 'payment failure'. (2025-02-24 23:24:29 - present)\n  - SupportBot is part of PaintWiz support. (2025-02-24 23:24:28 - present)\n  - user has the email of Emily@painters.com (2025-02-24 23:24:29 - present)\n  - Emily is a user of PaintWiz. (2025-02-24 23:24:28 - present)\n  - The support agent suggested that Emily manually select the boat shape from the options. (2025-02-24 23:24:29 - \npresent)\n  - All the people in Emily1c2e's drawings have six fingers. (2025-02-24 23:24:28 - present)\n  - Emily1c2e is using the landscape generator. (2025-02-24 23:24:28 - present)\n  - Emily is a user of the AI art generation. (2025-02-24 23:24:28 - present)\n  - Emily states that the AI art generation is completely broken. (2025-02-24 23:24:28 - present)\n  - The magic pen tool draws goats instead of boats when used by Emily. (2025-02-24 23:24:29 - present)\n  - Emily1c2e tries to draw mountains. (2025-02-24 23:24:28 - present)\n</FACTS>\n\n### These are the most relevant entities\n### ENTITY_NAME: entity summary\n<ENTITIES>\n  - goats: In a recent support interaction, a user reported a bug with the magic pen tool in a drawing application,\nwhere attempting to draw boats resulted in the tool drawing goats instead. The user, Emily, described the issue, \nstating that whenever she selects the magic pen and draws a boat shape, it is replaced with a goat shape. The \nsupport agent acknowledged the problem and confirmed it would be escalated to the engineering team for resolution. \nIn the meantime, the agent suggested that Emily could manually select the boat shape from the available options \ninstead of using the pen tool. Emily expressed her hope for a quick fix to the issue.\n  - failure_reason: Two transactions failed due to expired cards: one on September 15, 2024, and another on August \n30, 2024, for the amount of $99.99 associated with account ID 'Emily1c2e'.\n  - status: User account \"Emily1c2e\" is suspended due to a payment failure. A transaction of $99.99 on September \n15, 2024, failed because the card ending in \"1234\" had expired. This card had previously been used successfully for\nthe same amount on July 30, 2024, but a failure on August 30, 2024, resulted in the account's suspension.\n  - bug: A user reported a bug with the magic pen tool, stating that when attempting to draw boats, the tool \ninstead draws goats. The support agent acknowledged the issue and requested more details about how the user was \nutilizing the tool. The user explained that they select the magic pen and draw a boat shape, but it gets replaced \nwith goats. The support agent confirmed the bug and stated that it would be escalated to the engineering team for \nresolution. In the meantime, they suggested that the user manually select the boat shape from the options instead \nof using the pen. The user expressed hope for a quick fix.\n  - user_id: Emily reported a bug with the magic pen tool in a drawing application, where attempting to draw boats \nresulted in goats being drawn instead. A support agent acknowledged the issue and requested more details. Emily \nexplained her process, and the agent confirmed the bug, stating it would be escalated to the engineering team. As a\ntemporary workaround, the agent suggested manually selecting the boat shape. Emily expressed hope for a quick \nresolution. Additionally, it was noted that another user, identified as \"Emily1c2e,\" has a suspended account due to\na payment failure.\n  - people: Emily is frustrated with the AI art generation feature of PaintWiz, specifically mentioning that the \npeople in her drawings are depicted with six fingers, which she finds ridiculous.\n  - character creator: Emily is experiencing significant issues with the character creator feature of the app. She \nreports that when using the landscape generator and character creator, the app is malfunctioning, resulting in \nbizarre outcomes such as people in her drawings having six fingers. Emily expresses her frustration, stating that \nthe AI art generation is completely broken and is not functioning as expected.\n</ENTITIES>\n```",
  "content_length": 33943
}