{
  "title": "Retrieving Memory",
  "source_url": null,
  "content": "> Learn how to retrieve relevant context from a User Graph.\n\nZep provides three methods for retrieving memory from a User Graph, each offering different levels of control and customization.\n\n## Choosing a retrieval method\n\n| Method                                                                          | Query Control               | Format Control | Graph Types                      | Best For                                                   |\n| ------------------------------------------------------------------------------- | --------------------------- | -------------- | -------------------------------- | ---------------------------------------------------------- |\n| [**Zep's Context Block**](#zeps-context-block)                                  | Automatic (last 2 messages) | Fixed          | User graphs only                 | Most use cases - automatic relevance with optimized format |\n| [**Custom Context Templates**](#custom-context-templates)                       | Automatic (last 2 messages) | Custom         | User graphs only                 | Consistent custom formatting across threads/users          |\n| [**Advanced Context Block Construction**](#advanced-context-block-construction) | Full control                | Full control   | User graphs or standalone graphs | Maximum flexibility - custom queries and formats           |\n\n***\n\n## Zep's Context Block\n\nZep's Context Block is an optimized, automatically assembled string that you can directly provide as context to your agent. The Context Block combines semantic search, full text search, and breadth first search to return context that is highly relevant to the user's current conversation slice, utilizing the past two messages.\n\nThe Context Block is returned by the `thread.get_user_context()` method. This method uses the latest messages of the *given thread* to search the (entire) User Graph and then returns the search results in the form of the Context Block.\n\nNote that although `thread.get_user_context()` only requires a thread ID, it is able to return memory derived from any thread of that user. The thread is just used to determine what's relevant.\n\nThe Context Block provides low latency (P95 \\< 200ms) while preserving detailed information from the user's graph.\n\n<Callout intent=\"info\">\n  **Deprecated: mode parameter and summarized context**\n\n  The `mode` parameter is no longer supported. Previously, Zep offered a \"summarized\" context mode that used an LLM to condense context into a shorter format. However, we were unable to achieve the low latency required for real-time agent interactions with this approach. The Context Block now returns a user summary and structured facts in a detailed format optimized for both performance and information preservation.\n</Callout>\n\n### Retrieving the Context Block\n\n<CodeBlocks>\n  ```python Python\n  # Get memory for the thread\n  memory = client.thread.get_user_context(thread_id=thread_id)\n\n  # Access the context block (for use in prompts)\n  context_block = memory.context\n  print(context_block)\n  ```\n\n  ```typescript TypeScript\n  // Get memory for the thread\n  const memory = await client.thread.getUserContext(threadId);\n\n  // Access the context block (for use in prompts)\n  const contextBlock = memory.context;\n  console.log(contextBlock);\n  ```\n\n  ```go Go\n  import (\n      \"context\"\n      v3 \"github.com/getzep/zep-go/v3\"\n  )\n\n  // Get memory for the thread\n  memory, err := client.Thread.GetUserContext(context.TODO(), threadId, nil)\n  if err != nil {\n      log.Fatal(\"Error getting memory:\", err)\n  }\n  // Access the context block (for use in prompts)\n  contextBlock := memory.Context\n  fmt.Println(contextBlock)\n  ```\n</CodeBlocks>\n\n### Context Block Format\n\nThe Context Block returns a user summary along with relevant facts in a structured format:\n\n```text\n### This is the user summary\n<USER_SUMMARY>\nEmily Painter is a user with account ID Emily0e62 who uses digital art tools for creative work. She maintains an active account with the service, though has recently experienced technical issues with the Magic Pen Tool. Emily values reliable payment processing and seeks prompt resolution for account-related issues. She expects clear communication and efficient support when troubleshooting technical problems.\n</USER_SUMMARY>\n\n### These are the most relevant facts and their valid date ranges\n### format: FACT (Date range: from - to)\n<FACTS>\n  - Emily is experiencing issues with logging in. (2024-11-14 02:13:19+00:00 - present)\n  - User account Emily0e62 has a suspended status due to payment failure. (2024-11-14 02:03:58+00:00 - present)\n  - user has the id of Emily0e62 (2024-11-14 02:03:54 - present)\n  - The failed transaction used a card with last four digits 1234. (2024-09-15 00:00:00+00:00 - present)\n  - The reason for the transaction failure was 'Card expired'. (2024-09-15 00:00:00+00:00 - present)\n  - user has the name of Emily Painter (2024-11-14 02:03:54 - present)\n  - Account Emily0e62 made a failed transaction of 99.99. (2024-07-30 00:00:00+00:00 - 2024-08-30 00:00:00+00:00)\n</FACTS>\n```\n\n### Getting the Context Block Sooner\n\nYou can get the Context Block sooner by passing in the `return_context=True` flag to the `thread.add_messages()` method. Read more about this in our [performance guide](/performance#get-the-context-block-sooner).\n\n## Custom Context Templates\n\nYou can customize the format of the Context Block by using [context templates](/context-templates). Templates allow you to define how memory data is structured and presented while keeping Zep's automatic relevance detection.\n\nTo use a template, pass the `template_id` parameter when retrieving context:\n\n<CodeBlocks>\n  ```python Python\n  from zep_cloud import Zep\n\n  client = Zep(api_key=\"YOUR_API_KEY\")\n\n  # Create a custom template\n  client.context.create_context_template(\n      template_id=\"customer-support\",\n      template=\"\"\"# CUSTOMER PROFILE\n  %{user_summary}\n\n  # RECENT INTERACTIONS\n  %{edges limit=10}\n\n  # KEY ENTITIES\n  %{entities limit=5}\"\"\"\n  )\n\n  # Use the template to retrieve context\n  memory = client.thread.get_user_context(\n      thread_id=\"thread_id\",\n      template_id=\"customer-support\"\n  )\n  context_block = memory.context\n  ```\n\n  ```typescript TypeScript\n  import { Zep } from \"@getzep/zep-cloud\";\n\n  const client = new Zep({ apiKey: \"YOUR_API_KEY\" });\n\n  // Create a custom template\n  await client.context.createContextTemplate({\n      templateId: \"customer-support\",\n      template: `# CUSTOMER PROFILE\n  %{user_summary}\n\n  # RECENT INTERACTIONS\n  %{edges limit=10}\n\n  # KEY ENTITIES\n  %{entities limit=5}`\n  });\n\n  // Use the template to retrieve context\n  const memory = await client.thread.getUserContext(\"thread_id\", {\n      templateId: \"customer-support\"\n  });\n  const contextBlock = memory.context;\n  ```\n\n  ```go Go\n  import (\n      \"context\"\n      zep \"github.com/getzep/zep-go/v3\"\n      zepclient \"github.com/getzep/zep-go/v3/context\"\n      threadclient \"github.com/getzep/zep-go/v3/thread/client\"\n      \"github.com/getzep/zep-go/v3/option\"\n  )\n\n  contextClient := zepclient.NewClient(\n      option.WithAPIKey(\"YOUR_API_KEY\"),\n  )\n\n  threadClient := threadclient.NewClient(\n      option.WithAPIKey(\"YOUR_API_KEY\"),\n  )\n\n  // Create a custom template\n  _, err := contextClient.CreateContextTemplate(\n      context.TODO(),\n      &zep.CreateContextTemplateRequest{\n          TemplateID: \"customer-support\",\n          Template: `# CUSTOMER PROFILE\n  %{user_summary}\n\n  # RECENT INTERACTIONS\n  %{edges limit=10}\n\n  # KEY ENTITIES\n  %{entities limit=5}`,\n      },\n  )\n\n  // Use the template to retrieve context\n  templateID := \"customer-support\"\n  memory, err := threadClient.GetUserContext(\n      context.TODO(),\n      \"thread_id\",\n      &zep.ThreadGetUserContextRequest{\n          TemplateID: &templateID,\n      },\n  )\n  contextBlock := memory.Context\n  ```\n</CodeBlocks>\n\nSee the [Context Templates](/context-templates) guide to learn how to create and manage templates.\n\n## Advanced Context Block Construction\n\nFor maximum control over memory retrieval, see our [Advanced Context Block Construction](/cookbook/advanced-context-block-construction) cookbook. This approach lets you directly [search the graph](/searching-the-graph) and assemble results with complete control over search queries, parameters, and formatting.\n\n## Using Memory\n\n### Provide the Context Block in Your System Prompt\n\nOnce you've retrieved the [Context Block](/retrieving-memory#zeps-context-block), used a [custom context template](/context-templates), or [constructed your own context block](/cookbook/advanced-context-block-construction), you can include this string in your system prompt:\n\n| MessageType | Content                                                |\n| ----------- | ------------------------------------------------------ |\n| `System`    | Your system prompt <br /> <br /> `{Zep context block}` |\n| `Assistant` | An assistant message stored in Zep                     |\n| `User`      | A user message stored in Zep                           |\n| ...         | ...                                                    |\n| `User`      | The latest user message                                |\n\n### Provide the Last 4 to 6 Messages of the Thread\n\nYou should also include the last 4 to 6 messages of the thread when calling your LLM provider. Because Zep's ingestion can take a few minutes, the context block may not include information from the last few messages; and so the context block acts as the \"long-term memory,\" and the last few messages serve as the raw, short-term memory.",
  "content_length": 9561
}