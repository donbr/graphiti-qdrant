{
  "title": "AWS Cognito OAuth ðŸ¤ FastMCP",
  "source_url": "https://gofastmcp.com/integrations/aws-cognito",
  "content": "Secure your FastMCP server with AWS Cognito user pools\n\nexport const VersionBadge = ({version}) => {\n  return <code className=\"version-badge-container\">\n            <p className=\"version-badge\">\n                <span className=\"version-badge-label\">New in version:</span>Â \n                <code className=\"version-badge-version\">{version}</code>\n            </p>\n        </code>;\n};\n\n<VersionBadge version=\"2.12.4\" />\n\nThis guide shows you how to secure your FastMCP server using **AWS Cognito user pools**. Since AWS Cognito doesn't support Dynamic Client Registration, this integration uses the [**OAuth Proxy**](/servers/auth/oauth-proxy) pattern to bridge AWS Cognito's traditional OAuth with MCP's authentication requirements. It also includes robust JWT token validation, ensuring enterprise-grade authentication.\n\n## Configuration\n\n### Prerequisites\n\nBefore you begin, you will need:\n\n1. An **[AWS Account](https://aws.amazon.com/)** with access to create AWS Cognito user pools\n2. Basic familiarity with AWS Cognito concepts (user pools, app clients)\n3. Your FastMCP server's URL (can be localhost for development, e.g., `http://localhost:8000`)\n\n### Step 1: Create an AWS Cognito User Pool and App Client\n\nSet up AWS Cognito user pool with an app client to get the credentials needed for authentication:\n\n<Steps>\n  <Step title=\"Navigate to AWS Cognito\">\n    Go to the **[AWS Cognito Console](https://console.aws.amazon.com/cognito/)** and ensure you're in your desired AWS region.\n\n    Select **\"User pools\"** from the side navigation (click on the hamburger icon at the top left in case you don't see any), and click **\"Create user pool\"** to create a new user pool.\n  </Step>\n\n  <Step title=\"Define Your Application\">\n    AWS Cognito now provides a streamlined setup experience:\n\n    1. **Application type**: Select **\"Traditional web application\"** (this is the correct choice for FastMCP server-side authentication)\n    2. **Name your application**: Enter a descriptive name (e.g., `FastMCP Server`)\n\n    The traditional web application type automatically configures:\n\n    * Server-side authentication with client secrets\n    * Authorization code grant flow\n    * Appropriate security settings for confidential clients\n\n    <Info>\n      Choose \"Traditional web application\" rather than SPA, Mobile app, or Machine-to-machine options. This ensures proper OAuth 2.0 configuration for FastMCP.\n    </Info>\n  </Step>\n\n  <Step title=\"Configure Options\">\n    AWS will guide you through configuration options:\n\n    * **Sign-in identifiers**: Choose how users will sign in (email, username, or phone)\n    * **Required attributes**: Select any additional user information you need\n    * **Return URL**: Add your callback URL (e.g., `http://localhost:8000/auth/callback` for development)\n\n    <Tip>\n      The simplified interface handles most OAuth security settings automatically based on your application type selection.\n    </Tip>\n  </Step>\n\n  <Step title=\"Review and Create\">\n    Review your configuration and click **\"Create user pool\"**.\n\n    After creation, you'll see your user pool details. Save these important values:\n\n    * **User pool ID** (format: `eu-central-1_XXXXXXXXX`)\n    * **Client ID** (found under â†’ \"Applications\" â†’ \"App clients\" in the side navigation â†’ \\<Your application name, e.g., `FastMCP Server`> â†’ \"App client information\")\n    * **Client Secret** (found under â†’ \"Applications\" â†’ \"App clients\" in the side navigation â†’ \\<Your application name, e.g., `FastMCP Server`> â†’ \"App client information\")\n\n    <Tip>\n      The user pool ID and app client credentials are all you need for FastMCP configuration.\n    </Tip>\n  </Step>\n\n  <Step title=\"Configure OAuth Settings\">\n    Under \"Login pages\" in your app client's settings, you can double check and adjust the OAuth configuration:\n\n    * **Allowed callback URLs**: Add your server URL + `/auth/callback` (e.g., `http://localhost:8000/auth/callback`)\n    * **Allowed sign-out URLs**: Optional, for logout functionality\n    * **OAuth 2.0 grant types**: Ensure \"Authorization code grant\" is selected\n    * **OpenID Connect scopes**: Select scopes your application needs (e.g., `openid`, `email`, `profile`)\n\n    <Tip>\n      For local development, you can use `http://localhost` URLs. For production, you must use HTTPS.\n    </Tip>\n  </Step>\n\n  <Step title=\"Configure Resource Server\">\n    AWS Cognito requires a resource server entry to support OAuth with protected resources. Without this, token exchange will fail with an `invalid_grant` error.\n\n    Navigate to **\"Branding\" â†’ \"Domain\"** in the side navigation, then:\n\n    1. Click **\"Create resource server\"**\n    2. **Resource server name**: Enter a descriptive name (e.g., `My MCP Server`)\n    3. **Resource server identifier**: Enter your MCP endpoint URL exactly as it will be accessed (e.g., `http://localhost:8000/mcp` for development, or `https://your-server.com/mcp` for production)\n    4. Click **\"Create resource server\"**\n\n    <Warning>\n      The resource server identifier must exactly match your `base_url + mcp_path`. For the default configuration with `base_url=\"http://localhost:8000\"` and `path=\"/mcp\"`, use `http://localhost:8000/mcp`.\n    </Warning>\n  </Step>\n\n  <Step title=\"Save Your Credentials\">\n    After setup, you'll have:\n\n    * **User Pool ID**: Format like `eu-central-1_XXXXXXXXX`\n    * **Client ID**: Your application's client identifier\n    * **Client Secret**: Generated client secret (keep secure)\n    * **AWS Region**: Where Your AWS Cognito user pool is located\n\n    <Tip>\n      Store these credentials securely. Never commit them to version control. Use environment variables or AWS Secrets Manager in production.\n    </Tip>\n  </Step>\n</Steps>\n\n### Step 2: FastMCP Configuration\n\nCreate your FastMCP server using the `AWSCognitoProvider`, which handles AWS Cognito's JWT tokens and user claims automatically:\n\n```python server.py theme={\"theme\":{\"light\":\"snazzy-light\",\"dark\":\"dark-plus\"}}\nfrom fastmcp import FastMCP\nfrom fastmcp.server.auth.providers.aws import AWSCognitoProvider\nfrom fastmcp.server.dependencies import get_access_token\n\n# The AWSCognitoProvider handles JWT validation and user claims\nauth_provider = AWSCognitoProvider(\n    user_pool_id=\"eu-central-1_XXXXXXXXX\",   # Your AWS Cognito user pool ID\n    aws_region=\"eu-central-1\",               # AWS region (defaults to eu-central-1)\n    client_id=\"your-app-client-id\",          # Your app client ID\n    client_secret=\"your-app-client-secret\",  # Your app client Secret\n    base_url=\"http://localhost:8000\",        # Must match your callback URL\n    # redirect_path=\"/auth/callback\"         # Default value, customize if needed\n)\n\nmcp = FastMCP(name=\"AWS Cognito Secured App\", auth=auth_provider)\n\n# Add a protected tool to test authentication\n@mcp.tool\nasync def get_access_token_claims() -> dict:\n    \"\"\"Get the authenticated user's access token claims.\"\"\"\n    token = get_access_token()\n    return {\n        \"sub\": token.claims.get(\"sub\"),\n        \"username\": token.claims.get(\"username\"),\n        \"cognito:groups\": token.claims.get(\"cognito:groups\", []),\n    }\n```\n\n## Testing\n\n### Running the Server\n\nStart your FastMCP server with HTTP transport to enable OAuth flows:\n\n```bash  theme={\"theme\":{\"light\":\"snazzy-light\",\"dark\":\"dark-plus\"}}\nfastmcp run server.py --transport http --port 8000\n```\n\nYour server is now running and protected by AWS Cognito OAuth authentication.\n\n### Testing with a Client\n\nCreate a test client that authenticates with Your AWS Cognito-protected server:\n\n```python test_client.py theme={\"theme\":{\"light\":\"snazzy-light\",\"dark\":\"dark-plus\"}}\nfrom fastmcp import Client\nimport asyncio\n\nasync def main():\n    # The client will automatically handle AWS Cognito OAuth\n    async with Client(\"http://localhost:8000/mcp\", auth=\"oauth\") as client:\n        # First-time connection will open AWS Cognito login in your browser\n        print(\"âœ“ Authenticated with AWS Cognito!\")\n\n        # Test the protected tool\n        print(\"Calling protected tool: get_access_token_claims\")\n        result = await client.call_tool(\"get_access_token_claims\")\n        user_data = result.data\n        print(\"Available access token claims:\")\n        print(f\"- sub: {user_data.get('sub', 'N/A')}\")\n        print(f\"- username: {user_data.get('username', 'N/A')}\")\n        print(f\"- cognito:groups: {user_data.get('cognito:groups', [])}\")\n\nif __name__ == \"__main__\":\n    asyncio.run(main())\n```\n\nWhen you run the client for the first time:\n\n1. Your browser will open to AWS Cognito's hosted UI login page\n2. After you sign in (or sign up), you'll be redirected back to your MCP server\n3. The client receives the JWT token and can make authenticated requests\n\n<Info>\n  The client caches tokens locally, so you won't need to re-authenticate for subsequent runs unless the token expires or you explicitly clear the cache.\n</Info>\n\n## Production Configuration\n\n<VersionBadge version=\"2.13.0\" />\n\nFor production deployments with persistent token management across server restarts, configure `jwt_signing_key`, and `client_storage`:\n\n```python server.py theme={\"theme\":{\"light\":\"snazzy-light\",\"dark\":\"dark-plus\"}}\nimport os\nfrom fastmcp import FastMCP\nfrom fastmcp.server.auth.providers.aws import AWSCognitoProvider\nfrom key_value.aio.stores.redis import RedisStore\nfrom key_value.aio.wrappers.encryption import FernetEncryptionWrapper\nfrom cryptography.fernet import Fernet\n\n# Production setup with encrypted persistent token storage\nauth_provider = AWSCognitoProvider(\n    user_pool_id=\"eu-central-1_XXXXXXXXX\",\n    aws_region=\"eu-central-1\",\n    client_id=\"your-app-client-id\",\n    client_secret=\"your-app-client-secret\",\n    base_url=\"https://your-production-domain.com\",\n\n    # Production token management\n    jwt_signing_key=os.environ[\"JWT_SIGNING_KEY\"],\n    client_storage=FernetEncryptionWrapper(\n        key_value=RedisStore(\n            host=os.environ[\"REDIS_HOST\"],\n            port=int(os.environ[\"REDIS_PORT\"])\n        ),\n        fernet=Fernet(os.environ[\"STORAGE_ENCRYPTION_KEY\"])\n    )\n)\n\nmcp = FastMCP(name=\"Production AWS Cognito App\", auth=auth_provider)\n```\n\n<Note>\n  Parameters (`jwt_signing_key` and `client_storage`) work together to ensure tokens and client registrations survive server restarts. **Wrap your storage in `FernetEncryptionWrapper` to encrypt sensitive OAuth tokens at rest** - without it, tokens are stored in plaintext. Store secrets in environment variables and use a persistent storage backend like Redis for distributed deployments.\n\n  For complete details on these parameters, see the [OAuth Proxy documentation](/servers/auth/oauth-proxy#configuration-parameters).\n</Note>\n\n## Environment Variables\n\nFor production deployments, use environment variables instead of hardcoding credentials.\n\n### Provider Selection\n\nSetting this environment variable allows the AWS Cognito provider to be used automatically without explicitly instantiating it in code.\n\n<Card>\n  <ParamField path=\"FASTMCP_SERVER_AUTH\" default=\"Not set\">\n    Set to `fastmcp.server.auth.providers.aws.AWSCognitoProvider` to use AWS Cognito authentication.\n  </ParamField>\n</Card>\n\n### AWS Cognito-Specific Configuration\n\nThese environment variables provide default values for the AWS Cognito provider, whether it's instantiated manually or configured via `FASTMCP_SERVER_AUTH`.\n\n<Card>\n  <ParamField path=\"FASTMCP_SERVER_AUTH_AWS_COGNITO_USER_POOL_ID\" required>\n    Your AWS Cognito user pool ID (e.g., `eu-central-1_XXXXXXXXX`)\n  </ParamField>\n\n  <ParamField path=\"FASTMCP_SERVER_AUTH_AWS_COGNITO_AWS_REGION\" default=\"eu-central-1\">\n    AWS region where your AWS Cognito user pool is located\n  </ParamField>\n\n  <ParamField path=\"FASTMCP_SERVER_AUTH_AWS_COGNITO_CLIENT_ID\" required>\n    Your AWS Cognito app client ID\n  </ParamField>\n\n  <ParamField path=\"FASTMCP_SERVER_AUTH_AWS_COGNITO_CLIENT_SECRET\" required>\n    Your AWS Cognito app client secret\n  </ParamField>\n\n  <ParamField path=\"FASTMCP_SERVER_AUTH_AWS_COGNITO_BASE_URL\" default=\"http://localhost:8000\">\n    Public URL where OAuth endpoints will be accessible (includes any mount path)\n  </ParamField>\n\n  <ParamField path=\"FASTMCP_SERVER_AUTH_AWS_COGNITO_ISSUER_URL\" default=\"Uses BASE_URL\">\n    Issuer URL for OAuth metadata (defaults to `BASE_URL`). Set to root-level URL when mounting under a path prefix to avoid 404 logs. See [HTTP Deployment guide](/deployment/http#mounting-authenticated-servers) for details.\n  </ParamField>\n\n  <ParamField path=\"FASTMCP_SERVER_AUTH_AWS_COGNITO_REDIRECT_PATH\" default=\"/auth/callback\">\n    One of the redirect paths configured in your AWS Cognito app client\n  </ParamField>\n\n  <ParamField path=\"FASTMCP_SERVER_AUTH_AWS_COGNITO_REQUIRED_SCOPES\" default=\"[&#x22;openid&#x22;]\">\n    Comma-, space-, or JSON-separated list of required OAuth scopes (e.g., `openid email` or `[\"openid\",\"email\",\"profile\"]`)\n  </ParamField>\n</Card>\n\nExample `.env` file:\n\n```bash  theme={\"theme\":{\"light\":\"snazzy-light\",\"dark\":\"dark-plus\"}}\n# Use the AWS Cognito provider\nFASTMCP_SERVER_AUTH=fastmcp.server.auth.providers.aws.AWSCognitoProvider\n\n# AWS Cognito credentials\nFASTMCP_SERVER_AUTH_AWS_COGNITO_USER_POOL_ID=eu-central-1_XXXXXXXXX\nFASTMCP_SERVER_AUTH_AWS_COGNITO_AWS_REGION=eu-central-1\nFASTMCP_SERVER_AUTH_AWS_COGNITO_CLIENT_ID=your-app-client-id\nFASTMCP_SERVER_AUTH_AWS_COGNITO_CLIENT_SECRET=your-app-client-secret\nFASTMCP_SERVER_AUTH_AWS_COGNITO_BASE_URL=https://your-server.com\nFASTMCP_SERVER_AUTH_AWS_COGNITO_REQUIRED_SCOPES=openid,email,profile\n```\n\nWith environment variables set, your server code simplifies to:\n\n```python server.py theme={\"theme\":{\"light\":\"snazzy-light\",\"dark\":\"dark-plus\"}}\nfrom fastmcp import FastMCP\nfrom fastmcp.server.dependencies import get_access_token\n\n# Authentication is automatically configured from environment\nmcp = FastMCP(name=\"AWS Cognito Secured App\")\n\n@mcp.tool\nasync def get_access_token_claims() -> dict:\n    \"\"\"Get the authenticated user's access token claims.\"\"\"\n    token = get_access_token()\n    return {\n        \"sub\": token.claims.get(\"sub\"),\n        \"username\": token.claims.get(\"username\"),\n        \"cognito:groups\": token.claims.get(\"cognito:groups\", []),\n    }\n```\n\n## Features\n\n### JWT Token Validation\n\nThe AWS Cognito provider includes robust JWT token validation:\n\n* **Signature Verification**: Validates tokens against AWS Cognito's public keys (JWKS)\n* **Expiration Checking**: Automatically rejects expired tokens\n* **Issuer Validation**: Ensures tokens come from your specific AWS Cognito user pool\n* **Scope Enforcement**: Verifies required OAuth scopes are present\n\n### User Claims and Groups\n\nAccess rich user information from AWS Cognito JWT tokens:\n\n```python  theme={\"theme\":{\"light\":\"snazzy-light\",\"dark\":\"dark-plus\"}}\nfrom fastmcp.server.dependencies import get_access_token\n\n@mcp.tool\nasync def admin_only_tool() -> str:\n    \"\"\"A tool only available to admin users.\"\"\"\n    token = get_access_token()\n    user_groups = token.claims.get(\"cognito:groups\", [])\n\n    if \"admin\" not in user_groups:\n        raise ValueError(\"This tool requires admin access\")\n\n    return \"Admin access granted!\"\n```\n\n### Enterprise Integration\n\nPerfect for enterprise environments with:\n\n* **Single Sign-On (SSO)**: Integrate with corporate identity providers\n* **Multi-Factor Authentication (MFA)**: Leverage AWS Cognito's built-in MFA\n* **User Groups**: Role-based access control through AWS Cognito groups\n* **Custom Attributes**: Access custom user attributes defined in your AWS Cognito user pool\n* **Compliance**: Meet enterprise security and compliance requirements",
  "content_length": 15548
}