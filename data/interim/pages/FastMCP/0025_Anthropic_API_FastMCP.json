{
  "title": "Anthropic API ðŸ¤ FastMCP",
  "source_url": "https://gofastmcp.com/integrations/anthropic",
  "content": "Connect FastMCP servers to the Anthropic API\n\nexport const VersionBadge = ({version}) => {\n  return <code className=\"version-badge-container\">\n            <p className=\"version-badge\">\n                <span className=\"version-badge-label\">New in version:</span>Â \n                <code className=\"version-badge-version\">{version}</code>\n            </p>\n        </code>;\n};\n\nAnthropic's [Messages API](https://docs.anthropic.com/en/api/messages) supports MCP servers as remote tool sources. This tutorial will show you how to create a FastMCP server and deploy it to a public URL, then how to call it from the Messages API.\n\n<Tip>\n  Currently, the MCP connector only accesses **tools** from MCP serversâ€”it queries the `list_tools` endpoint and exposes those functions to Claude. Other MCP features like resources and prompts are not currently supported. You can read more about the MCP connector in the [Anthropic documentation](https://docs.anthropic.com/en/docs/agents-and-tools/mcp-connector).\n</Tip>\n\n## Create a Server\n\nFirst, create a FastMCP server with the tools you want to expose. For this example, we'll create a server with a single tool that rolls dice.\n\n```python server.py theme={\"theme\":{\"light\":\"snazzy-light\",\"dark\":\"dark-plus\"}}\nimport random\nfrom fastmcp import FastMCP\n\nmcp = FastMCP(name=\"Dice Roller\")\n\n@mcp.tool\ndef roll_dice(n_dice: int) -> list[int]:\n    \"\"\"Roll `n_dice` 6-sided dice and return the results.\"\"\"\n    return [random.randint(1, 6) for _ in range(n_dice)]\n\nif __name__ == \"__main__\":\n    mcp.run(transport=\"http\", port=8000)\n```\n\n## Deploy the Server\n\nYour server must be deployed to a public URL in order for Anthropic to access it. The MCP connector supports both SSE and Streamable HTTP transports.\n\nFor development, you can use tools like `ngrok` to temporarily expose a locally-running server to the internet. We'll do that for this example (you may need to install `ngrok` and create a free account), but you can use any other method to deploy your server.\n\nAssuming you saved the above code as `server.py`, you can run the following two commands in two separate terminals to deploy your server and expose it to the internet:\n\n<CodeGroup>\n  ```bash FastMCP server theme={\"theme\":{\"light\":\"snazzy-light\",\"dark\":\"dark-plus\"}}\n  python server.py\n  ```\n\n  ```bash ngrok theme={\"theme\":{\"light\":\"snazzy-light\",\"dark\":\"dark-plus\"}}\n  ngrok http 8000\n  ```\n</CodeGroup>\n\n<Warning>\n  This exposes your unauthenticated server to the internet. Only run this command in a safe environment if you understand the risks.\n</Warning>\n\n## Call the Server\n\nTo use the Messages API with MCP servers, you'll need to install the Anthropic Python SDK (not included with FastMCP):\n\n```bash  theme={\"theme\":{\"light\":\"snazzy-light\",\"dark\":\"dark-plus\"}}\npip install anthropic\n```\n\nYou'll also need to authenticate with Anthropic. You can do this by setting the `ANTHROPIC_API_KEY` environment variable. Consult the Anthropic SDK documentation for more information.\n\n```bash  theme={\"theme\":{\"light\":\"snazzy-light\",\"dark\":\"dark-plus\"}}\nexport ANTHROPIC_API_KEY=\"your-api-key\"\n```\n\nHere is an example of how to call your server from Python. Note that you'll need to replace `https://your-server-url.com` with the actual URL of your server. In addition, we use `/mcp/` as the endpoint because we deployed a streamable-HTTP server with the default path; you may need to use a different endpoint if you customized your server's deployment. **At this time you must also include the `extra_headers` parameter with the `anthropic-beta` header.**\n\n```python {5, 13-22} theme={\"theme\":{\"light\":\"snazzy-light\",\"dark\":\"dark-plus\"}}\nimport anthropic\nfrom rich import print\n\n# Your server URL (replace with your actual URL)\nurl = 'https://your-server-url.com'\n\nclient = anthropic.Anthropic()\n\nresponse = client.beta.messages.create(\n    model=\"claude-sonnet-4-20250514\",\n    max_tokens=1000,\n    messages=[{\"role\": \"user\", \"content\": \"Roll a few dice!\"}],\n    mcp_servers=[\n        {\n            \"type\": \"url\",\n            \"url\": f\"{url}/mcp/\",\n            \"name\": \"dice-server\",\n        }\n    ],\n    extra_headers={\n        \"anthropic-beta\": \"mcp-client-2025-04-04\"\n    }\n)\n\nprint(response.content)\n```\n\nIf you run this code, you'll see something like the following output:\n\n```text  theme={\"theme\":{\"light\":\"snazzy-light\",\"dark\":\"dark-plus\"}}\nI'll roll some dice for you! Let me use the dice rolling tool.\n\nI rolled 3 dice and got: 4, 2, 6\n\nThe results were 4, 2, and 6. Would you like me to roll again or roll a different number of dice?\n```\n\n## Authentication\n\n<VersionBadge version=\"2.6.0\" />\n\nThe MCP connector supports OAuth authentication through authorization tokens, which means you can secure your server while still allowing Anthropic to access it.\n\n### Server Authentication\n\nThe simplest way to add authentication to the server is to use a bearer token scheme.\n\nFor this example, we'll quickly generate our own tokens with FastMCP's `RSAKeyPair` utility, but this may not be appropriate for production use. For more details, see the complete server-side [Token Verification](/servers/auth/token-verification) documentation.\n\nWe'll start by creating an RSA key pair to sign and verify tokens.\n\n```python  theme={\"theme\":{\"light\":\"snazzy-light\",\"dark\":\"dark-plus\"}}\nfrom fastmcp.server.auth.providers.jwt import RSAKeyPair\n\nkey_pair = RSAKeyPair.generate()\naccess_token = key_pair.create_token(audience=\"dice-server\")\n```\n\n<Warning>\n  FastMCP's `RSAKeyPair` utility is for development and testing only.\n</Warning>\n\nNext, we'll create a `JWTVerifier` to authenticate the server.\n\n```python  theme={\"theme\":{\"light\":\"snazzy-light\",\"dark\":\"dark-plus\"}}\nfrom fastmcp import FastMCP\nfrom fastmcp.server.auth import JWTVerifier\n\nauth = JWTVerifier(\n    public_key=key_pair.public_key,\n    audience=\"dice-server\",\n)\n\nmcp = FastMCP(name=\"Dice Roller\", auth=auth)\n```\n\nHere is a complete example that you can copy/paste. For simplicity and the purposes of this example only, it will print the token to the console. **Do NOT do this in production!**\n\n```python server.py [expandable] theme={\"theme\":{\"light\":\"snazzy-light\",\"dark\":\"dark-plus\"}}\nfrom fastmcp import FastMCP\nfrom fastmcp.server.auth import JWTVerifier\nfrom fastmcp.server.auth.providers.jwt import RSAKeyPair\nimport random\n\nkey_pair = RSAKeyPair.generate()\naccess_token = key_pair.create_token(audience=\"dice-server\")\n\nauth = JWTVerifier(\n    public_key=key_pair.public_key,\n    audience=\"dice-server\",\n)\n\nmcp = FastMCP(name=\"Dice Roller\", auth=auth)\n\n@mcp.tool\ndef roll_dice(n_dice: int) -> list[int]:\n    \"\"\"Roll `n_dice` 6-sided dice and return the results.\"\"\"\n    return [random.randint(1, 6) for _ in range(n_dice)]\n\nif __name__ == \"__main__\":\n    print(f\"\\n---\\n\\nðŸ”‘ Dice Roller access token:\\n\\n{access_token}\\n\\n---\\n\")\n    mcp.run(transport=\"http\", port=8000)\n```\n\n### Client Authentication\n\nIf you try to call the authenticated server with the same Anthropic code we wrote earlier, you'll get an error indicating that the server rejected the request because it's not authenticated.\n\n```python  theme={\"theme\":{\"light\":\"snazzy-light\",\"dark\":\"dark-plus\"}}\nError code: 400 - {\n    \"type\": \"error\", \n    \"error\": {\n        \"type\": \"invalid_request_error\", \n        \"message\": \"MCP server 'dice-server' requires authentication. Please provide an authorization_token.\",\n    },\n}\n```\n\nTo authenticate the client, you can pass the token using the `authorization_token` parameter in your MCP server configuration:\n\n```python {8, 21} theme={\"theme\":{\"light\":\"snazzy-light\",\"dark\":\"dark-plus\"}}\nimport anthropic\nfrom rich import print\n\n# Your server URL (replace with your actual URL)\nurl = 'https://your-server-url.com'\n\n# Your access token (replace with your actual token)\naccess_token = 'your-access-token'\n\nclient = anthropic.Anthropic()\n\nresponse = client.beta.messages.create(\n    model=\"claude-sonnet-4-20250514\",\n    max_tokens=1000,\n    messages=[{\"role\": \"user\", \"content\": \"Roll a few dice!\"}],\n    mcp_servers=[\n        {\n            \"type\": \"url\",\n            \"url\": f\"{url}/mcp/\",\n            \"name\": \"dice-server\",\n            \"authorization_token\": access_token\n        }\n    ],\n    extra_headers={\n        \"anthropic-beta\": \"mcp-client-2025-04-04\"\n    }\n)\n\nprint(response.content)\n```\n\nYou should now see the dice roll results in the output.",
  "content_length": 8326
}