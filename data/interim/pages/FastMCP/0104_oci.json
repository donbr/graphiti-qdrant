{
  "title": "oci",
  "source_url": "https://gofastmcp.com/python-sdk/fastmcp-server-auth-providers-oci",
  "content": "# `fastmcp.server.auth.providers.oci`\n\nOCI OIDC provider for FastMCP.\n\nThe pull request for the provider is submitted to fastmcp.\n\nThis module provides OIDC Implementation to integrate MCP servers with OCI.\nYou only need OCI Identity Domain's discovery URL, client ID, client secret, and base URL.\n\nPost Authentication, you get OCI IAM domain access token. That is not authorized to invoke OCI control plane.\nYou need to exchange the IAM domain access token for OCI UPST token to invoke OCI control plane APIs.\nThe sample code below has get\\_oci\\_signer function that returns OCI TokenExchangeSigner object.\nYou can use the signer object to create OCI service object.\n\nExample:\n\n```python  theme={\"theme\":{\"light\":\"snazzy-light\",\"dark\":\"dark-plus\"}}\nfrom fastmcp import FastMCP\nfrom fastmcp.server.auth.providers.oci import OCIProvider\nfrom fastmcp.server.dependencies import get_access_token\nfrom fastmcp.utilities.logging import get_logger\n\nimport os\n\n# Load configuration from environment\nFASTMCP_SERVER_AUTH_OCI_CONFIG_URL = os.environ[\"FASTMCP_SERVER_AUTH_OCI_CONFIG_URL\"]\nFASTMCP_SERVER_AUTH_OCI_CLIENT_ID = os.environ[\"FASTMCP_SERVER_AUTH_OCI_CLIENT_ID\"]\nFASTMCP_SERVER_AUTH_OCI_CLIENT_SECRET = os.environ[\"FASTMCP_SERVER_AUTH_OCI_CLIENT_SECRET\"]\nFASTMCP_SERVER_AUTH_OCI_IAM_GUID = os.environ[\"FASTMCP_SERVER_AUTH_OCI_IAM_GUID\"]\n\nimport oci\nfrom oci.auth.signers import TokenExchangeSigner\n\nlogger = get_logger(__name__)\n\n# Simple OCI OIDC protection\nauth = OCIProvider(\n    config_url=FASTMCP_SERVER_AUTH_OCI_CONFIG_URL, #config URL is the OCI IAM Domain OIDC discovery URL.\n    client_id=FASTMCP_SERVER_AUTH_OCI_CLIENT_ID, #This is same as the client ID configured for the OCI IAM Domain Integrated Application\n    client_secret=FASTMCP_SERVER_AUTH_OCI_CLIENT_SECRET, #This is same as the client secret configured for the OCI IAM Domain Integrated Application\n    required_scopes=[\"openid\", \"profile\", \"email\"],\n    redirect_path=\"/auth/callback\",\n    base_url=\"http://localhost:8000\",\n)\n\n# NOTE: For production use, replace this with a thread-safe cache implementation\n# such as threading.Lock-protected dict or a proper caching library\n_global_token_cache = {} #In memory cache for OCI session token signer\n\ndef get_oci_signer() -> TokenExchangeSigner:\n\n    authntoken = get_access_token()\n    tokenID = authntoken.claims.get(\"jti\")\n    token = authntoken.token\n\n    #Check if the signer exists for the token ID in memory cache\n    cached_signer = _global_token_cache.get(tokenID)\n    logger.debug(f\"Global cached signer: {cached_signer}\")\n    if cached_signer:\n        logger.debug(f\"Using globally cached signer for token ID: {tokenID}\")\n        return cached_signer\n\n    #If the signer is not yet created for the token then create new OCI signer object\n    logger.debug(f\"Creating new signer for token ID: {tokenID}\")\n    signer = TokenExchangeSigner(\n        jwt_or_func=token,\n        oci_domain_id=FASTMCP_SERVER_AUTH_OCI_IAM_GUID.split(\".\")[0],   #This is same as IAM GUID configured for the OCI IAM Domain\n        client_id=FASTMCP_SERVER_AUTH_OCI_CLIENT_ID, #This is same as the client ID configured for the OCI IAM Domain Integrated Application\n        client_secret=FASTMCP_SERVER_AUTH_OCI_CLIENT_SECRET #This is same as the client secret configured for the OCI IAM Domain Integrated Application\n    )\n    logger.debug(f\"Signer {signer} created for token ID: {tokenID}\")\n\n    #Cache the signer object in memory cache\n    _global_token_cache[tokenID] = signer\n    logger.debug(f\"Signer cached for token ID: {tokenID}\")\n\n    return signer\n\nmcp = FastMCP(\"My Protected Server\", auth=auth)\n```\n\n## Classes\n\n### `OCIProviderSettings` <sup><a href=\"https://github.com/jlowin/fastmcp/blob/main/src/fastmcp/server/auth/providers/oci.py#L93\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\nSettings for OCI IAM domain OIDC provider.\n\n### `OCIProvider` <sup><a href=\"https://github.com/jlowin/fastmcp/blob/main/src/fastmcp/server/auth/providers/oci.py#L119\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\nAn OCI IAM Domain provider implementation for FastMCP.\n\nThis provider is a complete OCI integration that's ready to use with\njust the configuration URL, client ID, client secret, and base URL.",
  "content_length": 4284
}