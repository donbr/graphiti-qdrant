{
  "title": "Storage Backends",
  "source_url": "https://gofastmcp.com/servers/storage-backends",
  "content": "Configure persistent and distributed storage for caching and OAuth state management\n\nexport const VersionBadge = ({version}) => {\n  return <code className=\"version-badge-container\">\n            <p className=\"version-badge\">\n                <span className=\"version-badge-label\">New in version:</span> \n                <code className=\"version-badge-version\">{version}</code>\n            </p>\n        </code>;\n};\n\n<VersionBadge version=\"2.13.0\" />\n\nFastMCP uses pluggable storage backends for caching responses and managing OAuth state. By default, all storage is in-memory, which is perfect for development but doesn't persist across restarts. FastMCP includes support for multiple storage backends, and you can easily extend it with custom implementations.\n\n<Tip>\n  The storage layer is powered by **[py-key-value-aio](https://github.com/strawgate/py-key-value)**, an async key-value library maintained by a core FastMCP maintainer. This library provides a unified interface for multiple backends, making it easy to swap implementations based on your deployment needs.\n</Tip>\n\n## Available Backends\n\n### In-Memory Storage\n\n**Best for:** Development, testing, single-process deployments\n\nIn-memory storage is the default for all FastMCP storage needs. It's fast, requires no setup, and is perfect for getting started.\n\n```python  theme={\"theme\":{\"light\":\"snazzy-light\",\"dark\":\"dark-plus\"}}\nfrom key_value.aio.stores.memory import MemoryStore\n\n# Used by default - no configuration needed\n# But you can also be explicit:\ncache_store = MemoryStore()\n```\n\n**Characteristics:**\n\n* ✅ No setup required\n* ✅ Very fast\n* ❌ Data lost on restart\n* ❌ Not suitable for multi-process deployments\n\n### Disk Storage\n\n**Best for:** Single-server production deployments, persistent caching\n\nDisk storage persists data to the filesystem, allowing it to survive server restarts.\n\n```python  theme={\"theme\":{\"light\":\"snazzy-light\",\"dark\":\"dark-plus\"}}\nfrom key_value.aio.stores.disk import DiskStore\nfrom fastmcp.server.middleware.caching import ResponseCachingMiddleware\n\n# Persistent response cache\nmiddleware = ResponseCachingMiddleware(\n    cache_storage=DiskStore(directory=\"/var/cache/fastmcp\")\n)\n```\n\nOr with OAuth token storage:\n\n```python  theme={\"theme\":{\"light\":\"snazzy-light\",\"dark\":\"dark-plus\"}}\nfrom fastmcp.server.auth.providers.github import GitHubProvider\nfrom key_value.aio.stores.disk import DiskStore\n\nauth = GitHubProvider(\n    client_id=\"your-id\",\n    client_secret=\"your-secret\",\n    base_url=\"https://your-server.com\",\n    client_storage=DiskStore(directory=\"/var/lib/fastmcp/oauth\")\n)\n```\n\n**Characteristics:**\n\n* ✅ Data persists across restarts\n* ✅ Good performance for moderate load\n* ❌ Not suitable for distributed deployments\n* ❌ Filesystem access required\n\n### Redis\n\n**Best for:** Distributed production deployments, shared caching across multiple servers\n\n<Note>\n  Redis support requires an optional dependency: `pip install 'py-key-value-aio[redis]'`\n</Note>\n\nRedis provides distributed caching and state management, ideal for production deployments with multiple server instances.\n\n```python  theme={\"theme\":{\"light\":\"snazzy-light\",\"dark\":\"dark-plus\"}}\nfrom key_value.aio.stores.redis import RedisStore\nfrom fastmcp.server.middleware.caching import ResponseCachingMiddleware\n\n# Distributed response cache\nmiddleware = ResponseCachingMiddleware(\n    cache_storage=RedisStore(host=\"redis.example.com\", port=6379)\n)\n```\n\nWith authentication:\n\n```python  theme={\"theme\":{\"light\":\"snazzy-light\",\"dark\":\"dark-plus\"}}\nfrom key_value.aio.stores.redis import RedisStore\n\ncache_store = RedisStore(\n    host=\"redis.example.com\",\n    port=6379,\n    password=\"your-redis-password\"\n)\n```\n\nFor OAuth token storage:\n\n```python  theme={\"theme\":{\"light\":\"snazzy-light\",\"dark\":\"dark-plus\"}}\nimport os\nfrom fastmcp.server.auth.providers.github import GitHubProvider\nfrom key_value.aio.stores.redis import RedisStore\n\nauth = GitHubProvider(\n    client_id=os.environ[\"GITHUB_CLIENT_ID\"],\n    client_secret=os.environ[\"GITHUB_CLIENT_SECRET\"],\n    base_url=\"https://your-server.com\",\n    jwt_signing_key=os.environ[\"JWT_SIGNING_KEY\"],\n    client_storage=RedisStore(host=\"redis.example.com\", port=6379)\n)\n```\n\n**Characteristics:**\n\n* ✅ Distributed and highly available\n* ✅ Fast in-memory performance\n* ✅ Works across multiple server instances\n* ✅ Built-in TTL support\n* ❌ Requires Redis infrastructure\n* ❌ Network latency vs local storage\n\n### Other Backends from py-key-value-aio\n\nThe py-key-value-aio library includes additional implementations for various storage systems:\n\n* **DynamoDB** - AWS distributed database\n* **MongoDB** - NoSQL document store\n* **Elasticsearch** - Distributed search and analytics\n* **Memcached** - Distributed memory caching\n* **RocksDB** - Embedded high-performance key-value store\n* **Valkey** - Redis-compatible server\n\nFor configuration details on these backends, consult the [py-key-value-aio documentation](https://github.com/strawgate/py-key-value).\n\n<Warning>\n  Before using these backends in production, review the [py-key-value documentation](https://github.com/strawgate/py-key-value) to understand the maturity level and limitations of your chosen backend. Some backends may be in preview or have specific constraints that make them unsuitable for production use.\n</Warning>\n\n## Use Cases in FastMCP\n\n### Server-Side OAuth Token Storage\n\nThe [OAuth Proxy](/servers/auth/oauth-proxy) and OAuth auth providers use storage for persisting OAuth client registrations and upstream tokens. **By default, storage is automatically encrypted using `FernetEncryptionWrapper`.** When providing custom storage, wrap it in `FernetEncryptionWrapper` to encrypt sensitive OAuth tokens at rest.\n\n**Development (default behavior):**\n\nBy default, FastMCP automatically manages keys and storage based on your platform:\n\n* **Mac/Windows**: Keys are auto-managed via system keyring, storage defaults to disk. Suitable **only** for development and local testing.\n* **Linux**: Keys are ephemeral, storage defaults to memory.\n\nNo configuration needed:\n\n```python  theme={\"theme\":{\"light\":\"snazzy-light\",\"dark\":\"dark-plus\"}}\nfrom fastmcp.server.auth.providers.github import GitHubProvider\n\nauth = GitHubProvider(\n    client_id=\"your-id\",\n    client_secret=\"your-secret\",\n    base_url=\"https://your-server.com\"\n)\n```\n\n**Production:**\n\nFor production deployments, configure explicit keys and persistent network-accessible storage with encryption:\n\n```python  theme={\"theme\":{\"light\":\"snazzy-light\",\"dark\":\"dark-plus\"}}\nimport os\nfrom fastmcp.server.auth.providers.github import GitHubProvider\nfrom key_value.aio.stores.redis import RedisStore\nfrom key_value.aio.wrappers.encryption import FernetEncryptionWrapper\nfrom cryptography.fernet import Fernet\n\nauth = GitHubProvider(\n    client_id=os.environ[\"GITHUB_CLIENT_ID\"],\n    client_secret=os.environ[\"GITHUB_CLIENT_SECRET\"],\n    base_url=\"https://your-server.com\",\n    # Explicit JWT signing key (required for production)\n    jwt_signing_key=os.environ[\"JWT_SIGNING_KEY\"],\n    # Encrypted persistent storage (required for production)\n    client_storage=FernetEncryptionWrapper(\n        key_value=RedisStore(host=\"redis.example.com\", port=6379),\n        fernet=Fernet(os.environ[\"STORAGE_ENCRYPTION_KEY\"])\n    )\n)\n```\n\nBoth parameters are required for production. **Wrap your storage in `FernetEncryptionWrapper` to encrypt sensitive OAuth tokens at rest** - without it, tokens are stored in plaintext. See [OAuth Token Security](/deployment/http#oauth-token-security) and [Key and Storage Management](/servers/auth/oauth-proxy#key-and-storage-management) for complete setup details.\n\n### Response Caching Middleware\n\nThe [Response Caching Middleware](/servers/middleware#caching-middleware) caches tool calls, resource reads, and prompt requests. Storage configuration is passed via the `cache_storage` parameter:\n\n```python  theme={\"theme\":{\"light\":\"snazzy-light\",\"dark\":\"dark-plus\"}}\nfrom fastmcp import FastMCP\nfrom fastmcp.server.middleware.caching import ResponseCachingMiddleware\nfrom key_value.aio.stores.disk import DiskStore\n\nmcp = FastMCP(\"My Server\")\n\n# Cache to disk instead of memory\nmcp.add_middleware(ResponseCachingMiddleware(\n    cache_storage=DiskStore(directory=\"cache\")\n))\n```\n\nFor multi-server deployments sharing a Redis instance:\n\n```python  theme={\"theme\":{\"light\":\"snazzy-light\",\"dark\":\"dark-plus\"}}\nfrom fastmcp.server.middleware.caching import ResponseCachingMiddleware\nfrom key_value.aio.stores.redis import RedisStore\nfrom key_value.aio.wrappers.prefix_collections import PrefixCollectionsWrapper\n\nbase_store = RedisStore(host=\"redis.example.com\")\nnamespaced_store = PrefixCollectionsWrapper(\n    key_value=base_store,\n    prefix=\"my-server\"\n)\n\nmiddleware = ResponseCachingMiddleware(cache_storage=namespaced_store)\n```\n\n### Client-Side OAuth Token Storage\n\nThe [FastMCP Client](/clients/client) uses storage for persisting OAuth tokens locally. By default, tokens are stored in memory:\n\n```python  theme={\"theme\":{\"light\":\"snazzy-light\",\"dark\":\"dark-plus\"}}\nfrom fastmcp.client.auth import OAuthClientProvider\nfrom key_value.aio.stores.disk import DiskStore\n\n# Store tokens on disk for persistence across restarts\ntoken_storage = DiskStore(directory=\"~/.local/share/fastmcp/tokens\")\n\noauth_provider = OAuthClientProvider(\n    mcp_url=\"https://your-mcp-server.com/mcp/sse\",\n    token_storage=token_storage\n)\n```\n\nThis allows clients to reconnect without re-authenticating after restarts.\n\n## Choosing a Backend\n\n| Backend  | Development | Single Server | Multi-Server | Cloud Native |\n| -------- | ----------- | ------------- | ------------ | ------------ |\n| Memory   | ✅ Best      | ⚠️ Limited    | ❌            | ❌            |\n| Disk     | ✅ Good      | ✅ Recommended | ❌            | ⚠️           |\n| Redis    | ⚠️ Overkill | ✅ Good        | ✅ Best       | ✅ Best       |\n| DynamoDB | ❌           | ⚠️            | ✅            | ✅ Best (AWS) |\n| MongoDB  | ❌           | ⚠️            | ✅            | ✅ Good       |\n\n**Decision tree:**\n\n1. **Just starting?** Use **Memory** (default) - no configuration needed\n2. **Single server, needs persistence?** Use **Disk**\n3. **Multiple servers or cloud deployment?** Use **Redis** or **DynamoDB**\n4. **Existing infrastructure?** Look for a matching py-key-value-aio backend\n\n## More Resources\n\n* [py-key-value-aio GitHub](https://github.com/strawgate/py-key-value) - Full library documentation\n* [Response Caching Middleware](/servers/middleware#caching-middleware) - Using storage for caching\n* [OAuth Token Security](/deployment/http#oauth-token-security) - Production OAuth configuration\n* [HTTP Deployment](/deployment/http) - Complete deployment guide",
  "content_length": 10688
}