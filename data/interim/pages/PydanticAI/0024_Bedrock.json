{
  "title": "Bedrock",
  "source_url": null,
  "content": "## Install\n\nTo use `BedrockConverseModel`, you need to either install `pydantic-ai`, or install `pydantic-ai-slim` with the `bedrock` optional group:\n\n```bash\npip install \"pydantic-ai-slim[bedrock]\"\n\n```\n\n```bash\nuv add \"pydantic-ai-slim[bedrock]\"\n\n```\n\n## Configuration\n\nTo use [AWS Bedrock](https://aws.amazon.com/bedrock/), you'll need an AWS account with Bedrock enabled and appropriate credentials. You can use either AWS credentials directly or a pre-configured boto3 client.\n\n`BedrockModelName` contains a list of available Bedrock models, including models from Anthropic, Amazon, Cohere, Meta, and Mistral.\n\n## Environment variables\n\nYou can set your AWS credentials as environment variables ([among other options](https://boto3.amazonaws.com/v1/documentation/api/latest/guide/configuration.html#using-environment-variables)):\n\n```bash\nexport AWS_BEARER_TOKEN_BEDROCK='your-api-key'\n### or:\nexport AWS_ACCESS_KEY_ID='your-access-key'\nexport AWS_SECRET_ACCESS_KEY='your-secret-key'\nexport AWS_DEFAULT_REGION='us-east-1'  # or your preferred region\n\n```\n\nYou can then use `BedrockConverseModel` by name:\n\n[Learn about Gateway](../../gateway)\n\n```python\nfrom pydantic_ai import Agent\n\nagent = Agent('gateway/bedrock:anthropic.claude-3-sonnet-20240229-v1:0')\n...\n\n```\n\n```python\nfrom pydantic_ai import Agent\n\nagent = Agent('bedrock:anthropic.claude-3-sonnet-20240229-v1:0')\n...\n\n```\n\nOr initialize the model directly with just the model name:\n\n```python\nfrom pydantic_ai import Agent\nfrom pydantic_ai.models.bedrock import BedrockConverseModel\n\nmodel = BedrockConverseModel('anthropic.claude-3-sonnet-20240229-v1:0')\nagent = Agent(model)\n...\n\n```\n\n## Customizing Bedrock Runtime API\n\nYou can customize the Bedrock Runtime API calls by adding additional parameters, such as [guardrail configurations](https://docs.aws.amazon.com/bedrock/latest/userguide/guardrails.html) and [performance settings](https://docs.aws.amazon.com/bedrock/latest/userguide/latency-optimized-inference.html). For a complete list of configurable parameters, refer to the documentation for BedrockModelSettings.\n\ncustomize_bedrock_model_settings.py\n\n```python\nfrom pydantic_ai import Agent\nfrom pydantic_ai.models.bedrock import BedrockConverseModel, BedrockModelSettings\n\n### Define Bedrock model settings with guardrail and performance configurations\nbedrock_model_settings = BedrockModelSettings(\n    bedrock_guardrail_config={\n        'guardrailIdentifier': 'v1',\n        'guardrailVersion': 'v1',\n        'trace': 'enabled'\n    },\n    bedrock_performance_configuration={\n        'latency': 'optimized'\n    }\n)\n\n\nmodel = BedrockConverseModel(model_name='us.amazon.nova-pro-v1:0')\n\nagent = Agent(model=model, model_settings=bedrock_model_settings)\n\n```\n\n## `provider` argument\n\nYou can provide a custom `BedrockProvider` via the `provider` argument. This is useful when you want to specify credentials directly or use a custom boto3 client:\n\n```python\nfrom pydantic_ai import Agent\nfrom pydantic_ai.models.bedrock import BedrockConverseModel\nfrom pydantic_ai.providers.bedrock import BedrockProvider\n\n### Using AWS credentials directly\nmodel = BedrockConverseModel(\n    'anthropic.claude-3-sonnet-20240229-v1:0',\n    provider=BedrockProvider(\n        region_name='us-east-1',\n        aws_access_key_id='your-access-key',\n        aws_secret_access_key='your-secret-key',\n    ),\n)\nagent = Agent(model)\n...\n\n```\n\nYou can also pass a pre-configured boto3 client:\n\n```python\nimport boto3\n\nfrom pydantic_ai import Agent\nfrom pydantic_ai.models.bedrock import BedrockConverseModel\nfrom pydantic_ai.providers.bedrock import BedrockProvider\n\n### Using a pre-configured boto3 client\nbedrock_client = boto3.client('bedrock-runtime', region_name='us-east-1')\nmodel = BedrockConverseModel(\n    'anthropic.claude-3-sonnet-20240229-v1:0',\n    provider=BedrockProvider(bedrock_client=bedrock_client),\n)\nagent = Agent(model)\n...\n\n```\n\n## Configuring Retries\n\nBedrock uses boto3's built-in retry mechanisms. You can configure retry behavior by passing a custom boto3 client with retry settings:\n\n```python\nimport boto3\nfrom botocore.config import Config\n\nfrom pydantic_ai import Agent\nfrom pydantic_ai.models.bedrock import BedrockConverseModel\nfrom pydantic_ai.providers.bedrock import BedrockProvider\n\n### Configure retry settings\nconfig = Config(\n    retries={\n        'max_attempts': 5,\n        'mode': 'adaptive'  # Recommended for rate limiting\n    }\n)\n\nbedrock_client = boto3.client(\n    'bedrock-runtime',\n    region_name='us-east-1',\n    config=config\n)\n\nmodel = BedrockConverseModel(\n    'us.amazon.nova-micro-v1:0',\n    provider=BedrockProvider(bedrock_client=bedrock_client),\n)\nagent = Agent(model)\n\n```\n\n### Retry Modes\n\n- `'legacy'` (default): 5 attempts, basic retry behavior\n- `'standard'`: 3 attempts, more comprehensive error coverage\n- `'adaptive'`: 3 attempts with client-side rate limiting (recommended for handling `ThrottlingException`)\n\nFor more details on boto3 retry configuration, see the [AWS boto3 documentation](https://boto3.amazonaws.com/v1/documentation/api/latest/guide/retries.html).\n\nNote\n\nUnlike other providers that use httpx for HTTP requests, Bedrock uses boto3's native retry mechanisms. The retry strategies described in [HTTP Request Retries](../../retries/) do not apply to Bedrock.",
  "content_length": 5290
}