{
  "title": "`pydantic_graph.mermaid`",
  "source_url": null,
  "content": "### DEFAULT_HIGHLIGHT_CSS\n\n```python\nDEFAULT_HIGHLIGHT_CSS = 'fill:#fdff32'\n\n```\n\nThe default CSS to use for highlighting nodes.\n\n### StateDiagramDirection\n\n```python\nStateDiagramDirection = Literal['TB', 'LR', 'RL', 'BT']\n\n```\n\nUsed to specify the direction of the state diagram generated by mermaid.\n\n- `'TB'`: Top to bottom, this is the default for mermaid charts.\n- `'LR'`: Left to right\n- `'RL'`: Right to left\n- `'BT'`: Bottom to top\n\n### generate_code\n\n```python\ngenerate_code(\n    graph: Graph[Any, Any, Any],\n    /,\n    *,\n    start_node: (\n        Sequence[NodeIdent] | NodeIdent | None\n    ) = None,\n    highlighted_nodes: (\n        Sequence[NodeIdent] | NodeIdent | None\n    ) = None,\n    highlight_css: str = DEFAULT_HIGHLIGHT_CSS,\n    title: str | None = None,\n    edge_labels: bool = True,\n    notes: bool = True,\n    direction: StateDiagramDirection | None,\n) -> str\n\n```\n\nGenerate [Mermaid state diagram](https://mermaid.js.org/syntax/stateDiagram.html) code for a graph.\n\nParameters:\n\n| Name | Type | Description | Default | | --- | --- | --- | --- | | `graph` | `Graph[Any, Any, Any]` | The graph to generate the image for. | *required* | | `start_node` | `Sequence[NodeIdent] | NodeIdent | None` | Identifiers of nodes that start the graph. | `None` | | `highlighted_nodes` | `Sequence[NodeIdent] | NodeIdent | None` | Identifiers of nodes to highlight. | `None` | | `highlight_css` | `str` | CSS to use for highlighting nodes. | `DEFAULT_HIGHLIGHT_CSS` | | `title` | `str | None` | The title of the diagram. | `None` | | `edge_labels` | `bool` | Whether to include edge labels in the diagram. | `True` | | `notes` | `bool` | Whether to include notes in the diagram. | `True` | | `direction` | `StateDiagramDirection | None` | The direction of flow. | *required* |\n\nReturns:\n\n| Type | Description | | --- | --- | | `str` | The Mermaid code for the graph. |\n\nSource code in `pydantic_graph/pydantic_graph/mermaid.py`\n\n```python\ndef generate_code(  # noqa: C901\n    graph: Graph[Any, Any, Any],\n    /,\n    *,\n    start_node: Sequence[NodeIdent] | NodeIdent | None = None,\n    highlighted_nodes: Sequence[NodeIdent] | NodeIdent | None = None,\n    highlight_css: str = DEFAULT_HIGHLIGHT_CSS,\n    title: str | None = None,\n    edge_labels: bool = True,\n    notes: bool = True,\n    direction: StateDiagramDirection | None,\n) -> str:\n    \"\"\"Generate [Mermaid state diagram](https://mermaid.js.org/syntax/stateDiagram.html) code for a graph.\n\n    Args:\n        graph: The graph to generate the image for.\n        start_node: Identifiers of nodes that start the graph.\n        highlighted_nodes: Identifiers of nodes to highlight.\n        highlight_css: CSS to use for highlighting nodes.\n        title: The title of the diagram.\n        edge_labels: Whether to include edge labels in the diagram.\n        notes: Whether to include notes in the diagram.\n        direction: The direction of flow.\n\n\n    Returns:\n        The Mermaid code for the graph.\n    \"\"\"\n    start_node_ids = set(_node_ids(start_node or ()))\n    for node_id in start_node_ids:\n        if node_id not in graph.node_defs:\n            raise LookupError(f'Start node \"{node_id}\" is not in the graph.')\n\n    lines: list[str] = []\n    if title:\n        lines = ['---', f'title: {title}', '---']\n    lines.append('stateDiagram-v2')\n    if direction is not None:\n        lines.append(f'  direction {direction}')\n    for node_id, node_def in graph.node_defs.items():\n        # we use round brackets (rounded box) for nodes other than the start and end\n        if node_id in start_node_ids:\n            lines.append(f'  [*] --> {node_id}')\n        if node_def.returns_base_node:\n            for next_node_id in graph.node_defs:\n                lines.append(f'  {node_id} --> {next_node_id}')\n        else:\n            for next_node_id, edge in node_def.next_node_edges.items():\n                line = f'  {node_id} --> {next_node_id}'\n                if edge_labels and edge.label:\n                    line += f': {edge.label}'\n                lines.append(line)\n        if end_edge := node_def.end_edge:\n            line = f'  {node_id} --> [*]'\n            if edge_labels and end_edge.label:\n                line += f': {end_edge.label}'\n            lines.append(line)\n\n        if notes and node_def.note:\n            lines.append(f'  note right of {node_id}')\n            # mermaid doesn't like multiple paragraphs in a note, and shows if so\n            clean_docs = re.sub('\\n{2,}', '\\n', node_def.note)\n            lines.append(indent(clean_docs, '    '))\n            lines.append('  end note')\n\n    if highlighted_nodes:\n        lines.append('')\n        lines.append(f'classDef highlighted {highlight_css}')\n        for node_id in _node_ids(highlighted_nodes):\n            if node_id not in graph.node_defs:\n                raise LookupError(f'Highlighted node \"{node_id}\" is not in the graph.')\n            lines.append(f'class {node_id} highlighted')\n\n    return '\\n'.join(lines)\n\n```\n\n### request_image\n\n```python\nrequest_image(\n    graph: Graph[Any, Any, Any],\n    /,\n    **kwargs: Unpack[MermaidConfig],\n) -> bytes\n\n```\n\nGenerate an image of a Mermaid diagram using [mermaid.ink](https://mermaid.ink).\n\nParameters:\n\n| Name | Type | Description | Default | | --- | --- | --- | --- | | `graph` | `Graph[Any, Any, Any]` | The graph to generate the image for. | *required* | | `**kwargs` | `Unpack[MermaidConfig]` | Additional parameters to configure mermaid chart generation. | `{}` |\n\nReturns:\n\n| Type | Description | | --- | --- | | `bytes` | The image data. |\n\nSource code in `pydantic_graph/pydantic_graph/mermaid.py`\n\n```python\ndef request_image(\n    graph: Graph[Any, Any, Any],\n    /,\n    **kwargs: Unpack[MermaidConfig],\n) -> bytes:\n    \"\"\"Generate an image of a Mermaid diagram using [mermaid.ink](https://mermaid.ink).\n\n    Args:\n        graph: The graph to generate the image for.\n        **kwargs: Additional parameters to configure mermaid chart generation.\n\n    Returns:\n        The image data.\n    \"\"\"\n    code = generate_code(\n        graph,\n        start_node=kwargs.get('start_node'),\n        highlighted_nodes=kwargs.get('highlighted_nodes'),\n        highlight_css=kwargs.get('highlight_css', DEFAULT_HIGHLIGHT_CSS),\n        title=kwargs.get('title'),\n        edge_labels=kwargs.get('edge_labels', True),\n        notes=kwargs.get('notes', True),\n        direction=kwargs.get('direction'),\n    )\n    code_base64 = base64.b64encode(code.encode()).decode()\n\n    params: dict[str, str | float] = {}\n    if kwargs.get('image_type') == 'pdf':\n        url = f'https://mermaid.ink/pdf/{code_base64}'\n        if kwargs.get('pdf_fit'):\n            params['fit'] = ''\n        if kwargs.get('pdf_landscape'):\n            params['landscape'] = ''\n        if pdf_paper := kwargs.get('pdf_paper'):\n            params['paper'] = pdf_paper\n    elif kwargs.get('image_type') == 'svg':\n        url = f'https://mermaid.ink/svg/{code_base64}'\n    else:\n        url = f'https://mermaid.ink/img/{code_base64}'\n\n        if image_type := kwargs.get('image_type'):\n            params['type'] = image_type\n\n    if background_color := kwargs.get('background_color'):\n        params['bgColor'] = background_color\n    if theme := kwargs.get('theme'):\n        params['theme'] = theme\n    if width := kwargs.get('width'):\n        params['width'] = width\n    if height := kwargs.get('height'):\n        params['height'] = height\n    if scale := kwargs.get('scale'):\n        params['scale'] = scale\n\n    httpx_client = kwargs.get('httpx_client') or httpx.Client()\n    response = httpx_client.get(url, params=params)\n    if not response.is_success:\n        raise httpx.HTTPStatusError(\n            f'{response.status_code} error generating image:\\n{response.text}',\n            request=response.request,\n            response=response,\n        )\n    return response.content\n\n```\n\n### save_image\n\n```python\nsave_image(\n    path: Path | str,\n    graph: Graph[Any, Any, Any],\n    /,\n    **kwargs: Unpack[MermaidConfig],\n) -> None\n\n```\n\nGenerate an image of a Mermaid diagram using [mermaid.ink](https://mermaid.ink) and save it to a local file.\n\nParameters:\n\n| Name | Type | Description | Default | | --- | --- | --- | --- | | `path` | `Path | str` | The path to save the image to. | *required* | | `graph` | `Graph[Any, Any, Any]` | The graph to generate the image for. | *required* | | `**kwargs` | `Unpack[MermaidConfig]` | Additional parameters to configure mermaid chart generation. | `{}` |\n\nSource code in `pydantic_graph/pydantic_graph/mermaid.py`\n\n```python\ndef save_image(\n    path: Path | str,\n    graph: Graph[Any, Any, Any],\n    /,\n    **kwargs: Unpack[MermaidConfig],\n) -> None:\n    \"\"\"Generate an image of a Mermaid diagram using [mermaid.ink](https://mermaid.ink) and save it to a local file.\n\n    Args:\n        path: The path to save the image to.\n        graph: The graph to generate the image for.\n        **kwargs: Additional parameters to configure mermaid chart generation.\n    \"\"\"\n    if isinstance(path, str):\n        path = Path(path)\n\n    if 'image_type' not in kwargs:\n        ext = path.suffix.lower()[1:]\n        # no need to check for .jpeg/.jpg, as it is the default\n        if ext in ('png', 'webp', 'svg', 'pdf'):\n            kwargs['image_type'] = ext\n\n    image_data = request_image(graph, **kwargs)\n    path.write_bytes(image_data)\n\n```\n\n### MermaidConfig\n\nBases: `TypedDict`\n\nParameters to configure mermaid chart generation.\n\nSource code in `pydantic_graph/pydantic_graph/mermaid.py`\n\n```python\nclass MermaidConfig(TypedDict, total=False):\n    \"\"\"Parameters to configure mermaid chart generation.\"\"\"\n\n    start_node: Sequence[NodeIdent] | NodeIdent\n    \"\"\"Identifiers of nodes that start the graph.\"\"\"\n    highlighted_nodes: Sequence[NodeIdent] | NodeIdent\n    \"\"\"Identifiers of nodes to highlight.\"\"\"\n    highlight_css: str\n    \"\"\"CSS to use for highlighting nodes.\"\"\"\n    title: str | None\n    \"\"\"The title of the diagram.\"\"\"\n    edge_labels: bool\n    \"\"\"Whether to include edge labels in the diagram.\"\"\"\n    notes: bool\n    \"\"\"Whether to include notes on nodes in the diagram, defaults to true.\"\"\"\n    image_type: Literal['jpeg', 'png', 'webp', 'svg', 'pdf']\n    \"\"\"The image type to generate. If unspecified, the default behavior is `'jpeg'`.\"\"\"\n    pdf_fit: bool\n    \"\"\"When using image_type='pdf', whether to fit the diagram to the PDF page.\"\"\"\n    pdf_landscape: bool\n    \"\"\"When using image_type='pdf', whether to use landscape orientation for the PDF.\n\n    This has no effect if using `pdf_fit`.\n    \"\"\"\n    pdf_paper: Literal['letter', 'legal', 'tabloid', 'ledger', 'a0', 'a1', 'a2', 'a3', 'a4', 'a5', 'a6']\n    \"\"\"When using image_type='pdf', the paper size of the PDF.\"\"\"\n    background_color: str\n    \"\"\"The background color of the diagram.\n\n    If None, the default transparent background is used. The color value is interpreted as a hexadecimal color\n    code by default (and should not have a leading '#'), but you can also use named colors by prefixing the\n    value with `'!'`. For example, valid choices include `background_color='!white'` or `background_color='FF0000'`.\n    \"\"\"\n    theme: Literal['default', 'neutral', 'dark', 'forest']\n    \"\"\"The theme of the diagram. Defaults to 'default'.\"\"\"\n    width: int\n    \"\"\"The width of the diagram.\"\"\"\n    height: int\n    \"\"\"The height of the diagram.\"\"\"\n    scale: Annotated[float, Ge(1), Le(3)]\n    \"\"\"The scale of the diagram.\n\n    The scale must be a number between 1 and 3, and you can only set a scale if one or both of width and height are set.\n    \"\"\"\n    httpx_client: httpx.Client\n    \"\"\"An HTTPX client to use for requests, mostly for testing purposes.\"\"\"\n    direction: StateDiagramDirection\n    \"\"\"The direction of the state diagram.\"\"\"\n\n```\n\n#### start_node\n\n```python\nstart_node: Sequence[NodeIdent] | NodeIdent\n\n```\n\nIdentifiers of nodes that start the graph.\n\n#### highlighted_nodes\n\n```python\nhighlighted_nodes: Sequence[NodeIdent] | NodeIdent\n\n```\n\nIdentifiers of nodes to highlight.\n\n#### highlight_css\n\n```python\nhighlight_css: str\n\n```\n\nCSS to use for highlighting nodes.\n\n#### title\n\n```python\ntitle: str | None\n\n```\n\nThe title of the diagram.\n\n#### edge_labels\n\n```python\nedge_labels: bool\n\n```\n\nWhether to include edge labels in the diagram.\n\n#### notes\n\n```python\nnotes: bool\n\n```\n\nWhether to include notes on nodes in the diagram, defaults to true.\n\n#### image_type\n\n```python\nimage_type: Literal['jpeg', 'png', 'webp', 'svg', 'pdf']\n\n```\n\nThe image type to generate. If unspecified, the default behavior is `'jpeg'`.\n\n#### pdf_fit\n\n```python\npdf_fit: bool\n\n```\n\nWhen using image_type='pdf', whether to fit the diagram to the PDF page.\n\n#### pdf_landscape\n\n```python\npdf_landscape: bool\n\n```\n\nWhen using image_type='pdf', whether to use landscape orientation for the PDF.\n\nThis has no effect if using `pdf_fit`.\n\n#### pdf_paper\n\n```python\npdf_paper: Literal[\n    \"letter\",\n    \"legal\",\n    \"tabloid\",\n    \"ledger\",\n    \"a0\",\n    \"a1\",\n    \"a2\",\n    \"a3\",\n    \"a4\",\n    \"a5\",\n    \"a6\",\n]\n\n```\n\nWhen using image_type='pdf', the paper size of the PDF.\n\n#### background_color\n\n```python\nbackground_color: str\n\n```\n\nThe background color of the diagram.\n\nIf None, the default transparent background is used. The color value is interpreted as a hexadecimal color code by default (and should not have a leading '#'), but you can also use named colors by prefixing the value with `'!'`. For example, valid choices include `background_color='!white'` or `background_color='FF0000'`.\n\n#### theme\n\n```python\ntheme: Literal['default', 'neutral', 'dark', 'forest']\n\n```\n\nThe theme of the diagram. Defaults to 'default'.\n\n#### width\n\n```python\nwidth: int\n\n```\n\nThe width of the diagram.\n\n#### height\n\n```python\nheight: int\n\n```\n\nThe height of the diagram.\n\n#### scale\n\n```python\nscale: Annotated[float, Ge(1), Le(3)]\n\n```\n\nThe scale of the diagram.\n\nThe scale must be a number between 1 and 3, and you can only set a scale if one or both of width and height are set.\n\n#### httpx_client\n\n```python\nhttpx_client: Client\n\n```\n\nAn HTTPX client to use for requests, mostly for testing purposes.\n\n#### direction\n\n```python\ndirection: StateDiagramDirection\n\n```\n\nThe direction of the state diagram.\n\n### NodeIdent\n\n```python\nNodeIdent: TypeAlias = (\n    \"type[BaseNode[Any, Any, Any]] | BaseNode[Any, Any, Any] | str\"\n)\n\n```\n\nA type alias for a node identifier.\n\nThis can be:\n\n- A node instance (instance of a subclass of BaseNode).\n- A node class (subclass of BaseNode).\n- A string representing the node ID.",
  "content_length": 14476
}