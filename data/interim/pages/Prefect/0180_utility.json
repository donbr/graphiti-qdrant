{
  "title": "utility",
  "source_url": "https://docs-3.prefect.io/v3/api-ref/python/prefect-deployments-steps-utility",
  "content": "# `prefect.deployments.steps.utility`\n\nUtility project steps that are useful for managing a project's deployment lifecycle.\n\nSteps within this module can be used within a `build`, `push`, or `pull` deployment action.\n\nExample:\nUse the `run_shell_script` setp to retrieve the short Git commit hash of the current\nrepository and use it as a Docker image tag:\n\n```yaml  theme={null}\nbuild:\n    - prefect.deployments.steps.run_shell_script:\n        id: get-commit-hash\n        script: git rev-parse --short HEAD\n        stream_output: false\n    - prefect_docker.deployments.steps.build_docker_image:\n        requires: prefect-docker\n        image_name: my-image\n        image_tag: \"{{ get-commit-hash.stdout }}\"\n        dockerfile: auto\n```\n\n## Functions\n\n### `run_shell_script` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/deployments/steps/utility.py#L76\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nrun_shell_script(script: str, directory: Optional[str] = None, env: Optional[Dict[str, str]] = None, stream_output: bool = True, expand_env_vars: bool = False) -> RunShellScriptResult\n```\n\nRuns one or more shell commands in a subprocess. Returns the standard\noutput and standard error of the script.\n\n**Args:**\n\n* `script`: The script to run\n* `directory`: The directory to run the script in. Defaults to the current\n  working directory.\n* `env`: A dictionary of environment variables to set for the script\n* `stream_output`: Whether to stream the output of the script to\n  stdout/stderr\n* `expand_env_vars`: Whether to expand environment variables in the script\n  before running it\n\n**Returns:**\n\n* A dictionary with the keys `stdout` and `stderr` containing the output\n  of the script\n\n**Examples:**\n\nRetrieve the short Git commit hash of the current repository to use as\na Docker image tag:\n\n```yaml  theme={null}\nbuild:\n    - prefect.deployments.steps.run_shell_script:\n        id: get-commit-hash\n        script: git rev-parse --short HEAD\n        stream_output: false\n    - prefect_docker.deployments.steps.build_docker_image:\n        requires: prefect-docker\n        image_name: my-image\n        image_tag: \"{{ get-commit-hash.stdout }}\"\n        dockerfile: auto\n```\n\nRun a multi-line shell script:\n\n```yaml  theme={null}\nbuild:\n    - prefect.deployments.steps.run_shell_script:\n        script: |\n            echo \"Hello\"\n            echo \"World\"\n```\n\nRun a shell script with environment variables:\n\n```yaml  theme={null}\nbuild:\n    - prefect.deployments.steps.run_shell_script:\n        script: echo \"Hello $NAME\"\n        env:\n            NAME: World\n```\n\nRun a shell script with environment variables expanded\nfrom the current environment:\n\n```yaml  theme={null}\npull:\n    - prefect.deployments.steps.run_shell_script:\n        script: |\n            echo \"User: $USER\"\n            echo \"Home Directory: $HOME\"\n        stream_output: true\n        expand_env_vars: true\n```\n\nRun a shell script in a specific directory:\n\n```yaml  theme={null}\nbuild:\n    - prefect.deployments.steps.run_shell_script:\n        script: echo \"Hello\"\n        directory: /path/to/directory\n```\n\nRun a script stored in a file:\n\n```yaml  theme={null}\nbuild:\n    - prefect.deployments.steps.run_shell_script:\n        script: \"bash path/to/script.sh\"\n```\n\n### `pip_install_requirements` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/deployments/steps/utility.py#L204\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\npip_install_requirements(directory: Optional[str] = None, requirements_file: str = 'requirements.txt', stream_output: bool = True) -> dict[str, Any]\n```\n\nInstalls dependencies from a requirements.txt file.\n\n**Args:**\n\n* `requirements_file`: The requirements.txt to use for installation.\n* `directory`: The directory the requirements.txt file is in. Defaults to\n  the current working directory.\n* `stream_output`: Whether to stream the output from pip install should be\n  streamed to the console\n\n**Returns:**\n\n* A dictionary with the keys `stdout` and `stderr` containing the output\n  the `pip install` command\n\n**Raises:**\n\n* `subprocess.CalledProcessError`: if the pip install command fails for any reason\n\n## Classes\n\n### `RunShellScriptResult` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/deployments/steps/utility.py#L63\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\nThe result of a `run_shell_script` step.",
  "content_length": 4552
}