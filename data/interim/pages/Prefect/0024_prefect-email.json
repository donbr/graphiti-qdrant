{
  "title": "prefect-email",
  "source_url": "https://docs-3.prefect.io/integrations/prefect-email/index",
  "content": "The `prefect-email` library helps you send emails from your Prefect flows.\n\n## Getting started\n\n### Prerequisites\n\n* Many email services, such as Gmail, require an [App Password](https://support.google.com/accounts/answer/185833) to successfully send emails.\n  If you encounter an error similar to `smtplib.SMTPAuthenticationError: (535, b'5.7.8 Username and Password not accepted...`, it's likely you are not using an App Password.\n\n### Install `prefect-email`\n\nThe following command will install a version of prefect-email compatible with your installed version of Prefect.\nIf you don't already have Prefect installed, it will install the newest version of Prefect as well.\n\n```bash  theme={null}\npip install \"prefect[email]\"\n```\n\nUpgrade to the latest versions of Prefect and prefect-email:\n\n```bash  theme={null}\npip install -U \"prefect[email]\"\n```\n\n### Register newly installed block types\n\nRegister the block types in the prefect-email module to make them available for use.\n\n```bash  theme={null}\nprefect block register -m prefect_email\n```\n\n## Save credentials to an EmailServerCredentials block\n\nSave your email credentials to a block.\nReplace the placeholders with your email address and password.\n\n```python  theme={null}\nfrom prefect_email import EmailServerCredentials\n\n\ncredentials = EmailServerCredentials(\n    username=\"EMAIL-ADDRESS-PLACEHOLDER\",\n    password=\"PASSWORD-PLACEHOLDER\",  # must be an application password\n)\ncredentials.save(\"BLOCK-NAME-PLACEHOLDER\")\n```\n\nIn the examples below you load a credentials block to authenticate with the email server.\n\n## Send emails\n\nThe code below shows how to send an email using the pre-built `email_send_message` [task](https://docs.prefect.io/latest/develop/write-tasks/).\n\n```python  theme={null}\nfrom prefect import flow\nfrom prefect_email import EmailServerCredentials, email_send_message\n\n\n@flow\ndef example_email_send_message_flow(email_addresses):\n    email_server_credentials = EmailServerCredentials.load(\"BLOCK-NAME-PLACEHOLDER\")\n    for email_address in email_addresses:\n        subject = email_send_message.with_options(name=f\"email {email_address}\").submit(\n            email_server_credentials=email_server_credentials,\n            subject=\"Example Flow Notification using Gmail\",\n            msg=\"This proves email_send_message works!\",\n            email_to=email_address,\n        )\n\n\nif __name__ == \"__main__\":\n    example_email_send_message_flow([\"EMAIL-ADDRESS-PLACEHOLDER\"])\n```\n\n## Capture exceptions and send an email\n\nThis example demonstrates how to send an email notification with the details of the exception when a flow run fails.\n\n`prefect-email` can be wrapped in an `except` statement to do just that!\n\n```python  theme={null}\nfrom prefect import flow\nfrom prefect.context import get_run_context\nfrom prefect_email import EmailServerCredentials, email_send_message\n\n\ndef notify_exc_by_email(exc):\n    context = get_run_context()\n    flow_run_name = context.flow_run.name\n    email_server_credentials = EmailServerCredentials.load(\"email-server-credentials\")\n    email_send_message(\n        email_server_credentials=email_server_credentials,\n        subject=f\"Flow run {flow_run_name!r} failed\",\n        msg=f\"Flow run {flow_run_name!r} failed due to {exc}.\",\n        email_to=email_server_credentials.username,\n    )\n\n@flow\ndef example_flow():\n    try:\n        1 / 0\n    except Exception as exc:\n        notify_exc_by_email(exc)\n        raise\n\n\nif __name__ == \"__main__\":\n    example_flow()\n```\n\n## Resources\n\nRefer to the `prefect-email` [SDK documentation](https://reference.prefect.io/prefect_email/) to explore all the capabilities of the `prefect-email` library.",
  "content_length": 3659
}