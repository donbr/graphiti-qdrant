{
  "title": "task_runs",
  "source_url": "https://docs-3.prefect.io/v3/api-ref/python/prefect-task_runs",
  "content": "# `prefect.task_runs`\n\n## Classes\n\n### `TaskRunWaiter` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/task_runs.py#L25\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\nA service used for waiting for a task run to finish.\n\nThis service listens for task run events and provides a way to wait for a specific\ntask run to finish. This is useful for waiting for a task run to finish before\ncontinuing execution.\n\nThe service is a singleton and must be started before use. The service will\nautomatically start when the first instance is created. A single websocket\nconnection is used to listen for task run events.\n\nThe service can be used to wait for a task run to finish by calling\n`TaskRunWaiter.wait_for_task_run` with the task run ID to wait for. The method\nwill return when the task run has finished or the timeout has elapsed.\n\nThe service will automatically stop when the Python process exits or when the\nglobal loop thread is stopped.\n\nExample:\n\n```python  theme={null}\nimport asyncio\nfrom uuid import uuid4\n\nfrom prefect import task\nfrom prefect.task_engine import run_task_async\nfrom prefect.task_runs import TaskRunWaiter\n\n\n@task\nasync def test_task():\n    await asyncio.sleep(5)\n    print(\"Done!\")\n\n\nasync def main():\n    task_run_id = uuid4()\n    asyncio.create_task(run_task_async(task=test_task, task_run_id=task_run_id))\n\n    await TaskRunWaiter.wait_for_task_run(task_run_id)\n    print(\"Task run finished\")\n\n\nif __name__ == \"__main__\":\n    asyncio.run(main())\n```\n\n**Methods:**\n\n#### `add_done_callback` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/task_runs.py#L229\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nadd_done_callback(cls, task_run_id: uuid.UUID, callback: Callable[[], None]) -> None\n```\n\nAdd a callback to be called when a task run finishes.\n\n**Args:**\n\n* `task_run_id`: The ID of the task run to wait for.\n* `callback`: The callback to call when the task run finishes.\n\n#### `instance` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/task_runs.py#L251\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\ninstance(cls) -> Self\n```\n\nGet the singleton instance of TaskRunWaiter.\n\n#### `start` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/task_runs.py#L89\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nstart(self) -> None\n```\n\nStart the TaskRunWaiter service.\n\n#### `stop` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/task_runs.py#L164\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nstop(self) -> None\n```\n\nStop the TaskRunWaiter service.\n\n#### `wait_for_task_run` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/task_runs.py#L176\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nwait_for_task_run(cls, task_run_id: uuid.UUID, timeout: Optional[float] = None) -> Optional[State[Any]]\n```\n\nWait for a task run to finish and return its final state.\n\nNote this relies on a websocket connection to receive events from the server\nand will not work with an ephemeral server.\n\n**Args:**\n\n* `task_run_id`: The ID of the task run to wait for.\n* `timeout`: The maximum time to wait for the task run to\n  finish. Defaults to None.\n\n**Returns:**\n\n* The final state of the task run if available, None otherwise.",
  "content_length": 3628
}