{
  "title": "dockerutils",
  "source_url": "https://docs-3.prefect.io/v3/api-ref/python/prefect-utilities-dockerutils",
  "content": "# `prefect.utilities.dockerutils`\n\n## Functions\n\n### `python_version_minor` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/utilities/dockerutils.py#L34\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\npython_version_minor() -> str\n```\n\n### `python_version_micro` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/utilities/dockerutils.py#L38\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\npython_version_micro() -> str\n```\n\n### `get_prefect_image_name` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/utilities/dockerutils.py#L42\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nget_prefect_image_name(prefect_version: Optional[str] = None, python_version: Optional[str] = None, flavor: Optional[str] = None) -> str\n```\n\nGet the Prefect image name matching the current Prefect and Python versions.\n\n**Args:**\n\n* `prefect_version`: An optional override for the Prefect version.\n* `python_version`: An optional override for the Python version; must be at the\n  minor level e.g. '3.9'.\n* `flavor`: An optional alternative image flavor to build, like 'conda'\n\n### `silence_docker_warnings` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/utilities/dockerutils.py#L85\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nsilence_docker_warnings() -> Generator[None, None, None]\n```\n\n### `docker_client` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/utilities/dockerutils.py#L113\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\ndocker_client() -> Generator['DockerClient', None, None]\n```\n\nGet the environmentally-configured Docker client\n\n### `build_image` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/utilities/dockerutils.py#L141\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nbuild_image(context: Path, dockerfile: str = 'Dockerfile', tag: Optional[str] = None, pull: bool = False, platform: Optional[str] = None, stream_progress_to: Optional[TextIO] = None, **kwargs: Any) -> str\n```\n\nBuilds a Docker image, returning the image ID\n\n**Args:**\n\n* `context`: the root directory for the Docker build context\n* `dockerfile`: the path to the Dockerfile, relative to the context\n* `tag`: the tag to give this image\n* `pull`: True to pull the base image during the build\n* `stream_progress_to`: an optional stream (like sys.stdout, or an io.TextIO) that\n  will collect the build output as it is reported by Docker\n\n**Returns:**\n\n* The image ID\n\n### `push_image` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/utilities/dockerutils.py#L411\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\npush_image(image_id: str, registry_url: str, name: str, tag: Optional[str] = None, stream_progress_to: Optional[TextIO] = None) -> str\n```\n\nPushes a local image to a Docker registry, returning the registry-qualified tag\nfor that image\n\nThis assumes that the environment's Docker daemon is already authenticated to the\ngiven registry, and currently makes no attempt to authenticate.\n\n**Args:**\n\n* `image_id`: a Docker image ID\n* `registry_url`: the URL of a Docker registry\n* `name`: the name of this image\n* `tag`: the tag to give this image (defaults to a short representation of\n  the image's ID)\n* `stream_progress_to`: an optional stream (like sys.stdout, or an io.TextIO) that\n  will collect the build output as it is reported by Docker\n\n**Returns:**\n\n* A registry-qualified tag, like my-registry.example.com/my-image:abcdefg\n\n### `to_run_command` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/utilities/dockerutils.py#L468\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nto_run_command(command: list[str]) -> str\n```\n\nConvert a process-style list of command arguments to a single Dockerfile RUN\ninstruction.\n\n### `parse_image_tag` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/utilities/dockerutils.py#L492\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nparse_image_tag(name: str) -> tuple[str, Optional[str]]\n```\n\nParse Docker Image String\n\n* If a tag or digest exists, this function parses and returns the image registry and tag/digest,\n  separately as a tuple.\n  * Example 1: 'prefecthq/prefect:latest' -> ('prefecthq/prefect', 'latest')\n  * Example 2: 'hostname.io:5050/folder/subfolder:latest' -> ('hostname.io:5050/folder/subfolder', 'latest')\n  * Example 3: 'prefecthq/prefect\\@sha256:abc123' -> ('prefecthq/prefect', 'sha256:abc123')\n* Supports parsing Docker Image strings that follow Docker Image Specification v1.1.0\n  * Image building tools typically enforce this standard\n\n**Args:**\n\n* `name`: Name of Docker Image\n\n### `split_repository_path` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/utilities/dockerutils.py#L540\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nsplit_repository_path(repository_path: str) -> tuple[Optional[str], str]\n```\n\nSplits a Docker repository path into its namespace and repository components.\n\n**Args:**\n\n* `repository_path`: The Docker repository path to split.\n\n**Returns:**\n\n* Tuple\\[Optional\\[str], str]: A tuple containing the namespace and repository components.\n* namespace (Optional\\[str]): The Docker namespace, combining the registry and organization. None if not present.\n* repository (Optionals\\[str]): The repository name.\n\n### `format_outlier_version_name` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/utilities/dockerutils.py#L571\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nformat_outlier_version_name(version: str) -> str\n```\n\nFormats outlier docker version names to pass `packaging.version.parse` validation\n\n* Current cases are simple, but creates stub for more complicated formatting if eventually needed.\n* Example outlier versions that throw a parsing exception:\n  * \"20.10.0-ce\" (variant of community edition label)\n  * \"20.10.0-ee\" (variant of enterprise edition label)\n\n**Args:**\n\n* `version`: raw docker version value\n\n**Returns:**\n\n* value that can pass `packaging.version.parse` validation\n\n### `generate_default_dockerfile` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/utilities/dockerutils.py#L589\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\ngenerate_default_dockerfile(context: Optional[Path] = None)\n```\n\nGenerates a default Dockerfile used for deploying flows. The Dockerfile is written\nto a temporary file and yielded. The temporary file is removed after the context\nmanager exits.\n\n**Args:**\n\n* `- context`: The context to use for the Dockerfile. Defaults to\n  the current working directory.\n\n## Classes\n\n### `BuildError` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/utilities/dockerutils.py#L130\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\nRaised when a Docker build fails\n\n### `ImageBuilder` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/utilities/dockerutils.py#L205\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\nAn interface for preparing Docker build contexts and building images\n\n**Methods:**\n\n#### `add_line` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/utilities/dockerutils.py#L264\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nadd_line(self, line: str) -> None\n```\n\nAdd a line to this image's Dockerfile\n\n#### `add_lines` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/utilities/dockerutils.py#L268\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nadd_lines(self, lines: Iterable[str]) -> None\n```\n\nAdd lines to this image's Dockerfile\n\n#### `assert_has_file` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/utilities/dockerutils.py#L397\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nassert_has_file(self, source: Path, container_path: PurePosixPath) -> None\n```\n\nAsserts that the given file or directory will be copied into the container\nat the given path\n\n#### `assert_has_line` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/utilities/dockerutils.py#L338\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nassert_has_line(self, line: str) -> None\n```\n\nAsserts that the given line is in the Dockerfile\n\n#### `assert_line_absent` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/utilities/dockerutils.py#L348\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nassert_line_absent(self, line: str) -> None\n```\n\nAsserts that the given line is absent from the Dockerfile\n\n#### `assert_line_after` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/utilities/dockerutils.py#L393\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nassert_line_after(self, second: str, first: str) -> None\n```\n\nAsserts that the second line appears after the first line\n\n#### `assert_line_before` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/utilities/dockerutils.py#L368\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nassert_line_before(self, first: str, second: str) -> None\n```\n\nAsserts that the first line appears before the second line\n\n#### `build` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/utilities/dockerutils.py#L309\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nbuild(self, pull: bool = False, stream_progress_to: Optional[TextIO] = None) -> str\n```\n\nBuild the Docker image from the current state of the ImageBuilder\n\n**Args:**\n\n* `pull`: True to pull the base image during the build\n* `stream_progress_to`: an optional stream (like sys.stdout, or an io.TextIO)\n  that will collect the build output as it is reported by Docker\n\n**Returns:**\n\n* The image ID\n\n#### `copy` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/utilities/dockerutils.py#L272\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\ncopy(self, source: Union[str, Path], destination: Union[str, PurePosixPath]) -> None\n```\n\nCopy a file to this image\n\n#### `write_text` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/utilities/dockerutils.py#L298\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nwrite_text(self, text: str, destination: Union[str, PurePosixPath]) -> None\n```\n\n### `PushError` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/utilities/dockerutils.py#L406\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\nRaised when a Docker image push fails",
  "content_length": 11819
}