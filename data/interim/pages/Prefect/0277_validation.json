{
  "title": "validation",
  "source_url": "https://docs-3.prefect.io/v3/api-ref/python/prefect-server-api-validation",
  "content": "# `prefect.server.api.validation`\n\nThis module contains functions for validating job variables for deployments, work pools,\nflow runs, and RunDeployment actions. These functions are used to validate that job\nvariables provided by users conform to the JSON schema defined in the work pool's base job\ntemplate.\n\nNote some important details:\n\n1. The order of applying job variables is: work pool's base job template, deployment, flow\n   run. This means that flow run job variables override deployment job variables, which\n   override work pool job variables.\n\n2. The validation of job variables for work pools and deployments ignores required keys in\n   because we don't know if the full set of overrides will include values for any required\n   fields.\n\n3. Work pools can include default values for job variables. These can be normal types or\n   references to blocks. We have not been validating these values or whether default blocks\n   satisfy job variable JSON schemas. To avoid failing validation for existing (otherwise\n   working) data, we ignore invalid defaults when validating deployment and flow run\n   variables, but not when validating the work pool's base template, e.g. during work pool\n   creation or updates. If we find defaults that are invalid, we have to ignore required\n   fields when we run the full validation.\n\n4. A flow run is the terminal point for job variables, so it is the only place where\n   we validate required variables and default values. Thus,\n   `validate_job_variables_for_deployment_flow_run` and\n   `validate_job_variables_for_run_deployment_action` check for required fields.\n\n5. We have been using Pydantic v1 to generate work pool base job templates, and it produces\n   invalid JSON schemas for some fields, e.g. tuples and optional fields. We try to fix these\n   schemas on the fly while validating job variables, but there is a case we can't resolve,\n   which is whether or not an optional field supports a None value. In this case, we allow\n   None values to be passed in, which means that if an optional field does not actually\n   allow None values, the Pydantic model will fail to validate at runtime.\n\n## Functions\n\n### `validate_job_variables_for_deployment_flow_run` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/api/validation.py#L223\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nvalidate_job_variables_for_deployment_flow_run(session: AsyncSession, deployment: BaseDeployment, flow_run: FlowRunAction) -> None\n```\n\nValidate job variables for a flow run created for a deployment.\n\nFlow runs are the terminal point for job variable overlays, so we validate required\njob variables because all variables should now be present.\n\n### `validate_job_variables_for_deployment` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/api/validation.py#L265\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nvalidate_job_variables_for_deployment(session: AsyncSession, work_pool: WorkPool, deployment: DeploymentAction) -> None\n```\n\nValidate job variables for deployment creation and updates.\n\nThis validation applies only to deployments that have a work pool. If the deployment\ndoes not have a work pool, we cannot validate job variables because we don't have a\nbase job template to validate against, so we skip this validation.\n\nUnlike validations for flow runs, validation here ignores required keys in the schema\nbecause we don't know if the full set of overrides will include values for any\nrequired fields. If the full set of job variables when a flow is running, including\nthe deployment's and flow run's overrides, fails to specify a value for the required\nkey, that's an error.\n\n### `validate_job_variable_defaults_for_work_pool` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/api/validation.py#L302\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nvalidate_job_variable_defaults_for_work_pool(session: AsyncSession, work_pool_name: str, base_job_template: Dict[str, Any]) -> None\n```\n\nValidate the default job variables for a work pool.\n\nThis validation checks that default values for job variables match the JSON schema\ndefined in the work pool's base job template. It also resolves references to block\ndocuments in the default values and hydrates them to perform the validation.\n\nUnlike validations for flow runs, validation here ignores required keys in the schema\nbecause we're only concerned with default values. The absence of a default for a\nrequired field is not an error, but if the full set of job variables when a flow is\nrunning, including the deployment's and flow run's overrides, fails to specify a value\nfor the required key, that's an error.\n\nNOTE: This will raise an HTTP 404 error if a referenced block document does not exist.\n\n### `validate_job_variables_for_run_deployment_action` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/api/validation.py#L335\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nvalidate_job_variables_for_run_deployment_action(session: AsyncSession, run_action: RunDeployment) -> None\n```\n\nValidate the job variables for a RunDeployment action.\n\nThis action is equivalent to creating a flow run for a deployment, so we validate\nrequired job variables because all variables should now be present.",
  "content_length": 5558
}