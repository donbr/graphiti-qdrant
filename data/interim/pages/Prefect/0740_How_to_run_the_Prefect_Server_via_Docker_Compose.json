{
  "title": "How to run the Prefect Server via Docker Compose",
  "source_url": "https://docs-3.prefect.io/v3/how-to-guides/self-hosted/docker-compose",
  "content": "Deploy a self-hosted Prefect server environment using Docker Compose, including PostgreSQL, Redis, server, background services, and worker.\n\nThis guide shows how to run a complete self-hosted Prefect server environment using Docker Compose. This setup includes the following services:\n\n* `postgres`: PostgreSQL database\n* `redis`: Redis message broker\n* `prefect-server`: Prefect server\n* `prefect-services`: Prefect background services\n* `prefect-worker`: Prefect worker\n\n## Docker Compose file\n\nCreate a `compose.yml` file with the following contents:\n\n```yaml  theme={null}\nservices:\n  postgres:\n    image: postgres:14\n    environment:\n      POSTGRES_USER: prefect\n      POSTGRES_PASSWORD: prefect\n      POSTGRES_DB: prefect\n    volumes:\n      - postgres_data:/var/lib/postgresql/data\n    healthcheck:\n      test: [\"CMD-SHELL\", \"pg_isready -U prefect\"]\n      interval: 5s\n      timeout: 5s\n      retries: 5\n\n  redis:\n    image: redis:7\n    volumes:\n      - redis_data:/data\n    healthcheck:\n      test: [\"CMD-SHELL\", \"redis-cli ping\"]\n      interval: 5s\n      timeout: 5s\n      retries: 5\n\n  prefect-server:\n    image: prefecthq/prefect:3-latest\n    depends_on:\n      postgres:\n        condition: service_healthy\n      redis:\n        condition: service_healthy\n    environment:\n      PREFECT_API_DATABASE_CONNECTION_URL: postgresql+asyncpg://prefect:prefect@postgres:5432/prefect\n      PREFECT_SERVER_API_HOST: 0.0.0.0\n      PREFECT_MESSAGING_BROKER: prefect_redis.messaging\n      PREFECT_MESSAGING_CACHE: prefect_redis.messaging\n      PREFECT_REDIS_MESSAGING_HOST: redis\n      PREFECT_REDIS_MESSAGING_PORT: 6379\n      PREFECT_REDIS_MESSAGING_DB: 0\n    command: prefect server start --no-services\n    ports:\n      - \"4200:4200\"\n    healthcheck:\n      test: [\"CMD\", \"python\", \"-c\", \"import urllib.request as u; u.urlopen('http://localhost:4200/api/health', timeout=1)\"]\n      interval: 30s\n      timeout: 10s\n      retries: 3\n      start_period: 60s\n\n  prefect-services:\n    image: prefecthq/prefect:3-latest\n    depends_on:\n      prefect-server:\n        condition: service_healthy\n    environment:\n      PREFECT_API_DATABASE_CONNECTION_URL: postgresql+asyncpg://prefect:prefect@postgres:5432/prefect\n      PREFECT_MESSAGING_BROKER: prefect_redis.messaging\n      PREFECT_MESSAGING_CACHE: prefect_redis.messaging\n      PREFECT_REDIS_MESSAGING_HOST: redis\n      PREFECT_REDIS_MESSAGING_PORT: 6379\n      PREFECT_REDIS_MESSAGING_DB: 0\n    command: prefect server services start\n\n  prefect-worker:\n    image: prefecthq/prefect:3-latest\n    depends_on:\n      prefect-server:\n        condition: service_healthy\n    environment:\n      PREFECT_API_URL: http://prefect-server:4200/api\n    command: prefect worker start --pool local-pool\n    restart: on-failure\n\nvolumes:\n  postgres_data:\n  redis_data:\n```\n\n## Running the stack\n\n1. Save the `compose.yml` file to your local machine.\n\n2. From the directory containing the file, start the stack by running:\n\n```bash  theme={null}\ndocker compose up -d\n```\n\n3. Wait for all services to start (it may take a few moments).\n\n4. Open your browser and navigate to [http://localhost:4200](http://localhost:4200) to access the Prefect UI.\n\n5. To stop the stack, run:\n\n```bash  theme={null}\ndocker compose down\n```\n\n## Notes\n\n* The PostgreSQL database is preconfigured with user and database `prefect`.\n* Redis is not strictly required but is recommended as the messaging broker when [scaling a Prefect server installation](/v3/advanced/self-hosted).\n* The Prefect worker automatically registers a pool named `local-pool`.\n* The Prefect server exposes the API on port 4200; ensure this port is free.\n* Use `docker compose logs -f` to view live logs for all services.\n* This `compose.yml` does not configure authentication. See the [authentication guide](/v3/advanced/security-settings#basic-authentication) for more information.\n\n## Troubleshooting\n\n* If the UI does not load, verify that port 4200 is not occupied by another process.\n* Check container logs for errors with:\n\n```bash  theme={null}\ndocker compose logs -f\n```\n\n* Make sure Docker and Docker Compose are installed and up to date.\n\n***\n\nFor more information, see the official [Prefect documentation](https://docs.prefect.io).\n\n***",
  "content_length": 4223
}