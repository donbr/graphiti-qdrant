{
  "title": "prefect-aws",
  "source_url": "https://docs-3.prefect.io/integrations/prefect-aws/index",
  "content": "Build production-ready data workflows that seamlessly integrate with AWS services. `prefect-aws` provides battle-tested blocks, tasks, and infrastructure integrations for AWS, including ECS orchestration, S3 storage, Secrets Manager, Lambda functions, Batch computing, and Glue ETL operations.\n\n## Why use prefect-aws?\n\n`prefect-aws` offers significant advantages over direct boto3 integration:\n\n* **Production-ready integrations**: Pre-built, tested components that handle common AWS patterns and edge cases\n* **Unified credential management**: Secure, centralized authentication that works consistently across all AWS services\n* **Built-in observability**: Automatic logging, monitoring, and state tracking for all AWS operations\n* **Infrastructure as code**: Deploy and scale workflows on AWS ECS with minimal configuration\n\n## Getting started\n\n### Prerequisites\n\n* An [AWS account](https://aws.amazon.com/account/) and the necessary permissions to access desired services.\n\n### Install prefect-aws\n\nThe following command will install a version of `prefect-aws` compatible with your installed version of `prefect`. If you don't already have `prefect` installed, it will install the newest version of `prefect` as well.\n\n```bash  theme={null}\npip install \"prefect[aws]\"\n```\n\nUpgrade to the latest versions of `prefect` and `prefect-aws`:\n\n```bash  theme={null}\npip install -U \"prefect[aws]\"\n```\n\n## Blocks setup\n\n### Credentials\n\nMost AWS services requires an authenticated session.\nPrefect makes it simple to provide credentials via AWS Credentials blocks.\n\nSteps:\n\n1. Refer to the [AWS Configuration documentation](https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-quickstart.html#cli-configure-quickstart-creds) to retrieve your access key ID and secret access key.\n2. Copy the access key ID and secret access key.\n3. Create an `AwsCredentials` block in the Prefect UI or use a Python script like the one below.\n\n```python  theme={null}\nfrom prefect_aws import AwsCredentials\n\n\nAwsCredentials(\n    aws_access_key_id=\"PLACEHOLDER\",\n    aws_secret_access_key=\"PLACEHOLDER\",\n    aws_session_token=None,  # replace this with token if necessary\n    region_name=\"us-east-2\"\n).save(\"BLOCK-NAME-PLACEHOLDER\")\n```\n\nPrefect uses the Boto3 library under the hood.\nTo find credentials for authentication, any data not provided to the block are sourced at runtime in the order shown in the [Boto3 docs](https://boto3.amazonaws.com/v1/documentation/api/latest/guide/credentials.html#configuring-credentials).\nPrefect creates the session object using the values in the block and then, any missing values follow the sequence in the Boto3 docs.\n\n### S3\n\nCreate a block for reading and writing files to S3.\n\n```python  theme={null}\nfrom prefect_aws import AwsCredentials\nfrom prefect_aws.s3 import S3Bucket\n\nS3Bucket(\n    bucket_name=\"BUCKET-NAME-PLACEHOLDER\",\n    credentials=aws_credentials\n).save(\"S3-BLOCK-NAME-PLACEHOLDER\")\n```\n\n### Lambda\n\nInvoke AWS Lambdas, synchronously or asynchronously.\n\n```python  theme={null}\nfrom prefect_aws.lambda_function import LambdaFunction\nfrom prefect_aws.credentials import AwsCredentials\n\nLambdaFunction(\n    function_name=\"test_lambda_function\",\n    aws_credentials=credentials,\n).save(\"LAMBDA-BLOCK-NAME-PLACEHOLDER\")\n```\n\n### Secret Manager\n\nCreate a block to read, write, and delete AWS Secret Manager secrets.\n\n```python  theme={null}\nfrom prefect_aws import AwsCredentials\nfrom prefect_aws.secrets_manager import AwsSecret\n\nAwsSecret(\n    secret_name=\"test_secret_name\",\n    aws_credentials=credentials,\n).save(\"AWS-SECRET-BLOCK-NAME-PLACEHOLDER\")\n\n```\n\n## Supported AWS services\n\n`prefect-aws` provides comprehensive integrations for key AWS services:\n\n| Service             | Integration Type           | Use Cases                                              |\n| ------------------- | -------------------------- | ------------------------------------------------------ |\n| **S3**              | `S3Bucket` block           | File storage, data lake operations, deployment storage |\n| **Secrets Manager** | `AwsSecret` block          | Secure credential storage, API key management          |\n| **Lambda**          | `LambdaFunction` block     | Serverless function execution, event-driven processing |\n| **Glue**            | `GlueJobBlock` block       | ETL operations, data transformation pipelines          |\n| **ECS**             | `ECSWorker` infrastructure | Container orchestration, scalable compute workloads    |\n| **Batch**           | `batch_submit` task        | High-throughput computing, batch job processing        |\n\n**Integration types:**\n\n* **Blocks**: Reusable configuration objects that can be saved and shared across flows\n* **Tasks**: Functions decorated with `@task` for direct use in flows\n* **Workers**: Infrastructure components for running flows on AWS compute services\n\n## Scale workflows with AWS infrastructure\n\n### ECS (Elastic Container Service)\n\nDeploy and scale your Prefect workflows on [AWS ECS](https://aws.amazon.com/ecs/) for production workloads. `prefect-aws` provides:\n\n* **ECS worker**: Long-running worker for hybrid deployments with full control over execution environment\n* **Auto-scaling**: Dynamic resource allocation based on workflow demands\n* **Cost optimization**: Pay only for compute resources when workflows are running\n\nSee the [ECS worker deployment guide](/integrations/prefect-aws/ecs_guide) for a step-by-step walkthrough of deploying production-ready workers to your ECS cluster.\n\n### Docker Images\n\nPre-built Docker images with `prefect-aws` are available for simplified deployment:\n\n```bash  theme={null}\ndocker pull prefecthq/prefect-aws:latest\n```\n\n#### Available Tags\n\nImage tags have the following format:\n\n* `prefecthq/prefect-aws:latest` - Latest stable release with Python 3.12\n* `prefecthq/prefect-aws:latest-python3.11` - Latest stable with Python 3.11\n* `prefecthq/prefect-aws:0.5.9-python3.12` - Specific prefect-aws version with Python 3.12\n* `prefecthq/prefect-aws:0.5.9-python3.12-prefect3.4.9` - Full version specification\n\n#### Usage Examples\n\n**Running an ECS worker:**\n\n```bash  theme={null}\ndocker run -d \\\n  --name prefect-ecs-worker \\\n  -e PREFECT_API_URL=https://api.prefect.cloud/api/accounts/your-account/workspaces/your-workspace \\\n  -e PREFECT_API_KEY=your-api-key \\\n  prefecthq/prefect-aws:latest \\\n  prefect worker start --pool ecs-pool\n```\n\n**Local development:**\n\n```bash  theme={null}\ndocker run -it --rm \\\n  -v $(pwd):/opt/prefect \\\n  prefecthq/prefect-aws:latest \\\n  python your_flow.py\n```\n\n## Examples\n\n### Read and write files to AWS S3\n\nUpload a file to an AWS S3 bucket and download the same file under a different filename.\nThe following code assumes that the bucket already exists:\n\n```python  theme={null}\nfrom pathlib import Path\nfrom prefect import flow\nfrom prefect_aws import AwsCredentials, S3Bucket\n\n\n@flow\ndef s3_flow():\n    # create a dummy file to upload\n    file_path = Path(\"test-example.txt\")\n    file_path.write_text(\"Hello, Prefect!\")\n\n    aws_credentials = AwsCredentials.load(\"BLOCK-NAME-PLACEHOLDER\")\n    s3_bucket = S3Bucket(\n        bucket_name=\"BUCKET-NAME-PLACEHOLDER\",\n        credentials=aws_credentials\n    )\n\n    s3_bucket_path = s3_bucket.upload_from_path(file_path)\n    downloaded_file_path = s3_bucket.download_object_to_path(\n        s3_bucket_path, \"downloaded-test-example.txt\"\n    )\n    return downloaded_file_path.read_text()\n\n\nif __name__ == \"__main__\":\n    s3_flow()\n```\n\n### Access secrets with AWS Secrets Manager\n\nWrite a secret to AWS Secrets Manager, read the secret data, delete the secret, and return the secret data.\n\n```python  theme={null}\nfrom prefect import flow\nfrom prefect_aws import AwsCredentials, AwsSecret\n\n\n@flow\ndef secrets_manager_flow():\n    aws_credentials = AwsCredentials.load(\"BLOCK-NAME-PLACEHOLDER\")\n    aws_secret = AwsSecret(secret_name=\"test-example\", aws_credentials=aws_credentials)\n    aws_secret.write_secret(secret_data=b\"Hello, Prefect!\")\n    secret_data = aws_secret.read_secret()\n    aws_secret.delete_secret()\n    return secret_data\n\n\nif __name__ == \"__main__\":\n    secrets_manager_flow()\n```\n\n### Invoke lambdas\n\n```python  theme={null}\nfrom prefect_aws.lambda_function import LambdaFunction\nfrom prefect_aws.credentials import AwsCredentials\n\ncredentials = AwsCredentials()\nlambda_function = LambdaFunction(\n    function_name=\"test_lambda_function\",\n    aws_credentials=credentials,\n)\nresponse = lambda_function.invoke(\n    payload={\"foo\": \"bar\"},\n    invocation_type=\"RequestResponse\",\n)\nresponse[\"Payload\"].read()\n```\n\n### Submit AWS Glue jobs\n\n```python  theme={null}\nfrom prefect import flow\nfrom prefect_aws import AwsCredentials\nfrom prefect_aws.glue_job import GlueJobBlock\n\n\n@flow\ndef example_run_glue_job():\n    aws_credentials = AwsCredentials(\n        aws_access_key_id=\"your_access_key_id\",\n        aws_secret_access_key=\"your_secret_access_key\"\n    )\n    glue_job_run = GlueJobBlock(\n        job_name=\"your_glue_job_name\",\n        arguments={\"--YOUR_EXTRA_ARGUMENT\": \"YOUR_EXTRA_ARGUMENT_VALUE\"},\n    ).trigger()\n\n    return glue_job_run.wait_for_completion()\n\n\nif __name__ == \"__main__\":\n    example_run_glue_job()\n```\n\n### Submit AWS Batch jobs\n\n```python  theme={null}\nfrom prefect import flow\nfrom prefect_aws import AwsCredentials\nfrom prefect_aws.batch import batch_submit\n\n\n@flow\ndef example_batch_submit_flow():\n    aws_credentials = AwsCredentials(\n        aws_access_key_id=\"access_key_id\",\n        aws_secret_access_key=\"secret_access_key\"\n    )\n    job_id = batch_submit(\n        \"job_name\",\n        \"job_queue\",\n        \"job_definition\",\n        aws_credentials\n    )\n    return job_id\n\n\nif __name__ == \"__main__\":\n    example_batch_submit_flow()\n```\n\n## Resources\n\n### Documentation\n\n* **[prefect-aws SDK Reference](https://reference.prefect.io/prefect_aws/)** - Complete API documentation for all blocks and tasks\n* **[ECS Deployment Guide](/integrations/prefect-aws/ecs_guide)** - Step-by-step guide for deploying workflows on ECS\n* **[Prefect Secrets Management](/v3/develop/secrets)** - Using AWS credentials with third-party services\n\n### AWS Resources\n\n* **[AWS Documentation](https://docs.aws.amazon.com/)** - Official AWS service documentation\n* **[Boto3 Documentation](https://boto3.amazonaws.com/v1/documentation/api/latest/index.html)** - Python SDK reference for AWS services\n* **[AWS IAM Best Practices](https://docs.aws.amazon.com/IAM/latest/UserGuide/best-practices.html)** - Security recommendations for AWS access",
  "content_length": 10489
}