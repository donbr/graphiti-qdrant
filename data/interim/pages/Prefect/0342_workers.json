{
  "title": "workers",
  "source_url": "https://docs-3.prefect.io/v3/api-ref/python/prefect-server-models-workers",
  "content": "# `prefect.server.models.workers`\n\nFunctions for interacting with worker ORM objects.\nIntended for internal use by the Prefect REST API.\n\n## Functions\n\n### `create_work_pool` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/models/workers.py#L44\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\ncreate_work_pool(db: PrefectDBInterface, session: AsyncSession, work_pool: Union[schemas.core.WorkPool, schemas.actions.WorkPoolCreate]) -> orm_models.WorkPool\n```\n\nCreates a work pool.\n\nIf a WorkPool with the same name exists, an error will be thrown.\n\n**Args:**\n\n* `session`: a database session\n* `work_pool`: a WorkPool model\n\n**Returns:**\n\n* orm\\_models.WorkPool: the newly-created WorkPool\n\n### `read_work_pool` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/models/workers.py#L89\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nread_work_pool(db: PrefectDBInterface, session: AsyncSession, work_pool_id: UUID) -> Optional[orm_models.WorkPool]\n```\n\nReads a WorkPool by id.\n\n**Args:**\n\n* `session`: A database session\n* `work_pool_id`: a WorkPool id\n\n**Returns:**\n\n* orm\\_models.WorkPool: the WorkPool\n\n### `read_work_pool_by_name` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/models/workers.py#L108\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nread_work_pool_by_name(db: PrefectDBInterface, session: AsyncSession, work_pool_name: str) -> Optional[orm_models.WorkPool]\n```\n\nReads a WorkPool by name.\n\n**Args:**\n\n* `session`: A database session\n* `work_pool_name`: a WorkPool name\n\n**Returns:**\n\n* orm\\_models.WorkPool: the WorkPool\n\n### `read_work_pools` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/models/workers.py#L127\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nread_work_pools(db: PrefectDBInterface, session: AsyncSession, work_pool_filter: Optional[schemas.filters.WorkPoolFilter] = None, offset: Optional[int] = None, limit: Optional[int] = None) -> Sequence[orm_models.WorkPool]\n```\n\nRead worker configs.\n\n**Args:**\n\n* `session`: A database session\n* `offset`: Query offset\n* `limit`: Query limit\n\nReturns:\nList\\[orm\\_models.WorkPool]: worker configs\n\n### `count_work_pools` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/models/workers.py#L159\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\ncount_work_pools(db: PrefectDBInterface, session: AsyncSession, work_pool_filter: Optional[schemas.filters.WorkPoolFilter] = None) -> int\n```\n\nRead worker configs.\n\n**Args:**\n\n* `session`: A database session\n* `work_pool_filter`: filter criteria to apply to the count\n\nReturns:\nint: the count of work pools matching the criteria\n\n### `update_work_pool` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/models/workers.py#L184\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nupdate_work_pool(db: PrefectDBInterface, session: AsyncSession, work_pool_id: UUID, work_pool: schemas.actions.WorkPoolUpdate, emit_status_change: Optional[Callable[[UUID, DateTime, orm_models.WorkPool, orm_models.WorkPool], Awaitable[None]]] = None) -> bool\n```\n\nUpdate a WorkPool by id.\n\n**Args:**\n\n* `session`: A database session\n* `work_pool_id`: a WorkPool id\n* `worker`: the work queue data\n* `emit_status_change`: function to call when work pool\n  status is changed\n\n**Returns:**\n\n* whether or not the worker was updated\n\n### `delete_work_pool` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/models/workers.py#L272\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\ndelete_work_pool(db: PrefectDBInterface, session: AsyncSession, work_pool_id: UUID) -> bool\n```\n\nDelete a WorkPool by id.\n\n**Args:**\n\n* `session`: A database session\n* `work_pool_id`: a work pool id\n\n**Returns:**\n\n* whether or not the WorkPool was deleted\n\n### `get_scheduled_flow_runs` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/models/workers.py#L293\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nget_scheduled_flow_runs(db: PrefectDBInterface, session: AsyncSession, work_pool_ids: Optional[List[UUID]] = None, work_queue_ids: Optional[List[UUID]] = None, scheduled_before: Optional[datetime.datetime] = None, scheduled_after: Optional[datetime.datetime] = None, limit: Optional[int] = None, respect_queue_priorities: Optional[bool] = None) -> Sequence[schemas.responses.WorkerFlowRunResponse]\n```\n\nGet runs from queues in a specific work pool.\n\n**Args:**\n\n* `session`: a database session\n* `work_pool_ids`: a list of work pool ids\n* `work_queue_ids`: a list of work pool queue ids\n* `scheduled_before`: a datetime to filter runs scheduled before\n* `scheduled_after`: a datetime to filter runs scheduled after\n* `respect_queue_priorities`: whether or not to respect queue priorities\n* `limit`: the maximum number of runs to return\n* `db`: a database interface\n\n**Returns:**\n\n* List\\[WorkerFlowRunResponse]: the runs, as well as related work pool details\n\n### `create_work_queue` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/models/workers.py#L345\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\ncreate_work_queue(db: PrefectDBInterface, session: AsyncSession, work_pool_id: UUID, work_queue: schemas.actions.WorkQueueCreate) -> orm_models.WorkQueue\n```\n\nCreates a work pool queue.\n\n**Args:**\n\n* `session`: a database session\n* `work_pool_id`: a work pool id\n* `work_queue`: a WorkQueue action model\n\n**Returns:**\n\n* orm\\_models.WorkQueue: the newly-created WorkQueue\n\n### `bulk_update_work_queue_priorities` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/models/workers.py#L402\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nbulk_update_work_queue_priorities(db: PrefectDBInterface, session: AsyncSession, work_pool_id: UUID, new_priorities: Dict[UUID, int]) -> None\n```\n\nThis is a brute force update of all work pool queue priorities for a given work\npool.\n\nIt loads all queues fully into memory, sorts them, and flushes the update to\nthe orm\\_models. The algorithm ensures that priorities are unique integers > 0, and\nmakes the minimum number of changes required to satisfy the provided\n`new_priorities`. For example, if no queues currently have the provided\n`new_priorities`, then they are assigned without affecting other queues. If\nthey are held by other queues, then those queues' priorities are\nincremented as necessary.\n\nUpdating queue priorities is not a common operation (happens on the same scale as\nqueue modification, which is significantly less than reading from queues),\nso while this implementation is slow, it may suffice and make up for that\nwith extreme simplicity.\n\n### `read_work_queues` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/models/workers.py#L468\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nread_work_queues(db: PrefectDBInterface, session: AsyncSession, work_pool_id: UUID, work_queue_filter: Optional[schemas.filters.WorkQueueFilter] = None, offset: Optional[int] = None, limit: Optional[int] = None) -> Sequence[orm_models.WorkQueue]\n```\n\nRead all work pool queues for a work pool. Results are ordered by ascending priority.\n\n**Args:**\n\n* `session`: a database session\n* `work_pool_id`: a work pool id\n* `work_queue_filter`: Filter criteria for work pool queues\n* `offset`: Query offset\n* `limit`: Query limit\n\n**Returns:**\n\n* List\\[orm\\_models.WorkQueue]: the WorkQueues\n\n### `read_work_queue` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/models/workers.py#L509\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nread_work_queue(db: PrefectDBInterface, session: AsyncSession, work_queue_id: Union[UUID, PrefectUUID]) -> Optional[orm_models.WorkQueue]\n```\n\nRead a specific work pool queue.\n\n**Args:**\n\n* `session`: a database session\n* `work_queue_id`: a work pool queue id\n\n**Returns:**\n\n* orm\\_models.WorkQueue: the WorkQueue\n\n### `read_work_queue_by_name` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/models/workers.py#L529\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nread_work_queue_by_name(db: PrefectDBInterface, session: AsyncSession, work_pool_name: str, work_queue_name: str) -> Optional[orm_models.WorkQueue]\n```\n\nReads a WorkQueue by name.\n\n**Args:**\n\n* `session`: A database session\n* `work_pool_name`: a WorkPool name\n* `work_queue_name`: a WorkQueue name\n\n**Returns:**\n\n* orm\\_models.WorkQueue: the WorkQueue\n\n### `update_work_queue` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/models/workers.py#L563\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nupdate_work_queue(db: PrefectDBInterface, session: AsyncSession, work_queue_id: UUID, work_queue: schemas.actions.WorkQueueUpdate, emit_status_change: Optional[Callable[[orm_models.WorkQueue], Awaitable[None]]] = None, default_status: WorkQueueStatus = WorkQueueStatus.NOT_READY) -> bool\n```\n\nUpdate a work pool queue.\n\n**Args:**\n\n* `session`: a database session\n* `work_queue_id`: a work pool queue ID\n* `work_queue`: a WorkQueue model\n* `emit_status_change`: function to call when work queue\n  status is changed\n\n**Returns:**\n\n* whether or not the WorkQueue was updated\n\n### `delete_work_queue` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/models/workers.py#L647\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\ndelete_work_queue(db: PrefectDBInterface, session: AsyncSession, work_queue_id: UUID) -> bool\n```\n\nDelete a work pool queue.\n\n**Args:**\n\n* `session`: a database session\n* `work_queue_id`: a work pool queue ID\n\n**Returns:**\n\n* whether or not the WorkQueue was deleted\n\n### `read_workers` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/models/workers.py#L695\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nread_workers(db: PrefectDBInterface, session: AsyncSession, work_pool_id: UUID, worker_filter: Optional[schemas.filters.WorkerFilter] = None, limit: Optional[int] = None, offset: Optional[int] = None) -> Sequence[orm_models.Worker]\n```\n\n### `worker_heartbeat` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/models/workers.py#L724\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nworker_heartbeat(db: PrefectDBInterface, session: AsyncSession, work_pool_id: UUID, worker_name: str, heartbeat_interval_seconds: Optional[int] = None) -> bool\n```\n\nRecord a worker process heartbeat.\n\n**Args:**\n\n* `session`: a database session\n* `work_pool_id`: a work pool ID\n* `worker_name`: a worker name\n\n**Returns:**\n\n* whether or not the worker was updated\n\n### `delete_worker` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/models/workers.py#L774\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\ndelete_worker(db: PrefectDBInterface, session: AsyncSession, work_pool_id: UUID, worker_name: str) -> bool\n```\n\nDelete a work pool's worker.\n\n**Args:**\n\n* `session`: a database session\n* `work_pool_id`: a work pool ID\n* `worker_name`: a worker name\n\n**Returns:**\n\n* whether or not the Worker was deleted\n\n### `emit_work_pool_status_event` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/models/workers.py#L802\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nemit_work_pool_status_event(event_id: UUID, occurred: DateTime, pre_update_work_pool: Optional[orm_models.WorkPool], work_pool: orm_models.WorkPool) -> None\n```",
  "content_length": 12595
}