{
  "title": "deployments",
  "source_url": "https://docs-3.prefect.io/v3/api-ref/python/prefect-server-models-deployments",
  "content": "# `prefect.server.models.deployments`\n\nFunctions for interacting with deployment ORM objects.\nIntended for internal use by the Prefect REST API.\n\n## Functions\n\n### `create_deployment` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/models/deployments.py#L87\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\ncreate_deployment(db: PrefectDBInterface, session: AsyncSession, deployment: schemas.core.Deployment | schemas.actions.DeploymentCreate) -> Optional[orm_models.Deployment]\n```\n\nUpserts a deployment.\n\n**Args:**\n\n* `session`: a database session\n* `deployment`: a deployment model\n\n**Returns:**\n\n* orm\\_models.Deployment: the newly-created or updated deployment\n\n### `update_deployment` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/models/deployments.py#L210\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nupdate_deployment(db: PrefectDBInterface, session: AsyncSession, deployment_id: UUID, deployment: schemas.actions.DeploymentUpdate) -> bool\n```\n\nUpdates a deployment.\n\n**Args:**\n\n* `session`: a database session\n* `deployment_id`: the ID of the deployment to modify\n* `deployment`: changes to a deployment model\n\n**Returns:**\n\n* whether the deployment was updated\n\n### `read_deployment` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/models/deployments.py#L359\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nread_deployment(db: PrefectDBInterface, session: AsyncSession, deployment_id: UUID) -> Optional[orm_models.Deployment]\n```\n\nReads a deployment by id.\n\n**Args:**\n\n* `session`: A database session\n* `deployment_id`: a deployment id\n\n**Returns:**\n\n* orm\\_models.Deployment: the deployment\n\n### `read_deployment_by_name` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/models/deployments.py#L376\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nread_deployment_by_name(db: PrefectDBInterface, session: AsyncSession, name: str, flow_name: str) -> Optional[orm_models.Deployment]\n```\n\nReads a deployment by name.\n\n**Args:**\n\n* `session`: A database session\n* `name`: a deployment name\n* `flow_name`: the name of the flow the deployment belongs to\n\n**Returns:**\n\n* orm\\_models.Deployment: the deployment\n\n### `read_deployments` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/models/deployments.py#L468\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nread_deployments(db: PrefectDBInterface, session: AsyncSession, offset: Optional[int] = None, limit: Optional[int] = None, flow_filter: Optional[schemas.filters.FlowFilter] = None, flow_run_filter: Optional[schemas.filters.FlowRunFilter] = None, task_run_filter: Optional[schemas.filters.TaskRunFilter] = None, deployment_filter: Optional[schemas.filters.DeploymentFilter] = None, work_pool_filter: Optional[schemas.filters.WorkPoolFilter] = None, work_queue_filter: Optional[schemas.filters.WorkQueueFilter] = None, sort: schemas.sorting.DeploymentSort = schemas.sorting.DeploymentSort.NAME_ASC) -> Sequence[orm_models.Deployment]\n```\n\nRead deployments.\n\n**Args:**\n\n* `session`: A database session\n* `offset`: Query offset\n* `limit`: Query limit\n* `flow_filter`: only select deployments whose flows match these criteria\n* `flow_run_filter`: only select deployments whose flow runs match these criteria\n* `task_run_filter`: only select deployments whose task runs match these criteria\n* `deployment_filter`: only select deployment that match these filters\n* `work_pool_filter`: only select deployments whose work pools match these criteria\n* `work_queue_filter`: only select deployments whose work pool queues match these criteria\n* `sort`: the sort criteria for selected deployments. Defaults to `name` ASC.\n\n**Returns:**\n\n* list\\[orm\\_models.Deployment]: deployments\n\n### `count_deployments` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/models/deployments.py#L523\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\ncount_deployments(db: PrefectDBInterface, session: AsyncSession, flow_filter: Optional[schemas.filters.FlowFilter] = None, flow_run_filter: Optional[schemas.filters.FlowRunFilter] = None, task_run_filter: Optional[schemas.filters.TaskRunFilter] = None, deployment_filter: Optional[schemas.filters.DeploymentFilter] = None, work_pool_filter: Optional[schemas.filters.WorkPoolFilter] = None, work_queue_filter: Optional[schemas.filters.WorkQueueFilter] = None) -> int\n```\n\nCount deployments.\n\n**Args:**\n\n* `session`: A database session\n* `flow_filter`: only count deployments whose flows match these criteria\n* `flow_run_filter`: only count deployments whose flow runs match these criteria\n* `task_run_filter`: only count deployments whose task runs match these criteria\n* `deployment_filter`: only count deployment that match these filters\n* `work_pool_filter`: only count deployments that match these work pool filters\n* `work_queue_filter`: only count deployments that match these work pool queue filters\n\n**Returns:**\n\n* the number of deployments matching filters\n\n### `delete_deployment` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/models/deployments.py#L567\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\ndelete_deployment(db: PrefectDBInterface, session: AsyncSession, deployment_id: UUID) -> bool\n```\n\nDelete a deployment by id.\n\n**Args:**\n\n* `session`: A database session\n* `deployment_id`: a deployment id\n\n**Returns:**\n\n* whether or not the deployment was deleted\n\n### `schedule_runs` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/models/deployments.py#L610\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nschedule_runs(db: PrefectDBInterface, session: AsyncSession, deployment_id: UUID, start_time: Optional[datetime.datetime] = None, end_time: Optional[datetime.datetime] = None, min_time: Optional[datetime.timedelta] = None, min_runs: Optional[int] = None, max_runs: Optional[int] = None, auto_scheduled: bool = True) -> Sequence[UUID]\n```\n\nSchedule flow runs for a deployment\n\n**Args:**\n\n* `session`: a database session\n* `deployment_id`: the id of the deployment to schedule\n* `start_time`: the time from which to start scheduling runs\n* `end_time`: runs will be scheduled until at most this time\n* `min_time`: runs will be scheduled until at least this far in the future\n* `min_runs`: a minimum amount of runs to schedule\n* `max_runs`: a maximum amount of runs to schedule\n\nThis function will generate the minimum number of runs that satisfy the min\nand max times, and the min and max counts. Specifically, the following order\nwill be respected.\n\n* Runs will be generated starting on or after the `start_time`\n* No more than `max_runs` runs will be generated\n* No runs will be generated after `end_time` is reached\n* At least `min_runs` runs will be generated\n* Runs will be generated until at least `start_time` + `min_time` is reached\n\n**Returns:**\n\n* a list of flow run ids scheduled for the deployment\n\n### `check_work_queues_for_deployment` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/models/deployments.py#L867\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\ncheck_work_queues_for_deployment(db: PrefectDBInterface, session: AsyncSession, deployment_id: UUID) -> Sequence[orm_models.WorkQueue]\n```\n\nGet work queues that can pick up the specified deployment.\n\nWork queues will pick up a deployment when all of the following are met.\n\n* The deployment has ALL tags that the work queue has (i.e. the work\n  queue's tags must be a subset of the deployment's tags).\n* The work queue's specified deployment IDs match the deployment's ID,\n  or the work queue does NOT have specified deployment IDs.\n* The work queue's specified flow runners match the deployment's flow\n  runner or the work queue does NOT have a specified flow runner.\n\nNotes on the query:\n\n* Our database currently allows either \"null\" and empty lists as\n  null values in filters, so we need to catch both cases with \"or\".\n* `A.contains(B)` should be interpreted as \"True if A\n  contains B\".\n\n**Returns:**\n\n* List\\[orm\\_models.WorkQueue]: WorkQueues\n\n### `create_deployment_schedules` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/models/deployments.py#L927\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\ncreate_deployment_schedules(db: PrefectDBInterface, session: AsyncSession, deployment_id: UUID, schedules: list[schemas.actions.DeploymentScheduleCreate]) -> list[schemas.core.DeploymentSchedule]\n```\n\nCreates a deployment's schedules.\n\n**Args:**\n\n* `session`: A database session\n* `deployment_id`: a deployment id\n* `schedules`: a list of deployment schedule create actions\n\n### `read_deployment_schedules` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/models/deployments.py#L961\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nread_deployment_schedules(db: PrefectDBInterface, session: AsyncSession, deployment_id: UUID, deployment_schedule_filter: Optional[schemas.filters.DeploymentScheduleFilter] = None) -> list[schemas.core.DeploymentSchedule]\n```\n\nReads a deployment's schedules.\n\n**Args:**\n\n* `session`: A database session\n* `deployment_id`: a deployment id\n\n**Returns:**\n\n* list\\[schemas.core.DeploymentSchedule]: the deployment's schedules\n\n### `update_deployment_schedule` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/models/deployments.py#L998\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nupdate_deployment_schedule(db: PrefectDBInterface, session: AsyncSession, deployment_id: UUID, schedule: schemas.actions.DeploymentScheduleUpdate, deployment_schedule_id: UUID | None = None, deployment_schedule_slug: str | None = None) -> bool\n```\n\nUpdates a deployment's schedules.\n\n**Args:**\n\n* `session`: A database session\n* `deployment_schedule_id`: a deployment schedule id\n* `schedule`: a deployment schedule update action\n\n### `delete_schedules_for_deployment` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/models/deployments.py#L1045\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\ndelete_schedules_for_deployment(db: PrefectDBInterface, session: AsyncSession, deployment_id: UUID) -> bool\n```\n\nDeletes a deployment schedule.\n\n**Args:**\n\n* `session`: A database session\n* `deployment_id`: a deployment id\n\n### `delete_deployment_schedule` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/models/deployments.py#L1070\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\ndelete_deployment_schedule(db: PrefectDBInterface, session: AsyncSession, deployment_id: UUID, deployment_schedule_id: UUID) -> bool\n```\n\nDeletes a deployment schedule.\n\n**Args:**\n\n* `session`: A database session\n* `deployment_schedule_id`: a deployment schedule id\n\n### `mark_deployments_ready` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/models/deployments.py#L1096\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nmark_deployments_ready() -> None\n```\n\n### `mark_deployments_not_ready` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/models/deployments.py#L1152\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nmark_deployments_not_ready(db: PrefectDBInterface, deployment_ids: Optional[Iterable[UUID]] = None, work_queue_ids: Optional[Iterable[UUID]] = None) -> None\n```\n\n### `with_system_labels_for_deployment` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/models/deployments.py#L1206\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nwith_system_labels_for_deployment(session: AsyncSession, deployment: schemas.core.Deployment) -> schemas.core.KeyValueLabels\n```\n\nAugment user supplied labels with system default labels for a deployment.\n\n### `with_system_labels_for_deployment_flow_run` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/models/deployments.py#L1227\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nwith_system_labels_for_deployment_flow_run(session: AsyncSession, deployment: orm_models.Deployment, user_supplied_labels: Optional[schemas.core.KeyValueLabels] = None) -> schemas.core.KeyValueLabels\n```\n\nGenerate system labels for a flow run created from a deployment.\n\n**Args:**\n\n* `session`: Database session\n* `deployment`: The deployment the flow run is created from\n* `user_supplied_labels`: Optional user-supplied labels to include\n\n**Returns:**\n\n* Complete set of labels for the flow run",
  "content_length": 13571
}