{
  "title": "Automations",
  "source_url": "https://docs-3.prefect.io/v3/concepts/automations",
  "content": "Learn how to automatically take action in response to events.\n\nAutomations enable you to configure [actions](#actions) that execute automatically based on [trigger](#triggers) conditions.\n\nPotential triggers include the occurrence of events from changes in a flow run's state—or the absence of such events.\nYou can define your own custom trigger to fire based on a custom [event](/v3/concepts/event-triggers/) defined in Python code.\n\nWith Prefect Cloud you can even create [webhooks](/v3/automate/events/webhook-triggers/) that can receive data for use in actions.\n\nActions you can take upon a trigger include:\n\n* creating flow runs from existing deployments\n* pausing and resuming schedules or work pools\n* sending custom notifications\n\n### Triggers\n\nTriggers specify the conditions under which your action should be performed. The Prefect UI includes templates for many\ncommon conditions, such as:\n\n* Flow run state change (Flow Run Tags are only evaluated with `OR` criteria)\n* Work pool status\n* Work queue status\n* Deployment status\n* Metric thresholds, such as average duration, lateness, or completion percentage\n* Custom event triggers\n\nImportantly, you can configure the triggers not only in reaction to events, but also proactively: in the absence of\nan expected event.\n\n<img src=\"https://mintcdn.com/prefect-bd373955/dwD6EJObIjtIzwSC/v3/img/ui/automations-trigger.png?fit=max&auto=format&n=dwD6EJObIjtIzwSC&q=85&s=266fbeea3114360696a4adbc82eeac85\" alt=\"Configuring a trigger for an automation in Prefect Cloud.\" data-og-width=\"1666\" width=\"1666\" data-og-height=\"940\" height=\"940\" data-path=\"v3/img/ui/automations-trigger.png\" data-optimize=\"true\" data-opv=\"3\" srcset=\"https://mintcdn.com/prefect-bd373955/dwD6EJObIjtIzwSC/v3/img/ui/automations-trigger.png?w=280&fit=max&auto=format&n=dwD6EJObIjtIzwSC&q=85&s=c2519e723f59057d06c1435a79fb3f71 280w, https://mintcdn.com/prefect-bd373955/dwD6EJObIjtIzwSC/v3/img/ui/automations-trigger.png?w=560&fit=max&auto=format&n=dwD6EJObIjtIzwSC&q=85&s=2fa993bb8bed63d95a92e3d5fb255f43 560w, https://mintcdn.com/prefect-bd373955/dwD6EJObIjtIzwSC/v3/img/ui/automations-trigger.png?w=840&fit=max&auto=format&n=dwD6EJObIjtIzwSC&q=85&s=8841b66b7ea213ed5314ce7c4d5c1302 840w, https://mintcdn.com/prefect-bd373955/dwD6EJObIjtIzwSC/v3/img/ui/automations-trigger.png?w=1100&fit=max&auto=format&n=dwD6EJObIjtIzwSC&q=85&s=e3de933081548cb30cd12433bf75464f 1100w, https://mintcdn.com/prefect-bd373955/dwD6EJObIjtIzwSC/v3/img/ui/automations-trigger.png?w=1650&fit=max&auto=format&n=dwD6EJObIjtIzwSC&q=85&s=c497962e2a4e6b9dda2ecfc260cb382e 1650w, https://mintcdn.com/prefect-bd373955/dwD6EJObIjtIzwSC/v3/img/ui/automations-trigger.png?w=2500&fit=max&auto=format&n=dwD6EJObIjtIzwSC&q=85&s=febf611557113851b886d74fa0e62ea5 2500w\" />\n\nFor example, in the case of flow run state change triggers, you might expect production flows to finish in no longer\nthan thirty minutes. But transient infrastructure or network issues could cause your flow to get “stuck” in a running state.\nA trigger could kick off an action if the flow stays in a running state for more than 30 minutes.\n\nThis action could be taken on the flow itself, such as cancelling or restarting it. Or the action could take the form of a\nnotification for someone to take manual remediation steps. Or you could set both actions to take place when the trigger occurs.\n\n### Actions\n\nActions specify what your automation does when its trigger criteria are met. Current action types include:\n\n| Action                                                         | Type                    |\n| -------------------------------------------------------------- | ----------------------- |\n| Cancel a flow run                                              | `cancel-flow-run`       |\n| Change the state of a flow run                                 | `change-flow-run-state` |\n| Suspend a flow run                                             | `suspend-flow-run`      |\n| Resume a flow run                                              | `resume-flow-run`       |\n| Run a deployment                                               | `run-deployment`        |\n| Pause a deployment schedule                                    | `pause-deployment`      |\n| Resume a deployment schedule                                   | `resume-deployment`     |\n| Pause a work pool                                              | `pause-work-pool`       |\n| Resume a work pool                                             | `resume-work-pool`      |\n| Pause a work queue                                             | `pause-work-queue`      |\n| Resume a work queue                                            | `resume-work-queue`     |\n| Pause an automation                                            | `pause-automation`      |\n| Resume an automation                                           | `resume-automation`     |\n| Send a [notification](#sending-notifications-with-automations) | `send-notification`     |\n| Call a webhook                                                 | `call-webhook`          |\n\n<img src=\"https://mintcdn.com/prefect-bd373955/ZU4EjeonScNdwFxn/v3/img/ui/automations-action.png?fit=max&auto=format&n=ZU4EjeonScNdwFxn&q=85&s=16439f3f9b1614ab84454c79ccfda359\" alt=\"Configuring an action for an automation in Prefect Cloud.\" data-og-width=\"2471\" width=\"2471\" data-og-height=\"1187\" height=\"1187\" data-path=\"v3/img/ui/automations-action.png\" data-optimize=\"true\" data-opv=\"3\" srcset=\"https://mintcdn.com/prefect-bd373955/ZU4EjeonScNdwFxn/v3/img/ui/automations-action.png?w=280&fit=max&auto=format&n=ZU4EjeonScNdwFxn&q=85&s=51045405c04e0ba544a415cbee5eda94 280w, https://mintcdn.com/prefect-bd373955/ZU4EjeonScNdwFxn/v3/img/ui/automations-action.png?w=560&fit=max&auto=format&n=ZU4EjeonScNdwFxn&q=85&s=530c98618e692d16e8056e15f887931e 560w, https://mintcdn.com/prefect-bd373955/ZU4EjeonScNdwFxn/v3/img/ui/automations-action.png?w=840&fit=max&auto=format&n=ZU4EjeonScNdwFxn&q=85&s=5c6902a7b482a803d869b788768b32ab 840w, https://mintcdn.com/prefect-bd373955/ZU4EjeonScNdwFxn/v3/img/ui/automations-action.png?w=1100&fit=max&auto=format&n=ZU4EjeonScNdwFxn&q=85&s=e9d2121922b0950a257f24381a1d6d78 1100w, https://mintcdn.com/prefect-bd373955/ZU4EjeonScNdwFxn/v3/img/ui/automations-action.png?w=1650&fit=max&auto=format&n=ZU4EjeonScNdwFxn&q=85&s=91ad6e75ced9bcf1385bbde73d247def 1650w, https://mintcdn.com/prefect-bd373955/ZU4EjeonScNdwFxn/v3/img/ui/automations-action.png?w=2500&fit=max&auto=format&n=ZU4EjeonScNdwFxn&q=85&s=66be6db8ec03fec57b38ce6844d1c947 2500w\" />\n\n### Selected and inferred action targets\n\nSome actions require you to either select the target of the action, or specify that the target of the action should be\ninferred. Selected targets are simple and useful for when you know exactly what object your action should act on. For\nexample, the case of a cleanup flow you want to run or a specific notification you want to send.\n\nInferred targets are deduced from the trigger itself.\n\nFor example, if a trigger fires on a flow run that is stuck in a running state, and the action is to cancel an inferred\nflow run—the flow run that caused the trigger to fire.\n\nSimilarly, if a trigger fires on a work queue event and the corresponding action is to pause an inferred work queue, the\ninferred work queue is the one that emitted the event.\n\nPrefect infers the relevant event whenever possible, but sometimes one does not exist.\n\nSpecify a name and, optionally, a description for the automation.\n\n## Sending notifications with automations\n\nAutomations support sending notifications through any predefined block that is capable of and configured\nto send a message, including:\n\n* Slack message to a channel\n* Microsoft Teams message to a channel\n* Email to an email address\n\n<img src=\"https://mintcdn.com/prefect-bd373955/dwD6EJObIjtIzwSC/v3/img/ui/automations-notifications.png?fit=max&auto=format&n=dwD6EJObIjtIzwSC&q=85&s=43a44548667b7a594fff369d8040f54a\" alt=\"Configuring notifications for an automation in Prefect Cloud.\" data-og-width=\"2476\" width=\"2476\" data-og-height=\"1337\" height=\"1337\" data-path=\"v3/img/ui/automations-notifications.png\" data-optimize=\"true\" data-opv=\"3\" srcset=\"https://mintcdn.com/prefect-bd373955/dwD6EJObIjtIzwSC/v3/img/ui/automations-notifications.png?w=280&fit=max&auto=format&n=dwD6EJObIjtIzwSC&q=85&s=869c66eb06cb0e1eaaaa46776ce07e3f 280w, https://mintcdn.com/prefect-bd373955/dwD6EJObIjtIzwSC/v3/img/ui/automations-notifications.png?w=560&fit=max&auto=format&n=dwD6EJObIjtIzwSC&q=85&s=daa37777a7d2d5c106f04646948f11c1 560w, https://mintcdn.com/prefect-bd373955/dwD6EJObIjtIzwSC/v3/img/ui/automations-notifications.png?w=840&fit=max&auto=format&n=dwD6EJObIjtIzwSC&q=85&s=4209224885ed178823e926601d15156e 840w, https://mintcdn.com/prefect-bd373955/dwD6EJObIjtIzwSC/v3/img/ui/automations-notifications.png?w=1100&fit=max&auto=format&n=dwD6EJObIjtIzwSC&q=85&s=9ef49c2864e36c1edae2f2d84972fc53 1100w, https://mintcdn.com/prefect-bd373955/dwD6EJObIjtIzwSC/v3/img/ui/automations-notifications.png?w=1650&fit=max&auto=format&n=dwD6EJObIjtIzwSC&q=85&s=fbaf721f8c4de1887486bf8975524521 1650w, https://mintcdn.com/prefect-bd373955/dwD6EJObIjtIzwSC/v3/img/ui/automations-notifications.png?w=2500&fit=max&auto=format&n=dwD6EJObIjtIzwSC&q=85&s=44104bfd1b6f0fb707f35e7f307d56dd 2500w\" />\n\n## Templating with Jinja\n\nYou can access templated variables with automation actions through [Jinja](https://palletsprojects.com/p/jinja/) syntax.\nTemplated variables enable you to dynamically include details from an automation trigger, such as a flow or pool name.\n\nJinja templated variable syntax wraps the variable name in double curly brackets, like this: `{{ variable }}`.\n\nYou can access properties of the underlying flow run objects including:\n\n* [flow\\_run](https://reference.prefect.io/prefect/server/schemas/core/#prefect.server.schemas.core.FlowRun)\n* [flow](https://reference.prefect.io/prefect/server/schemas/core/#prefect.server.schemas.core.Flow)\n* [deployment](https://reference.prefect.io/prefect/server/schemas/core/#prefect.server.schemas.core.Deployment)\n* [work\\_queue](https://reference.prefect.io/prefect/server/schemas/core/#prefect.server.schemas.core.WorkQueue)\n* [work\\_pool](https://reference.prefect.io/prefect/server/schemas/core/#prefect.server.schemas.core.WorkPool)\n\nIn addition to its native properties, each object includes an `id` along with `created` and `updated` timestamps.\n\nThe `flow_run|ui_url` token returns the URL to view the flow run in the UI.\n\nHere's an example relevant to a flow run state-based notification:\n\n```\nFlow run {{ flow_run.name }} entered state {{ flow_run.state.name }}.\n\n    Timestamp: {{ flow_run.state.timestamp }}\n    Flow ID: {{ flow_run.flow_id }}\n    Flow Run ID: {{ flow_run.id }}\n    State message: {{ flow_run.state.message }}\n```\n\nThe resulting Slack webhook notification looks something like this:\n\n<img src=\"https://mintcdn.com/prefect-bd373955/rT_XiX8cZI7Bzt5c/v3/img/ui/templated-notification.png?fit=max&auto=format&n=rT_XiX8cZI7Bzt5c&q=85&s=d2072752b2ef7111879fd64ffd46c841\" alt=\"Configuring notifications for an automation in Prefect Cloud.\" data-og-width=\"723\" width=\"723\" data-og-height=\"211\" height=\"211\" data-path=\"v3/img/ui/templated-notification.png\" data-optimize=\"true\" data-opv=\"3\" srcset=\"https://mintcdn.com/prefect-bd373955/rT_XiX8cZI7Bzt5c/v3/img/ui/templated-notification.png?w=280&fit=max&auto=format&n=rT_XiX8cZI7Bzt5c&q=85&s=a422ce5bc65b952437ea454101061447 280w, https://mintcdn.com/prefect-bd373955/rT_XiX8cZI7Bzt5c/v3/img/ui/templated-notification.png?w=560&fit=max&auto=format&n=rT_XiX8cZI7Bzt5c&q=85&s=dcc5e01c2f57795ee9f9c94944bb1d31 560w, https://mintcdn.com/prefect-bd373955/rT_XiX8cZI7Bzt5c/v3/img/ui/templated-notification.png?w=840&fit=max&auto=format&n=rT_XiX8cZI7Bzt5c&q=85&s=8dcc506be325b204d8cf9ca18b92abf5 840w, https://mintcdn.com/prefect-bd373955/rT_XiX8cZI7Bzt5c/v3/img/ui/templated-notification.png?w=1100&fit=max&auto=format&n=rT_XiX8cZI7Bzt5c&q=85&s=2fb47409956cca8270df3555aa7bfe2c 1100w, https://mintcdn.com/prefect-bd373955/rT_XiX8cZI7Bzt5c/v3/img/ui/templated-notification.png?w=1650&fit=max&auto=format&n=rT_XiX8cZI7Bzt5c&q=85&s=baba7f5c1fe883f747a21d44fa540d4f 1650w, https://mintcdn.com/prefect-bd373955/rT_XiX8cZI7Bzt5c/v3/img/ui/templated-notification.png?w=2500&fit=max&auto=format&n=rT_XiX8cZI7Bzt5c&q=85&s=2571b9e878befb8c157ac32fa6a9598d 2500w\" />\n\nYou could include `flow` and `deployment` properties:\n\n```\nFlow run {{ flow_run.name }} for flow {{ flow.name }}\nentered state {{ flow_run.state.name }}\nwith message {{ flow_run.state.message }}\n\nFlow tags: {{ flow_run.tags }}\nDeployment name: {{ deployment.name }}\nDeployment version: {{ deployment.version }}\nDeployment parameters: {{ deployment.parameters }}\n```\n\nAn automation that reports on work pool status might include notifications using `work_pool` properties:\n\n```\nWork pool status alert!\n\nName: {{ work_pool.name }}\nLast polled: {{ work_pool.last_polled }}\n```\n\nIn addition to those shortcuts for flows, deployments, and work pools, you have access to the automation and the\nevent that triggered the automation. See the [Automations API](https://app.prefect.cloud/api/docs#tag/Automations)\nfor additional details.\n\n```\nAutomation: {{ automation.name }}\nDescription: {{ automation.description }}\n\nEvent: {{ event.id }}\nResource:\n{% for label, value in event.resource %}\n{{ label }}: {{ value }}\n{% endfor %}\nRelated Resources:\n{% for related in event.related %}\n    Role: {{ related.role }}\n    {% for label, value in related %}\n    {{ label }}: {{ value }}\n    {% endfor %}\n{% endfor %}\n```\n\nNote that this example also illustrates the ability to use Jinja features such as iterator and for loop\n[control structures](https://jinja.palletsprojects.com/en/3.1.x/templates/#list-of-control-structures) when\ntemplating notifications.\n\nFor more on the common use case of passing an upstream flow run's parameters to the flow run invoked by the automation, see the [Passing parameters to a flow run](/v3/how-to-guides/automations/access-parameters-in-templates/) guide.\n\n## Further reading\n\n* To learn more about Prefect events, which can trigger automations, see the [events docs](/v3/concepts/events/).\n* See the [webhooks guide](/v3/how-to-guides/cloud/create-a-webhook/)\n  to learn how to create webhooks and receive external events.",
  "content_length": 14314
}