{
  "title": "alembic_commands",
  "source_url": "https://docs-3.prefect.io/v3/api-ref/python/prefect-server-database-alembic_commands",
  "content": "# `prefect.server.database.alembic_commands`\n\n## Functions\n\n### `with_alembic_lock` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/database/alembic_commands.py#L22\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nwith_alembic_lock(fn: Callable[P, R]) -> Callable[P, R]\n```\n\nDecorator that prevents alembic commands from running concurrently.\nThis is necessary because alembic uses a global configuration object\nthat is not thread-safe.\n\nThis issue occurred in [https://github.com/PrefectHQ/prefect-dask/pull/50](https://github.com/PrefectHQ/prefect-dask/pull/50), where\ndask threads were simultaneously performing alembic upgrades, and causing\ncryptic `KeyError: 'config'` when `del globals_[attr_name]`.\n\n### `alembic_config` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/database/alembic_commands.py#L41\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nalembic_config() -> 'Config'\n```\n\n### `alembic_upgrade` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/database/alembic_commands.py#L54\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nalembic_upgrade(revision: str = 'head', dry_run: bool = False) -> None\n```\n\nRun alembic upgrades on Prefect REST API database\n\n**Args:**\n\n* `revision`: The revision passed to `alembic downgrade`. Defaults to 'head', upgrading all revisions.\n* `dry_run`: Show what migrations would be made without applying them. Will emit sql statements to stdout.\n\n### `alembic_downgrade` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/database/alembic_commands.py#L76\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nalembic_downgrade(revision: str = '-1', dry_run: bool = False) -> None\n```\n\nRun alembic downgrades on Prefect REST API database\n\n**Args:**\n\n* `revision`: The revision passed to `alembic downgrade`. Defaults to 'base', downgrading all revisions.\n* `dry_run`: Show what migrations would be made without applying them. Will emit sql statements to stdout.\n\n### `alembic_revision` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/database/alembic_commands.py#L91\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nalembic_revision(message: Optional[str] = None, autogenerate: bool = False, **kwargs: Any) -> None\n```\n\nCreate a new revision file for the database.\n\n**Args:**\n\n* `message`: string message to apply to the revision.\n* `autogenerate`: whether or not to autogenerate the script from the database.\n\n### `alembic_stamp` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/database/alembic_commands.py#L110\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nalembic_stamp(revision: Union[str, list[str], tuple[str, ...]]) -> None\n```\n\nStamp the revision table with the given revision; don't run any migrations\n\n**Args:**\n\n* `revision`: The revision passed to `alembic stamp`.",
  "content_length": 3274
}