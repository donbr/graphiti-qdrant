{
  "title": "How to pass event payloads to flows",
  "source_url": "https://docs-3.prefect.io/v3/how-to-guides/automations/passing-event-payloads-to-flows",
  "content": "Learn how to pass custom event payload data to flows triggered by automations\n\nWhen you emit custom events with payloads, you can pass that payload data to flows triggered by automations. This is useful for event-driven workflows where external systems or APIs send structured data that your flows need to process.\n\n## Define a flow that accepts payload data\n\nCreate a flow that accepts a dictionary payload:\n\n```python  theme={null}\nfrom typing import Any\n\nfrom prefect import flow\n\n\n@flow(log_prints=True)\ndef process_webhook(payload: dict[str, Any]):\n    \"\"\"Process data from a custom event\"\"\"\n    print(f\"User: {payload.get('user_id')}\")\n    print(f\"Action: {payload.get('action')}\")\n    print(f\"Full payload: {payload}\")\n\n\nif __name__ == \"__main__\":\n    process_webhook.serve(\n        name=\"webhook-processor\",\n        tags=[\"webhook\", \"event-driven\"],\n    )\n```\n\n## Emit a custom event with payload\n\nEmit custom events with structured payloads using the Prefect CLI:\n\n```bash  theme={null}\nprefect event emit api.webhook.received \\\n  --resource-id custom.webhook.handler \\\n  --payload '{\n    \"user_id\": \"123\",\n    \"action\": \"created\",\n    \"resource_type\": \"order\",\n    \"timestamp\": \"2024-01-15T10:30:00Z\"\n  }'\n```\n\nOr using the Python SDK:\n\n```python  theme={null}\nfrom prefect.events import emit_event\n\nemit_event(\n    event=\"api.webhook.received\",\n    resource={\n        \"prefect.resource.id\": \"custom.webhook.handler\",\n        \"prefect.resource.role\": \"api\"\n    },\n    payload={\n        \"user_id\": \"123\",\n        \"action\": \"created\",\n        \"resource_type\": \"order\",\n        \"timestamp\": \"2024-01-15T10:30:00Z\"\n    }\n)\n```\n\n## Configure the automation trigger\n\nCreate a new automation from the Automations page. In the trigger configuration, set it to listen for your custom event. The trigger definition should look like this in the `JSON` tab:\n\n```json  theme={null}\n{\n  \"type\": \"event\",\n  \"match\": {\n    \"prefect.resource.id\": [\n      \"custom.webhook.handler\"\n    ]\n  },\n  \"match_related\": {},\n  \"after\": [],\n  \"expect\": [\n    \"api.webhook.received\"\n  ],\n  \"for_each\": [],\n  \"posture\": \"Reactive\",\n  \"threshold\": 1,\n  \"within\": 0\n}\n```\n\n<Tip>\n  **Finding your custom events**\n\n  You can view all events, including your custom events, in the Event Feed in the Prefect UI. This helps you verify the exact event names and payload structure to use in your automation configuration.\n</Tip>\n\n## Configure the action to pass the payload\n\nAdd a \"Run a deployment\" action and configure it to pass the event payload as a dictionary to your flow.\n\nIn the UI, you'll need to use \"custom JSON\" mode for the `payload` parameter and enter:\n\n```json  theme={null}\n{\n  \"__prefect_kind\": \"json\",\n  \"value\": {\n    \"__prefect_kind\": \"jinja\",\n    \"template\": \"{{ event.payload | tojson }}\"\n  }\n}\n```\n\nThis nested structure:\n\n1. Renders the Jinja template `{{ event.payload | tojson }}` to a JSON string\n2. Automatically parses the JSON string back to a dictionary using the `json` handler\n\nThis allows your flow to receive the payload as a `dict` type rather than a string.\n\n## Define everything in Python\n\nYou can define the flow and trigger entirely in Python using `DeploymentEventTrigger`:\n\n```python event_payload_example.py theme={null}\nfrom typing import Any\n\nfrom prefect import flow, serve\nfrom prefect.events import DeploymentEventTrigger\n\n\n@flow(log_prints=True)\ndef process_webhook(payload: dict[str, Any]):\n    \"\"\"Process data from a custom event\"\"\"\n    print(f\"User: {payload.get('user_id')}\")\n    print(f\"Action: {payload.get('action')}\")\n    print(f\"Full payload: {payload}\")\n\n\nif __name__ == \"__main__\":\n    deployment = process_webhook.to_deployment(\n        name=\"webhook-processor\",\n        triggers=[\n            DeploymentEventTrigger(\n                expect={\"api.webhook.received\"},\n                parameters={\n                    \"payload\": {\n                        \"__prefect_kind\": \"json\",\n                        \"value\": {\n                            \"__prefect_kind\": \"jinja\",\n                            \"template\": \"{{ event.payload | tojson }}\",\n                        }\n                    }\n                },\n            )\n        ],\n    )\n\n    serve(deployment)\n```\n\nStart the serve process:\n\n```bash  theme={null}\npython event_payload_example.py\n```\n\nGet the deployment ID from the output, then emit an event targeting that deployment:\n\n```bash  theme={null}\nprefect event emit api.webhook.received \\\n  --resource-id prefect.deployment.<deployment-id> \\\n  --payload '{\"user_id\": \"123\", \"action\": \"created\", \"resource_type\": \"order\"}'\n```\n\n<Note>\n  **Targeting the deployment**\n\n  When using `DeploymentEventTrigger`, events must target the deployment's resource ID (`prefect.deployment.<deployment-id>`). You can find the deployment ID in the serve output or with `prefect deployment ls`.\n</Note>\n\n## Alternative: Pass individual payload fields\n\nIf you only need specific fields from the payload, you can access them individually using Jinja templates for each parameter:\n\n```python  theme={null}\nfrom prefect import flow, serve\nfrom prefect.events import DeploymentEventTrigger\n\n\n@flow(log_prints=True)\ndef process_webhook(user_id: str, action: str, resource_type: str):\n    \"\"\"Process individual fields from a custom event\"\"\"\n    print(f\"Processing {action} for user {user_id}\")\n    print(f\"Resource type: {resource_type}\")\n\n\nif __name__ == \"__main__\":\n    deployment = process_webhook.to_deployment(\n        name=\"webhook-processor-fields\",\n        triggers=[\n            DeploymentEventTrigger(\n                expect={\"api.webhook.received\"},\n                parameters={\n                    \"user_id\": {\n                        \"__prefect_kind\": \"jinja\",\n                        \"template\": \"{{ event.payload.user_id }}\",\n                    },\n                    \"action\": {\n                        \"__prefect_kind\": \"jinja\",\n                        \"template\": \"{{ event.payload.action }}\",\n                    },\n                    \"resource_type\": {\n                        \"__prefect_kind\": \"jinja\",\n                        \"template\": \"{{ event.payload.resource_type }}\",\n                    },\n                },\n            )\n        ],\n    )\n\n    serve(deployment)\n```\n\nThis approach is useful when your flow expects specific typed parameters (like strings or integers) rather than a generic dictionary. Each field from the event payload is extracted and passed as a separate parameter to your flow.",
  "content_length": 6449
}