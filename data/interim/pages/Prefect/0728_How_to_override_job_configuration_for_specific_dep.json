{
  "title": "How to override job configuration for specific deployments",
  "source_url": "https://docs-3.prefect.io/v3/how-to-guides/deployments/customize-job-variables",
  "content": "Override job variables on a deployment to set environment variables, specify a Docker image, allocate resources, and more.\n\nexport const deployments = {\n  cli: \"https://docs.prefect.io/v3/api-ref/cli/deployment\",\n  api: \"https://app.prefect.cloud/api/docs#tag/Deployments\",\n  tf: \"https://registry.terraform.io/providers/PrefectHQ/prefect/latest/docs/resources/deployment\"\n};\n\nexport const TF = ({name, href}) => <p>You can manage {name} with the <a href={href}>Terraform provider for Prefect</a>.</p>;\n\nThere are two ways to deploy flows to work pools: with a [`prefect.yaml` file](/v3/deploy/infrastructure-concepts/prefect-yaml) or using the [Python `deploy` method](/v3/deploy/infrastructure-concepts/deploy-via-python).\nIn both cases, you can add or override job variables to the work pool's defaults for a given deployment.\nYou can override both a work pool and a deployment when a flow run is triggered.\n\nThis guide explores common patterns for overriding job variables in\nboth deployment methods.\n\n## Job variables\n\nJob variables are infrastructure-related values that are configurable on a work pool.\nYou can override job variables on a per-deployment or\nper-flow run basis. This allows you to dynamically change infrastructure from the work pool's defaults.\n\nFor example, when you create or edit a work pool, you can specify a set of environment variables to set in the\nruntime environment of the flow run.\n\nYou could set the following value in the `env` field of any work pool:\n\n```json  theme={null}\n{\n  \"EXECUTION_ENV\": \"staging\",\n  \"MY_NOT_SO_SECRET_CONFIG\": \"plumbus\",\n}\n```\n\nRather than hardcoding these values into your work pool in the UI (and making them available to all\ndeployments associated with that work pool), you can override these values for a specific deployment.\n\n## Override job variables on a deployment\n\nHere's an example repo structure:\n\n```\n» tree\n.\n|── README.md\n|── requirements.txt\n|── demo_project\n|   |── daily_flow.py\n```\n\nWith a `demo_flow.py` file like:\n\n```python  theme={null}\nimport os\nfrom prefect import flow, task\n\n\n@task\ndef do_something_important(not_so_secret_value: str) -> None:\n    print(f\"Doing something important with {not_so_secret_value}!\")\n\n\n@flow(log_prints=True)\ndef some_work():\n    environment = os.environ.get(\"EXECUTION_ENVIRONMENT\", \"local\")\n    \n    print(f\"Coming to you live from {environment}!\")\n    \n    not_so_secret_value = os.environ.get(\"MY_NOT_SO_SECRET_CONFIG\")\n    \n    if not_so_secret_value is None:\n        raise ValueError(\"You forgot to set MY_NOT_SO_SECRET_CONFIG!\")\n\n    do_something_important(not_so_secret_value)\n```\n\n### Use a `prefect.yaml` file\n\nImagine you have the following deployment definition in a `prefect.yaml` file at the\nroot of your repository:\n\n```yaml  theme={null}\ndeployments:\n- name: demo-deployment\n  entrypoint: demo_project/demo_flow.py:some_work\n  work_pool:\n    name: local\n  schedule: null\n```\n\n<Note>\n  While not the focus of this guide, this deployment definition uses a default \"global\" `pull` step,\n  because one is not explicitly defined on the deployment. For reference, here's what that would look like at\n  the top of the `prefect.yaml` file:\n\n  ```yaml  theme={null}\n  pull:\n  - prefect.deployments.steps.git_clone: &clone_repo\n      repository: https://github.com/some-user/prefect-monorepo\n      branch: main\n  ```\n</Note>\n\n#### Hard-coded job variables\n\nTo provide the `EXECUTION_ENVIRONMENT` and `MY_NOT_SO_SECRET_CONFIG` environment variables to this deployment,\nyou can add a `job_variables` section to your deployment definition in the `prefect.yaml` file:\n\n```yaml  theme={null}\ndeployments:\n- name: demo-deployment\n  entrypoint: demo_project/demo_flow.py:some_work\n  work_pool:\n    name: local\n    job_variables:\n        env:\n            EXECUTION_ENVIRONMENT: staging\n            MY_NOT_SO_SECRET_CONFIG: plumbus\n  schedule: null\n```\n\nThen run `prefect deploy -n demo-deployment` to deploy the flow with these job variables.\n\nYou should see the job variables in the `Configuration` tab of the deployment in the UI:\n\n<img src=\"https://mintcdn.com/prefect-bd373955/rm4-_dTLtkmSX6eG/v3/img/guides/job-variables.png?fit=max&auto=format&n=rm4-_dTLtkmSX6eG&q=85&s=b3ecc9849ed07d1db9e54180aec304e4\" alt=\"Job variables in the UI\" data-og-width=\"473\" width=\"473\" data-og-height=\"206\" height=\"206\" data-path=\"v3/img/guides/job-variables.png\" data-optimize=\"true\" data-opv=\"3\" srcset=\"https://mintcdn.com/prefect-bd373955/rm4-_dTLtkmSX6eG/v3/img/guides/job-variables.png?w=280&fit=max&auto=format&n=rm4-_dTLtkmSX6eG&q=85&s=91569c1fafedd01b7ac2d581cd21bf77 280w, https://mintcdn.com/prefect-bd373955/rm4-_dTLtkmSX6eG/v3/img/guides/job-variables.png?w=560&fit=max&auto=format&n=rm4-_dTLtkmSX6eG&q=85&s=92986256d66ddd5d356e4865b68d96fd 560w, https://mintcdn.com/prefect-bd373955/rm4-_dTLtkmSX6eG/v3/img/guides/job-variables.png?w=840&fit=max&auto=format&n=rm4-_dTLtkmSX6eG&q=85&s=6f0cb3601718a9eea8899eba07f00c6b 840w, https://mintcdn.com/prefect-bd373955/rm4-_dTLtkmSX6eG/v3/img/guides/job-variables.png?w=1100&fit=max&auto=format&n=rm4-_dTLtkmSX6eG&q=85&s=1b5fd58c79e4534fd3558649f8f31041 1100w, https://mintcdn.com/prefect-bd373955/rm4-_dTLtkmSX6eG/v3/img/guides/job-variables.png?w=1650&fit=max&auto=format&n=rm4-_dTLtkmSX6eG&q=85&s=1345895940ec28a661e40ec3290642d4 1650w, https://mintcdn.com/prefect-bd373955/rm4-_dTLtkmSX6eG/v3/img/guides/job-variables.png?w=2500&fit=max&auto=format&n=rm4-_dTLtkmSX6eG&q=85&s=787e717931dc07609b83a6236a652c24 2500w\" />\n\n#### Use existing environment variables\n\nTo use environment variables that are already set in your local environment, you can template\nthese in the `prefect.yaml` file using the `{{ $ENV_VAR_NAME }}` syntax:\n\n```yaml  theme={null}\ndeployments:\n- name: demo-deployment\n  entrypoint: demo_project/demo_flow.py:some_work\n  work_pool:\n    name: local\n    job_variables:\n        env:\n            EXECUTION_ENVIRONMENT: \"{{ $EXECUTION_ENVIRONMENT }}\"\n            MY_NOT_SO_SECRET_CONFIG: \"{{ $MY_NOT_SO_SECRET_CONFIG }}\"\n  schedule: null\n```\n\n<Note>\n  This assumes that the machine where `prefect deploy` is run would have these environment variables set.\n\n  ```bash  theme={null}\n  export EXECUTION_ENVIRONMENT=staging\n  export MY_NOT_SO_SECRET_CONFIG=plumbus\n  ```\n</Note>\n\nRun `prefect deploy -n demo-deployment` to deploy the flow with these job variables,\nand you should see them in the UI under the `Configuration` tab.\n\n### Use the `.deploy()` method\n\nIf you're using the `.deploy()` method to deploy your flow, the process is similar. But instead of\\\n`prefect.yaml` defining the job variables, you can pass them as a dictionary to the `job_variables` argument\nof the `.deploy()` method.\n\nAdd the following block to your `demo_project/daily_flow.py` file from the setup section:\n\n```python  theme={null}\nif __name__ == \"__main__\":\n    flow.from_source(\n        source=\"https://github.com/zzstoatzz/prefect-monorepo.git\",\n        entrypoint=\"src/demo_project/demo_flow.py:some_work\"\n    ).deploy(\n        name=\"demo-deployment\",\n        work_pool_name=\"local\", \n        job_variables={\n            \"env\": {\n                \"EXECUTION_ENVIRONMENT\": os.environ.get(\"EXECUTION_ENVIRONMENT\", \"local\"),\n                \"MY_NOT_SO_SECRET_CONFIG\": os.environ.get(\"MY_NOT_SO_SECRET_CONFIG\")\n            }\n        }\n    )\n```\n\n<Note>\n  The above example works assuming a couple things:\n\n  * the machine where this script is run would have these environment variables set.\n\n  ```bash  theme={null}\n  export EXECUTION_ENVIRONMENT=staging\n  export MY_NOT_SO_SECRET_CONFIG=plumbus\n  ```\n\n  * `demo_project/daily_flow.py` *already exists* in the repository at the specified path\n</Note>\n\nRun the script to deploy the flow with the specified job variables.\n\n```bash  theme={null}\npython demo_project/daily_flow.py\n```\n\nThe job variables should be visible in the UI under the `Configuration` tab.\n\n<img src=\"https://mintcdn.com/prefect-bd373955/rm4-_dTLtkmSX6eG/v3/img/guides/job-variables.png?fit=max&auto=format&n=rm4-_dTLtkmSX6eG&q=85&s=b3ecc9849ed07d1db9e54180aec304e4\" alt=\"Job variables in the UI\" data-og-width=\"473\" width=\"473\" data-og-height=\"206\" height=\"206\" data-path=\"v3/img/guides/job-variables.png\" data-optimize=\"true\" data-opv=\"3\" srcset=\"https://mintcdn.com/prefect-bd373955/rm4-_dTLtkmSX6eG/v3/img/guides/job-variables.png?w=280&fit=max&auto=format&n=rm4-_dTLtkmSX6eG&q=85&s=91569c1fafedd01b7ac2d581cd21bf77 280w, https://mintcdn.com/prefect-bd373955/rm4-_dTLtkmSX6eG/v3/img/guides/job-variables.png?w=560&fit=max&auto=format&n=rm4-_dTLtkmSX6eG&q=85&s=92986256d66ddd5d356e4865b68d96fd 560w, https://mintcdn.com/prefect-bd373955/rm4-_dTLtkmSX6eG/v3/img/guides/job-variables.png?w=840&fit=max&auto=format&n=rm4-_dTLtkmSX6eG&q=85&s=6f0cb3601718a9eea8899eba07f00c6b 840w, https://mintcdn.com/prefect-bd373955/rm4-_dTLtkmSX6eG/v3/img/guides/job-variables.png?w=1100&fit=max&auto=format&n=rm4-_dTLtkmSX6eG&q=85&s=1b5fd58c79e4534fd3558649f8f31041 1100w, https://mintcdn.com/prefect-bd373955/rm4-_dTLtkmSX6eG/v3/img/guides/job-variables.png?w=1650&fit=max&auto=format&n=rm4-_dTLtkmSX6eG&q=85&s=1345895940ec28a661e40ec3290642d4 1650w, https://mintcdn.com/prefect-bd373955/rm4-_dTLtkmSX6eG/v3/img/guides/job-variables.png?w=2500&fit=max&auto=format&n=rm4-_dTLtkmSX6eG&q=85&s=787e717931dc07609b83a6236a652c24 2500w\" />\n\n## Override job variables on a flow run\n\nWhen running flows, you can pass in job variables that override any values set on the work pool or deployment.\nAny interface that runs deployments can accept job variables.\n\n### Use the custom run form in the UI\n\nCustom runs allow you to pass in a dictionary of variables into your flow run infrastructure. Using the same\n`env` example from above, you could do the following:\n\n<img src=\"https://mintcdn.com/prefect-bd373955/dwD6EJObIjtIzwSC/v3/img/ui/deployment-job-variables.png?fit=max&auto=format&n=dwD6EJObIjtIzwSC&q=85&s=17edf6009b61e918e00e22f1a7eeee04\" alt=\"Job variables through custom run\" data-og-width=\"1706\" width=\"1706\" data-og-height=\"997\" height=\"997\" data-path=\"v3/img/ui/deployment-job-variables.png\" data-optimize=\"true\" data-opv=\"3\" srcset=\"https://mintcdn.com/prefect-bd373955/dwD6EJObIjtIzwSC/v3/img/ui/deployment-job-variables.png?w=280&fit=max&auto=format&n=dwD6EJObIjtIzwSC&q=85&s=33a71fbd969a167370632458233cf731 280w, https://mintcdn.com/prefect-bd373955/dwD6EJObIjtIzwSC/v3/img/ui/deployment-job-variables.png?w=560&fit=max&auto=format&n=dwD6EJObIjtIzwSC&q=85&s=d375f2d8cca8bf71f6763f64a57fcaa0 560w, https://mintcdn.com/prefect-bd373955/dwD6EJObIjtIzwSC/v3/img/ui/deployment-job-variables.png?w=840&fit=max&auto=format&n=dwD6EJObIjtIzwSC&q=85&s=8cc216884c1cac68182749f165fbf61a 840w, https://mintcdn.com/prefect-bd373955/dwD6EJObIjtIzwSC/v3/img/ui/deployment-job-variables.png?w=1100&fit=max&auto=format&n=dwD6EJObIjtIzwSC&q=85&s=d1e2edf85292072f923779f28b4acb52 1100w, https://mintcdn.com/prefect-bd373955/dwD6EJObIjtIzwSC/v3/img/ui/deployment-job-variables.png?w=1650&fit=max&auto=format&n=dwD6EJObIjtIzwSC&q=85&s=c95a4260e3d37a9f4474cb6ab1e9e19f 1650w, https://mintcdn.com/prefect-bd373955/dwD6EJObIjtIzwSC/v3/img/ui/deployment-job-variables.png?w=2500&fit=max&auto=format&n=dwD6EJObIjtIzwSC&q=85&s=6e1dc83da40330f6d26170fb0ad30792 2500w\" />\n\n### Use the CLI\n\nSimilarly, runs kicked off through the CLI accept job variables with the `-jv` or `--job-variable` flag.\n\n```bash  theme={null}\nprefect deployment run \\\n  --id \"fb8e3073-c449-474b-b993-851fe5e80e53\" \\\n  --job-variable MY_NEW_ENV_VAR=42 \\\n  --job-variable HELLO=THERE\n```\n\n### Use job variables in Terraform\n\n<TF name=\"job variables\" href={deployments.tf} />\n\n### Use job variables in automations\n\nAdditionally, runs kicked off through automation actions can use job variables, including ones rendered from Jinja\ntemplates.\n\n<img src=\"https://mintcdn.com/prefect-bd373955/ZU4EjeonScNdwFxn/v3/img/ui/automations-action-job-variable.png?fit=max&auto=format&n=ZU4EjeonScNdwFxn&q=85&s=9d5df018b5b779875fdb8cba644b2562\" alt=\"Job variables through automation action\" data-og-width=\"1705\" width=\"1705\" data-og-height=\"642\" height=\"642\" data-path=\"v3/img/ui/automations-action-job-variable.png\" data-optimize=\"true\" data-opv=\"3\" srcset=\"https://mintcdn.com/prefect-bd373955/ZU4EjeonScNdwFxn/v3/img/ui/automations-action-job-variable.png?w=280&fit=max&auto=format&n=ZU4EjeonScNdwFxn&q=85&s=683e581ec64629ed0a068aaa8195b005 280w, https://mintcdn.com/prefect-bd373955/ZU4EjeonScNdwFxn/v3/img/ui/automations-action-job-variable.png?w=560&fit=max&auto=format&n=ZU4EjeonScNdwFxn&q=85&s=1af86bcbc49a19f81837378757dda354 560w, https://mintcdn.com/prefect-bd373955/ZU4EjeonScNdwFxn/v3/img/ui/automations-action-job-variable.png?w=840&fit=max&auto=format&n=ZU4EjeonScNdwFxn&q=85&s=3bda51f8e6ea6753fe61a41918d26067 840w, https://mintcdn.com/prefect-bd373955/ZU4EjeonScNdwFxn/v3/img/ui/automations-action-job-variable.png?w=1100&fit=max&auto=format&n=ZU4EjeonScNdwFxn&q=85&s=a26e7577f2504e99e3afe4e4678a7802 1100w, https://mintcdn.com/prefect-bd373955/ZU4EjeonScNdwFxn/v3/img/ui/automations-action-job-variable.png?w=1650&fit=max&auto=format&n=ZU4EjeonScNdwFxn&q=85&s=f0e2d11fd53ddad91a98a735a00b9a89 1650w, https://mintcdn.com/prefect-bd373955/ZU4EjeonScNdwFxn/v3/img/ui/automations-action-job-variable.png?w=2500&fit=max&auto=format&n=ZU4EjeonScNdwFxn&q=85&s=8b2e068217dc8a5812a6c19a300a3322 2500w\" />",
  "content_length": 13305
}