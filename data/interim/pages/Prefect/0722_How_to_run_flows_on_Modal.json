{
  "title": "How to run flows on Modal",
  "source_url": "https://docs-3.prefect.io/v3/how-to-guides/deployment_infra/modal",
  "content": "Learn how to use Modal as a push work pool to schedule, run, and debug your Prefect flows\n\nPrefect is the world's best orchestrator.\nModal is the world's best serverless compute framework.\nIt only makes sense that they would fit together perfectly.\n\nIn this tutorial, you'll build your first Prefect deployment that runs on Modal every hour, and create a scalable framework to grow your project.\n\nHere's an architecture diagram which shows what you'll build.\n\n<img src=\"https://mintcdn.com/prefect-bd373955/ZU4EjeonScNdwFxn/v3/img/tutorials/modal/0.png?fit=max&auto=format&n=ZU4EjeonScNdwFxn&q=85&s=4a4e18e1bc8d72a7e70443c7c52dba23\" alt=\"image.png\" data-og-width=\"741\" width=\"741\" data-og-height=\"677\" height=\"677\" data-path=\"v3/img/tutorials/modal/0.png\" data-optimize=\"true\" data-opv=\"3\" srcset=\"https://mintcdn.com/prefect-bd373955/ZU4EjeonScNdwFxn/v3/img/tutorials/modal/0.png?w=280&fit=max&auto=format&n=ZU4EjeonScNdwFxn&q=85&s=1d4079a8bbd00d84f53c5e7828de774f 280w, https://mintcdn.com/prefect-bd373955/ZU4EjeonScNdwFxn/v3/img/tutorials/modal/0.png?w=560&fit=max&auto=format&n=ZU4EjeonScNdwFxn&q=85&s=4adb16c8ed49598d7c0f84e19bc436eb 560w, https://mintcdn.com/prefect-bd373955/ZU4EjeonScNdwFxn/v3/img/tutorials/modal/0.png?w=840&fit=max&auto=format&n=ZU4EjeonScNdwFxn&q=85&s=3685e0064c4dfb5ccd388e7b100bc19f 840w, https://mintcdn.com/prefect-bd373955/ZU4EjeonScNdwFxn/v3/img/tutorials/modal/0.png?w=1100&fit=max&auto=format&n=ZU4EjeonScNdwFxn&q=85&s=c4f61b69e53770c507493312b09b1f1a 1100w, https://mintcdn.com/prefect-bd373955/ZU4EjeonScNdwFxn/v3/img/tutorials/modal/0.png?w=1650&fit=max&auto=format&n=ZU4EjeonScNdwFxn&q=85&s=1ba7b78f440d2815c0334ad2a7ed1a05 1650w, https://mintcdn.com/prefect-bd373955/ZU4EjeonScNdwFxn/v3/img/tutorials/modal/0.png?w=2500&fit=max&auto=format&n=ZU4EjeonScNdwFxn&q=85&s=0b1876b858a9baa43934039d1268b7b5 2500w\" />\n\nYou'll build a full serverless infrastructure framework for scheduling and provisioning workflows.\nGitHub will act as the source of truth, Prefect will be the orchestrator, and Modal will be the serverless infrastructure.\nYou'll only pay for the Modal CPU time you use.\n\nFirst, here's a recap of some important terms:\n\n| Term         | Definition                                                                                                                                                                       |\n| ------------ | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |\n| *Flow*       | A Python function in a file, decorated with `@flow`, that is an entrypoint to perform a task in Prefect.                                                                         |\n| *Run*        | An instance of a flow, executed at a specific time with a specific payload.                                                                                                      |\n| *Deployment* | A manifest around a flow, including where it should run, when it should run, and any variables it needs to run. A deployment can schedule your flows, creating runs when needed. |\n| *Work Pool*  | An interface to the hardware used to run a given flow.                                                                                                                           |\n\n## Prerequisites\n\n* A free [Prefect Cloud](https://app.prefect.cloud/auth/sign-in) account.\n* A free [Modal](https://modal.com/signup?next=%2Fapps) account.\n\n## Create a GitHub repository\n\nCreate a GitHub repository containing your Prefect flows.\nYou can reference the [Ben-Epstein/prefect-modal](https://github.com/Ben-Epstein/prefect-modal) repository for a complete example.\nYour repository should have a `prefect.yaml` deployment configuration file, standard Python tooling, and CI/CD.\n\n1. Start by creating the following `Makefile` to keep things easy:\n\n   ```makefile Makefile theme={null}\n   export PYTHONPATH = .venv\n\n   .PHONY: uv\n   uv:\n     pip install --upgrade 'uv>=0.5.6,<0.6'\n     uv venv\n\n   setup:\n     @if [ ! -d \".venv\" ] || ! command -v uv > /dev/null; then \\\n       echo \"UV not installed or .venv does not exist, running uv\"; \\\n       make uv; \\\n     fi\n     @if [ ! -f \"uv.lock\" ]; then \\\n       echo \"Can't find lockfile. Locking\"; \\\n       uv lock; \\\n     fi\n     uv sync --all-extras --all-groups\n     uv pip install --no-deps -e .\n   ```\n\n2. Set up and manage your environment with `uv`.\n\n   ```bash  theme={null}\n   make setup\n   ```\n\n3. Create your Python project.\n\n   ```bash  theme={null}\n   uv init --lib --name prefect_modal --python 3.12\n   ```\n\n   <Info>\n     If `uv` creates a `python-version` that is pinned to a micro version (for example, 3.12.6), remove the micro version (for example, 3.12) to avoid downstream issues.\n   </Info>\n\n4. Add your dependencies:\n\n   ```bash  theme={null}\n   uv add modal 'prefect[github]'\n   ```\n\n5. Add the following to the end of the `pyproject.toml` file created by `uv`:\n\n   ```makefile  theme={null}\n   [tool.hatch.build.targets.wheel]\n   packages = [\"src/prefect_modal\"]\n   ```\n\n6. Initialize the Prefect environment:\n\n   ```bash  theme={null}\n   uv run prefect init\n   ```\n\n   You will be prompted to choose your code storage; select `git` to store code within a git repository.\n\n   <img src=\"https://mintcdn.com/prefect-bd373955/ZU4EjeonScNdwFxn/v3/img/tutorials/modal/1.png?fit=max&auto=format&n=ZU4EjeonScNdwFxn&q=85&s=3998fff07e902af8b6bc8539593bce2e\" alt=\"image.png\" data-og-width=\"1012\" width=\"1012\" data-og-height=\"223\" height=\"223\" data-path=\"v3/img/tutorials/modal/1.png\" data-optimize=\"true\" data-opv=\"3\" srcset=\"https://mintcdn.com/prefect-bd373955/ZU4EjeonScNdwFxn/v3/img/tutorials/modal/1.png?w=280&fit=max&auto=format&n=ZU4EjeonScNdwFxn&q=85&s=c40db62770bb19fc82af916649519620 280w, https://mintcdn.com/prefect-bd373955/ZU4EjeonScNdwFxn/v3/img/tutorials/modal/1.png?w=560&fit=max&auto=format&n=ZU4EjeonScNdwFxn&q=85&s=0b88362bb029a8bed5a11eeef22ab89e 560w, https://mintcdn.com/prefect-bd373955/ZU4EjeonScNdwFxn/v3/img/tutorials/modal/1.png?w=840&fit=max&auto=format&n=ZU4EjeonScNdwFxn&q=85&s=dd360472072e35b16f57974f1e60ad5c 840w, https://mintcdn.com/prefect-bd373955/ZU4EjeonScNdwFxn/v3/img/tutorials/modal/1.png?w=1100&fit=max&auto=format&n=ZU4EjeonScNdwFxn&q=85&s=6d5e6b8fa00b13be84ac36d2bc050f47 1100w, https://mintcdn.com/prefect-bd373955/ZU4EjeonScNdwFxn/v3/img/tutorials/modal/1.png?w=1650&fit=max&auto=format&n=ZU4EjeonScNdwFxn&q=85&s=1af2c7cc3000444608c9070e928f254f 1650w, https://mintcdn.com/prefect-bd373955/ZU4EjeonScNdwFxn/v3/img/tutorials/modal/1.png?w=2500&fit=max&auto=format&n=ZU4EjeonScNdwFxn&q=85&s=b3fddb39729eedb5bc44a76bda0bbe15 2500w\" />\n\n7. Because this is meant to be a scalable repository, create a submodule just for your workflows.\n\n   ```bash  theme={null}\n   mkdir src/prefect_modal/flows\n   touch src/prefect_modal/flows/__init__.py\n   ```\n\nNow that your repository is set up, take a look at the `prefect.yaml` file that you generated.\n\n```yaml prefect.yaml theme={null}\n# Welcome to your prefect.yaml file! You can use this file for storing and managing\n# configuration for deploying your flows. We recommend committing this file to source\n# control along with your flow code.\n\n# Generic metadata about this project\nname: prefect-modal\nprefect-version: 3.1.15\n\n# build section allows you to manage and build docker images\nbuild: null\n\n# push section allows you to manage if and how this project is uploaded to remote locations\npush: null\n\n# pull section allows you to provide instructions for cloning this project in remote locations\npull:\n- prefect.deployments.steps.git_clone:\n    repository: https://github.com/Ben-Epstein/prefect-modal\n    branch: main\n    access_token: null\n\n# the deployments section allows you to provide configuration for deploying flows\ndeployments:\n- name: null\n  version: null\n  tags: []\n  description: null\n  schedule: {}\n  flow_name: null\n  entrypoint: null\n  parameters: {}\n  work_pool:\n    name: null\n    work_queue_name: null\n    job_variables: {}\n```\n\nThe important sections here are `pull`, which defines the repository and branch to pull from, as well as `deployments`, which define the `flows` that will be `run` at some `schedule` on a `work_pool`.\nThe work pool will be set to modal later in this tutorial.\n\nFinally, create your flow.\n\n```bash  theme={null}\ntouch src/prefect_modal/flows/flow1.py\n```\n\nYou can do anything in your flow, but use the following code to keep it simple.\n\n```python src/prefect_modal/flows/flow1.py theme={null}\nfrom prefect import flow, task\n\n@task()\ndef do_print(param: str) -> None:\n    print(\"Doing the task\")\n    print(param)\n\n@flow(log_prints=True)\ndef run_my_flow(param: str) -> None:\n    print(\"flow 2\")\n    do_print(param)\n\n@flow(log_prints=True)\ndef main(name: str = \"world\", goodbye: bool = False):\n    print(f\"Hello {name} from Prefect! ðŸ¤—\")\n    run_my_flow(name)\n    if goodbye:\n        print(f\"Goodbye {name}!\")\n```\n\n## Give Prefect access to your GitHub repository\n\nFirst, authenticate to Prefect Cloud.\n\n```bash  theme={null}\nuv run prefect cloud login\n```\n\nYou'll need a Personal Access Token (PAT) for authentication.\nFor simplicity, use a classic token, but you can configure a fine-grained token if you want.\n\nIn GitHub, go to [Personal access tokens](https://github.com/settings/tokens) and click **Generate new token (classic)**.\n\n<img src=\"https://mintcdn.com/prefect-bd373955/ZU4EjeonScNdwFxn/v3/img/tutorials/modal/2.png?fit=max&auto=format&n=ZU4EjeonScNdwFxn&q=85&s=7c14394650d398bd359d940cea743757\" alt=\"image.png\" data-og-width=\"1384\" width=\"1384\" data-og-height=\"800\" height=\"800\" data-path=\"v3/img/tutorials/modal/2.png\" data-optimize=\"true\" data-opv=\"3\" srcset=\"https://mintcdn.com/prefect-bd373955/ZU4EjeonScNdwFxn/v3/img/tutorials/modal/2.png?w=280&fit=max&auto=format&n=ZU4EjeonScNdwFxn&q=85&s=c8c9a9bbca21bec91dd30ea9faff451a 280w, https://mintcdn.com/prefect-bd373955/ZU4EjeonScNdwFxn/v3/img/tutorials/modal/2.png?w=560&fit=max&auto=format&n=ZU4EjeonScNdwFxn&q=85&s=848dad8856a06e2b23320990f7260c63 560w, https://mintcdn.com/prefect-bd373955/ZU4EjeonScNdwFxn/v3/img/tutorials/modal/2.png?w=840&fit=max&auto=format&n=ZU4EjeonScNdwFxn&q=85&s=e0084c907d313c94dcea4fda1f99bc31 840w, https://mintcdn.com/prefect-bd373955/ZU4EjeonScNdwFxn/v3/img/tutorials/modal/2.png?w=1100&fit=max&auto=format&n=ZU4EjeonScNdwFxn&q=85&s=8d35c97333b1cafb366fc84ca40a5d31 1100w, https://mintcdn.com/prefect-bd373955/ZU4EjeonScNdwFxn/v3/img/tutorials/modal/2.png?w=1650&fit=max&auto=format&n=ZU4EjeonScNdwFxn&q=85&s=bcca026a217e348b2f7fbd390dbd2ae3 1650w, https://mintcdn.com/prefect-bd373955/ZU4EjeonScNdwFxn/v3/img/tutorials/modal/2.png?w=2500&fit=max&auto=format&n=ZU4EjeonScNdwFxn&q=85&s=05b53933cc5d93bdeefd4ce8967d84f6 2500w\" />\n\nGive the token a name, an expiration date, and repository access.\n\n<img src=\"https://mintcdn.com/prefect-bd373955/ZU4EjeonScNdwFxn/v3/img/tutorials/modal/3.png?fit=max&auto=format&n=ZU4EjeonScNdwFxn&q=85&s=d5961a522ab8264b6cd2268731364fae\" alt=\"image.png\" data-og-width=\"653\" width=\"653\" data-og-height=\"429\" height=\"429\" data-path=\"v3/img/tutorials/modal/3.png\" data-optimize=\"true\" data-opv=\"3\" srcset=\"https://mintcdn.com/prefect-bd373955/ZU4EjeonScNdwFxn/v3/img/tutorials/modal/3.png?w=280&fit=max&auto=format&n=ZU4EjeonScNdwFxn&q=85&s=21110b7f8d32fdb4318cd5519b9b1822 280w, https://mintcdn.com/prefect-bd373955/ZU4EjeonScNdwFxn/v3/img/tutorials/modal/3.png?w=560&fit=max&auto=format&n=ZU4EjeonScNdwFxn&q=85&s=61b04b994c186ff7c440f6d4262a1a87 560w, https://mintcdn.com/prefect-bd373955/ZU4EjeonScNdwFxn/v3/img/tutorials/modal/3.png?w=840&fit=max&auto=format&n=ZU4EjeonScNdwFxn&q=85&s=e9ee414967d5d81bbf0d410426bcfc61 840w, https://mintcdn.com/prefect-bd373955/ZU4EjeonScNdwFxn/v3/img/tutorials/modal/3.png?w=1100&fit=max&auto=format&n=ZU4EjeonScNdwFxn&q=85&s=1a6402d296bc04831ccebe50c9ce6db9 1100w, https://mintcdn.com/prefect-bd373955/ZU4EjeonScNdwFxn/v3/img/tutorials/modal/3.png?w=1650&fit=max&auto=format&n=ZU4EjeonScNdwFxn&q=85&s=c55a601936c13eb6616a060120199bb9 1650w, https://mintcdn.com/prefect-bd373955/ZU4EjeonScNdwFxn/v3/img/tutorials/modal/3.png?w=2500&fit=max&auto=format&n=ZU4EjeonScNdwFxn&q=85&s=c626233c5f16764c1561632a3a87b143 2500w\" />\n\nOnce you've created the token, copy it and give it to Prefect.\nFirst, run:\n\n```bash  theme={null}\n# Register the block\nuv run prefect block register -m prefect_github\n\n# Create the block\nuv run prefect block create prefect_github\n```\n\nThe second command returns a URL.\nClick that URL to give your block a name and paste in the token you got from GitHub.\nName the block `prefect-modal`.\n\nIn `prefect.yaml`, edit the `pull:` section as follows:\n\n```yaml  theme={null}\npull:\n- prefect.deployments.steps.git_clone:\n    id: clone-step\n    repository: https://github.com/Ben-Epstein/prefect-modal\n    branch: main\n    credentials: '{{ prefect.blocks.github-credentials.prefect-modal }}'\n```\n\n* Replace the `access_token` key name with `credentials`.\n* Change the repository name to the name of your repository.\n\nNow, add the following section to configure how you install your package and what your working directory is:\n\n```yaml  theme={null}\n- prefect.deployments.steps.run_shell_script:\n    directory: '{{ clone-step.directory }}'\n    script: pip install --upgrade 'uv>=0.5.6,<0.6'\n- prefect.deployments.steps.run_shell_script:\n    directory: '{{ clone-step.directory }}'\n    script: uv sync --no-editable --no-dev\n```\n\n<Info>\n  Typically, `uv sync` creates a new virtual environment.\n  The following steps show how to tell `uv` to use the root Python version.\n</Info>\n\nThis configuration tells Prefect how to download the code from GitHub into the Modal pod before running the flow.\nThis is important: you are telling Modal to load the code from `main`.\nThis means that if you push new code to main, the next run of a flow in Modal will change to whatever is in main.\nTo keep this stable, you can set that to a release branch, for example, to only update that release branch when youâ€™re stable and ready.\n\nNow, configure a few more options on the `deployment` to get it ready: `entrypoint`, `schedule`, and `description`.\n\n```yaml  theme={null}\n  name: prefect-modal-example\n  description: \"Your first deployment which runs daily at 12:00 on Modal\"\n  entrypoint: prefect_modal.flows.flow1:main\n  schedules:\n  - cron: '0 12 * * *'\n    timezone: America/New_York\n    active: true\n```\n\nThis schedule runs once a day at 12PM EST.\nYou can add another schedule by adding another list element.\n\n<Info>\n  Because you referenced the entrypoint as a module and not a path, you can call it from anywhere (as long as itâ€™s installed).\n  This is much more flexible.\n</Info>\n\n## Connect Prefect and Modal\n\nYou need to give Prefect access to your Modal account to provision a serverless instance to run your flows and tasks.\nModal will be the *Work Pool* in Prefect terms, remaining off when unused, and spinning up the infrastructure you need when a new flow run is scheduled.\nPrefect makes this incredibly easy.\n\nFirst, authenticate with Modal:\n\n```bash  theme={null}\nuv run modal setup\n```\n\nNext, create a token:\n\n```bash  theme={null}\nuv run modal token new\n```\n\nFinally, create a work pool:\n\n```bash  theme={null}\nuv run prefect work-pool create --type modal:push --provision-infra pref-modal-pool\n```\n\nThe name `pref-modal-pool` in the last command is custom, you can name it whatever you want.\nTake the work pool name and update your `prefect.yaml` file with it.\n\n```yaml prefect.yaml {2} theme={null}\n...\nwork_pool:\n    name: \"pref-modal-pool\"\n    work_queue_name: \"default\"\n    job_variables: {\n        \"env\": {\"UV_PROJECT_ENVIRONMENT\": \"/usr/local\"}\n    }\n```\n\n<Info>\n  This `UV_PROJECT_ENVIRONMENT` is how you tell uv to use the root python.\n  You could `pip install` without `uv` but it would be significantly slower (minutes instead of seconds) and you can't leverage your lockfile, resulting in unexpected behavior!\n</Info>\n\nYou can create multiple work queues across the same pool (for example, if you have another job using this pool).\nMultiple work queues let you handle concurrency and swim-lane priorities.\nTo keep things simple, this tutorial will use the the default queue name that comes with every new pool.\n\nWhen you deploy to Prefect, it will know to schedule all of the flow runs for this particular deployment on your modal work pool!\n\nAt this point, you could `git add . && git commit -m \"prefect modal\" && git push` to get your code into GitHub, and then `uv run prefect deploy --all` to get your deployment live.\nBut first, learn how to automate Prefect deployments.\n\n## Configure CI/CD\n\nSince the code must exist in GitHub in order for Modal to download, install, and run it, GitHub should also be the source of truth for telling Prefect what to do with the code.\n\nFirst, create two secrets to add to the GitHub repository: `PREFECT_API_KEY` and `PREFECT_API_URL`.\n\n1. For `PREFECT_API_URL`, the format is as follows: `https://api.prefect.cloud/api/accounts/{account_id}/workspaces/{workspace_id}`.\n\n   Go to the Prefect Cloud Dashboard, and then extract the account ID and workspace ID from the URL.\n\n   <Note>\n     The Prefect console URL uses `/account` and `/workspace` but the API uses `/accounts` and `/workspaces`, respectively.\n   </Note>\n\n2. For `PREFECT_API_KEY`, go to the [API keys](https://app.prefect.cloud/my/api-keys) page and create a new API key.\n\n   <img src=\"https://mintcdn.com/prefect-bd373955/ZU4EjeonScNdwFxn/v3/img/tutorials/modal/4.png?fit=max&auto=format&n=ZU4EjeonScNdwFxn&q=85&s=22db8bb67f9faa3f051f6a22994685ed\" alt=\"image.png\" data-og-width=\"511\" width=\"511\" data-og-height=\"354\" height=\"354\" data-path=\"v3/img/tutorials/modal/4.png\" data-optimize=\"true\" data-opv=\"3\" srcset=\"https://mintcdn.com/prefect-bd373955/ZU4EjeonScNdwFxn/v3/img/tutorials/modal/4.png?w=280&fit=max&auto=format&n=ZU4EjeonScNdwFxn&q=85&s=2e16527daf99adc6deff582a24c2b5a7 280w, https://mintcdn.com/prefect-bd373955/ZU4EjeonScNdwFxn/v3/img/tutorials/modal/4.png?w=560&fit=max&auto=format&n=ZU4EjeonScNdwFxn&q=85&s=b3a0a98419e53487265c63898b100dfe 560w, https://mintcdn.com/prefect-bd373955/ZU4EjeonScNdwFxn/v3/img/tutorials/modal/4.png?w=840&fit=max&auto=format&n=ZU4EjeonScNdwFxn&q=85&s=5e6322f22464f88d4189b1f915e06b6a 840w, https://mintcdn.com/prefect-bd373955/ZU4EjeonScNdwFxn/v3/img/tutorials/modal/4.png?w=1100&fit=max&auto=format&n=ZU4EjeonScNdwFxn&q=85&s=f3e8fa2f401bf17cad6f95b90410f4d1 1100w, https://mintcdn.com/prefect-bd373955/ZU4EjeonScNdwFxn/v3/img/tutorials/modal/4.png?w=1650&fit=max&auto=format&n=ZU4EjeonScNdwFxn&q=85&s=59db06f4b15a98145901381e7dbc84cd 1650w, https://mintcdn.com/prefect-bd373955/ZU4EjeonScNdwFxn/v3/img/tutorials/modal/4.png?w=2500&fit=max&auto=format&n=ZU4EjeonScNdwFxn&q=85&s=3495367f284b2fc4f1ecd3fe2c83b976 2500w\" />\n\nGo to your repository, and then **Settings** / **Secrets and variables** / **Actions**.\n\n<img src=\"https://mintcdn.com/prefect-bd373955/ZU4EjeonScNdwFxn/v3/img/tutorials/modal/5.png?fit=max&auto=format&n=ZU4EjeonScNdwFxn&q=85&s=67f61f7362368a8fd4b163590e227bf3\" alt=\"image.png\" data-og-width=\"1204\" width=\"1204\" data-og-height=\"813\" height=\"813\" data-path=\"v3/img/tutorials/modal/5.png\" data-optimize=\"true\" data-opv=\"3\" srcset=\"https://mintcdn.com/prefect-bd373955/ZU4EjeonScNdwFxn/v3/img/tutorials/modal/5.png?w=280&fit=max&auto=format&n=ZU4EjeonScNdwFxn&q=85&s=bb0305ee93925cb0fb6da563361b8414 280w, https://mintcdn.com/prefect-bd373955/ZU4EjeonScNdwFxn/v3/img/tutorials/modal/5.png?w=560&fit=max&auto=format&n=ZU4EjeonScNdwFxn&q=85&s=a5fffa73a8ecdfa4fd9e3d28a3ded5b8 560w, https://mintcdn.com/prefect-bd373955/ZU4EjeonScNdwFxn/v3/img/tutorials/modal/5.png?w=840&fit=max&auto=format&n=ZU4EjeonScNdwFxn&q=85&s=b246fd2d72d44056de270b428c82df9c 840w, https://mintcdn.com/prefect-bd373955/ZU4EjeonScNdwFxn/v3/img/tutorials/modal/5.png?w=1100&fit=max&auto=format&n=ZU4EjeonScNdwFxn&q=85&s=0354774da5134118424df893a138408e 1100w, https://mintcdn.com/prefect-bd373955/ZU4EjeonScNdwFxn/v3/img/tutorials/modal/5.png?w=1650&fit=max&auto=format&n=ZU4EjeonScNdwFxn&q=85&s=d27b4e3cb16d6cb4ccce6abf8e15123f 1650w, https://mintcdn.com/prefect-bd373955/ZU4EjeonScNdwFxn/v3/img/tutorials/modal/5.png?w=2500&fit=max&auto=format&n=ZU4EjeonScNdwFxn&q=85&s=86140a751a53a1df53225daa2012dd07 2500w\" />\n\nClick **New repository secret** to add these secrets to your GitHub repository.\n\nNow, add a simple GitHub workflow.\nCreate a new folder in the root of your GitHub repository:\n\n```bash  theme={null}\nmkdir -p .github/workflows\n```\n\nCreate a workflow file.\n\n```bash  theme={null}\ntouch .github/workflows/prefect_cd.yaml\n```\n\nAdd the following code to this workflow.\n\n```yaml .github/workflows/prefect_cd.yaml theme={null}\nname: Deploy Prefect flow\n\non:\n  push:\n    branches:\n      - main\n\njobs:\n  deploy:\n    name: Deploy\n    runs-on: ubuntu-latest\n\n    steps:\n      - name: Checkout\n        uses: actions/checkout@v4\n\n      - name: Setup Python\n        uses: actions/setup-python@v5\n        with:\n          python-version: \"3.12\"\n\n      - name: Prefect Deploy\n        env:\n          PREFECT_API_KEY: ${{ secrets.PREFECT_API_KEY }}\n          PREFECT_API_URL: ${{ secrets.PREFECT_API_URL }}\n        run: |\n          make prefect-deploy\n\n```\n\nThe `make prefect-deploy` command is used to deploy the flows in your deployment.\n\n<Tip>\n  You can run `make prefect-deploy` locally at any time to keep your deployment up to date.\n</Tip>\n\nAdd the following command to your `Makefile`.\n\n```makefile Makefile theme={null}\nprefect-deploy: setup\n    uv run prefect deploy --prefect-file prefect.yaml --all\n```\n\nBefore pushing your code, run `make prefect-deploy` once to make sure everything works.\nPrefect will suggest changes to `prefect.yaml`, which you should accept.\n\n<img src=\"https://mintcdn.com/prefect-bd373955/ZU4EjeonScNdwFxn/v3/img/tutorials/modal/6.png?fit=max&auto=format&n=ZU4EjeonScNdwFxn&q=85&s=e64a05a860e344c8c79a102b819569fe\" alt=\"image.png\" data-og-width=\"1546\" width=\"1546\" data-og-height=\"373\" height=\"373\" data-path=\"v3/img/tutorials/modal/6.png\" data-optimize=\"true\" data-opv=\"3\" srcset=\"https://mintcdn.com/prefect-bd373955/ZU4EjeonScNdwFxn/v3/img/tutorials/modal/6.png?w=280&fit=max&auto=format&n=ZU4EjeonScNdwFxn&q=85&s=1cf1e88bf279278652f9b9072e8e2139 280w, https://mintcdn.com/prefect-bd373955/ZU4EjeonScNdwFxn/v3/img/tutorials/modal/6.png?w=560&fit=max&auto=format&n=ZU4EjeonScNdwFxn&q=85&s=40beebf67e9c9f44ab61de9dd69831ac 560w, https://mintcdn.com/prefect-bd373955/ZU4EjeonScNdwFxn/v3/img/tutorials/modal/6.png?w=840&fit=max&auto=format&n=ZU4EjeonScNdwFxn&q=85&s=62e3a0d1289f090f21a6c67181dbf762 840w, https://mintcdn.com/prefect-bd373955/ZU4EjeonScNdwFxn/v3/img/tutorials/modal/6.png?w=1100&fit=max&auto=format&n=ZU4EjeonScNdwFxn&q=85&s=3383e77bd26ebe69c7de24154fb24df3 1100w, https://mintcdn.com/prefect-bd373955/ZU4EjeonScNdwFxn/v3/img/tutorials/modal/6.png?w=1650&fit=max&auto=format&n=ZU4EjeonScNdwFxn&q=85&s=0543c3dd72c03d0064c07971ec33e1a3 1650w, https://mintcdn.com/prefect-bd373955/ZU4EjeonScNdwFxn/v3/img/tutorials/modal/6.png?w=2500&fit=max&auto=format&n=ZU4EjeonScNdwFxn&q=85&s=2db68e256119a1d06e841be083c7cfa4 2500w\" />\n\nYou let Prefect override your deployment spec, which allowed your CD to run without any interruptions or prompts.\nIf you go to the **Deployment** page in Prefect Cloud, you'll see your deployment!\n\n<img src=\"https://mintcdn.com/prefect-bd373955/ZU4EjeonScNdwFxn/v3/img/tutorials/modal/7.png?fit=max&auto=format&n=ZU4EjeonScNdwFxn&q=85&s=aeb05225ab1e4ec603edc49806adc51b\" alt=\"image.png\" data-og-width=\"1629\" width=\"1629\" data-og-height=\"366\" height=\"366\" data-path=\"v3/img/tutorials/modal/7.png\" data-optimize=\"true\" data-opv=\"3\" srcset=\"https://mintcdn.com/prefect-bd373955/ZU4EjeonScNdwFxn/v3/img/tutorials/modal/7.png?w=280&fit=max&auto=format&n=ZU4EjeonScNdwFxn&q=85&s=acd73de2e6587432c2979f8475d109a3 280w, https://mintcdn.com/prefect-bd373955/ZU4EjeonScNdwFxn/v3/img/tutorials/modal/7.png?w=560&fit=max&auto=format&n=ZU4EjeonScNdwFxn&q=85&s=7e0dc2d285f8618263a19b8345d4c817 560w, https://mintcdn.com/prefect-bd373955/ZU4EjeonScNdwFxn/v3/img/tutorials/modal/7.png?w=840&fit=max&auto=format&n=ZU4EjeonScNdwFxn&q=85&s=ec6da33abcdc2964ca2c3d5524d9b2d3 840w, https://mintcdn.com/prefect-bd373955/ZU4EjeonScNdwFxn/v3/img/tutorials/modal/7.png?w=1100&fit=max&auto=format&n=ZU4EjeonScNdwFxn&q=85&s=45e93c39d702275a320f1c899754b4cc 1100w, https://mintcdn.com/prefect-bd373955/ZU4EjeonScNdwFxn/v3/img/tutorials/modal/7.png?w=1650&fit=max&auto=format&n=ZU4EjeonScNdwFxn&q=85&s=eb74a7e5dbad9f5853c137e3997f54bf 1650w, https://mintcdn.com/prefect-bd373955/ZU4EjeonScNdwFxn/v3/img/tutorials/modal/7.png?w=2500&fit=max&auto=format&n=ZU4EjeonScNdwFxn&q=85&s=a59fb06502e9bdb3b3d1124cd6071838 2500w\" />\n\nThere are no runs yet.\nThe output from `make prefect-deploy` shows the command to run your deployed flow.\nHowever, since the code isnâ€™t in GitHub yet, this will fail.\nTo fix this, push your code:\n\n```bash  theme={null}\ngit push\n```\n\nGo to the repository in **GitHub**, and then open **Actions** to verify that your CI/CD is running successfully.\n\n<img src=\"https://mintcdn.com/prefect-bd373955/ZU4EjeonScNdwFxn/v3/img/tutorials/modal/8.png?fit=max&auto=format&n=ZU4EjeonScNdwFxn&q=85&s=7fa4a81f7489dd7e405a1d59c0af1c27\" alt=\"image.png\" data-og-width=\"1610\" width=\"1610\" data-og-height=\"636\" height=\"636\" data-path=\"v3/img/tutorials/modal/8.png\" data-optimize=\"true\" data-opv=\"3\" srcset=\"https://mintcdn.com/prefect-bd373955/ZU4EjeonScNdwFxn/v3/img/tutorials/modal/8.png?w=280&fit=max&auto=format&n=ZU4EjeonScNdwFxn&q=85&s=7e4fc98f6b33f079f44ef5b7193d3a27 280w, https://mintcdn.com/prefect-bd373955/ZU4EjeonScNdwFxn/v3/img/tutorials/modal/8.png?w=560&fit=max&auto=format&n=ZU4EjeonScNdwFxn&q=85&s=4eeb088999525d534acb4fc6891e9241 560w, https://mintcdn.com/prefect-bd373955/ZU4EjeonScNdwFxn/v3/img/tutorials/modal/8.png?w=840&fit=max&auto=format&n=ZU4EjeonScNdwFxn&q=85&s=6457bd2320a922e7a1d9afa58f7bd84c 840w, https://mintcdn.com/prefect-bd373955/ZU4EjeonScNdwFxn/v3/img/tutorials/modal/8.png?w=1100&fit=max&auto=format&n=ZU4EjeonScNdwFxn&q=85&s=925e3a29905a506347c20776bd076c09 1100w, https://mintcdn.com/prefect-bd373955/ZU4EjeonScNdwFxn/v3/img/tutorials/modal/8.png?w=1650&fit=max&auto=format&n=ZU4EjeonScNdwFxn&q=85&s=ac9c6e19e14ddbdf235081756749bebd 1650w, https://mintcdn.com/prefect-bd373955/ZU4EjeonScNdwFxn/v3/img/tutorials/modal/8.png?w=2500&fit=max&auto=format&n=ZU4EjeonScNdwFxn&q=85&s=3501f27d3447b4e35318e83103726111 2500w\" />\n\nYou can see the flow run in Prefect Cloud as well.\n\nThe flow will run automatically at 12 PM, but you can also run it manually.\n\nIn a new browser tab, open your [Modal dashboard](https://modal.com/apps/) alongside your Prefect Cloud dashboard.\n\nIn your terminal, run the following command:\n\n```bash  theme={null}\nuv run prefect deployment run main/prefect-modal-example\n```\n\nYou should see the run start in your Prefect dashboard.\nIn 30-60 seconds, you should see it run in Modal.\nYou can click on the run to see the logs.\n\n<img src=\"https://mintcdn.com/prefect-bd373955/ZU4EjeonScNdwFxn/v3/img/tutorials/modal/9.png?fit=max&auto=format&n=ZU4EjeonScNdwFxn&q=85&s=8db98eb8807965b3333dd36122bce457\" alt=\"image.png\" data-og-width=\"452\" width=\"452\" data-og-height=\"73\" height=\"73\" data-path=\"v3/img/tutorials/modal/9.png\" data-optimize=\"true\" data-opv=\"3\" srcset=\"https://mintcdn.com/prefect-bd373955/ZU4EjeonScNdwFxn/v3/img/tutorials/modal/9.png?w=280&fit=max&auto=format&n=ZU4EjeonScNdwFxn&q=85&s=6a54347cd440b4c28a7bd4cb3bae4249 280w, https://mintcdn.com/prefect-bd373955/ZU4EjeonScNdwFxn/v3/img/tutorials/modal/9.png?w=560&fit=max&auto=format&n=ZU4EjeonScNdwFxn&q=85&s=dc25c7aa60062fa4ad3ce6863c8990ae 560w, https://mintcdn.com/prefect-bd373955/ZU4EjeonScNdwFxn/v3/img/tutorials/modal/9.png?w=840&fit=max&auto=format&n=ZU4EjeonScNdwFxn&q=85&s=6f3deba49d09367c98eae2109b4bcab4 840w, https://mintcdn.com/prefect-bd373955/ZU4EjeonScNdwFxn/v3/img/tutorials/modal/9.png?w=1100&fit=max&auto=format&n=ZU4EjeonScNdwFxn&q=85&s=e6da492e31d1ca92f24e6262da11db54 1100w, https://mintcdn.com/prefect-bd373955/ZU4EjeonScNdwFxn/v3/img/tutorials/modal/9.png?w=1650&fit=max&auto=format&n=ZU4EjeonScNdwFxn&q=85&s=922cf2ea1ca798e77874ae822a19ad45 1650w, https://mintcdn.com/prefect-bd373955/ZU4EjeonScNdwFxn/v3/img/tutorials/modal/9.png?w=2500&fit=max&auto=format&n=ZU4EjeonScNdwFxn&q=85&s=7eb61285ddabd23eda75109d6a866848 2500w\" />\n\nClick into the app and then click **App Logs** on the left to show everything thatâ€™s happening inside the flow run!\n\n<img src=\"https://mintcdn.com/prefect-bd373955/ZU4EjeonScNdwFxn/v3/img/tutorials/modal/10.png?fit=max&auto=format&n=ZU4EjeonScNdwFxn&q=85&s=0ed44b69a5f58f0547d129ae1180e0c1\" alt=\"image.png\" data-og-width=\"1915\" width=\"1915\" data-og-height=\"829\" height=\"829\" data-path=\"v3/img/tutorials/modal/10.png\" data-optimize=\"true\" data-opv=\"3\" srcset=\"https://mintcdn.com/prefect-bd373955/ZU4EjeonScNdwFxn/v3/img/tutorials/modal/10.png?w=280&fit=max&auto=format&n=ZU4EjeonScNdwFxn&q=85&s=3f9def5b3098853c627100cf0406a3dc 280w, https://mintcdn.com/prefect-bd373955/ZU4EjeonScNdwFxn/v3/img/tutorials/modal/10.png?w=560&fit=max&auto=format&n=ZU4EjeonScNdwFxn&q=85&s=120916d83da19b7ec13f6ad4f496458d 560w, https://mintcdn.com/prefect-bd373955/ZU4EjeonScNdwFxn/v3/img/tutorials/modal/10.png?w=840&fit=max&auto=format&n=ZU4EjeonScNdwFxn&q=85&s=5f8cc8d9e66d17e60bf54c668bd798ce 840w, https://mintcdn.com/prefect-bd373955/ZU4EjeonScNdwFxn/v3/img/tutorials/modal/10.png?w=1100&fit=max&auto=format&n=ZU4EjeonScNdwFxn&q=85&s=7c438551abef3e7d7e1ed34e89a08eaa 1100w, https://mintcdn.com/prefect-bd373955/ZU4EjeonScNdwFxn/v3/img/tutorials/modal/10.png?w=1650&fit=max&auto=format&n=ZU4EjeonScNdwFxn&q=85&s=65cdb38bec91f5e78e0445de1faecf2d 1650w, https://mintcdn.com/prefect-bd373955/ZU4EjeonScNdwFxn/v3/img/tutorials/modal/10.png?w=2500&fit=max&auto=format&n=ZU4EjeonScNdwFxn&q=85&s=9d026d2a2630b980f878dc565f7ef5b8 2500w\" />\n\nClick on a specific log line to get more details.\n\n<img src=\"https://mintcdn.com/prefect-bd373955/ZU4EjeonScNdwFxn/v3/img/tutorials/modal/11.png?fit=max&auto=format&n=ZU4EjeonScNdwFxn&q=85&s=7f10980722d9f62f824307ccedd7eee9\" alt=\"image.png\" data-og-width=\"1613\" width=\"1613\" data-og-height=\"721\" height=\"721\" data-path=\"v3/img/tutorials/modal/11.png\" data-optimize=\"true\" data-opv=\"3\" srcset=\"https://mintcdn.com/prefect-bd373955/ZU4EjeonScNdwFxn/v3/img/tutorials/modal/11.png?w=280&fit=max&auto=format&n=ZU4EjeonScNdwFxn&q=85&s=f14f899200bcf7123e569d4dfff56d93 280w, https://mintcdn.com/prefect-bd373955/ZU4EjeonScNdwFxn/v3/img/tutorials/modal/11.png?w=560&fit=max&auto=format&n=ZU4EjeonScNdwFxn&q=85&s=52817640f07d05c301aa975751cb73e4 560w, https://mintcdn.com/prefect-bd373955/ZU4EjeonScNdwFxn/v3/img/tutorials/modal/11.png?w=840&fit=max&auto=format&n=ZU4EjeonScNdwFxn&q=85&s=8a9a7e77ff59c74f02d436c8dc5869e1 840w, https://mintcdn.com/prefect-bd373955/ZU4EjeonScNdwFxn/v3/img/tutorials/modal/11.png?w=1100&fit=max&auto=format&n=ZU4EjeonScNdwFxn&q=85&s=fc4492f7b4815006a3655c2c239c6e36 1100w, https://mintcdn.com/prefect-bd373955/ZU4EjeonScNdwFxn/v3/img/tutorials/modal/11.png?w=1650&fit=max&auto=format&n=ZU4EjeonScNdwFxn&q=85&s=cc15fc63031a896084c7544698b7e647 1650w, https://mintcdn.com/prefect-bd373955/ZU4EjeonScNdwFxn/v3/img/tutorials/modal/11.png?w=2500&fit=max&auto=format&n=ZU4EjeonScNdwFxn&q=85&s=9aaad7d016f6393ec21395cbd078b072 2500w\" />\n\nIf you open the URL in that log, youâ€™ll see the corresponding logs in Prefect Cloud.\n\n<img src=\"https://mintcdn.com/prefect-bd373955/ZU4EjeonScNdwFxn/v3/img/tutorials/modal/12.png?fit=max&auto=format&n=ZU4EjeonScNdwFxn&q=85&s=361cfb3d4a4a66310c6e187fae01dc23\" alt=\"image.png\" data-og-width=\"1616\" width=\"1616\" data-og-height=\"918\" height=\"918\" data-path=\"v3/img/tutorials/modal/12.png\" data-optimize=\"true\" data-opv=\"3\" srcset=\"https://mintcdn.com/prefect-bd373955/ZU4EjeonScNdwFxn/v3/img/tutorials/modal/12.png?w=280&fit=max&auto=format&n=ZU4EjeonScNdwFxn&q=85&s=f51c48a7583e2925cfd1aefcb27df2d9 280w, https://mintcdn.com/prefect-bd373955/ZU4EjeonScNdwFxn/v3/img/tutorials/modal/12.png?w=560&fit=max&auto=format&n=ZU4EjeonScNdwFxn&q=85&s=6e974efb38f84ed3c1a96cee37d29b02 560w, https://mintcdn.com/prefect-bd373955/ZU4EjeonScNdwFxn/v3/img/tutorials/modal/12.png?w=840&fit=max&auto=format&n=ZU4EjeonScNdwFxn&q=85&s=a8958002e69a707fbb40c1670d0e2b44 840w, https://mintcdn.com/prefect-bd373955/ZU4EjeonScNdwFxn/v3/img/tutorials/modal/12.png?w=1100&fit=max&auto=format&n=ZU4EjeonScNdwFxn&q=85&s=7de60c05415588bec2fedc01f67c43f2 1100w, https://mintcdn.com/prefect-bd373955/ZU4EjeonScNdwFxn/v3/img/tutorials/modal/12.png?w=1650&fit=max&auto=format&n=ZU4EjeonScNdwFxn&q=85&s=25753a1a94f8e67b1b8fef2fb5c48505 1650w, https://mintcdn.com/prefect-bd373955/ZU4EjeonScNdwFxn/v3/img/tutorials/modal/12.png?w=2500&fit=max&auto=format&n=ZU4EjeonScNdwFxn&q=85&s=896deca8d474edc20fa80d641b4060c2 2500w\" />\n\nAs you make changes to either the code or deployment file, Prefect will redeploy and Modal will automatically pick up changes.\nYou've successfully built your first Prefect deployment that runs on Modal every hour!\n\n<Note>\n  For more information about CI/CD in Prefect, see [Build deployments via CI/CD](/v3/advanced/deploy-ci-cd).\n</Note>",
  "content_length": 33195
}