{
  "title": "How to create custom blocks",
  "source_url": "https://docs-3.prefect.io/v3/advanced/custom-blocks",
  "content": "### Create a new block type\n\nTo create a custom block type, define a class that subclasses `Block`. The `Block` base class builds\non Pydantic's `BaseModel`, so you can declare custom fields just like a [Pydantic model](https://pydantic-docs.helpmanual.io/usage/models/#basic-model-usage).\n\nWe've already seen an example of a `Cube` block that represents a cube and holds information about the length of each edge in inches:\n\n```python  theme={null}\nfrom prefect.blocks.core import Block\n\nclass Cube(Block):\n    edge_length_inches: float\n\n\nCube.register_type_and_schema()\n```\n\n### Register custom blocks\n\nIn addition to the `register_type_and_schema` method shown above, you can register blocks from a Python module with a CLI command:\n\n```bash  theme={null}\nprefect block register --module prefect_aws.credentials\n```\n\nThis command is useful for registering all blocks found within a module in a [Prefect Integration library](/integrations/).\n\nAlternatively, if a custom block was created in a `.py` file, you can register the block with the CLI command:\n\n```bash  theme={null}\nprefect block register --file my_block.py\n```\n\nBlock documents can now be created with the registered block schema.\n\n### Secret fields\n\nAll block values are encrypted before being stored.\nIf you have values that you would not like visible in the UI or in logs,\nuse the `SecretStr` field type provided by Pydantic to automatically obfuscate those values.\nYou can use this capability for fields that store credentials such as passwords and API tokens.\n\nHere's an example of an `AwsCredentials` block that uses `SecretStr`:\n\n```python  theme={null}\nfrom typing import Optional\n\nfrom prefect.blocks.core import Block\nfrom pydantic import SecretStr\n\nclass AwsCredentials(Block):\n    aws_access_key_id: Optional[str] = None\n    aws_secret_access_key: Optional[SecretStr] = None\n    aws_session_token: Optional[str] = None\n    profile_name: Optional[str] = None\n    region_name: Optional[str] = None\n```\n\nSince `aws_secret_access_key` has the `SecretStr` type hint assigned to it,\nthe value of that field is not exposed if the object is logged:\n\n```python  theme={null}\naws_credentials_block = AwsCredentials(\n    aws_access_key_id=\"AKIAJKLJKLJKLJKLJKLJK\",\n    aws_secret_access_key=\"secret_access_key\"\n)\n\nprint(aws_credentials_block)\n# aws_access_key_id='AKIAJKLJKLJKLJKLJKLJK' aws_secret_access_key=SecretStr('**********') aws_session_token=None profile_name=None region_name=None\n```\n\nPrefect's `SecretDict` field type allows you to add a dictionary field to your block\nthat automatically obfuscates values at all levels in the UI or in logs.\nThis capability is useful for blocks where typing or structure of secret fields is not known until configuration time.\n\nHere's an example of a block that uses `SecretDict`:\n\n```python  theme={null}\nfrom prefect.blocks.core import Block\nfrom prefect.blocks.fields import SecretDict\n\n\nclass SystemConfiguration(Block):\n    system_secrets: SecretDict\n    system_variables: dict\n\n\nsystem_configuration_block = SystemConfiguration(\n    system_secrets={\n        \"password\": \"p@ssw0rd\",\n        \"api_token\": \"token_123456789\",\n        \"private_key\": \"<private key here>\",\n    },\n    system_variables={\n        \"self_destruct_countdown_seconds\": 60,\n        \"self_destruct_countdown_stop_time\": 7,\n    },\n)\n```\n\n`system_secrets` is obfuscated when `system_configuration_block` is displayed, but `system_variables` show up in plain-text:\n\n```python  theme={null}\nprint(system_configuration_block)\n# SystemConfiguration(\n#   system_secrets=SecretDict('{'password': '**********', 'api_token': '**********', 'private_key': '**********'}'), \n#   system_variables={'self_destruct_countdown_seconds': 60, 'self_destruct_countdown_stop_time': 7}\n# )\n```\n\n### Customize a block's display\n\nYou can set metadata fields on a block type's subclass to control how a block displays.\n\nAvailable metadata fields include:\n\n| Property           | Description                                                                                                                                   |\n| ------------------ | --------------------------------------------------------------------------------------------------------------------------------------------- |\n| `_block_type_name` | Display name of the block in the UI. Defaults to the class name.                                                                              |\n| `_block_type_slug` | Unique slug used to reference the block type in the API. Defaults to a lowercase, dash-delimited version of the block type name.              |\n| `_logo_url`        | URL pointing to an image that should be displayed for the block type in the UI. Default to `None`.                                            |\n| `_description`     | Short description of block type. Defaults to docstring, if provided.                                                                          |\n| `_code_example`    | Short code snippet shown in UI for how to load/use block type. Defaults to first example provided in the docstring of the class, if provided. |\n\n### Update custom `Block` types\n\nHere's an example of how to add a `bucket_folder` field to your custom `S3Bucket` block; it represents the default path to\nread and write objects from (this field exists on [our implementation](https://github.com/PrefectHQ/prefect/blob/main/src/integrations/prefect-aws/prefect_aws/s3.py)).\n\nAdd the new field to the class definition:\n\n```python  theme={null}\nfrom typing import Optional\n\nfrom prefect.blocks.core import Block\n\n\nclass S3Bucket(Block):\n    bucket_name: str\n    credentials: AwsCredentials\n    bucket_folder: Optional[str] = None\n    ...\n```\n\nThen [register the updated block type](#register-blocks) with either your Prefect Cloud account or your self-hosted Prefect server instance.\n\nIf you have any existing blocks of this type that were created before the update and\nyou'd prefer to not re-create them, migrate them to the new version of your block type by adding the missing values:\n\n```python  theme={null}\n# Bypass Pydantic validation to allow your local Block class to load the old block version\nmy_s3_bucket_block = S3Bucket.load(\"my-s3-bucket\", validate=False)\n\n# Set the new field to an appropriate value\nmy_s3_bucket_block.bucket_path = \"my-default-bucket-path\"\n\n# Overwrite the old block values and update the expected fields on the block\nmy_s3_bucket_block.save(\"my-s3-bucket\", overwrite=True)\n```",
  "content_length": 6442
}