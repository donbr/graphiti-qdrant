{
  "title": "How to chain deployments with events",
  "source_url": "https://docs-3.prefect.io/v3/how-to-guides/automations/chaining-deployments-with-events",
  "content": "Learn how to establish event-based dependencies between individual workflows.\n\nThis example shows how to use a trigger to schedule a run of downstream deployment when a run of an upstream deployment completes.\n\n## Define an upstream and downstream deployment\n\n```python event_driven_deployments.py theme={null}\nfrom prefect import flow, serve\nfrom prefect.events import DeploymentEventTrigger\n\n\n@flow(log_prints=True)\ndef upstream_flow():\n    print(\"upstream flow\")\n\n\n@flow(log_prints=True)\ndef downstream_flow():\n    print(\"downstream flow\")\n\n\nif __name__ == \"__main__\":\n    upstream_deployment = upstream_flow.to_deployment(name=\"upstream_deployment\")\n    downstream_deployment = downstream_flow.to_deployment(\n        name=\"downstream_deployment\",\n        triggers=[\n            DeploymentEventTrigger(\n                expect={\"prefect.flow-run.Completed\"},\n                match_related={\"prefect.resource.name\": \"upstream_deployment\"},\n            )\n        ],\n    )\n\n    serve(upstream_deployment, downstream_deployment)\n```\n\n## Test it out\n\nFirst, start the `serve` process to listen for scheduled deployments runs:\n\n```bash  theme={null}\npython event_driven_deployments.py\n```\n\nNow, run the upstream deployment and see the downstream deployment kick off after it completes:\n\n```bash  theme={null}\nprefect deployment run upstream-flow/upstream_deployment\n```\n\n<Tip>\n  **Check the event feed**\n\n  You can inspect raw events in the event feed in the UI to see what related resources are available to match against.\n\n  For example, the following `prefect.flow-run.Completed` event's related resources include:\n\n  ```json  theme={null}\n  {\n     \"related\": [\n      {\n        \"prefect.resource.id\": \"prefect.flow.10e099ec-8358-4146-b188-be68027ee58f\",\n        \"prefect.resource.role\": \"flow\",\n        \"prefect.resource.name\": \"upstream-flow\"\n      },\n      {\n        \"prefect.resource.id\": \"prefect.deployment.be777bbd-4b15-49f3-bc1f-4d109374cee2\",\n        \"prefect.resource.role\": \"deployment\",\n        \"prefect.resource.name\": \"upstream_deployment\"\n      },\n      {\n        \"prefect.resource.id\": \"prefect-cloud.user.80546602-9f31-4396-ab4b-e873a5377feb\",\n        \"prefect.resource.role\": \"creator\",\n        \"prefect.resource.name\": \"stoat\"\n      }\n    ]\n  }\n  ```\n</Tip>",
  "content_length": 2274
}