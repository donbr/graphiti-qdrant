{
  "title": "prefect-bitbucket",
  "source_url": "https://docs-3.prefect.io/integrations/prefect-bitbucket/index",
  "content": "The `prefect-bitbucket` library makes it easy to interact with Bitbucket repositories and credentials.\n\n## Getting started\n\n### Prerequisites\n\n* A [Bitbucket account](https://bitbucket.org/product).\n\n### Install `prefect-bitbucket`\n\nThe following command will install a version of `prefect-bitbucket` compatible with your installed version of `prefect`.\nIf you don't already have `prefect` installed, it will install the newest version of `prefect` as well.\n\n```bash  theme={null}\npip install \"prefect[bitbucket]\"\n```\n\nUpgrade to the latest versions of `prefect` and `prefect-bitbucket`:\n\n```bash  theme={null}\npip install -U \"prefect[bitbucket]\"\n```\n\n### Register newly installed block types\n\nRegister the block types in the `prefect-bitbucket` module to make them available for use.\n\n```bash  theme={null}\nprefect block register -m prefect_bitbucket\n```\n\n## Examples\n\nIn the examples below, you create blocks with Python code.\nAlternatively, blocks can be created through the Prefect UI.\n\n## Store deployment flow code in a private Bitbucket repository\n\nTo create a deployment and run a deployment where the flow code is stored in a private Bitbucket repository, you can use the `BitBucketCredentials` block.\n\nA deployment can use flow code stored in a Bitbucket repository without using this library in either of the following cases:\n\n* The repository is public\n* The deployment uses a [Secret block](/v3/develop/secrets) to store the token\n\nCreate a Bitbucket Credentials block:\n\n```python  theme={null}\nfrom prefect_bitbucket import BitBucketCredentials\n\n\nbitbucket_credentials_block = BitBucketCredentials(token=\"x-token-auth:my-token\")\nbitbucket_credentials_block.save(name=\"my-bitbucket-credentials-block\")\n```\n\n<Info>\n  **Difference between Bitbucket Server and Bitbucket Cloud authentication**\n\n  If using a token to authenticate to Bitbucket Cloud, only set the `token` to authenticate. Do not include a value in the `username` field or authentication will fail. If using Bitbucket Server, provide both the `token` and `username` values.\n</Info>\n\n### Access flow code stored in a private Bitbucket repository in a deployment\n\nUse the credentials block you created above to pass the Bitbucket access token during deployment creation. The code below assumes there's flow code stored in a private Bitbucket repository.\n\n```python  theme={null}\nfrom prefect import flow\nfrom prefect.runner.storage import GitRepository\nfrom prefect_bitbucket import BitBucketCredentials\n\n\nif __name__ == \"__main__\":\n    \n    source = GitRepository(\n        url=\"https://bitbucket.com/org/private-repo.git\",\n        credentials=BitBucketCredentials.load(\"my-bitbucket-credentials-block\")\n        )\n\n    flow.from_source(\n        source=source,\n        entrypoint=\"my_file.py:my_flow\",\n    ).deploy(\n        name=\"private-bitbucket-deploy\",\n        work_pool_name=\"my_pool\",\n    )\n```\n\nAlternatively, if you use a `prefect.yaml` file to create the deployment, reference the Bitbucket Credentials block in the `pull` step:\n\n```yaml  theme={null}\npull:\n    - prefect.deployments.steps.git_clone:\n        credentials: https://bitbucket.org/org/private-repo.git\n        credentials: \"{{ prefect.blocks.bitbucket-credentials.my-bitbucket-credentials-block }}\"\n```\n\n### Interact with a Bitbucket repository\n\nThe code below shows how to reference a particular branch or tag of a Bitbucket repository.\n\n```python  theme={null}\nfrom prefect_bitbucket import BitbucketRepository\n\n\ndef save_bitbucket_block():\n    bitbucket_block = BitbucketRepository(\n        repository=\"https://bitbucket.org/testing/my-repository.git\",\n        reference=\"branch-or-tag-name\",\n    )\n\n    bitbucket_block.save(\"my-bitbucket-block\")\n\n\nif __name__ == \"__main__\":\n    save_bitbucket_block()\n```\n\nExclude the `reference` field to use the default branch.\nReference a BitBucketCredentials block for authentication if the repository is private.\n\nUse the newly created block to interact with the Bitbucket repository.\n\nFor example, download the repository contents with the `.get_directory()` method like this:\n\n```python  theme={null}\nfrom prefect_bitbucket.repositories import BitbucketRepository\n\n\ndef fetch_repo():\n    bitbucket_block = BitbucketRepository.load(\"my-bitbucket-block\")\n    bitbucket_block.get_directory()\n\n\nif __name__ == \"__main__\":\n    fetch_repo()\n```\n\n## Resources\n\nFor assistance using Bitbucket, consult the [Bitbucket documentation](https://bitbucket.org/product/guides).\n\nRefer to the `prefect-bitbucket` [SDK documentation](https://reference.prefect.io/prefect_bitbucket/) to explore all the capabilities of the `prefect-bitbucket` library.",
  "content_length": 4622
}