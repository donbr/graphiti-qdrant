{
  "title": "event_persister",
  "source_url": "https://docs-3.prefect.io/v3/api-ref/python/prefect-server-events-services-event_persister",
  "content": "# `prefect.server.events.services.event_persister`\n\nThe event persister moves event messages from the event bus to storage\nstorage as fast as it can.  Never gets tired.\n\n## Functions\n\n### `batch_delete` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/events/services/event_persister.py#L48\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nbatch_delete(session: AsyncSession, model: type[T], condition: Any, batch_size: int = 10000) -> int\n```\n\nPerform a batch deletion of database records using a subquery with LIMIT. Works with both PostgreSQL and\nSQLite. Compared to a basic delete(...).where(...), a batch deletion is more robust against timeouts\nwhen handling large tables, which is especially the case if we first delete old entries from long\nexisting tables.\n\n**Returns:**\n\n* Total number of deleted records\n\n### `create_handler` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/events/services/event_persister.py#L146\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\ncreate_handler(batch_size: int = 20, flush_every: timedelta = timedelta(seconds=5), trim_every: timedelta = timedelta(minutes=15)) -> AsyncGenerator[MessageHandler, None]\n```\n\nSet up a message handler that will accumulate and send events to\nthe database every `batch_size` messages, or every `flush_every` interval to flush\nany remaining messages\n\n## Classes\n\n### `EventPersister` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/events/services/event_persister.py#L83\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\nA service that persists events to the database as they arrive.\n\n**Methods:**\n\n#### `all_services` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/services/base.py#L92\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nall_services(cls) -> Sequence[type[Self]]\n```\n\nGet list of all service classes\n\n#### `enabled` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/services/base.py#L87\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nenabled(cls) -> bool\n```\n\nWhether the service is enabled\n\n#### `enabled_services` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/services/base.py#L106\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nenabled_services(cls) -> list[type[Self]]\n```\n\nGet list of enabled service classes\n\n#### `environment_variable_name` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/services/base.py#L83\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nenvironment_variable_name(cls) -> str\n```\n\n#### `run_services` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/services/base.py#L127\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nrun_services(cls) -> NoReturn\n```\n\nRun enabled services until cancelled.\n\n#### `running` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/services/base.py#L112\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nrunning(cls) -> AsyncGenerator[None, None]\n```\n\nA context manager that runs enabled services on entry and stops them on\nexit.\n\n#### `service_settings` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/events/services/event_persister.py#L89\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nservice_settings(cls) -> ServicesBaseSetting\n```\n\n#### `service_settings` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/services/base.py#L78\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nservice_settings(cls) -> ServicesBaseSetting\n```\n\nThe Prefect setting that controls whether the service is enabled\n\n#### `start` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/events/services/event_persister.py#L106\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nstart(self) -> NoReturn\n```\n\n#### `start` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/services/base.py#L137\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nstart(self) -> NoReturn\n```\n\nStart running the service, which may run indefinitely\n\n#### `started_event` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/events/services/event_persister.py#L97\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nstarted_event(self) -> asyncio.Event\n```\n\n#### `started_event` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/events/services/event_persister.py#L103\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nstarted_event(self, value: asyncio.Event) -> None\n```\n\n#### `stop` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/events/services/event_persister.py#L130\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nstop(self) -> None\n```\n\n#### `stop` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/services/base.py#L142\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nstop(self) -> None\n```\n\nStop the service",
  "content_length": 6048
}