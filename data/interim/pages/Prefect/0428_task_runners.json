{
  "title": "task_runners",
  "source_url": "https://docs-3.prefect.io/v3/api-ref/python/prefect-task_runners",
  "content": "# `prefect.task_runners`\n\n## Classes\n\n### `TaskRunner` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/task_runners.py#L57\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\nAbstract base class for task runners.\n\nA task runner is responsible for submitting tasks to the task run engine running\nin an execution environment. Submitted tasks are non-blocking and return a future\nobject that can be used to wait for the task to complete and retrieve the result.\n\nTask runners are context managers and should be used in a `with` block to ensure\nproper cleanup of resources.\n\n**Methods:**\n\n#### `duplicate` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/task_runners.py#L79\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nduplicate(self) -> Self\n```\n\nReturn a new instance of this task runner with the same configuration.\n\n#### `map` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/task_runners.py#L112\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nmap(self, task: 'Task[P, R | CoroutineType[Any, Any, R]]', parameters: dict[str, Any | unmapped[Any] | allow_failure[Any]], wait_for: Iterable[PrefectFuture[R]] | None = None) -> PrefectFutureList[F]\n```\n\nSubmit multiple tasks to the task run engine.\n\n**Args:**\n\n* `task`: The task to submit.\n* `parameters`: The parameters to use when running the task.\n* `wait_for`: A list of futures that the task depends on.\n\n**Returns:**\n\n* An iterable of future objects that can be used to wait for the tasks to\n* complete and retrieve the results.\n\n#### `name` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/task_runners.py#L74\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nname(self) -> str\n```\n\nThe name of this task runner\n\n#### `submit` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/task_runners.py#L85\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nsubmit(self, task: 'Task[P, CoroutineType[Any, Any, R]]', parameters: dict[str, Any], wait_for: Iterable[PrefectFuture[Any]] | None = None, dependencies: dict[str, set[RunInput]] | None = None) -> F\n```\n\n#### `submit` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/task_runners.py#L95\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nsubmit(self, task: 'Task[Any, R]', parameters: dict[str, Any], wait_for: Iterable[PrefectFuture[Any]] | None = None, dependencies: dict[str, set[RunInput]] | None = None) -> F\n```\n\n#### `submit` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/task_runners.py#L104\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nsubmit(self, task: 'Task[P, R | CoroutineType[Any, Any, R]]', parameters: dict[str, Any], wait_for: Iterable[PrefectFuture[Any]] | None = None, dependencies: dict[str, set[RunInput]] | None = None) -> F\n```\n\n### `ThreadPoolTaskRunner` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/task_runners.py#L234\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\nA task runner that executes tasks in a separate thread pool.\n\n**Examples:**\n\nUse a thread pool task runner with a flow:\n\n```python  theme={null}\nfrom prefect import flow, task\nfrom prefect.task_runners import ThreadPoolTaskRunner\n\n@task\ndef some_io_bound_task(x: int) -> int:\n    # making a query to a database, reading a file, etc.\n    return x * 2\n\n@flow(task_runner=ThreadPoolTaskRunner(max_workers=3)) # use at most 3 threads at a time\ndef my_io_bound_flow():\n    futures = []\n    for i in range(10):\n        future = some_io_bound_task.submit(i * 100)\n        futures.append(future)\n\n    return [future.result() for future in futures]\n```\n\nUse a thread pool task runner as a context manager:\n\n```python  theme={null}\nfrom prefect.task_runners import ThreadPoolTaskRunner\n\n@task\ndef some_io_bound_task(x: int) -> int:\n    # making a query to a database, reading a file, etc.\n    return x * 2\n\n# Use the runner directly\nwith ThreadPoolTaskRunner(max_workers=2) as runner:\n    future1 = runner.submit(some_io_bound_task, {\"x\": 1})\n    future2 = runner.submit(some_io_bound_task, {\"x\": 2})\n\n    result1 = future1.result()  # 2\n    result2 = future2.result()  # 4\n```\n\nConfigure max workers via settings:\n\n```python  theme={null}\n# Set via environment variable\n# export PREFECT_TASK_RUNNER_THREAD_POOL_MAX_WORKERS=8\n\nfrom prefect import flow\nfrom prefect.task_runners import ThreadPoolTaskRunner\n\n@flow(task_runner=ThreadPoolTaskRunner())  # Uses 8 workers from setting\ndef my_flow():\n    ...\n```\n\n**Methods:**\n\n#### `cancel_all` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/task_runners.py#L437\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\ncancel_all(self) -> None\n```\n\n#### `duplicate` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/task_runners.py#L319\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nduplicate(self) -> 'ThreadPoolTaskRunner[R]'\n```\n\n#### `map` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/task_runners.py#L414\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nmap(self, task: 'Task[P, CoroutineType[Any, Any, R]]', parameters: dict[str, Any], wait_for: Iterable[PrefectFuture[Any]] | None = None) -> PrefectFutureList[PrefectConcurrentFuture[R]]\n```\n\n#### `map` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/task_runners.py#L422\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nmap(self, task: 'Task[Any, R]', parameters: dict[str, Any], wait_for: Iterable[PrefectFuture[Any]] | None = None) -> PrefectFutureList[PrefectConcurrentFuture[R]]\n```\n\n#### `map` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/task_runners.py#L429\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nmap(self, task: 'Task[P, R | CoroutineType[Any, Any, R]]', parameters: dict[str, Any], wait_for: Iterable[PrefectFuture[Any]] | None = None) -> PrefectFutureList[PrefectConcurrentFuture[R]]\n```\n\n#### `submit` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/task_runners.py#L323\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nsubmit(self, task: 'Task[P, CoroutineType[Any, Any, R]]', parameters: dict[str, Any], wait_for: Iterable[PrefectFuture[Any]] | None = None, dependencies: dict[str, set[RunInput]] | None = None) -> PrefectConcurrentFuture[R]\n```\n\n#### `submit` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/task_runners.py#L332\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nsubmit(self, task: 'Task[Any, R]', parameters: dict[str, Any], wait_for: Iterable[PrefectFuture[Any]] | None = None, dependencies: dict[str, set[RunInput]] | None = None) -> PrefectConcurrentFuture[R]\n```\n\n#### `submit` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/task_runners.py#L340\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nsubmit(self, task: 'Task[P, R | CoroutineType[Any, Any, R]]', parameters: dict[str, Any], wait_for: Iterable[PrefectFuture[Any]] | None = None, dependencies: dict[str, set[RunInput]] | None = None) -> PrefectConcurrentFuture[R]\n```\n\nSubmit a task to the task run engine running in a separate thread.\n\n**Args:**\n\n* `task`: The task to submit.\n* `parameters`: The parameters to use when running the task.\n* `wait_for`: A list of futures that the task depends on.\n\n**Returns:**\n\n* A future object that can be used to wait for the task to complete and\n* retrieve the result.\n\n### `ProcessPoolTaskRunner` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/task_runners.py#L581\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\nA task runner that executes tasks in a separate process pool.\n\nThis task runner uses `ProcessPoolExecutor` to run tasks in separate processes,\nproviding true parallelism for CPU-bound tasks and process isolation. Tasks\nare executed with proper context propagation and error handling.\n\n**Examples:**\n\nUse a process pool task runner with a flow:\n\n```python  theme={null}\nfrom prefect import flow, task\nfrom prefect.task_runners import ProcessPoolTaskRunner\n\n@task\ndef compute_heavy_task(n: int) -> int:\n    # CPU-intensive computation that benefits from process isolation\n    return sum(i ** 2 for i in range(n))\n\n@flow(task_runner=ProcessPoolTaskRunner(max_workers=4))\ndef my_flow():\n    futures = []\n    for i in range(10):\n        future = compute_heavy_task.submit(i * 1000)\n        futures.append(future)\n\n    return [future.result() for future in futures]\n```\n\nUse a process pool task runner as a context manager:\n\n```python  theme={null}\nfrom prefect.task_runners import ProcessPoolTaskRunner\n\n@task\ndef my_task(x: int) -> int:\n    return x * 2\n\n# Use the runner directly\nwith ProcessPoolTaskRunner(max_workers=2) as runner:\n    future1 = runner.submit(my_task, {\"x\": 1})\n    future2 = runner.submit(my_task, {\"x\": 2})\n\n    result1 = future1.result()  # 2\n    result2 = future2.result()  # 4\n```\n\nConfigure max workers via settings:\n\n```python  theme={null}\n# Set via environment variable\n# export PREFECT_TASKS_RUNNER_PROCESS_POOL_MAX_WORKERS=8\n\nfrom prefect import flow\nfrom prefect.task_runners import ProcessPoolTaskRunner\n\n@flow(task_runner=ProcessPoolTaskRunner())  # Uses 8 workers from setting\ndef my_flow():\n    ...\n```\n\n**Methods:**\n\n#### `cancel_all` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/task_runners.py#L847\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\ncancel_all(self) -> None\n```\n\n#### `duplicate` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/task_runners.py#L673\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nduplicate(self) -> Self\n```\n\n#### `map` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/task_runners.py#L824\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nmap(self, task: 'Task[P, CoroutineType[Any, Any, R]]', parameters: dict[str, Any], wait_for: Iterable[PrefectFuture[Any]] | None = None) -> PrefectFutureList[PrefectConcurrentFuture[R]]\n```\n\n#### `map` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/task_runners.py#L832\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nmap(self, task: 'Task[Any, R]', parameters: dict[str, Any], wait_for: Iterable[PrefectFuture[Any]] | None = None) -> PrefectFutureList[PrefectConcurrentFuture[R]]\n```\n\n#### `map` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/task_runners.py#L839\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nmap(self, task: 'Task[P, R | CoroutineType[Any, Any, R]]', parameters: dict[str, Any], wait_for: Iterable[PrefectFuture[Any]] | None = None) -> PrefectFutureList[PrefectConcurrentFuture[R]]\n```\n\n#### `submit` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/task_runners.py#L727\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nsubmit(self, task: 'Task[P, CoroutineType[Any, Any, R]]', parameters: dict[str, Any], wait_for: Iterable[PrefectFuture[Any]] | None = None, dependencies: dict[str, set[RunInput]] | None = None) -> PrefectConcurrentFuture[R]\n```\n\n#### `submit` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/task_runners.py#L736\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nsubmit(self, task: 'Task[Any, R]', parameters: dict[str, Any], wait_for: Iterable[PrefectFuture[Any]] | None = None, dependencies: dict[str, set[RunInput]] | None = None) -> PrefectConcurrentFuture[R]\n```\n\n#### `submit` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/task_runners.py#L744\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nsubmit(self, task: 'Task[P, R | CoroutineType[Any, Any, R]]', parameters: dict[str, Any], wait_for: Iterable[PrefectFuture[Any]] | None = None, dependencies: dict[str, set[RunInput]] | None = None) -> PrefectConcurrentFuture[R]\n```\n\nSubmit a task to the task run engine running in a separate process.\n\n**Args:**\n\n* `task`: The task to submit.\n* `parameters`: The parameters to use when running the task.\n* `wait_for`: A list of futures that the task depends on.\n* `dependencies`: A dictionary of dependencies for the task.\n\n**Returns:**\n\n* A future object that can be used to wait for the task to complete and\n* retrieve the result.\n\n### `PrefectTaskRunner` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/task_runners.py#L892\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n**Methods:**\n\n#### `duplicate` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/task_runners.py#L896\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nduplicate(self) -> 'PrefectTaskRunner[R]'\n```\n\n#### `map` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/task_runners.py#L955\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nmap(self, task: 'Task[P, CoroutineType[Any, Any, R]]', parameters: dict[str, Any], wait_for: Iterable[PrefectFuture[Any]] | None = None) -> PrefectFutureList[PrefectDistributedFuture[R]]\n```\n\n#### `map` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/task_runners.py#L963\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nmap(self, task: 'Task[Any, R]', parameters: dict[str, Any], wait_for: Iterable[PrefectFuture[Any]] | None = None) -> PrefectFutureList[PrefectDistributedFuture[R]]\n```\n\n#### `map` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/task_runners.py#L970\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nmap(self, task: 'Task[P, R | CoroutineType[Any, Any, R]]', parameters: dict[str, Any], wait_for: Iterable[PrefectFuture[Any]] | None = None) -> PrefectFutureList[PrefectDistributedFuture[R]]\n```\n\n#### `submit` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/task_runners.py#L900\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nsubmit(self, task: 'Task[P, CoroutineType[Any, Any, R]]', parameters: dict[str, Any], wait_for: Iterable[PrefectFuture[Any]] | None = None, dependencies: dict[str, set[RunInput]] | None = None) -> PrefectDistributedFuture[R]\n```\n\n#### `submit` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/task_runners.py#L909\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nsubmit(self, task: 'Task[Any, R]', parameters: dict[str, Any], wait_for: Iterable[PrefectFuture[Any]] | None = None, dependencies: dict[str, set[RunInput]] | None = None) -> PrefectDistributedFuture[R]\n```\n\n#### `submit` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/task_runners.py#L917\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nsubmit(self, task: 'Task[P, R | CoroutineType[Any, Any, R]]', parameters: dict[str, Any], wait_for: Iterable[PrefectFuture[Any]] | None = None, dependencies: dict[str, set[RunInput]] | None = None) -> PrefectDistributedFuture[R]\n```\n\nSubmit a task to the task run engine running in a separate thread.\n\n**Args:**\n\n* `task`: The task to submit.\n* `parameters`: The parameters to use when running the task.\n* `wait_for`: A list of futures that the task depends on.\n\n**Returns:**\n\n* A future object that can be used to wait for the task to complete and\n* retrieve the result.",
  "content_length": 16965
}