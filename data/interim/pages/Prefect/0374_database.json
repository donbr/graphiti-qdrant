{
  "title": "database",
  "source_url": "https://docs-3.prefect.io/v3/api-ref/python/prefect-server-utilities-database",
  "content": "# `prefect.server.utilities.database`\n\nUtilities for interacting with Prefect REST API database and ORM layer.\n\nPrefect supports both SQLite and Postgres. Many of these utilities\nallow the Prefect REST API to seamlessly switch between the two.\n\n## Functions\n\n### `db_injector` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/utilities/database.py#L77\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\ndb_injector(func: Union[_DBMethod[T, P, R], _DBFunction[P, R]]) -> Union[_Method[T, P, R], _Function[P, R]]\n```\n\n### `generate_uuid_postgresql` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/utilities/database.py#L96\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\ngenerate_uuid_postgresql(element: GenerateUUID, compiler: SQLCompiler, **kwargs: Any) -> str\n```\n\nGenerates a random UUID in Postgres; requires the pgcrypto extension.\n\n### `generate_uuid_sqlite` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/utilities/database.py#L107\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\ngenerate_uuid_sqlite(element: GenerateUUID, compiler: SQLCompiler, **kwargs: Any) -> str\n```\n\nGenerates a random UUID in other databases (SQLite) by concatenating\nbytes in a way that approximates a UUID hex representation. This is\nsufficient for our purposes of having a random client-generated ID\nthat is compatible with a UUID spec.\n\n### `bindparams_from_clause` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/utilities/database.py#L327\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nbindparams_from_clause(query: sa.ClauseElement) -> dict[str, sa.BindParameter[Any]]\n```\n\nRetrieve all non-anonymous bind parameters defined in a SQL clause\n\n### `datetime_or_interval_add_postgresql` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/utilities/database.py#L425\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\ndatetime_or_interval_add_postgresql(element: Union[date_add, interval_add, date_diff], compiler: SQLCompiler, **kwargs: Any) -> str\n```\n\n### `date_diff_seconds_postgresql` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/utilities/database.py#L435\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\ndate_diff_seconds_postgresql(element: date_diff_seconds, compiler: SQLCompiler, **kwargs: Any) -> str\n```\n\n### `current_timestamp_sqlite` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/utilities/database.py#L507\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\ncurrent_timestamp_sqlite(element: functions.now, compiler: SQLCompiler, **kwargs: Any) -> str\n```\n\nGenerates the current timestamp for SQLite\n\n### `date_add_sqlite` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/utilities/database.py#L515\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\ndate_add_sqlite(element: date_add, compiler: SQLCompiler, **kwargs: Any) -> str\n```\n\n### `interval_add_sqlite` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/utilities/database.py#L523\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\ninterval_add_sqlite(element: interval_add, compiler: SQLCompiler, **kwargs: Any) -> str\n```\n\n### `date_diff_sqlite` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/utilities/database.py#L532\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\ndate_diff_sqlite(element: date_diff, compiler: SQLCompiler, **kwargs: Any) -> str\n```\n\n### `date_diff_seconds_sqlite` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/utilities/database.py#L539\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\ndate_diff_seconds_sqlite(element: date_diff_seconds, compiler: SQLCompiler, **kwargs: Any) -> str\n```\n\n### `sqlite_json_operators` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/utilities/database.py#L690\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nsqlite_json_operators(element: sa.BinaryExpression[Any], compiler: SQLCompiler, override_operator: Optional[OperatorType] = None, **kwargs: Any) -> str\n```\n\nIntercept the PostgreSQL-only JSON / JSONB operators and translate them to SQLite\n\n### `sqlite_greatest_as_max` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/utilities/database.py#L709\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nsqlite_greatest_as_max(element: greatest[Any], compiler: SQLCompiler, **kwargs: Any) -> str\n```\n\n### `sqlite_least_as_min` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/utilities/database.py#L732\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nsqlite_least_as_min(element: least[Any], compiler: SQLCompiler, **kwargs: Any) -> str\n```\n\n### `get_dialect` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/utilities/database.py#L741\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nget_dialect(obj: Union[str, Session, sa.Engine]) -> type[sa.Dialect]\n```\n\nGet the dialect of a session, engine, or connection url.\n\nPrimary use case is figuring out whether the Prefect REST API is communicating with\nSQLite or Postgres.\n\n## Classes\n\n### `GenerateUUID` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/utilities/database.py#L85\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\nPlatform-independent UUID default generator.\nNote the actual functionality for this class is specified in the\n`compiles`-decorated functions below\n\n### `Timestamp` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/utilities/database.py#L133\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\nTypeDecorator that ensures that timestamps have a timezone.\n\nFor SQLite, all timestamps are converted to UTC (since they are stored\nas naive timestamps without timezones) and recovered as UTC.\n\n**Methods:**\n\n#### `load_dialect_impl` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/utilities/database.py#L143\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nload_dialect_impl(self, dialect: sa.Dialect) -> TypeEngine[Any]\n```\n\n#### `process_bind_param` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/utilities/database.py#L155\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nprocess_bind_param(self, value: Optional[datetime.datetime], dialect: sa.Dialect) -> Optional[datetime.datetime]\n```\n\n#### `process_result_value` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/utilities/database.py#L170\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nprocess_result_value(self, value: Optional[datetime.datetime], dialect: sa.Dialect) -> Optional[datetime.datetime]\n```\n\n### `UUID` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/utilities/database.py#L183\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\nPlatform-independent UUID type.\n\nUses PostgreSQL's UUID type, otherwise uses\nCHAR(36), storing as stringified hex values with\nhyphens.\n\n**Methods:**\n\n#### `load_dialect_impl` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/utilities/database.py#L195\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nload_dialect_impl(self, dialect: sa.Dialect) -> TypeEngine[Any]\n```\n\n#### `process_bind_param` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/utilities/database.py#L201\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nprocess_bind_param(self, value: Optional[Union[str, uuid.UUID]], dialect: sa.Dialect) -> Optional[str]\n```\n\n#### `process_result_value` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/utilities/database.py#L213\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nprocess_result_value(self, value: Optional[Union[str, uuid.UUID]], dialect: sa.Dialect) -> Optional[uuid.UUID]\n```\n\n### `JSON` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/utilities/database.py#L224\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\nJSON type that returns SQLAlchemy's dialect-specific JSON types, where\npossible. Uses generic JSON otherwise.\n\nThe \"base\" type is postgresql.JSONB to expose useful methods prior\nto SQL compilation\n\n**Methods:**\n\n#### `load_dialect_impl` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/utilities/database.py#L238\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nload_dialect_impl(self, dialect: sa.Dialect) -> TypeEngine[Any]\n```\n\n#### `process_bind_param` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/utilities/database.py#L246\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nprocess_bind_param(self, value: Optional[Any], dialect: sa.Dialect) -> Optional[Any]\n```\n\nPrepares the given value to be used as a JSON field in a parameter binding\n\n### `Pydantic` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/utilities/database.py#L267\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\nA pydantic type that converts inserted parameters to\njson and converts read values to the pydantic type.\n\n**Methods:**\n\n#### `process_bind_param` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/utilities/database.py#L306\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nprocess_bind_param(self, value: Optional[T], dialect: sa.Dialect) -> Optional[str]\n```\n\n#### `process_result_value` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/utilities/database.py#L320\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nprocess_result_value(self, value: Optional[Any], dialect: sa.Dialect) -> Optional[T]\n```\n\n### `date_add` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/utilities/database.py#L346\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\nPlatform-independent way to add a timestamp and an interval\n\n### `interval_add` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/utilities/database.py#L365\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\nPlatform-independent way to add two intervals.\n\n### `date_diff` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/utilities/database.py#L384\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\nPlatform-independent difference of two timestamps. Computes d1 - d2.\n\n### `date_diff_seconds` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/utilities/database.py#L401\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\nPlatform-independent calculation of the number of seconds between two timestamps or from 'now'\n\n### `greatest` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/utilities/database.py#L704\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n### `least` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/utilities/database.py#L727\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>",
  "content_length": 12987
}