{
  "title": "Develop on Prefect",
  "source_url": "https://docs-3.prefect.io/contribute/dev-contribute",
  "content": "Learn how to set up Prefect for development, experimentation and code contributions.\n\n## Make a code contribution\n\nWe welcome all forms of contributions to Prefect, whether it's small typo fixes in [our documentation](/contribute/docs-contribute), bug fixes or feature enhancements!\nIf this is your first time making an open source contribution we will be glad to work with you and help you get up to speed.\n\n<Note>\n  For small changes such as typo fixes you can simply open a pull request - we typically review small changes like these within the day.\n  For larger changes including all bug fixes, we ask that you first open [an issue](https://github.com/PrefectHQ/prefect/issues) or comment on the issue that you are planning to work on.\n</Note>\n\n## Fork the repository\n\nAll contributions to Prefect need to start on [a fork of the repository](https://docs.github.com/en/pull-requests/collaborating-with-pull-requests/working-with-forks/fork-a-repo).\nOnce you have successfully forked [the Prefect repo](https://github.com/PrefectHQ/prefect), clone a local version to your machine:\n\n```bash  theme={null}\ngit clone https://github.com/GITHUB-USERNAME/prefect.git\ncd prefect\n```\n\nCreate a branch with an informative name:\n\n```\ngit checkout -b fix-for-issue-NUM\n```\n\nAfter committing your changes to this branch, you can then open a pull request from your fork that we will review with you.\n\n## Install Prefect for development\n\nOnce you have cloned your fork of the repo you can install [an editable version](https://setuptools.pypa.io/en/latest/userguide/development_mode.html) of Prefect for quick iteration.\n\nWe recommend using `uv` for dependency management when developing. Refer to the [`uv` docs for installation instructions](https://docs.astral.sh/uv/getting-started/installation/).\n\nTo set up a virtual environment and install a development version of `prefect`:\n\n<CodeGroup>\n  ```bash uv theme={null}\n  uv sync\n  ```\n\n  ```bash pip and venv theme={null}\n  python -m venv .venv\n  source .venv/bin/activate\n\n  # Installs the package with development dependencies\n  pip install -e \".[dev]\"\n  ```\n</CodeGroup>\n\nTo verify `prefect` was install correctly:\n\n<CodeGroup>\n  ```bash uv theme={null}\n  uv run prefect --version\n  ```\n\n  ```bash pip and venv theme={null}\n  prefect --version\n  ```\n</CodeGroup>\n\nTo ensure your changes comply with our linting policies, set up `pre-commit` and `pre-push` hooks to run with every commit:\n\n```bash  theme={null}\nuv run pre-commit install\n```\n\nTo manually run the `pre-commit` hooks against all files:\n\n```bash  theme={null}\nuv run pre-commit run --all-files\n```\n\nTo manually run the pre-push hooks:\n\n```bash  theme={null}\nuv run pre-commit run --hook-stage pre-push --all-files\n```\n\n<Tip>\n  If you're using `uv`, you can run commands with the project's dependencies by prefixing the command with `uv run`.\n</Tip>\n\n## Write tests\n\nPrefect relies on unit testing to ensure proposed changes don't negatively impact any functionality.\nFor all code changes, including bug fixes, we ask that you write at least one corresponding test.\nOne rule of thumb - especially for bug fixes - is that you should write a test that fails prior to your changes and passes with your changes.\nThis ensures the test will fail and prevent the bug from resurfacing if other changes are made in the future.\nAll tests can be found in the `tests/` directory of the repository.\n\nYou can run the test suite with `pytest`:\n\n```bash  theme={null}\n# run all tests\npytest tests\n\n# run a specific file\npytest tests/test_flows.py\n\n# run all tests that match a pattern\npytest tests/test_tasks.py -k cache_policy\n```\n\n## Working with a development UI\n\nIf you plan to use the UI during development, you will need to build a development version of the UI first.\n\nUsing the Prefect UI in development requires installation of [npm](https://github.com/npm/cli).\nWe recommend using [nvm](https://github.com/nvm-sh/nvm) to manage Node.js versions.\nOnce installed, run `nvm use` from the root of the Prefect repository to initialize the proper version of `npm` and `node`.\n\nStart a development UI that reloads on code changes:\n\n```bash  theme={null}\nprefect dev ui\n```\n\nThis command is most useful if you are working directly on the UI codebase.\n\nAlternatively, you can build a static UI that will be served when running `prefect server start`:\n\n```bash  theme={null}\nprefect dev build-ui\n```\n\n## Working with a development server\n\nThe Prefect CLI provides several helpful commands to aid development of server-side changes.\n\nYou can start all services with hot-reloading on code changes (note that this requires installation of UI dependencies):\n\n```bash  theme={null}\nprefect dev start\n```\n\nStart a Prefect API that reloads on code changes:\n\n```bash  theme={null}\nprefect dev api\n```\n\n## Add database migrations\n\nIf your code changes necessitate modifications to a database table, first update the SQLAlchemy model in `src/prefect/server/database/orm_models.py`.\n\nFor example, to add a new column to the `flow_run` table, add a new column to the `FlowRun` model:\n\n```python  theme={null}\n# src/prefect/server/database/orm_models.py\n\nclass FlowRun(Run):\n    \"\"\"SQLAlchemy model of a flow run.\"\"\"\n    ...\n    new_column: Mapped[Union[str, None]] = mapped_column(sa.String, nullable=True) # <-- add this line\n```\n\nNext, generate new migration files.\nGenerate a new migration file for each database type.\n\nMigrations are generated for whichever database type `PREFECT_API_DATABASE_CONNECTION_URL` is set to.\nSee [how to set the database connection URL](/v3/api-ref/settings-ref#connection-url) for each database type.\n\nTo generate a new migration file, run:\n\n```bash  theme={null}\nprefect server database revision --autogenerate -m \"<migration name>\"\n```\n\nMake the migration name brief but descriptive.\nFor example:\n\n* `add_flow_run_new_column`\n* `add_flow_run_new_column_idx`\n* `rename_flow_run_old_column_to_new_column`\n\nThe `--autogenerate` flag automatically generates a migration file based on the changes to the models.\n\n<Warning>\n  **Always inspect the output of `--autogenerate`**\n\n  `--autogenerate` generates a migration file based on the changes to the models.\n  However, it is not perfect. Check the file to ensure it only includes the desired changes.\n</Warning>\n\nThe new migration is in the `src/prefect/server/database/migrations/versions/` directory. Each database type has its\nown subdirectory. For example, the SQLite migrations are stored in `src/prefect/server/database/migrations/versions/sqlite/`.\n\nAfter inspecting the migration file, apply the migration to the database by running:\n\n```bash  theme={null}\nprefect server database upgrade -y\n```\n\nAfter successfully creating migrations for all database types, update `MIGRATION-NOTES.md` to\ndocument the changes.",
  "content_length": 6780
}