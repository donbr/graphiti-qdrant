{
  "title": "Runtime context",
  "source_url": "https://docs-3.prefect.io/v3/concepts/runtime-context",
  "content": "The runtime context allows global access to information about the current run.\n\nPrefect tracks information about the current flow or task run with a run context.\n\nThe run context is like a global variable that allows the Prefect engine to determine relationships\nbetween your runs, such as which flow your task was called from.\n\nThe run context itself contains many internal objects used by Prefect to manage execution of\nyour run, and is only available in specific situations. For this reason, we expose a simple interface\nthat only includes the items you care about and dynamically retrieves additional information when necessary.\nWe call this the \"runtime context\" as it contains information that's only accessible during a run.\n\n<Tip>\n  **Mock values through environment variable**\n  You may want to mock certain values for testing purposes. For example, by manually setting an ID or\n  a scheduled start time to ensure your code is functioning properly.\n\n  Mock values in runtime through an environment variable using the schema\n  `PREFECT__RUNTIME__{SUBMODULE}__{KEY_NAME}=value`:\n\n  ```bash  theme={null}\n  export PREFECT__RUNTIME__TASK_RUN__FAKE_KEY='foo'\n  python -c 'from prefect.runtime import task_run; print(task_run.fake_key)' # \"foo\"\n  ```\n\n  If the environment variable mocks an existing runtime attribute, the value is cast to the same type.\n  This works for runtime attributes of basic types (`bool`, `int`, `float` and `str`) and `datetime.datetime`.\n  For complex types like `list` or `dict`, we suggest mocking them using\n  [monkeypatch](https://docs.pytest.org/en/latest/how-to/monkeypatch.html) or a similar tool.\n</Tip>\n\n## Access runtime information\n\nThe `prefect.runtime` module is the home for all runtime context access. Each major runtime concept\nhas its own submodule:\n\n* `deployment`: Access information about the deployment for the current run\n* `flow_run`: Access information about the current flow run\n* `task_run`: Access information about the current task run\n\nFor example:\n\n```python my_runtime_info.py theme={null}\nfrom prefect import flow, task\nfrom prefect import runtime\n\n@flow(log_prints=True)\ndef my_flow(x):\n    print(\"My name is\", runtime.flow_run.name)\n    print(\"I belong to deployment\", runtime.deployment.name)\n    my_task(2)\n\n@task\ndef my_task(y):\n    print(\"My name is\", runtime.task_run.name)\n    print(\"Flow run parameters:\", runtime.flow_run.parameters)\n\nif __name__ == \"__main__\":\n    my_flow(1)\n```\n\nRunning this file produces output similar to the following:\n\n```bash  theme={null}\n10:08:02.948 | INFO    | prefect.engine - Created flow run 'solid-gibbon' for flow 'my-flow'\n10:08:03.555 | INFO    | Flow run 'solid-gibbon' - My name is solid-gibbon\n10:08:03.558 | INFO    | Flow run 'solid-gibbon' - I belong to deployment None\n10:08:03.703 | INFO    | Flow run 'solid-gibbon' - Created task run 'my_task-0' for task 'my_task'\n10:08:03.704 | INFO    | Flow run 'solid-gibbon' - Executing 'my_task-0' immediately...\n10:08:04.006 | INFO    | Task run 'my_task-0' - My name is my_task-0\n10:08:04.007 | INFO    | Task run 'my_task-0' - Flow run parameters: {'x': 1}\n10:08:04.105 | INFO    | Task run 'my_task-0' - Finished in state Completed()\n10:08:04.968 | INFO    | Flow run 'solid-gibbon' - Finished in state Completed('All states completed.')\n```\n\nThe above example demonstrates access to information about the current flow run, task run, and deployment.\nWhen run without a deployment (through `python my_runtime_info.py`), you should see `\"I belong to deployment None\"` logged.\nWhen information is not available, the runtime always returns an empty value.\nBecause this flow runs outside of a deployment, there is no deployment data.\nIf this flow was run as part of a deployment, we'd see the name of the deployment instead.\n\nSee the [runtime API reference](https://reference.prefect.io/prefect/runtime/flow_run/) for a full list of available attributes.\n\n## Access the run context directly\n\nAccess the current run context with `prefect.context.get_run_context()`.\nThis function raises an exception if no run context is available, meaning you are not in a flow or task run.\nIf a task run context is available, it is returned even if a flow run context is available.\n\nAlternatively, you can access the flow run or task run context explicitly.\nFor example, this allows you to access the flow run context from a task run.\n\nPrefect does not send the flow run context to distributed task workers because the context is\ncostly to serialize and deserialize.\n\n```python  theme={null}\nfrom prefect.context import FlowRunContext, TaskRunContext\n\nflow_run_ctx = FlowRunContext.get()\ntask_run_ctx = TaskRunContext.get()\n```\n\nUnlike `get_run_context`, these method calls do not raise an error if the context is unavailable.\nInstead, they return `None`.",
  "content_length": 4797
}