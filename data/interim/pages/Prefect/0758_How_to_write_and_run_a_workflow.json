{
  "title": "How to write and run a workflow",
  "source_url": "https://docs-3.prefect.io/v3/how-to-guides/workflows/write-and-run",
  "content": "### Define a workflow\n\nMake a Python function a workflow by adding the `@flow` decorator to it:\n\n```python  theme={null}\nfrom prefect import flow\n\n\n@flow\ndef my_workflow() -> str:\n    return \"Hello, world!\"\n```\n\nRun the workflow by calling it like a normal Python function:\n\n```python  theme={null}\nmy_workflow()\n```\n\nYou can create a workflow from a method on a class:\n\n```python  theme={null}\nfrom prefect import flow\n\n\nclass MyClass:\n\n    @flow\n    def my_instance_method(self):\n        return \"Hello, from an instance method!\"\n\n\n    @flow\n    @classmethod\n    def my_class_method(cls):\n        return \"Hello, from a class method!\"\n\n\n    @flow\n    @staticmethod\n    def my_static_method():\n        return \"Hello, from a static method!\"\n\n\nMyClass().my_instance_method()\nMyClass.my_class_method()\nMyClass.my_static_method()\n```\n\nor from a generator function:\n\n```python  theme={null}\nfrom prefect import flow\n\n\n@flow\ndef generator():\n    for i in range(10):\n        yield i\n\n\nfor val in generator():\n    print(val)\n```\n\nYou can view all workflow runs in the Prefect UI.\n\n### Create tasks and child workflows\n\nYou can create tasks and child flows to organize your workflow logic.\n\n```python  theme={null}\nfrom prefect import flow, task\n\n\n@task\ndef generate_a_number():\n    return random.randint(0, 100)\n\n\n@flow\ndef is_number_even(number: int):\n    return number % 2 == 0\n\n\n@flow\ndef even_or_odd():\n    number = generate_a_number()\n    if is_number_even(number):\n        print(\"The number is even\")\n    else:\n        print(\"The number is odd\")\n```\n\nEach task and child flow is a separate unit of work and is displayed in the Prefect UI.\n\n### Cancel a workflow if it runs for too long\n\nTo apply a timeout to a flow or task to prevent it from running for too long, use the `timeout_seconds` keyword argument.\n\n```python  theme={null}\nfrom prefect import flow\nimport time\n\n@flow(timeout_seconds=1, log_prints=True)\ndef show_timeouts():\n    print(\"I will execute\")\n    time.sleep(5)\n    print(\"I will not execute\")\n```\n\n## Configure flows and tasks\n\n### Flow configuration\n\nAll flows can be configured by passing arguments to the decorator. Flows accept the following optional settings:\n\n| Argument                                           | Description                                                                                                                                                                                                          |\n| -------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |\n| `description`                                      | An optional string description for the flow. If not provided, the description is pulled from the docstring for the decorated function.                                                                               |\n| `name`                                             | An optional name for the flow. If not provided, the name is inferred from the function.                                                                                                                              |\n| `retries`                                          | An optional number of times to retry on flow run failure.                                                                                                                                                            |\n| <span class=\"no-wrap\">`retry_delay_seconds`</span> | An optional number of seconds to wait before retrying the flow after failure. This is only applicable if `retries` is nonzero.                                                                                       |\n| `flow_run_name`                                    | An optional name to distinguish runs of this flow; this name can be provided as a string template with the flow's parameters as variables; you can also provide this name as a function that returns a string.       |\n| `task_runner`                                      | An optional [task runner](/v3/concepts/task-runners/) to use for task execution within the flow when you `.submit()` tasks. If not provided and you `.submit()` tasks, the `ThreadPoolTaskRunner` is used.           |\n| `timeout_seconds`                                  | An optional number of seconds indicating a maximum runtime for the flow. If the flow exceeds this runtime, it is marked as failed. Flow execution may continue until the next task is called.                        |\n| `validate_parameters`                              | Boolean indicating whether parameters passed to flows are validated by Pydantic. Default is `True`.                                                                                                                  |\n| `version`                                          | An optional version string for the flow. If not provided, we will attempt to create a version string as a hash of the file containing the wrapped function. If the file cannot be located, the version will be null. |\n\n### Task configuration\n\nTasks allow for customization through optional arguments that can be provided to the [task decorator](https://reference.prefect.io/prefect/tasks/#prefect.tasks.task).\n\n| Argument              | Description                                                                                                                                                                                                                |\n| --------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |\n| `name`                | An optional name for the task. If not provided, the name is inferred from the function name.                                                                                                                               |\n| `description`         | An optional string description for the task. If not provided, the description is pulled from the docstring for the decorated function.                                                                                     |\n| `tags`                | An optional set of tags associated with runs of this task. These tags are combined with any tags defined by a `prefect.tags` context at task runtime.                                                                      |\n| `timeout_seconds`     | An optional number of seconds indicating a maximum runtime for the task. If the task exceeds this runtime, it will be marked as failed.                                                                                    |\n| `cache_key_fn`        | An optional callable that, given the task run context and call parameters, generates a string key. If the key matches a previous completed state, that state result is restored instead of running the task again.         |\n| `cache_policy`        | An optional policy that determines what information is used to generate cache keys. Available policies include `INPUTS`, `TASK_SOURCE`, `RUN_ID`, `FLOW_PARAMETERS`, and `NO_CACHE`. Can be combined using the + operator. |\n| `cache_expiration`    | An optional amount of time indicating how long cached states for this task are restorable; if not provided, cached states will never expire.                                                                               |\n| `retries`             | An optional number of times to retry on task run failure.                                                                                                                                                                  |\n| `retry_delay_seconds` | An optional number of seconds to wait before retrying the task after failure. This is only applicable if `retries` is nonzero.                                                                                             |\n| `log_prints`          | An optional boolean indicating whether to log print statements.                                                                                                                                                            |\n\nSee all possible options in the [Python SDK docs](https://reference.prefect.io/prefect/tasks/#prefect.tasks.task).\n\nFor example, provide optional `name` and `description` arguments to a task:\n\n```python  theme={null}\nfrom prefect import task\n\n\n@task(name=\"hello-task\", description=\"This task says hello.\")\ndef my_task():\n    print(\"Hello, I'm a task\")\n```\n\nDistinguish runs of this task by providing a `task_run_name`.\\\nPython's standard string formatting syntax applies:\n\n```python  theme={null}\nimport datetime\nfrom prefect import flow, task\n\n\n@task(name=\"My Example Task\", \n      description=\"An example task for a tutorial.\",\n      task_run_name=\"hello-{name}-on-{date:%A}\")\ndef my_task(name, date):\n    pass\n\n\n@flow\ndef my_flow():\n    # creates a run with a name like \"hello-marvin-on-Thursday\"\n    my_task(name=\"marvin\", date=datetime.datetime.now(datetime.timezone.utc))\n\nif __name__ == \"__main__\":\n    my_flow()\n```\n\nAdditionally, this setting accepts a function that returns a string for the task run name:\n\n```python  theme={null}\nimport datetime\nfrom prefect import flow, task\n\n\ndef generate_task_name():\n    date = datetime.datetime.now(datetime.timezone.utc)\n    return f\"{date:%A}-is-a-lovely-day\"\n\n\n@task(name=\"My Example Task\",\n      description=\"An example task for the docs.\",\n      task_run_name=generate_task_name)\ndef my_task(name):\n    pass\n\n\n@flow\ndef my_flow():\n    # creates a run with a name like \"Thursday-is-a-lovely-day\"\n    my_task(name=\"marvin\")\n\n\nif __name__ == \"__main__\":\n    my_flow()  \n```",
  "content_length": 9836
}