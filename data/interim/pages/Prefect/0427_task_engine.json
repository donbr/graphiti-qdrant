{
  "title": "task_engine",
  "source_url": "https://docs-3.prefect.io/v3/api-ref/python/prefect-task_engine",
  "content": "# `prefect.task_engine`\n\n## Functions\n\n### `run_task_sync` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/task_engine.py#L1512\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nrun_task_sync(task: 'Task[P, R]', task_run_id: Optional[UUID] = None, task_run: Optional[TaskRun] = None, parameters: Optional[dict[str, Any]] = None, wait_for: Optional['OneOrManyFutureOrResult[Any]'] = None, return_type: Literal['state', 'result'] = 'result', dependencies: Optional[dict[str, set[RunInput]]] = None, context: Optional[dict[str, Any]] = None) -> Union[R, State, None]\n```\n\n### `run_task_async` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/task_engine.py#L1543\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nrun_task_async(task: 'Task[P, R]', task_run_id: Optional[UUID] = None, task_run: Optional[TaskRun] = None, parameters: Optional[dict[str, Any]] = None, wait_for: Optional['OneOrManyFutureOrResult[Any]'] = None, return_type: Literal['state', 'result'] = 'result', dependencies: Optional[dict[str, set[RunInput]]] = None, context: Optional[dict[str, Any]] = None) -> Union[R, State, None]\n```\n\n### `run_generator_task_sync` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/task_engine.py#L1574\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nrun_generator_task_sync(task: 'Task[P, R]', task_run_id: Optional[UUID] = None, task_run: Optional[TaskRun] = None, parameters: Optional[dict[str, Any]] = None, wait_for: Optional['OneOrManyFutureOrResult[Any]'] = None, return_type: Literal['state', 'result'] = 'result', dependencies: Optional[dict[str, set[RunInput]]] = None, context: Optional[dict[str, Any]] = None) -> Generator[R, None, None]\n```\n\n### `run_generator_task_async` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/task_engine.py#L1633\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nrun_generator_task_async(task: 'Task[P, R]', task_run_id: Optional[UUID] = None, task_run: Optional[TaskRun] = None, parameters: Optional[dict[str, Any]] = None, wait_for: Optional['OneOrManyFutureOrResult[Any]'] = None, return_type: Literal['state', 'result'] = 'result', dependencies: Optional[dict[str, set[RunInput]]] = None, context: Optional[dict[str, Any]] = None) -> AsyncGenerator[R, None]\n```\n\n### `run_task` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/task_engine.py#L1719\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nrun_task(task: 'Task[P, Union[R, Coroutine[Any, Any, R]]]', task_run_id: Optional[UUID] = None, task_run: Optional[TaskRun] = None, parameters: Optional[dict[str, Any]] = None, wait_for: Optional['OneOrManyFutureOrResult[Any]'] = None, return_type: Literal['state', 'result'] = 'result', dependencies: Optional[dict[str, set[RunInput]]] = None, context: Optional[dict[str, Any]] = None) -> Union[R, State, None, Coroutine[Any, Any, Union[R, State, None]]]\n```\n\nRuns the provided task.\n\n**Args:**\n\n* `task`: The task to run\n* `task_run_id`: The ID of the task run; if not provided, a new task run\n  will be created\n* `task_run`: The task run object; if not provided, a new task run\n  will be created\n* `parameters`: The parameters to pass to the task\n* `wait_for`: A list of futures to wait for before running the task\n* `return_type`: The return type to return; either \"state\" or \"result\"\n* `dependencies`: A dictionary of task run inputs to use for dependency tracking\n* `context`: A dictionary containing the context to use for the task run; only\n  required if the task is running on in a remote environment\n\n**Returns:**\n\n* The result of the task run\n\n## Classes\n\n### `TaskRunTimeoutError` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/task_engine.py#L115\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\nRaised when a task run exceeds its timeout.\n\n### `BaseTaskRunEngine` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/task_engine.py#L120\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n**Methods:**\n\n#### `compute_transaction_key` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/task_engine.py#L157\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\ncompute_transaction_key(self) -> Optional[str]\n```\n\n#### `handle_rollback` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/task_engine.py#L297\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nhandle_rollback(self, txn: Transaction) -> None\n```\n\n#### `is_cancelled` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/task_engine.py#L148\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nis_cancelled(self) -> bool\n```\n\n#### `is_running` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/task_engine.py#L253\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nis_running(self) -> bool\n```\n\nWhether or not the engine is currently running a task.\n\n#### `log_finished_message` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/task_engine.py#L259\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nlog_finished_message(self) -> None\n```\n\n#### `record_terminal_state_timing` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/task_engine.py#L246\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nrecord_terminal_state_timing(self, state: State) -> None\n```\n\n#### `state` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/task_engine.py#L143\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nstate(self) -> State\n```\n\n### `SyncTaskRunEngine` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/task_engine.py#L314\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n**Methods:**\n\n#### `asset_context` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/task_engine.py#L685\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nasset_context(self)\n```\n\n#### `begin_run` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/task_engine.py#L398\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nbegin_run(self) -> None\n```\n\n#### `call_hooks` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/task_engine.py#L361\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\ncall_hooks(self, state: Optional[State] = None) -> None\n```\n\n#### `call_task_fn` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/task_engine.py#L890\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\ncall_task_fn(self, transaction: Transaction) -> Union[ResultRecord[Any], None, Coroutine[Any, Any, R], R]\n```\n\nConvenience method to call the task function. Returns a coroutine if the\ntask is async.\n\n#### `can_retry` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/task_engine.py#L324\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\ncan_retry(self, exc_or_state: Exception | State[R]) -> bool\n```\n\n#### `client` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/task_engine.py#L319\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nclient(self) -> SyncPrefectClient\n```\n\n#### `handle_crash` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/task_engine.py#L631\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nhandle_crash(self, exc: BaseException) -> None\n```\n\n#### `handle_exception` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/task_engine.py#L599\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nhandle_exception(self, exc: Exception) -> None\n```\n\n#### `handle_retry` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/task_engine.py#L544\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nhandle_retry(self, exc_or_state: Exception | State[R]) -> bool\n```\n\nHandle any task run retries.\n\n* If the task has retries left, and the retry condition is met, set the task to retrying and return True.\n* If the task has a retry delay, place in AwaitingRetry state with a delayed scheduled time.\n* If the task has no retries left, or the retry condition is not met, return False.\n\n#### `handle_success` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/task_engine.py#L504\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nhandle_success(self, result: R, transaction: Transaction) -> Union[ResultRecord[R], None, Coroutine[Any, Any, R], R]\n```\n\n#### `handle_timeout` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/task_engine.py#L616\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nhandle_timeout(self, exc: TimeoutError) -> None\n```\n\n#### `initialize_run` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/task_engine.py#L703\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\ninitialize_run(self, task_run_id: Optional[UUID] = None, dependencies: Optional[dict[str, set[RunInput]]] = None) -> Generator[Self, Any, Any]\n```\n\nEnters a client context and creates a task run if needed.\n\n#### `result` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/task_engine.py#L489\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nresult(self, raise_on_failure: bool = True) -> 'Union[R, State, None]'\n```\n\n#### `run_context` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/task_engine.py#L870\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nrun_context(self)\n```\n\n#### `set_state` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/task_engine.py#L438\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nset_state(self, state: State[R], force: bool = False) -> State[R]\n```\n\n#### `setup_run_context` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/task_engine.py#L641\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nsetup_run_context(self, client: Optional[SyncPrefectClient] = None)\n```\n\n#### `start` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/task_engine.py#L800\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nstart(self, task_run_id: Optional[UUID] = None, dependencies: Optional[dict[str, set[RunInput]]] = None) -> Generator[None, None, None]\n```\n\n#### `transaction_context` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/task_engine.py#L843\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\ntransaction_context(self) -> Generator[Transaction, None, None]\n```\n\n#### `wait_until_ready` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/task_engine.py#L777\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nwait_until_ready(self) -> None\n```\n\nWaits until the scheduled time (if its the future), then enters Running.\n\n### `AsyncTaskRunEngine` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/task_engine.py#L907\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n**Methods:**\n\n#### `asset_context` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/task_engine.py#L1292\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nasset_context(self)\n```\n\n#### `begin_run` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/task_engine.py#L990\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nbegin_run(self) -> None\n```\n\n#### `call_hooks` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/task_engine.py#L953\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\ncall_hooks(self, state: Optional[State] = None) -> None\n```\n\n#### `call_task_fn` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/task_engine.py#L1496\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\ncall_task_fn(self, transaction: AsyncTransaction) -> Union[ResultRecord[Any], None, Coroutine[Any, Any, R], R]\n```\n\nConvenience method to call the task function. Returns a coroutine if the\ntask is async.\n\n#### `can_retry` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/task_engine.py#L917\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\ncan_retry(self, exc_or_state: Exception | State[R]) -> bool\n```\n\n#### `client` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/task_engine.py#L912\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nclient(self) -> PrefectClient\n```\n\n#### `handle_crash` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/task_engine.py#L1237\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nhandle_crash(self, exc: BaseException) -> None\n```\n\n#### `handle_exception` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/task_engine.py#L1205\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nhandle_exception(self, exc: Exception) -> None\n```\n\n#### `handle_retry` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/task_engine.py#L1149\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nhandle_retry(self, exc_or_state: Exception | State[R]) -> bool\n```\n\nHandle any task run retries.\n\n* If the task has retries left, and the retry condition is met, set the task to retrying and return True.\n* If the task has a retry delay, place in AwaitingRetry state with a delayed scheduled time.\n* If the task has no retries left, or the retry condition is not met, return False.\n\n#### `handle_success` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/task_engine.py#L1112\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nhandle_success(self, result: R, transaction: AsyncTransaction) -> Union[ResultRecord[R], None, Coroutine[Any, Any, R], R]\n```\n\n#### `handle_timeout` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/task_engine.py#L1220\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nhandle_timeout(self, exc: TimeoutError) -> None\n```\n\n#### `initialize_run` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/task_engine.py#L1310\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\ninitialize_run(self, task_run_id: Optional[UUID] = None, dependencies: Optional[dict[str, set[RunInput]]] = None) -> AsyncGenerator[Self, Any]\n```\n\nEnters a client context and creates a task run if needed.\n\n#### `result` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/task_engine.py#L1097\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nresult(self, raise_on_failure: bool = True) -> 'Union[R, State, None]'\n```\n\n#### `run_context` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/task_engine.py#L1476\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nrun_context(self)\n```\n\n#### `set_state` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/task_engine.py#L1044\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nset_state(self, state: State, force: bool = False) -> State\n```\n\n#### `setup_run_context` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/task_engine.py#L1248\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nsetup_run_context(self, client: Optional[PrefectClient] = None)\n```\n\n#### `start` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/task_engine.py#L1405\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nstart(self, task_run_id: Optional[UUID] = None, dependencies: Optional[dict[str, set[RunInput]]] = None) -> AsyncGenerator[None, None]\n```\n\n#### `transaction_context` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/task_engine.py#L1450\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\ntransaction_context(self) -> AsyncGenerator[AsyncTransaction, None]\n```\n\n#### `wait_until_ready` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/task_engine.py#L1382\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nwait_until_ready(self) -> None\n```\n\nWaits until the scheduled time (if its the future), then enters Running.",
  "content_length": 18955
}