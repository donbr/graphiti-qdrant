{
  "title": "How to test workflows",
  "source_url": "https://docs-3.prefect.io/v3/how-to-guides/workflows/test-workflows",
  "content": "Learn about writing tests for Prefect flows and tasks.\n\n### Isolate tests with an ephemeral backend\n\nPrefect provides a simple context manager for unit tests that allows you to run flows and tasks against a temporary local SQLite database.\n\n```python  theme={null}\nfrom prefect import flow\nfrom prefect.testing.utilities import prefect_test_harness\n\n@flow\ndef my_favorite_flow():\n    return 42\n\ndef test_my_favorite_flow():\n  with prefect_test_harness():\n      # run the flow against a temporary testing database\n      assert my_favorite_flow() == 42\n```\n\nFor more extensive testing, use `prefect_test_harness` as a fixture in your unit testing framework. For example, when using `pytest`:\n\n```python  theme={null}\nfrom prefect import flow\nimport pytest\nfrom prefect.testing.utilities import prefect_test_harness\n\n@pytest.fixture(autouse=True, scope=\"session\")\ndef prefect_test_fixture():\n    with prefect_test_harness():\n        yield\n\n@flow\ndef my_favorite_flow():\n    return 42\n\ndef test_my_favorite_flow():\n    assert my_favorite_flow() == 42\n```\n\n<Note>\n  **Session scoped fixture**\n\n  In this example, the fixture is scoped to run once for the entire test session. In most cases, you do not need a clean database for each test. Just isolate your test runs to a test database. Creating a new test database per test creates significant overhead, so we recommend scoping the fixture to the session. If you need to isolate some tests fully, use the test harness again to create a fresh database.\n</Note>\n\n### Unit testing underlying functions\n\nTo test the function decorated with `@task` or `@flow`, use `.fn` to call the wrapped function directly:\n\n```python  theme={null}\nfrom prefect import flow, task\n\n@task\ndef my_favorite_task():\n    return 42\n\n@flow\ndef my_favorite_flow():\n    val = my_favorite_task()\n    return val\n\ndef test_my_favorite_task():\n    assert my_favorite_task.fn() == 42\n```\n\nIf your flow or task uses a logger, you can disable the logger to avoid the `RuntimeError` raised from a missing flow context.\n\n```python  theme={null}\nfrom prefect.logging import disable_run_logger\n\ndef test_my_favorite_task():\n    with disable_run_logger():\n        assert my_favorite_task.fn() == 42\n```",
  "content_length": 2207
}