{
  "title": "core_policy",
  "source_url": "https://docs-3.prefect.io/v3/api-ref/python/prefect-server-orchestration-core_policy",
  "content": "# `prefect.server.orchestration.core_policy`\n\nOrchestration logic that fires on state transitions.\n\n`CoreFlowPolicy` and `CoreTaskPolicy` contain all default orchestration rules that\nPrefect enforces on a state transition.\n\n## Classes\n\n### `CoreFlowPolicy` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/orchestration/core_policy.py#L66\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\nOrchestration rules that run against flow-run-state transitions in priority order.\n\n**Methods:**\n\n#### `priority` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/orchestration/core_policy.py#L72\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\npriority() -> list[Union[type[BaseUniversalTransform[orm_models.FlowRun, core.FlowRunPolicy]], type[BaseOrchestrationRule[orm_models.FlowRun, core.FlowRunPolicy]]]]\n```\n\n### `CoreTaskPolicy` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/orchestration/core_policy.py#L108\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\nOrchestration rules that run against task-run-state transitions in priority order.\n\n**Methods:**\n\n#### `priority` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/orchestration/core_policy.py#L114\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\npriority() -> list[Union[type[BaseUniversalTransform[orm_models.TaskRun, core.TaskRunPolicy]], type[BaseOrchestrationRule[orm_models.TaskRun, core.TaskRunPolicy]]]]\n```\n\n### `ClientSideTaskOrchestrationPolicy` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/orchestration/core_policy.py#L145\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\nOrchestration rules that run against task-run-state transitions in priority order,\nspecifically for clients doing client-side orchestration.\n\n**Methods:**\n\n#### `priority` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/orchestration/core_policy.py#L152\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\npriority() -> list[Union[type[BaseUniversalTransform[orm_models.TaskRun, core.TaskRunPolicy]], type[BaseOrchestrationRule[orm_models.TaskRun, core.TaskRunPolicy]]]]\n```\n\n### `BackgroundTaskPolicy` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/orchestration/core_policy.py#L182\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\nOrchestration rules that run against task-run-state transitions in priority order.\n\n**Methods:**\n\n#### `priority` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/orchestration/core_policy.py#L188\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\npriority() -> list[type[BaseUniversalTransform[orm_models.TaskRun, core.TaskRunPolicy]] | type[BaseOrchestrationRule[orm_models.TaskRun, core.TaskRunPolicy]]]\n```\n\n### `MinimalFlowPolicy` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/orchestration/core_policy.py#L219\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n**Methods:**\n\n#### `priority` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/orchestration/core_policy.py#L221\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\npriority() -> list[Union[type[BaseUniversalTransform[orm_models.FlowRun, core.FlowRunPolicy]], type[BaseOrchestrationRule[orm_models.FlowRun, core.FlowRunPolicy]]]]\n```\n\n### `MarkLateRunsPolicy` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/orchestration/core_policy.py#L234\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n**Methods:**\n\n#### `priority` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/orchestration/core_policy.py#L236\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\npriority() -> list[Union[type[BaseUniversalTransform[orm_models.FlowRun, core.FlowRunPolicy]], type[BaseOrchestrationRule[orm_models.FlowRun, core.FlowRunPolicy]]]]\n```\n\n### `MinimalTaskPolicy` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/orchestration/core_policy.py#L248\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n**Methods:**\n\n#### `priority` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/orchestration/core_policy.py#L250\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\npriority() -> list[Union[type[BaseUniversalTransform[orm_models.TaskRun, core.TaskRunPolicy]], type[BaseOrchestrationRule[orm_models.TaskRun, core.TaskRunPolicy]]]]\n```\n\n### `SecureTaskConcurrencySlots` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/orchestration/core_policy.py#L261\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\nChecks relevant concurrency slots are available before entering a Running state.\n\nThis rule checks if concurrency limits have been set on the tags associated with a\nTaskRun. If so, a concurrency slot will be secured against each concurrency limit\nbefore being allowed to transition into a running state. If a concurrency limit has\nbeen reached, the client will be instructed to delay the transition for the duration\nspecified by the \"PREFECT\\_TASK\\_RUN\\_TAG\\_CONCURRENCY\\_SLOT\\_WAIT\\_SECONDS\" setting\nbefore trying again. If the concurrency limit set on a tag is 0, the transition will\nbe aborted to prevent deadlocks.\n\n**Methods:**\n\n#### `before_transition` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/orchestration/core_policy.py#L277\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nbefore_transition(self, initial_state: states.State[Any] | None, proposed_state: states.State[Any] | None, context: OrchestrationContext[orm_models.TaskRun, core.TaskRunPolicy]) -> None\n```\n\n#### `cleanup` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/orchestration/core_policy.py#L417\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\ncleanup(self, initial_state: states.State[Any] | None, validated_state: states.State[Any] | None, context: OrchestrationContext[orm_models.TaskRun, core.TaskRunPolicy]) -> None\n```\n\n### `ReleaseTaskConcurrencySlots` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/orchestration/core_policy.py#L454\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\nReleases any concurrency slots held by a run upon exiting a Running or\nCancelling state.\n\n**Methods:**\n\n#### `after_transition` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/orchestration/core_policy.py#L460\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nafter_transition(self, context: OrchestrationContext[orm_models.TaskRun, core.TaskRunPolicy]) -> None\n```\n\n### `SecureFlowConcurrencySlots` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/orchestration/core_policy.py#L525\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\nEnforce deployment concurrency limits.\n\nThis rule enforces concurrency limits on deployments. If a deployment has a concurrency limit,\nthis rule will prevent more than that number of flow runs from being submitted concurrently\nbased on the concurrency limit behavior configured for the deployment.\n\nWe use the PENDING state as the target transition because this allows workers to secure a slot\nbefore provisioning dynamic infrastructure to run a flow. If a slot isn't available, the worker\nwon't provision infrastructure.\n\nA lease is created for the concurrency limit. The client will be responsible for maintaining the lease.\n\n**Methods:**\n\n#### `before_transition` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/orchestration/core_policy.py#L547\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nbefore_transition(self, initial_state: states.State[Any] | None, proposed_state: states.State[Any] | None, context: FlowOrchestrationContext) -> None\n```\n\n#### `cleanup` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/orchestration/core_policy.py#L635\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\ncleanup(self, initial_state: states.State[Any] | None, validated_state: states.State[Any] | None, context: FlowOrchestrationContext) -> None\n```\n\n### `CopyDeploymentConcurrencyLeaseID` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/orchestration/core_policy.py#L673\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\nCopies the deployment concurrency lease ID to the proposed state.\n\n**Methods:**\n\n#### `before_transition` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/orchestration/core_policy.py#L681\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nbefore_transition(self, initial_state: states.State[Any] | None, proposed_state: states.State[Any] | None, context: OrchestrationContext[orm_models.FlowRun, core.FlowRunPolicy]) -> None\n```\n\n### `RemoveDeploymentConcurrencyLeaseForOldClientVersions` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/orchestration/core_policy.py#L696\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\nRemoves a deployment concurrency lease if the client version is less than the minimum version for leasing.\n\n**Methods:**\n\n#### `after_transition` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/orchestration/core_policy.py#L704\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nafter_transition(self, initial_state: states.State[Any] | None, validated_state: states.State[Any] | None, context: OrchestrationContext[orm_models.FlowRun, core.FlowRunPolicy]) -> None\n```\n\n### `ReleaseFlowConcurrencySlots` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/orchestration/core_policy.py#L724\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\nReleases deployment concurrency slots held by a flow run.\n\nThis rule releases a concurrency slot for a deployment when a flow run\ntransitions out of the Running or Cancelling state.\n\n**Methods:**\n\n#### `after_transition` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/orchestration/core_policy.py#L732\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nafter_transition(self, context: OrchestrationContext[orm_models.FlowRun, core.FlowRunPolicy]) -> None\n```\n\n### `CacheInsertion` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/orchestration/core_policy.py#L802\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\nCaches completed states with cache keys after they are validated.\n\n**Methods:**\n\n#### `after_transition` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/orchestration/core_policy.py#L829\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nafter_transition(self, db: PrefectDBInterface, initial_state: states.State[Any] | None, validated_state: states.State[Any] | None, context: OrchestrationContext[orm_models.TaskRun, core.TaskRunPolicy]) -> None\n```\n\n#### `before_transition` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/orchestration/core_policy.py#L810\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nbefore_transition(self, initial_state: states.State[Any] | None, proposed_state: states.State[Any] | None, context: OrchestrationContext[orm_models.TaskRun, core.TaskRunPolicy]) -> None\n```\n\n### `CacheRetrieval` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/orchestration/core_policy.py#L849\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\nRejects running states if a completed state has been cached.\n\nThis rule rejects transitions into a running state with a cache key if the key\nhas already been associated with a completed state in the cache table. The client\nwill be instructed to transition into the cached completed state instead.\n\n**Methods:**\n\n#### `before_transition` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/orchestration/core_policy.py#L862\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nbefore_transition(self, db: PrefectDBInterface, initial_state: states.State[Any] | None, proposed_state: states.State[Any] | None, context: OrchestrationContext[orm_models.TaskRun, core.TaskRunPolicy]) -> None\n```\n\n### `RetryFailedFlows` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/orchestration/core_policy.py#L899\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\nRejects failed states and schedules a retry if the retry limit has not been reached.\n\nThis rule rejects transitions into a failed state if `retries` has been\nset and the run count has not reached the specified limit. The client will be\ninstructed to transition into a scheduled state to retry flow execution.\n\n**Methods:**\n\n#### `before_transition` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/orchestration/core_policy.py#L911\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nbefore_transition(self, initial_state: states.State[Any] | None, proposed_state: states.State[Any] | None, context: OrchestrationContext[orm_models.FlowRun, core.FlowRunPolicy]) -> None\n```\n\n### `RetryFailedTasks` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/orchestration/core_policy.py#L980\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\nRejects failed states and schedules a retry if the retry limit has not been reached.\n\nThis rule rejects transitions into a failed state if `retries` has been\nset, the run count has not reached the specified limit, and the client\nasserts it is a retriable task run. The client will be instructed to\ntransition into a scheduled state to retry task execution.\n\n**Methods:**\n\n#### `before_transition` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/orchestration/core_policy.py#L993\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nbefore_transition(self, initial_state: states.State[Any] | None, proposed_state: states.State[Any] | None, context: OrchestrationContext[orm_models.TaskRun, core.TaskRunPolicy]) -> None\n```\n\n### `EnqueueScheduledTasks` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/orchestration/core_policy.py#L1032\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\nEnqueues background task runs when they are scheduled\n\n**Methods:**\n\n#### `after_transition` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/orchestration/core_policy.py#L1040\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nafter_transition(self, initial_state: states.State[Any] | None, validated_state: states.State[Any] | None, context: OrchestrationContext[orm_models.TaskRun, core.TaskRunPolicy]) -> None\n```\n\n### `RenameReruns` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/orchestration/core_policy.py#L1063\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\nName the states if they have run more than once.\n\nIn the special case where the initial state is an \"AwaitingRetry\" scheduled state,\nthe proposed state will be renamed to \"Retrying\" instead.\n\n**Methods:**\n\n#### `before_transition` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/orchestration/core_policy.py#L1074\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nbefore_transition(self, initial_state: states.State[Any] | None, proposed_state: states.State[Any] | None, context: OrchestrationContext[orm_models.Run, core.TaskRunPolicy | core.FlowRunPolicy]) -> None\n```\n\n### `CopyScheduledTime` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/orchestration/core_policy.py#L1093\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\nEnsures scheduled time is copied from scheduled states to pending states.\n\nIf a new scheduled time has been proposed on the pending state, the scheduled time\non the scheduled state will be ignored.\n\n**Methods:**\n\n#### `before_transition` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/orchestration/core_policy.py#L1106\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nbefore_transition(self, initial_state: states.State[Any] | None, proposed_state: states.State[Any] | None, context: OrchestrationContext[orm_models.Run, core.TaskRunPolicy | core.FlowRunPolicy]) -> None\n```\n\n### `WaitForScheduledTime` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/orchestration/core_policy.py#L1123\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\nPrevents transitions to running states from happening too early.\n\nThis rule enforces that all scheduled states will only start with the machine clock\nused by the Prefect REST API instance. This rule will identify transitions from scheduled\nstates that are too early and nullify them. Instead, no state will be written to the\ndatabase and the client will be sent an instruction to wait for `delay_seconds`\nbefore attempting the transition again.\n\n**Methods:**\n\n#### `before_transition` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/orchestration/core_policy.py#L1139\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nbefore_transition(self, initial_state: states.State[Any] | None, proposed_state: states.State[Any] | None, context: OrchestrationContext[orm_models.Run, core.TaskRunPolicy | core.FlowRunPolicy]) -> None\n```\n\n### `CopyTaskParametersID` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/orchestration/core_policy.py#L1165\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\nEnsures a task's parameters ID is copied from Scheduled to Pending and from\nPending to Running states.\n\nIf a parameters ID has been included on the proposed state, the parameters ID\non the initial state will be ignored.\n\n**Methods:**\n\n#### `before_transition` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/orchestration/core_policy.py#L1177\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nbefore_transition(self, initial_state: states.State[Any] | None, proposed_state: states.State[Any] | None, context: OrchestrationContext[orm_models.TaskRun, core.TaskRunPolicy]) -> None\n```\n\n### `HandlePausingFlows` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/orchestration/core_policy.py#L1192\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\nGoverns runs attempting to enter a Paused/Suspended state\n\n**Methods:**\n\n#### `after_transition` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/orchestration/core_policy.py#L1247\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nafter_transition(self, initial_state: states.State[Any] | None, validated_state: states.State[Any] | None, context: OrchestrationContext[orm_models.FlowRun, core.FlowRunPolicy]) -> None\n```\n\n#### `before_transition` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/orchestration/core_policy.py#L1200\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nbefore_transition(self, initial_state: states.State[Any] | None, proposed_state: states.State[Any] | None, context: OrchestrationContext[orm_models.FlowRun, core.FlowRunPolicy]) -> None\n```\n\n### `HandleResumingPausedFlows` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/orchestration/core_policy.py#L1258\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\nGoverns runs attempting to leave a Paused state\n\n**Methods:**\n\n#### `after_transition` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/orchestration/core_policy.py#L1321\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nafter_transition(self, initial_state: states.State[Any] | None, validated_state: states.State[Any] | None, context: OrchestrationContext[orm_models.FlowRun, core.FlowRunPolicy]) -> None\n```\n\n#### `before_transition` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/orchestration/core_policy.py#L1266\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nbefore_transition(self, initial_state: states.State[Any] | None, proposed_state: states.State[Any] | None, context: OrchestrationContext[orm_models.FlowRun, core.FlowRunPolicy]) -> None\n```\n\n### `UpdateFlowRunTrackerOnTasks` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/orchestration/core_policy.py#L1332\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\nTracks the flow run attempt a task run state is associated with.\n\n**Methods:**\n\n#### `after_transition` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/orchestration/core_policy.py#L1340\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nafter_transition(self, initial_state: states.State[Any] | None, validated_state: states.State[Any] | None, context: OrchestrationContext[orm_models.TaskRun, core.TaskRunPolicy]) -> None\n```\n\n### `HandleTaskTerminalStateTransitions` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/orchestration/core_policy.py#L1359\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\nWe do not allow tasks to leave terminal states if:\n\n* The task is completed and has a persisted result\n* The task is going to CANCELLING / PAUSED / CRASHED\n\nWe reset the run count when a task leaves a terminal state for a non-terminal state\nwhich resets task run retries; this is particularly relevant for flow run retries.\n\n**Methods:**\n\n#### `before_transition` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/orchestration/core_policy.py#L1372\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nbefore_transition(self, initial_state: states.State[Any] | None, proposed_state: states.State[Any] | None, context: OrchestrationContext[orm_models.TaskRun, core.TaskRunPolicy]) -> None\n```\n\n#### `cleanup` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/orchestration/core_policy.py#L1413\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\ncleanup(self, initial_state: states.State[Any] | None, validated_state: states.State[Any] | None, context: OrchestrationContext[orm_models.TaskRun, core.TaskRunPolicy]) -> None\n```\n\n### `HandleFlowTerminalStateTransitions` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/orchestration/core_policy.py#L1423\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\nWe do not allow flows to leave terminal states if:\n\n* The flow is completed and has a persisted result\n* The flow is going to CANCELLING / PAUSED / CRASHED\n* The flow is going to scheduled and has no deployment\n\nWe reset the pause metadata when a flow leaves a terminal state for a non-terminal\nstate. This resets pause behavior during manual flow run retries.\n\n**Methods:**\n\n#### `before_transition` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/orchestration/core_policy.py#L1437\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nbefore_transition(self, initial_state: states.State[Any] | None, proposed_state: states.State[Any] | None, context: OrchestrationContext[orm_models.FlowRun, core.FlowRunPolicy]) -> None\n```\n\n#### `cleanup` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/orchestration/core_policy.py#L1492\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\ncleanup(self, initial_state: states.State[Any] | None, validated_state: states.State[Any] | None, context: OrchestrationContext[orm_models.FlowRun, core.FlowRunPolicy]) -> None\n```\n\n### `PreventPendingTransitions` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/orchestration/core_policy.py#L1501\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\nPrevents transitions to PENDING.\n\nThis rule is only used for flow runs.\n\nThis is intended to prevent race conditions during duplicate submissions of runs.\nBefore a run is submitted to its execution environment, it should be placed in a\nPENDING state. If two workers attempt to submit the same run, one of them should\nencounter a PENDING -> PENDING transition and abort orchestration of the run.\n\nSimilarly, if the execution environment starts quickly the run may be in a RUNNING\nstate when the second worker attempts the PENDING transition. We deny these state\nchanges as well to prevent duplicate submission. If a run has transitioned to a\nRUNNING state a worker should not attempt to submit it again unless it has moved\ninto a terminal state.\n\nCANCELLING and CANCELLED runs should not be allowed to transition to PENDING.\nFor re-runs of deployed runs, they should transition to SCHEDULED first.\nFor re-runs of ad-hoc runs, they should transition directly to RUNNING.\n\n**Methods:**\n\n#### `before_transition` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/orchestration/core_policy.py#L1531\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nbefore_transition(self, initial_state: states.State[Any] | None, proposed_state: states.State[Any] | None, context: OrchestrationContext[orm_models.Run, Union[core.FlowRunPolicy, core.TaskRunPolicy]]) -> None\n```\n\n### `EnsureOnlyScheduledFlowsMarkedLate` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/orchestration/core_policy.py#L1550\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n**Methods:**\n\n#### `before_transition` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/orchestration/core_policy.py#L1554\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nbefore_transition(self, initial_state: states.State[Any] | None, proposed_state: states.State[Any] | None, context: OrchestrationContext[orm_models.FlowRun, core.FlowRunPolicy]) -> None\n```\n\n### `PreventRunningTasksFromStoppedFlows` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/orchestration/core_policy.py#L1572\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\nPrevents running tasks from stopped flows.\n\nA running state implies execution, but also the converse. This rule ensures that a\nflow's tasks cannot be run unless the flow is also running.\n\n**Methods:**\n\n#### `before_transition` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/orchestration/core_policy.py#L1583\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nbefore_transition(self, initial_state: states.State[Any] | None, proposed_state: states.State[Any] | None, context: OrchestrationContext[orm_models.TaskRun, core.TaskRunPolicy]) -> None\n```\n\n### `EnforceCancellingToCancelledTransition` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/orchestration/core_policy.py#L1619\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\nRejects transitions from Cancelling to any terminal state except for Cancelled.\n\n**Methods:**\n\n#### `before_transition` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/orchestration/core_policy.py#L1627\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nbefore_transition(self, initial_state: states.State[Any] | None, proposed_state: states.State[Any] | None, context: OrchestrationContext[orm_models.TaskRun, core.TaskRunPolicy]) -> None\n```\n\n### `BypassCancellingFlowRunsWithNoInfra` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/orchestration/core_policy.py#L1643\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\nRejects transitions from Scheduled to Cancelling, and instead sets the state to Cancelled,\nif the flow run has no associated infrastructure process ID. Also Rejects transitions from\nPaused to Cancelling if the Paused state's details indicates the flow run has been suspended,\nexiting the flow and tearing down infra.\n\nThe `Cancelling` state is used to clean up infrastructure. If there is not infrastructure\nto clean up, we can transition directly to `Cancelled`. Runs that are `Resuming` are in a\n`Scheduled` state that were previously `Suspended` and do not yet have infrastructure.\n\nRuns that are `AwaitingRetry` are a `Scheduled` state that may have associated infrastructure.\n\n**Methods:**\n\n#### `before_transition` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/orchestration/core_policy.py#L1659\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nbefore_transition(self, initial_state: states.State[Any] | None, proposed_state: states.State[Any] | None, context: OrchestrationContext[orm_models.FlowRun, core.FlowRunPolicy]) -> None\n```\n\n### `PreventDuplicateTransitions` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/orchestration/core_policy.py#L1687\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\nPrevent duplicate transitions from being made right after one another.\n\nThis rule allows for clients to set an optional transition\\_id on a state. If the\nrun's next transition has the same transition\\_id, the transition will be\nrejected and the existing state will be returned.\n\nThis allows for clients to make state transition requests without worrying about\nthe following case:\n\n* A client making a state transition request\n* The server accepts transition and commits the transition\n* The client is unable to receive the response and retries the request\n\n**Methods:**\n\n#### `before_transition` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/orchestration/core_policy.py#L1705\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nbefore_transition(self, initial_state: states.State[Any] | None, proposed_state: states.State[Any] | None, context: OrchestrationContext[orm_models.FlowRun, core.FlowRunPolicy]) -> None\n```",
  "content_length": 33123
}