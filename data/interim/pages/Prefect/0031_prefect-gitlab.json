{
  "title": "prefect-gitlab",
  "source_url": "https://docs-3.prefect.io/integrations/prefect-gitlab/index",
  "content": "The prefect-gitlab library makes it easy to interact with GitLab repositories and credentials.\n\n## Getting started\n\n### Prerequisites\n\n* A [GitLab account](https://gitlab.com/).\n\n### Install `prefect-gitlab`\n\nThe following command will install a version of `prefect-gitlab` compatible with your installed version of `prefect`.\nIf you don't already have `prefect` installed, it will install the newest version of `prefect` as well.\n\n```bash  theme={null}\npip install \"prefect[gitlab]\"\n```\n\nUpgrade to the latest versions of `prefect` and `prefect-gitlab`:\n\n```bash  theme={null}\npip install -U \"prefect[gitlab]\"\n```\n\n### Register newly installed block types\n\nRegister the block types in the `prefect-gitlab` module to make them available for use.\n\n```bash  theme={null}\nprefect block register -m prefect_gitlab\n```\n\n## Examples\n\nIn the examples below, you create blocks with Python code.\nAlternatively, blocks can be created through the Prefect UI.\n\n## Store deployment flow code in a private GitLab repository\n\nTo create a deployment where the flow code is stored in a private GitLab repository, you can use the `GitLabCredentials` block.\n\nA deployment can use flow code stored in a GitLab repository without using this library in either of the following cases:\n\n* The repository is public\n* The deployment uses a [Secret block](https://docs.prefect.io/latest/develop/blocks/) to store the token\n\nCode to create a GitLab Credentials block:\n\n```python  theme={null}\nfrom prefect_gitlab import GitLabCredentials\n\n\ngitlab_credentials_block = GitLabCredentials(token=\"my_token\")\ngitlab_credentials_block.save(name=\"my-gitlab-credentials-block\")\n```\n\n### Access flow code stored in a private GitLab repository in a deployment\n\nUse the credentials block you created above to pass the GitLab access token during deployment creation. The code below assumes there's flow code in your private GitLab repository.\n\n```python  theme={null}\nfrom prefect import flow\nfrom prefect.runner.storage import GitRepository\nfrom prefect_gitlab import GitLabCredentials\n\n\nif __name__ == \"__main__\":\n\n    source = GitRepository(\n        url=\"https://gitlab.com/org/private-repo.git\",\n        credentials=GitLabCredentials.load(\"my-gitlab-credentials-block\")\n    )\n\n    source = GitRepository(\n    flow.from_source(\n        source=source,\n        entrypoint=\"my_file.py:my_flow\",\n    ).deploy(\n        name=\"private-gitlab-deploy\",\n        work_pool_name=\"my_pool\",\n    )\n```\n\nAlternatively, if you use a `prefect.yaml` file to create the deployment, reference the GitLab Credentials block in the `pull` step:\n\n```yaml  theme={null}\npull:\n    - prefect.deployments.steps.git_clone:\n        repository: https://github.com/org/repo.git\n        credentials: \"{{ prefect.blocks.gitlab-credentials.my-gitlab-credentials-block }}\"\n```\n\n### Interact with a GitLab repository\n\nThe code below shows how to reference a particular branch or tag of a GitLab repository.\n\n```python  theme={null}\nfrom prefect_gitlab import GitLabRepository\n\n\ndef save_private_gitlab_block():\n    private_gitlab_block = GitLabRepository(\n        repository=\"https://gitlab.com/testing/my-repository.git\",\n        access_token=\"YOUR_GITLAB_PERSONAL_ACCESS_TOKEN\",\n        reference=\"branch-or-tag-name\",\n    )\n\n    private_gitlab_block.save(\"my-private-gitlab-block\")\n\n\nif __name__ == \"__main__\":\n    save_private_gitlab_block()\n```\n\nExclude the `access_token` field if the repository is public and exclude the `reference` field to use the default branch.\n\nUse the newly created block to interact with the GitLab repository.\n\nFor example, download the repository contents with the `.get_directory()` method like this:\n\n```python  theme={null}\nfrom prefect_gitlab.repositories import GitLabRepository\n\n\ndef fetch_repo():\n    private_gitlab_block = GitLabRepository.load(\"my-gitlab-block\")\n    private_gitlab_block.get_directory()\n\n\nif __name__ == \"__main__\":\n    fetch_repo()\n```\n\n## Resources\n\nFor assistance using GitLab, consult the [GitLab documentation](https://gitlab.com).\n\nRefer to the `prefect-gitlab` [SDK documentation](https://reference.prefect.io/prefect_gitlab/) to explore all the capabilities of the `prefect-gitlab` library.",
  "content_length": 4182
}