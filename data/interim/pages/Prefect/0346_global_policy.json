{
  "title": "global_policy",
  "source_url": "https://docs-3.prefect.io/v3/api-ref/python/prefect-server-orchestration-global_policy",
  "content": "# `prefect.server.orchestration.global_policy`\n\nBookkeeping logic that fires on every state transition.\n\nFor clarity, `GlobalFlowpolicy` and `GlobalTaskPolicy` contain all transition logic\nimplemented using `BaseUniversalTransform`. None of these operations modify state, and regardless of what orchestration Prefect REST API might\nenforce on a transition, the global policies contain Prefect's necessary bookkeeping.\nBecause these transforms record information about the validated state committed to the\nstate database, they should be the most deeply nested contexts in orchestration loop.\n\n## Functions\n\n### `COMMON_GLOBAL_TRANSFORMS` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/orchestration/global_policy.py#L34\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nCOMMON_GLOBAL_TRANSFORMS() -> list[type[BaseUniversalTransform[orm_models.Run, Union[core.FlowRunPolicy, core.TaskRunPolicy]]]]\n```\n\n## Classes\n\n### `GlobalFlowPolicy` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/orchestration/global_policy.py#L54\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\nGlobal transforms that run against flow-run-state transitions in priority order.\n\nThese transforms are intended to run immediately before and after a state transition\nis validated.\n\n**Methods:**\n\n#### `priority` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/orchestration/global_policy.py#L63\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\npriority() -> list[Union[type[BaseUniversalTransform[orm_models.FlowRun, core.FlowRunPolicy]], type[BaseOrchestrationRule[orm_models.FlowRun, core.FlowRunPolicy]]]]\n```\n\n### `GlobalTaskPolicy` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/orchestration/global_policy.py#L87\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\nGlobal transforms that run against task-run-state transitions in priority order.\n\nThese transforms are intended to run immediately before and after a state transition\nis validated.\n\n**Methods:**\n\n#### `priority` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/orchestration/global_policy.py#L96\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\npriority() -> list[Union[type[BaseUniversalTransform[orm_models.TaskRun, core.TaskRunPolicy]], type[BaseOrchestrationRule[orm_models.TaskRun, core.TaskRunPolicy]]]]\n```\n\n### `SetRunStateType` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/orchestration/global_policy.py#L115\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\nUpdates the state type of a run on a state transition.\n\n**Methods:**\n\n#### `before_transition` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/orchestration/global_policy.py#L124\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nbefore_transition(self, context: GenericOrchestrationContext[orm_models.Run, Any]) -> None\n```\n\n### `SetRunStateName` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/orchestration/global_policy.py#L135\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\nUpdates the state name of a run on a state transition.\n\n**Methods:**\n\n#### `before_transition` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/orchestration/global_policy.py#L144\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nbefore_transition(self, context: GenericOrchestrationContext[orm_models.Run, Any]) -> None\n```\n\n### `SetStartTime` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/orchestration/global_policy.py#L155\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\nRecords the time a run enters a running state for the first time.\n\n**Methods:**\n\n#### `before_transition` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/orchestration/global_policy.py#L164\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nbefore_transition(self, context: GenericOrchestrationContext[orm_models.Run, Any]) -> None\n```\n\n### `SetRunStateTimestamp` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/orchestration/global_policy.py#L177\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\nRecords the time a run changes states.\n\n**Methods:**\n\n#### `before_transition` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/orchestration/global_policy.py#L186\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nbefore_transition(self, context: GenericOrchestrationContext[orm_models.Run, Any]) -> None\n```\n\n### `SetEndTime` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/orchestration/global_policy.py#L197\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\nRecords the time a run enters a terminal state.\n\nWith normal client usage, a run will not transition out of a terminal state.\nHowever, it's possible to force these transitions manually via the API. While\nleaving a terminal state, the end time will be unset.\n\n**Methods:**\n\n#### `before_transition` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/orchestration/global_policy.py#L210\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nbefore_transition(self, context: GenericOrchestrationContext[orm_models.Run, Any]) -> None\n```\n\n### `IncrementRunTime` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/orchestration/global_policy.py#L233\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\nRecords the amount of time a run spends in the running state.\n\n**Methods:**\n\n#### `before_transition` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/orchestration/global_policy.py#L242\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nbefore_transition(self, context: GenericOrchestrationContext[orm_models.Run, Any]) -> None\n```\n\n### `IncrementFlowRunCount` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/orchestration/global_policy.py#L257\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\nRecords the number of times a run enters a running state. For use with retries.\n\n**Methods:**\n\n#### `before_transition` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/orchestration/global_policy.py#L264\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nbefore_transition(self, context: OrchestrationContext[orm_models.FlowRun, core.FlowRunPolicy]) -> None\n```\n\n### `RemoveResumingIndicator` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/orchestration/global_policy.py#L283\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\nRemoves the indicator on a flow run that marks it as resuming.\n\n**Methods:**\n\n#### `before_transition` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/orchestration/global_policy.py#L290\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nbefore_transition(self, context: OrchestrationContext[orm_models.FlowRun, core.FlowRunPolicy]) -> None\n```\n\n### `IncrementTaskRunCount` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/orchestration/global_policy.py#L309\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\nRecords the number of times a run enters a running state. For use with retries.\n\n**Methods:**\n\n#### `before_transition` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/orchestration/global_policy.py#L314\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nbefore_transition(self, context: OrchestrationContext[orm_models.TaskRun, core.TaskRunPolicy]) -> None\n```\n\n### `SetExpectedStartTime` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/orchestration/global_policy.py#L328\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\nEstimates the time a state is expected to start running if not set.\n\nFor scheduled states, this estimate is simply the scheduled time. For other states,\nthis is set to the time the proposed state was created by Prefect.\n\n**Methods:**\n\n#### `before_transition` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/orchestration/global_policy.py#L340\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nbefore_transition(self, context: GenericOrchestrationContext[orm_models.Run, Any]) -> None\n```\n\n### `SetNextScheduledStartTime` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/orchestration/global_policy.py#L356\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\nRecords the scheduled time on a run.\n\nWhen a run enters a scheduled state, `run.next_scheduled_start_time` is set to\nthe state's scheduled time. When leaving a scheduled state,\n`run.next_scheduled_start_time` is unset.\n\n**Methods:**\n\n#### `before_transition` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/orchestration/global_policy.py#L369\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nbefore_transition(self, context: GenericOrchestrationContext[orm_models.Run, Any]) -> None\n```\n\n### `UpdateSubflowParentTask` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/orchestration/global_policy.py#L386\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\nWhenever a subflow changes state, it must update its parent task run's state.\n\n**Methods:**\n\n#### `after_transition` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/orchestration/global_policy.py#L393\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nafter_transition(self, context: OrchestrationContext[orm_models.FlowRun, core.FlowRunPolicy]) -> None\n```\n\n### `UpdateSubflowStateDetails` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/orchestration/global_policy.py#L418\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\nUpdate a child subflow state's references to a corresponding tracking task run id\nin the parent flow run\n\n**Methods:**\n\n#### `before_transition` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/orchestration/global_policy.py#L426\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nbefore_transition(self, context: OrchestrationContext[orm_models.FlowRun, core.FlowRunPolicy]) -> None\n```\n\n### `UpdateStateDetails` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/orchestration/global_policy.py#L442\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\nUpdate a state's references to a corresponding flow- or task- run.\n\n**Methods:**\n\n#### `before_transition` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/orchestration/global_policy.py#L451\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nbefore_transition(self, context: GenericOrchestrationContext) -> None\n```",
  "content_length": 12409
}