{
  "title": "How to configure worker healthchecks",
  "source_url": "https://docs-3.prefect.io/v3/advanced/worker-healthchecks",
  "content": "Learn how to monitor worker health and automatically restart workers when they become unresponsive.\n\nWorker healthchecks provide a way to monitor whether your Prefect workers are functioning properly and polling for work as expected. This is particularly useful in production environments where you need to ensure workers are available to execute scheduled flow runs.\n\n## Overview\n\nWorker healthchecks work by:\n\n1. **Tracking polling activity**: Workers record when they last polled for flow runs from their work pool\n2. **Exposing a health endpoint**: When enabled, workers start an HTTP server that provides health status\n3. **Detecting unresponsive workers**: The health endpoint returns an error status if the worker hasn't polled recently\n\nThis allows external monitoring systems, container orchestrators, or process managers to detect and restart unhealthy workers automatically.\n\n## Enabling Healthchecks\n\nStart a worker with healthchecks enabled using the `--with-healthcheck` flag:\n\n```bash  theme={null}\nprefect worker start --pool \"my-pool\" --with-healthcheck\n```\n\nThis starts both the worker and a lightweight HTTP health server that exposes a `/health` endpoint.\nWhen enabled, the worker exposes an HTTP endpoint at:\n\n```\nhttp://localhost:8080/health\n```\n\nFor GET requests the endpoint returns:\n\n* **200 OK** with `{\"message\": \"OK\"}` when the worker is healthy\n* **503 Service Unavailable** with `{\"message\": \"Worker may be unresponsive at this time\"}` when the worker is unhealthy\n\n### Configuring the Health Server\n\nYou can customize the health server's host and port using environment variables:\n\n```bash  theme={null}\nexport PREFECT_WORKER_WEBSERVER_HOST=0.0.0.0\nexport PREFECT_WORKER_WEBSERVER_PORT=9090\nprefect worker start --pool \"my-pool\" --with-healthcheck\n```\n\n## Health Detection Logic\n\nA worker is considered unhealthy if it hasn't polled for flow runs within a specific timeframe defined by its configured polling interval. The health check algorithm works as follows:\n\nIf a worker hasn't made a successful poll within the time window of `PREFECT_WORKER_QUERY_SECONDS * 30` seconds, it is considered unhealthy\nand its health endpoint will return 503 (Service Unavailable). With default settings, a worker is unhealthy if it hasn't polled in 450 seconds (7.5 minutes).\n\nThis generous threshold accounts for temporary network issues, API unavailability, or brief worker pauses without triggering false alarms.\n\n## Production Deployment Patterns\n\n### Docker with Health Checks\n\nUse Docker's built-in health check functionality by including these lines in your Dockerfile:\n\n```dockerfile  theme={null}\n# Health check configuration\nHEALTHCHECK --interval=30s --timeout=10s --start-period=60s --retries=3 \\\n  CMD python -c \"import urllib.request as u; u.urlopen('http://localhost:8080/health', timeout=1)\"\n\n# Start worker with healthcheck\nCMD [\"prefect\", \"worker\", \"start\", \"--pool\", \"my-pool\", \"--with-healthcheck\"]\n```\n\nFor more information see [Docker's reference guide](https://docs.docker.com/reference/dockerfile/#healthcheck).\n\n### Kubernetes with Liveness Probes\n\nConfigure Kubernetes to automatically restart unhealthy worker pods by including this configuration in your worker deployment:\n\n```yaml  theme={null}\nlivenessProbe:\n  httpGet:\n    path: /health\n    port: 8080\n  initialDelaySeconds: 60\n  periodSeconds: 30\n  timeoutSeconds: 10\n  failureThreshold: 3\n```\n\nThis is enabled by default when using [Prefect's Helm Chart](v3/advanced/server-helm).\n\n### Docker Compose with Health Checks\n\nUse Docker Compose's built-in health check functionality by including these lines in your Docker compose file:\n\n```yaml  theme={null}\nversion: '3.8'\nservices:\n  prefect-worker:\n    image: my-prefect-worker:latest\n    command: [\"prefect\", \"worker\", \"start\", \"--pool\", \"my-pool\", \"--with-healthcheck\"]\n    healthcheck:\n      test: [\"CMD\", \"python\", \"-c\", \"import urllib.request as u; u.urlopen('http://localhost:8080/health', timeout=1)\"]\n      interval: 30s\n      timeout: 10s\n      retries: 3\n      start_period: 60s\n    restart: unless-stopped\n```\n\nFor more information see [Docker Compose's reference guide](https://docs.docker.com/reference/compose-file/services/#healthcheck).\n\n## Troubleshooting\n\n### Health endpoint not accessible\n\n* Verify the worker was started with `--with-healthcheck`\n* Check that the configured host/port is accessible (default: `http://localhost:8080/health`)\n* Ensure no firewall rules are blocking the health port\n* Port 8080 may conflict with other services - change with `PREFECT_WORKER_WEBSERVER_PORT`\n* Verify configuration: `prefect config view --show-defaults | grep WORKER`\n\n### Worker appears healthy but not picking up flows\n\n* Health checks only verify polling activity, not successful flow execution\n* Check work pool and work queue configuration: ensure worker is polling the correct pool/queue\n* Verify deployment configuration matches worker capabilities\n* Review flow run states - flows may be stuck in PENDING due to concurrency limits\n* Enable debug logging: set `PREFECT_LOGGING_LEVEL=DEBUG` on the worker to see detailed polling activity\n* Increase polling frequency temporarily: `PREFECT_WORKER_QUERY_SECONDS=5`\n\n### False positive health failures\n\n* Increase `PREFECT_WORKER_QUERY_SECONDS` if your API has high latency\n* Check for network connectivity issues between worker and Prefect API\n* Review worker logs for authentication or authorization errors (API key issues)\n* Verify `PREFECT_API_URL` is correctly configured and accessible\n* Check for temporary API outages or [rate limiting](v3/concepts/rate-limits)\n\n## Related Configuration\n\nRelevant settings for worker health and polling behavior:\n\n* `PREFECT_WORKER_HEARTBEAT_SECONDS`: How often workers send heartbeats to the API (default: 30)\n* `PREFECT_WORKER_QUERY_SECONDS`: How often workers poll for new flow runs (default: 15)\n* `PREFECT_WORKER_PREFETCH_SECONDS`: How far in advance to submit flow runs (default: 10)\n* `PREFECT_WORKER_WEBSERVER_HOST`: Health server host (default: 127.0.0.1)\n* `PREFECT_WORKER_WEBSERVER_PORT`: Health server port (default: 8080)\n\n## Further Reading\n\nFor more information on worker configuration, see the [Workers concept guide](/v3/concepts/workers/).",
  "content_length": 6219
}