{
  "title": "How to run flows on serverless compute",
  "source_url": "https://docs-3.prefect.io/v3/how-to-guides/deployment_infra/serverless",
  "content": "Learn how to use Prefect push work pools to schedule work on serverless infrastructure without having to run a worker.\n\n<span class=\"badge cloud\" /> Push [work pools](/v3/deploy/infrastructure-concepts/work-pools/) are a special type of work pool. They allow\nPrefect Cloud to submit flow runs for execution to serverless computing infrastructure without requiring you to run a worker.\nPush work pools currently support execution in AWS ECS tasks, Azure Container Instances, Google Cloud Run jobs, Modal, and Coiled.\n\nIn this guide you will:\n\n* Create a push work pool that sends work to Amazon Elastic Container Service (AWS ECS), Azure Container Instances (ACI),\n  Google Cloud Run, Modal, or Coiled\n* Deploy a flow to that work pool\n* Execute a flow without having to run a worker process to poll for flow runs\n\n<Note>\n  You can automatically provision infrastructure and create your push work pool using the `prefect work-pool create`\n  CLI command with the `--provision-infra` flag.\n  This approach greatly simplifies the setup process.\n</Note>\n\nFirst, you will set up automatic infrastructure provisioning for push work pools. Then you will learn how to manually\nset up your push work pool.\n\n## Automatic infrastructure provisioning\n\nWith Perfect Cloud you can provision infrastructure for use with an AWS ECS, Google Cloud Run, ACI push work pool.\nPush work pools in Prefect Cloud simplify the setup and management of the infrastructure necessary to run your flows.\nHowever, setting up infrastructure on your cloud provider can still be a time-consuming process.\nPrefect dramatically simplifies this process by automatically provisioning the necessary infrastructure for you.\n\nWe'll use the `prefect work-pool create` CLI command with the `--provision-infra` flag to automatically provision your\nserverless cloud resources and set up your Prefect workspace to use a new push pool.\n\n### Prerequisites\n\nTo use automatic infrastructure provisioning, you need:\n\n* the relevant cloud CLI library installed\n* to be authenticated with your cloud provider\n\n<Tabs>\n  <Tab title=\"AWS ECS\">\n    Install the [AWS CLI](https://docs.aws.amazon.com/cli/latest/userguide/getting-started-install.html),\n    [authenticate with your AWS account](https://docs.aws.amazon.com/signin/latest/userguide/command-line-sign-in.html),\n    and [set a default region](https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-files.html#cli-configure-files-methods).\n\n    If you already have the AWS CLI installed, be sure to [update to the latest version](https://docs.aws.amazon.com/cli/latest/userguide/getting-started-install.html#getting-started-install-instructions).\n\n    You will need the following permissions in your authenticated AWS account:\n\n    IAM Permissions:\n\n    * iam:CreatePolicy\n    * iam:GetPolicy\n    * iam:ListPolicies\n    * iam:CreateUser\n    * iam:GetUser\n    * iam:AttachUserPolicy\n    * iam:CreateRole\n    * iam:GetRole\n    * iam:AttachRolePolicy\n    * iam:ListRoles\n    * iam:PassRole\n\n    Amazon ECS Permissions:\n\n    * ecs:CreateCluster\n    * ecs:DescribeClusters\n\n    Amazon EC2 Permissions:\n\n    * ec2:CreateVpc\n    * ec2:DescribeVpcs\n    * ec2:CreateInternetGateway\n    * ec2:AttachInternetGateway\n    * ec2:CreateRouteTable\n    * ec2:CreateRoute\n    * ec2:CreateSecurityGroup\n    * ec2:DescribeSubnets\n    * ec2:CreateSubnet\n    * ec2:DescribeAvailabilityZones\n    * ec2:AuthorizeSecurityGroupIngress\n    * ec2:AuthorizeSecurityGroupEgress\n\n    Amazon ECR Permissions:\n\n    * ecr:CreateRepository\n    * ecr:DescribeRepositories\n    * ecr:GetAuthorizationToken\n\n    If you want to use AWS managed policies, you can use the following:\n\n    * AmazonECS\\_FullAccess\n    * AmazonEC2FullAccess\n    * IAMFullAccess\n    * AmazonEC2ContainerRegistryFullAccess\n\n    The above policies give you all the permissions needed, but are more permissive than necessary.\n\n    [Docker](https://docs.docker.com/get-docker/) is also required to build and push images to your registry.\n  </Tab>\n\n  <Tab title=\"Azure Container Instances\">\n    Install the [Azure CLI](https://learn.microsoft.com/en-us/cli/azure/install-azure-cli) and\n    [authenticate with your Azure account](https://learn.microsoft.com/en-us/cli/azure/authenticate-azure-cli).\n\n    If you already have the Azure CLI installed, be sure to update to the latest version with `az upgrade`.\n\n    You will also need the following roles in your Azure subscription:\n\n    * Contributor\n    * User Access Administrator\n    * Application Administrator\n    * Managed Identity Operator\n    * Azure Container Registry Contributor\n\n    Docker is also required to build and push images to your registry. You can install Docker\n    [here](https://docs.docker.com/get-docker/).\n  </Tab>\n\n  <Tab title=\"Google Cloud Run\">\n    Install the [gcloud CLI](https://cloud.google.com/sdk/docs/install) and\n    [authenticate with your GCP project](https://cloud.google.com/docs/authentication/gcloud).\n\n    If you already have the gcloud CLI installed, be sure to update to the latest version with `gcloud components update`.\n\n    You will also need the following permissions in your GCP project:\n\n    * resourcemanager.projects.list\n    * serviceusage.services.enable\n    * iam.serviceAccounts.create\n    * iam.serviceAccountKeys.create\n    * resourcemanager.projects.setIamPolicy\n    * artifactregistry.repositories.create\n\n    Docker is also required to build and push images to your registry. You can install Docker\n    [here](https://docs.docker.com/get-docker/).\n  </Tab>\n\n  <Tab title=\"Modal\">\n    Install `modal` by running:\n\n    ```bash  theme={null}\n    pip install modal\n    ```\n\n    Create a Modal API token by running:\n\n    ```bash  theme={null}\n    modal token new\n    ```\n\n    See [Run flows on Modal](/v3/how-to-guides/deployment_infra/modal) for more details.\n  </Tab>\n\n  <Tab title=\"Coiled\">\n    Install `coiled` by running:\n\n    ```bash  theme={null}\n    pip install coiled prefect-coiled\n    ```\n\n    Create a Coiled API token by running:\n\n    ```bash  theme={null}\n    coiled login\n    ```\n\n    Connect Coiled to your cloud account by running\n\n    ```bash  theme={null}\n    coiled setup\n    ```\n\n    or by navigating to [cloud.coiled.io/get-started](https://cloud.coiled.io/get-started)\n  </Tab>\n</Tabs>\n\n### Automatically create a new push work pool and provision infrastructure\n\nTo create a new push work pool and configure the necessary infrastructure,\nrun this command for your particular cloud provider:\n\n<Tabs>\n  <Tab title=\"AWS ECS\">\n    ```bash  theme={null}\n    prefect work-pool create --type ecs:push --provision-infra my-ecs-pool\n    ```\n\n    The `--provision-infra` flag automatically sets up your default AWS account to execute\n    flows with ECS tasks.\n    In your AWS account, this command creates a new IAM user, IAM policy, and\n    ECS cluster that uses AWS Fargate, VPC, and ECR repository (if they don't already exist).\n    In your Prefect workspace, this command creates an\n    [`AWSCredentials` block](/integrations/prefect-aws/index#save-credentials-to-an-aws-credentials-block) for storing the generated credentials.\n\n    Here's an abbreviated example output from running the command:\n\n    ```bash  theme={null}\n    _____________________________________________________________________________________________\n    | Provisioning infrastructure for your work pool my-ecs-pool will require:                   |\n    |                                                                                            |\n    |          - Creating an IAM user for managing ECS tasks: prefect-ecs-user                   |\n    |          - Creating and attaching an IAM policy for managing ECS tasks: prefect-ecs-policy |\n    |          - Storing generated AWS credentials in a block                                    |\n    |          - Creating an ECS cluster for running Prefect flows: prefect-ecs-cluster          |\n    |          - Creating a VPC with CIDR 172.31.0.0/16 for running ECS tasks: prefect-ecs-vpc   |\n    |          - Creating an ECR repository for storing Prefect images: prefect-flows            |\n    _____________________________________________________________________________________________\n    Proceed with infrastructure provisioning? [y/n]: y\n    Provisioning IAM user\n    Creating IAM policy\n    Generating AWS credentials\n    Creating AWS credentials block\n    Provisioning ECS cluster\n    Provisioning VPC\n    Creating internet gateway\n    Setting up subnets\n    Setting up security group\n    Provisioning ECR repository\n    Authenticating with ECR\n    Setting default Docker build namespace\n    Provisioning Infrastructure ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 100% 0:00:00\n    Infrastructure successfully provisioned!\n    Created work pool 'my-ecs-pool'!\n    ```\n\n    <Tip>\n      **Default Docker build namespace**\n\n      After infrastructure provisioning completes, you will be logged into your new ECR repository and the default\n      Docker build namespace will be set to the URL of the registry.\n    </Tip>\n\n    While the default namespace is set, you do not need to provide the registry URL when building images as\n    part of your deployment process.\n\n    To take advantage of this, you can write your deploy scripts like this:\n\n    ```python example_deploy_script.py theme={null}\n    from prefect import flow\n    from prefect.docker import DockerImage\n\n    @flow(log_prints=True)\n    def my_flow(name: str = \"world\"):\n        print(f\"Hello {name}! I'm a flow running in a ECS task!\")\n\n\n    if __name__ == \"__main__\":\n        my_flow.deploy(\n            name=\"my-deployment\",\n            work_pool_name=\"my-work-pool\",\n            image=DockerImage(\n                name=\"my-repository:latest\",\n                platform=\"linux/amd64\",\n            )\n        )\n    ```\n\n    This builds an image with the tag `<ecr-registry-url>/my-image:latest` and push it to the registry.\n\n    Your image name needs to match the name of the repository created with your work pool. You can create\n    new repositories in the ECR console.\n  </Tab>\n\n  <Tab title=\"Azure Container Instances\">\n    ```bash  theme={null}\n    prefect work-pool create --type azure-container-instance:push --provision-infra my-aci-pool\n    ```\n\n    The `--provision-infra` flag automatically sets up your default Azure account to execute\n    flows through Azure Container Instances.\n    In your Azure account, this command creates a resource group, app registration, service account with necessary permission,\n    generates a secret for the app registration, and creates an Azure Container Registry, (if they don't already exist).\n    In your Prefect workspace, this command creates an\n    [`AzureContainerInstanceCredentials` block](/integrations/prefect-azure)\n    to store the client secret value from the generated secret.\n\n    Here's an abbreviated example output from running the command:\n\n    ```bash  theme={null}\n    _____________________________________________________________________________________________\n    | Provisioning infrastructure for your work pool my-aci-work-pool will require:             |\n    |                                                                                           |\n    |     Updates in subscription Azure subscription 1                                          |\n    |                                                                                           |\n    |         - Create a resource group in location eastus                                      |\n    |         - Create an app registration in Azure AD prefect-aci-push-pool-app                |\n    |         - Create/use a service principal for app registration                             |\n    |         - Generate a secret for app registration                                          |\n    |         - Create an Azure Container Registry with prefix prefect                           |\n    |         - Create an identity prefect-acr-identity to allow access to the created registry |\n    |         - Assign Contributor role to service account                                      |\n    |         - Create an ACR registry for image hosting                                        |\n    |         - Create an identity for Azure Container Instance to allow access to the registry |\n    |                                                                                           |\n    |     Updates in Prefect workspace                                                          |\n    |                                                                                           |\n    |         - Create Azure Container Instance credentials block aci-push-pool-credentials     |\n    |                                                                                           |\n    _____________________________________________________________________________________________\n    Proceed with infrastructure provisioning? [y/n]:\n    Creating resource group\n    Creating app registration\n    Generating secret for app registration\n    Creating ACI credentials block\n    ACI credentials block 'aci-push-pool-credentials' created in Prefect Cloud\n    Assigning Contributor role to service account\n    Creating Azure Container Registry\n    Creating identity\n    Provisioning infrastructure... ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 100% 0:00:00\n    Infrastructure successfully provisioned for 'my-aci-work-pool' work pool!\n    Created work pool 'my-aci-work-pool'!\n    ```\n\n    <Tip>\n      **Default Docker build namespace**\n      After infrastructure provisioning completes, you are logged into your new Azure Container Registry and\n      the default Docker build namespace is set to the URL of the registry.\n    </Tip>\n\n    While the default namespace is set, any images you build without specifying a registry or username/organization\n    are pushed to the registry.\n\n    To use this capability, write your deploy scripts like this:\n\n    ```python example_deploy_script.py theme={null}\n    from prefect import flow\n    from prefect.docker import DockerImage\n\n\n    @flow(log_prints=True)\n    def my_flow(name: str = \"world\"):\n        print(f\"Hello {name}! I'm a flow running on an Azure Container Instance!\")\n\n\n    if __name__ == \"__main__\":\n        my_flow.deploy(\n            name=\"my-deployment\",\n            work_pool_name=\"my-work-pool\",\n            image=DockerImage(\n                name=\"my-image:latest\",\n                platform=\"linux/amd64\",\n            )\n        )\n    ```\n\n    This builds an image with the tag `<acr-registry-url>/my-image:latest` and pushes it to the registry.\n  </Tab>\n\n  <Tab title=\"Google Cloud Run\">\n    ```bash  theme={null}\n    prefect work-pool create --type cloud-run:push --provision-infra my-cloud-run-pool\n    ```\n\n    The `--provision-infra` flag allows you to select a GCP project to use for your work pool and automatically\n    configures it to execute flows through Cloud Run.\n    In your GCP project, this command activates the Cloud Run API, creates a service account, and creates a key for the\n    service account, (if they don't already exist).\n    In your Prefect workspace, this command creates a\n    [`GCPCredentials` block](/integrations/prefect-gcp/index#authenticate-using-a-gcp-credentials-block) to store the service account key.\n\n    Here's an abbreviated example output from running the command:\n\n    ```bash  theme={null}\n    ____________________________________________________________________________________________________________\n    | Provisioning infrastructure for your work pool my-cloud-run-pool will require:                           |\n    |                                                                                                          |\n    |     Updates in GCP project central-kit-405415 in region us-central1                                      |\n    |                                                                                                          |\n    |         - Activate the Cloud Run API for your project                                                    |\n    |         - Activate the Artifact Registry API for your project                                            |\n    |         - Create an Artifact Registry repository named prefect-images                                    |\n    |         - Create a service account for managing Cloud Run jobs: prefect-cloud-run                        |\n    |             - Service account will be granted the following roles:                                       |\n    |                 - Service Account User                                                                   |\n    |                 - Cloud Run Developer                                                                    |\n    |         - Create a key for service account prefect-cloud-run                                             |\n    |                                                                                                          |\n    |     Updates in Prefect workspace                                                                         |\n    |                                                                                                          |\n    |         - Create GCP credentials block my--pool-push-pool-credentials to store the service account key   |\n    |                                                                                                          |\n    ____________________________________________________________________________________________________________\n    Proceed with infrastructure provisioning? [y/n]: y\n    Activating Cloud Run API\n    Activating Artifact Registry API\n    Creating Artifact Registry repository\n    Configuring authentication to Artifact Registry\n    Setting default Docker build namespace\n    Creating service account\n    Assigning roles to service account\n    Creating service account key\n    Creating GCP credentials block\n    Provisioning Infrastructure ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 100% 0:00:00\n    Infrastructure successfully provisioned!\n    Created work pool 'my-cloud-run-pool'!\n    ```\n\n    <Tip>\n      **Default Docker build namespace**\n\n      After infrastructure provisioning completes, you are logged into your new Artifact Registry repository\n      and the default Docker build namespace is set to the URL of the repository.\n    </Tip>\n\n    While the default namespace is set, any images you build without specifying a registry or username/organization\n    are pushed to the repository.\n\n    To use this capability, write your deploy scripts like this:\n\n    ```python example_deploy_script.py theme={null}\n    from prefect import flow\n    from prefect.docker import DockerImage\n\n\n    @flow(log_prints=True)\n    def my_flow(name: str = \"world\"):\n        print(f\"Hello {name}! I'm a flow running on Cloud Run!\")\n\n\n    if __name__ == \"__main__\":\n        my_flow.deploy(\n            name=\"my-deployment\",\n            work_pool_name=\"above-ground\",\n            image=DockerImage(\n                name=\"my-image:latest\",\n                platform=\"linux/amd64\",\n            )\n        )\n    ```\n\n    This builds an image with the tag `<region>-docker.pkg.dev/<project>/<repository-name>/my-image:latest`\n    and pushes it to the repository.\n  </Tab>\n\n  <Tab title=\"Modal\">\n    ```bash  theme={null}\n    prefect work-pool create --type modal:push --provision-infra my-modal-pool\n    ```\n\n    Using the `--provision-infra` flag triggers the creation of a `ModalCredentials` block in your Prefect Cloud workspace.\n    This block stores your Modal API token, which authenticates with Modal's API. By default, the token for your\n    current Modal profile is used for the new `ModalCredentials` block. If Prefect is unable to discover a Modal\n    API token for your current profile, you will be prompted to create a new one.\n  </Tab>\n\n  <Tab title=\"Coiled\">\n    ```bash  theme={null}\n    prefect work-pool create --type coiled:push --provision-infra my-coiled-pool\n    ```\n\n    Using the `--provision-infra` flag triggers the creation of a `CoiledCredentials` block in your Prefect Cloud workspace.\n    This block stores your Coiled API token, which authenticates with Coiled's API.\n  </Tab>\n</Tabs>\n\nYou're ready to create and schedule deployments that use your new push work pool.\nReminder that no worker is required to run flows with a push work pool.\n\n### Use existing resources with automatic infrastructure provisioning\n\nIf you already have the necessary infrastructure set up, Prefect detects that at work pool creation and the\ninfrastructure provisioning for that resource is skipped.\n\nFor example, here's how `prefect work-pool create my-work-pool --provision-infra` looks when existing Azure resources are detected:\n\n```bash  theme={null}\nProceed with infrastructure provisioning? [y/n]: y\nCreating resource group\nResource group 'prefect-aci-push-pool-rg' already exists in location 'eastus'.\nCreating app registration\nApp registration 'prefect-aci-push-pool-app' already exists.\nGenerating secret for app registration\nProvisioning infrastructure\nACI credentials block 'bb-push-pool-credentials' created\nAssigning Contributor role to service account...\nService principal with object ID '4be6fed7-...' already has the 'Contributor' role assigned in\n'/subscriptions/.../'\nCreating Azure Container Instance\nContainer instance 'prefect-aci-push-pool-container' already exists.\nCreating Azure Container Instance credentials block\nProvisioning infrastructure... ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 100% 0:00:00\nInfrastructure successfully provisioned!\nCreated work pool 'my-work-pool'!\n```\n\n## Provision infrastructure for an existing push work pool\n\nIf you already have a push work pool set up, but haven't configured the necessary infrastructure, you can use the\n`provision-infra` sub-command to provision the infrastructure for that work pool.\nFor example, you can run the following command if you have a work pool named \"my-work-pool\".\n\n```bash  theme={null}\nprefect work-pool provision-infra my-work-pool\n```\n\nPrefect creates the necessary infrastructure for the `my-work-pool` work pool and provides you with a summary\nof the changes:\n\n```bash  theme={null}\n__________________________________________________________________________________________________________________\n| Provisioning infrastructure for your work pool my-work-pool will require:                                      |\n|                                                                                                                |\n|     Updates in subscription Azure subscription 1                                                               |\n|                                                                                                                |\n|         - Create a resource group in location eastus                                                           |\n|         - Create an app registration in Azure AD prefect-aci-push-pool-app                                     |\n|         - Create/use a service principal for app registration                                                  |\n|         - Generate a secret for app registration                                                               |\n|         - Assign Contributor role to service account                                                           |\n|         - Create Azure Container Instance 'aci-push-pool-container' in resource group prefect-aci-push-pool-rg |\n|                                                                                                                |\n|     Updates in Prefect workspace                                                                               |\n|                                                                                                                |\n|         - Create Azure Container Instance credentials block aci-push-pool-credentials                          |\n|                                                                                                                |\n__________________________________________________________________________________________________________________\nProceed with infrastructure provisioning? [y/n]: y\n```\n\nThis command speeds up your infrastructure setup process.\n\nAs with the examples above, you need to have the related cloud CLI library installed and to be authenticated with\nyour cloud provider.\n\n## Manual infrastructure provisioning\n\nIf you prefer to set up your infrastructure manually, exclude the `--provision-infra` flag in the CLI command.\nIn the examples below, you'll create a push work pool through the Prefect Cloud UI.\n\n<Tabs>\n  <Tab title=\"AWS ECS\">\n    To push work to ECS, AWS credentials are required.\n\n    Create a user and attach the *AmazonECS\\_FullAccess* permissions.\n\n    From that user's page, create credentials and store them somewhere safe for use in the next section.\n  </Tab>\n\n  <Tab title=\"Azure Container Instances\">\n    To push work to Azure, you need an Azure subscription, resource group, and tenant secret.\n\n    **Create Subscription and Resource Group**\n\n    1. In the Azure portal, create a subscription.\n    2. Create a resource group within your subscription.\n\n    **Create App Registration**\n\n    1. In the Azure portal, create an app registration.\n    2. In the app registration, create a client secret. Copy the value and store it somewhere safe.\n\n    **Add App Registration to Resource Group**\n\n    1. Navigate to the resource group you created earlier.\n    2. Choose the \"Access control (IAM)\" blade in the left-hand side menu. Click \"+ Add\" button at the top, then\n       \"Add role assignment\".\n    3. Go to the \"Privileged administrator roles\" tab, click on \"Contributor\", then click \"Next\" at the bottom of the page.\n    4. Click on \"+ Select members\". Type the name of the app registration (otherwise it may not autopopulate) and click to add it.\n       Then hit \"Select\" and click \"Next\". The default permissions associated with a role like \"Contributor\" may\n       not be sufficient for all operations related to Azure Container Instances (ACI). The specific permissions\n       required depend on the operations you need to perform (like creating, running, and deleting ACI container groups)\n       and your organization's security policies. In some cases, additional permissions or custom roles are necessary.\n    5. Click \"Review + assign\" to finish.\n  </Tab>\n\n  <Tab title=\"Google Cloud Run\">\n    You need a GCP service account and an API Key to push work to Cloud Run.\n\n    Create a service account by navigating to the service accounts page and clicking *Create*. Name and describe your service account,\n    and click *continue* to configure permissions.\n\n    The service account must have two roles at a minimum: *Cloud Run Developer* and *Service Account User*.\n\n        <img src=\"https://mintcdn.com/prefect-bd373955/rm4-_dTLtkmSX6eG/v3/img/guides/gcr-service-account-setup.png?fit=max&auto=format&n=rm4-_dTLtkmSX6eG&q=85&s=6fc561f651b41f62449f14c6f2fa9b57\" alt=\"Configuring service account permissions in GCP\" data-og-width=\"1170\" width=\"1170\" data-og-height=\"1016\" height=\"1016\" data-path=\"v3/img/guides/gcr-service-account-setup.png\" data-optimize=\"true\" data-opv=\"3\" srcset=\"https://mintcdn.com/prefect-bd373955/rm4-_dTLtkmSX6eG/v3/img/guides/gcr-service-account-setup.png?w=280&fit=max&auto=format&n=rm4-_dTLtkmSX6eG&q=85&s=977c00b438dc21e3ace0936a6d108a0d 280w, https://mintcdn.com/prefect-bd373955/rm4-_dTLtkmSX6eG/v3/img/guides/gcr-service-account-setup.png?w=560&fit=max&auto=format&n=rm4-_dTLtkmSX6eG&q=85&s=094606b8a086c345335d0eb18e51b112 560w, https://mintcdn.com/prefect-bd373955/rm4-_dTLtkmSX6eG/v3/img/guides/gcr-service-account-setup.png?w=840&fit=max&auto=format&n=rm4-_dTLtkmSX6eG&q=85&s=073a090abd3201dc842cd87343402367 840w, https://mintcdn.com/prefect-bd373955/rm4-_dTLtkmSX6eG/v3/img/guides/gcr-service-account-setup.png?w=1100&fit=max&auto=format&n=rm4-_dTLtkmSX6eG&q=85&s=909858cefd912995af87a6f726aea9a3 1100w, https://mintcdn.com/prefect-bd373955/rm4-_dTLtkmSX6eG/v3/img/guides/gcr-service-account-setup.png?w=1650&fit=max&auto=format&n=rm4-_dTLtkmSX6eG&q=85&s=6f986dd3bd338a4c6127796254517a22 1650w, https://mintcdn.com/prefect-bd373955/rm4-_dTLtkmSX6eG/v3/img/guides/gcr-service-account-setup.png?w=2500&fit=max&auto=format&n=rm4-_dTLtkmSX6eG&q=85&s=f7de60cf6da1c923d0c951dc1f3d7f4b 2500w\" />\n\n    Once you create the Service account, navigate to its *Keys* page to add an API key. Create a JSON type key, download it,\n    and store it somewhere safe for use in the next section.\n  </Tab>\n\n  <Tab title=\"Modal\">\n    You need a Modal API token to push work to Modal.\n\n    Navigate to **Settings** in the Modal UI to create a Modal API token. In the **API Tokens** section of the Settings page,\n    click **New Token**.\n\n    Copy the token ID and token secret and store them somewhere safe for use in the next section.\n  </Tab>\n\n  <Tab title=\"Coiled\">\n    You need a Coiled API token to push work to Coiled.\n\n    In the Coiled UI click on your avatar and select **Profile**.  Then press the **Create API Token** button and copy the result.  You will need it in the next section.\n  </Tab>\n</Tabs>\n\n### Work pool configuration\n\nThe push work pool stores information about what type of infrastructure the flow will run on, what default values to\nprovide to compute jobs, and other important execution environment parameters. Because the push work pool needs to\nintegrate securely with your serverless infrastructure, you need to store your credentials in Prefect Cloud by making a block.\n\n### Create a Credentials block\n\n<Tabs>\n  <Tab title=\"AWS ECS\">\n    Navigate to the blocks page, click create new block, and select AWS Credentials for the type.\n\n    For use in a push work pool, set the region, access key, and access key secret.\n\n    Provide any other optional information and create your block.\n  </Tab>\n\n  <Tab title=\"Azure Container Instances\">\n    Navigate to the blocks page and click the \"+\" at the top to create a new block. Find the Azure Container\n    Instance Credentials block and click \"Add +\".\n\n    Locate the client ID and tenant ID on your app registration and use the client secret you saved earlier.\n    Make sure the value of the secret, not the secret ID.\n\n    Provide any other optional information and click \"Create\".\n  </Tab>\n\n  <Tab title=\"Google Cloud Run\">\n    Navigate to the blocks page, click create new block, and select GCP Credentials for the type.\n\n    For use in a push work pool, this block must have the contents of the JSON key stored in the\n    Service Account Info field, as such:\n\n        <img src=\"https://mintcdn.com/prefect-bd373955/rm4-_dTLtkmSX6eG/v3/img/guides/gcp-creds-block-setup.png?fit=max&auto=format&n=rm4-_dTLtkmSX6eG&q=85&s=93b1d4a0324a6100442e9b231f6c6ad7\" alt=\"Configuring GCP Credentials block for use in cloud run push work pools\" data-og-width=\"2432\" width=\"2432\" data-og-height=\"1296\" height=\"1296\" data-path=\"v3/img/guides/gcp-creds-block-setup.png\" data-optimize=\"true\" data-opv=\"3\" srcset=\"https://mintcdn.com/prefect-bd373955/rm4-_dTLtkmSX6eG/v3/img/guides/gcp-creds-block-setup.png?w=280&fit=max&auto=format&n=rm4-_dTLtkmSX6eG&q=85&s=c3c441f9c38cfc102a2ca1392f345eb2 280w, https://mintcdn.com/prefect-bd373955/rm4-_dTLtkmSX6eG/v3/img/guides/gcp-creds-block-setup.png?w=560&fit=max&auto=format&n=rm4-_dTLtkmSX6eG&q=85&s=84aa018ab14e856179191b48cc2faf85 560w, https://mintcdn.com/prefect-bd373955/rm4-_dTLtkmSX6eG/v3/img/guides/gcp-creds-block-setup.png?w=840&fit=max&auto=format&n=rm4-_dTLtkmSX6eG&q=85&s=c4e71b8a26719cace97fa556cef43fab 840w, https://mintcdn.com/prefect-bd373955/rm4-_dTLtkmSX6eG/v3/img/guides/gcp-creds-block-setup.png?w=1100&fit=max&auto=format&n=rm4-_dTLtkmSX6eG&q=85&s=c1b7852945f82dab21d487937cda4f0b 1100w, https://mintcdn.com/prefect-bd373955/rm4-_dTLtkmSX6eG/v3/img/guides/gcp-creds-block-setup.png?w=1650&fit=max&auto=format&n=rm4-_dTLtkmSX6eG&q=85&s=7c98527a3dc845dcdf291fa1a8ff348c 1650w, https://mintcdn.com/prefect-bd373955/rm4-_dTLtkmSX6eG/v3/img/guides/gcp-creds-block-setup.png?w=2500&fit=max&auto=format&n=rm4-_dTLtkmSX6eG&q=85&s=8742ed514b91c0b80679a1761c3989fd 2500w\" />\n\n    Provide any other optional information and create your block.\n  </Tab>\n\n  <Tab title=\"Modal\">\n    Navigate to the blocks page, click create new block, and select Modal Credentials for the type.\n\n    For use in a push work pool, this block must have the token ID and token secret stored in the Token ID and Token\n    Secret fields, respectively.\n  </Tab>\n\n  <Tab title=\"Coiled\">\n    Navigate to the blocks page, click create new block, and select Coiled Credentials for the type.  Provide the API token from the previous section.\n  </Tab>\n</Tabs>\n\n### Create a push work pool\n\nNow navigate to the work pools page.\nClick **Create** to configure your push work pool by selecting a push option in the infrastructure type step.\n\n<Tabs>\n  <Tab title=\"AWS ECS\">\n    Each step has several optional fields that are detailed in the\n    [work pools documentation](/v3/deploy/infrastructure-concepts/work-pools/).\n    Select the block you created under the AWS Credentials field.\n    This allows Prefect Cloud to securely interact with your ECS cluster.\n  </Tab>\n\n  <Tab title=\"Azure Container Instances\">\n    Fill in the subscription ID and resource group name from the resource group you created.\n    Add the Azure Container Instance Credentials block you created in the step above.\n  </Tab>\n\n  <Tab title=\"Google Cloud Run\">\n    Each step has several optional fields that are detailed in\n    [Manage infrastructure with work pools](/v3/deploy/infrastructure-concepts/work-pools/).\n    Select the block you created under the GCP Credentials field.\n    This allows Prefect Cloud to securely interact with your GCP project.\n  </Tab>\n\n  <Tab title=\"Modal\">\n    Each step has several optional fields that are detailed in the\n    [work pools documentation](/v3/deploy/infrastructure-concepts/work-pools/).\n    Select the block you created under the Modal Credentials field.\n    This allows Prefect Cloud to securely interact with your Modal account.\n  </Tab>\n\n  <Tab title=\"Coiled\">\n    Each step has several optional fields that are detailed in the\n    [work pools documentation](/v3/deploy/infrastructure-concepts/work-pools/).\n    Select the block you created under the Coiled Credentials field.\n    This allows Prefect Cloud to securely interact with your Coiled account.\n  </Tab>\n</Tabs>\n\nCreate your pool to be ready to deploy flows to your Push work pool.\n\n## Deployment\n\nYou need to configure your [deployment](/v3/how-to-guides/deployment_infra/docker) to send flow runs to your push work pool.\nFor example, if you create a deployment through the interactive command line experience,\nchoose the work pool you just created. If you are deploying an existing `prefect.yaml` file, the deployment would contain:\n\n```yaml  theme={null}\n  work_pool:\n    name: my-push-pool\n```\n\nDeploying your flow to the `my-push-pool` work pool ensures that runs that are ready for execution are\nsubmitted immediately—without the need for a worker to poll for them.\n\n<Warning>\n  **Serverless infrastructure may require a certain image architecture**\n\n  Serverless infrastructure may assume a certain Docker image architecture; for example,\n  Google Cloud Run will fail to run images built with `linux/arm64` architecture. If using Prefect to build your image,\n  you can change the image architecture through the `platform` keyword (for example, `platform=\"linux/amd64\"`).\n</Warning>\n\n## Putting it all together\n\nWith your deployment created, navigate to its detail page and create a new flow run.\nYou'll see the flow start running without polling the work pool, because Prefect Cloud securely connected\nto your serverless infrastructure, created a job, ran the job, and reported on its execution.\n\n## Usage Limits\n\nPush work pool usage is unlimited. However push work pools limit flow runs to 24 hours.\n\n## Next steps\n\nLearn more about [work pools](/v3/deploy/infrastructure-concepts/work-pools/) and [workers](/v3/deploy/infrastructure-concepts/workers/).\n\nLearn about installing dependencies at runtime or baking them into your Docker image in the [Deploy to Docker](/v3/how-to-guides/deployment_infra/docker#automatically-build-a-custom-docker-image-with-a-local-dockerfile) guide.",
  "content_length": 36283
}