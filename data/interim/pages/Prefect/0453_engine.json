{
  "title": "engine",
  "source_url": "https://docs-3.prefect.io/v3/api-ref/python/prefect-utilities-engine",
  "content": "# `prefect.utilities.engine`\n\n## Functions\n\n### `collect_task_run_inputs` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/utilities/engine.py#L66\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\ncollect_task_run_inputs(expr: Any, max_depth: int = -1) -> set[Union[TaskRunResult, FlowRunResult]]\n```\n\nThis function recurses through an expression to generate a set of any discernible\ntask run inputs it finds in the data structure. It produces a set of all inputs\nfound.\n\nExamples:\n\n```python  theme={null}\ntask_inputs = {\n    k: await collect_task_run_inputs(v) for k, v in parameters.items()\n }\n```\n\n### `collect_task_run_inputs_sync` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/utilities/engine.py#L117\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\ncollect_task_run_inputs_sync(expr: Any, future_cls: Any = PrefectFuture, max_depth: int = -1) -> set[Union[TaskRunResult, FlowRunResult]]\n```\n\nThis function recurses through an expression to generate a set of any discernible\ntask run inputs it finds in the data structure. It produces a set of all inputs\nfound.\n\n**Examples:**\n\n```python  theme={null}\ntask_inputs = {\n    k: collect_task_run_inputs_sync(v) for k, v in parameters.items()\n }\n```\n\n### `capture_sigterm` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/utilities/engine.py#L172\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\ncapture_sigterm() -> Generator[None, Any, None]\n```\n\n### `resolve_inputs` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/utilities/engine.py#L201\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nresolve_inputs(parameters: dict[str, Any], return_data: bool = True, max_depth: int = -1) -> dict[str, Any]\n```\n\nResolve any `Quote`, `PrefectFuture`, or `State` types nested in parameters into\ndata.\n\n**Returns:**\n\n* A copy of the parameters with resolved data\n\n**Raises:**\n\n* `UpstreamTaskError`: If any of the upstream states are not `COMPLETED`\n\n### `propose_state` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/utilities/engine.py#L315\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\npropose_state(client: 'PrefectClient', state: State[Any], flow_run_id: UUID, force: bool = False) -> State[Any]\n```\n\nPropose a new state for a flow run, invoking Prefect orchestration logic.\n\nIf the proposed state is accepted, the provided `state` will be augmented with\ndetails and returned.\n\nIf the proposed state is rejected, a new state returned by the Prefect API will be\nreturned.\n\nIf the proposed state results in a WAIT instruction from the Prefect API, the\nfunction will sleep and attempt to propose the state again.\n\nIf the proposed state results in an ABORT instruction from the Prefect API, an\nerror will be raised.\n\n**Args:**\n\n* `state`: a new state for a flow run\n* `flow_run_id`: an optional flow run id, used when proposing flow run states\n\n**Returns:**\n\n* a State model representation of the flow run state\n\n**Raises:**\n\n* `prefect.exceptions.Abort`: if an ABORT instruction is received from\n  the Prefect API\n\n### `propose_state_sync` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/utilities/engine.py#L413\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\npropose_state_sync(client: 'SyncPrefectClient', state: State[Any], flow_run_id: UUID, force: bool = False) -> State[Any]\n```\n\nPropose a new state for a flow run, invoking Prefect orchestration logic.\n\nIf the proposed state is accepted, the provided `state` will be augmented with\ndetails and returned.\n\nIf the proposed state is rejected, a new state returned by the Prefect API will be\nreturned.\n\nIf the proposed state results in a WAIT instruction from the Prefect API, the\nfunction will sleep and attempt to propose the state again.\n\nIf the proposed state results in an ABORT instruction from the Prefect API, an\nerror will be raised.\n\n**Args:**\n\n* `state`: a new state for the flow run\n* `flow_run_id`: an optional flow run id, used when proposing flow run states\n\n**Returns:**\n\n* a State model representation of the flow run state\n\n**Raises:**\n\n* `ValueError`: if flow\\_run\\_id is not provided\n* `prefect.exceptions.Abort`: if an ABORT instruction is received from\n  the Prefect API\n\n### `get_state_for_result` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/utilities/engine.py#L507\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nget_state_for_result(obj: Any) -> Optional[tuple[State, RunType]]\n```\n\nGet the state related to a result object.\n\n`link_state_to_result` must have been called first.\n\n### `link_state_to_flow_run_result` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/utilities/engine.py#L518\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nlink_state_to_flow_run_result(state: State, result: Any) -> None\n```\n\nCreates a link between a state and flow run result\n\n### `link_state_to_task_run_result` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/utilities/engine.py#L523\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nlink_state_to_task_run_result(state: State, result: Any) -> None\n```\n\nCreates a link between a state and task run result\n\n### `link_state_to_result` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/utilities/engine.py#L528\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nlink_state_to_result(state: State, result: Any, run_type: RunType) -> None\n```\n\nCaches a link between a state and a result and its components using\nthe `id` of the components to map to the state. The cache is persisted to the\ncurrent flow run context since task relationships are limited to within a flow run.\n\nThis allows dependency tracking to occur when results are passed around.\nNote: Because `id` is used, we cannot cache links between singleton objects.\n\nWe only cache the relationship between components 1-layer deep.\nExample:\nGiven the result \\[1, \\[\"a\",\"b\"], (\"c\",)], the following elements will be\nmapped to the state:\n\n* \\[1, \\[\"a\",\"b\"], (\"c\",)]\n* \\[\"a\",\"b\"]\n* (\"c\",)\n\nNote: the int `1` will not be mapped to the state because it is a singleton.\n\nOther Notes:\nWe do not hash the result because:\n\n* If changes are made to the object in the flow between task calls, we can still\n  track that they are related.\n* Hashing can be expensive.\n* Not all objects are hashable.\n\nWe do not set an attribute, e.g. `__prefect_state__`, on the result because:\n\n* Mutating user's objects is dangerous.\n* Unrelated equality comparisons can break unexpectedly.\n* The field can be preserved on copy.\n* We cannot set this attribute on Python built-ins.\n\n### `should_log_prints` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/utilities/engine.py#L589\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nshould_log_prints(flow_or_task: Union['Flow[..., Any]', 'Task[..., Any]']) -> bool\n```\n\n### `check_api_reachable` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/utilities/engine.py#L601\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\ncheck_api_reachable(client: 'PrefectClient', fail_message: str) -> None\n```\n\n### `emit_task_run_state_change_event` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/utilities/engine.py#L619\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nemit_task_run_state_change_event(task_run: TaskRun, initial_state: Optional[State[Any]], validated_state: State[Any], follows: Optional[Event] = None) -> Optional[Event]\n```\n\n### `resolve_to_final_result` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/utilities/engine.py#L717\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nresolve_to_final_result(expr: Any, context: dict[str, Any]) -> Any\n```\n\nResolve any `PrefectFuture`, or `State` types nested in parameters into\ndata. Designed to be use with `visit_collection`.\n\n### `resolve_inputs_sync` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/utilities/engine.py#L788\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nresolve_inputs_sync(parameters: dict[str, Any], return_data: bool = True, max_depth: int = -1) -> dict[str, Any]\n```\n\nResolve any `Quote`, `PrefectFuture`, or `State` types nested in parameters into\ndata.\n\n**Returns:**\n\n* A copy of the parameters with resolved data\n\n**Raises:**\n\n* `UpstreamTaskError`: If any of the upstream states are not `COMPLETED`",
  "content_length": 9301
}