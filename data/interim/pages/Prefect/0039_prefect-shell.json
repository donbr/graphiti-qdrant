{
  "title": "prefect-shell",
  "source_url": "https://docs-3.prefect.io/integrations/prefect-shell/index",
  "content": "Execute shell commands from within Prefect flows.\n\n## Getting started\n\n### Install `prefect-shell`\n\nThe following command will install a version of `prefect-shell` compatible with your installed version of `prefect`.\nIf you don't already have `prefect` installed, it will install the newest version of `prefect` as well.\n\n```bash  theme={null}\npip install \"prefect[shell]\"\n```\n\nUpgrade to the latest versions of `prefect` and `prefect-shell`:\n\n```bash  theme={null}\npip install -U \"prefect[shell]\"\n```\n\n### Register newly installed block types\n\nRegister the block types in the `prefect-shell` module to make them available for use.\n\n```bash  theme={null}\nprefect block register -m prefect_shell\n```\n\n## Examples\n\n### Integrate shell commands with Prefect flows\n\nWith `prefect-shell`, you can use shell commands (and/or scripts) in Prefect flows to provide observability and resiliency.\n`prefect-shell` can be a useful tool if you're transitioning your orchestration from shell scripts to Prefect.\n\nLet's get the shell-abration started!\n\nThe Python code below has shell commands embedded in a Prefect flow:\n\n```python  theme={null}\nfrom prefect import flow\nfrom datetime import datetime\nfrom prefect_shell import ShellOperation\n\n\n@flow\ndef download_data():\n    today = datetime.today().strftime(\"%Y%m%d\")\n\n    # for short running operations, you can use the `run` method\n    # which automatically manages the context\n    ShellOperation(\n        commands=[\n            \"mkdir -p data\",\n            \"mkdir -p data/${today}\"\n        ],\n        env={\"today\": today}\n    ).run()\n\n    # for long running operations, you can use a context manager\n    with ShellOperation(\n        commands=[\n            \"curl -O https://masie_web.apps.nsidc.org/pub/DATASETS/NOAA/G02135/north/daily/data/N_seaice_extent_daily_v3.0.csv\",\n        ],\n        working_dir=f\"data/{today}\",\n    ) as download_csv_operation:\n\n        # trigger runs the process in the background\n        download_csv_process = download_csv_operation.trigger()\n\n        # then do other things here in the meantime, like download another file\n        ...\n\n        # when you're ready, wait for the process to finish\n        download_csv_process.wait_for_completion()\n\n        # if you'd like to get the output lines, you can use the `fetch_result` method\n        output_lines = download_csv_process.fetch_result()\n\n\nif __name__ == \"__main__\":\n    download_data()\n```\n\nRunning this script results in output like this:\n\n```bash  theme={null}\n14:48:16.550 | INFO    | prefect.engine - Created flow run 'tentacled-chachalaca' for flow 'download-data'\n14:48:17.977 | INFO    | Flow run 'tentacled-chachalaca' - PID 19360 triggered with 2 commands running inside the '.' directory.\n14:48:17.987 | INFO    | Flow run 'tentacled-chachalaca' - PID 19360 completed with return code 0.\n14:48:17.994 | INFO    | Flow run 'tentacled-chachalaca' - PID 19363 triggered with 1 commands running inside the PosixPath('data/20230201') directory.\n14:48:18.009 | INFO    | Flow run 'tentacled-chachalaca' - PID 19363 stream output:\n  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current\n                                 Dl\n14:48:18.010 | INFO    | Flow run 'tentacled-chachalaca' - PID 19363 stream output:\noad  Upload   Total   Spent    Left  Speed\n  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0\n14:48:18.840 | INFO    | Flow run 'tentacled-chachalaca' - PID 19363 stream output:\n 11 1630k   11  192k    0     0   229k      0  0:00:07 --:--:--  0:00:07  231k\n14:48:19.839 | INFO    | Flow run 'tentacled-chachalaca' - PID 19363 stream output:\n 83 1630k   83 1368k    0     0   745k      0  0:00:02  0:00:01  0:00:01  747k\n14:48:19.993 | INFO    | Flow run 'tentacled-chachalaca' - PID 19363 stream output:\n100 1630k  100 1630k    0     0   819k      0  0\n14:48:19.994 | INFO    | Flow run 'tentacled-chachalaca' - PID 19363 stream output:\n:00:01  0:00:01 --:--:--  821k\n14:48:19.996 | INFO    | Flow run 'tentacled-chachalaca' - PID 19363 completed with return code 0.\n14:48:19.998 | INFO    | Flow run 'tentacled-chachalaca' - Successfully closed all open processes.\n14:48:20.203 | INFO    | Flow run 'tentacled-chachalaca' - Finished in state Completed()\n```\n\n### Save shell commands in Prefect blocks\n\nYou can save commands within a `ShellOperation` block, then reuse them across multiple flows.\n\nSave the block with desired commands:\n\n```python  theme={null}\nfrom prefect_shell import ShellOperation\n\n\nping_op = ShellOperation(commands=[\"ping -t 1 prefect.io\"])\nping_op.save(\"block-name\")\n\n# Load the saved block:\nping_op = ShellOperation.load(\"block-name\")\n```\n\n## Resources\n\nRefer to the `prefect-shell` [SDK documentation](https://reference.prefect.io/prefect_shell/) to explore all the capabilities of the `prefect-shell` library.",
  "content_length": 4824
}