{
  "title": "How to manage Prefect resources using Infrastructure as Code",
  "source_url": "https://docs-3.prefect.io/v3/advanced/infrastructure-as-code",
  "content": "Declaratively manage Prefect resources with additional tools\n\nexport const HELM = ({name, href}) => <p>You can manage {name} with the <a href={href}>Prefect Helm charts</a>.</p>;\n\nexport const home = {\n  tf: \"https://registry.terraform.io/providers/PrefectHQ/prefect/latest/docs/guides/getting-started\",\n  cli: \"https://docs.prefect.io/v3/api-ref/cli/index\",\n  api: \"https://app.prefect.cloud/api/docs\",\n  helm: \"https://github.com/PrefectHQ/prefect-helm/tree/main/charts\"\n};\n\nexport const TF = ({name, href}) => <p>You can manage {name} with the <a href={href}>Terraform provider for Prefect</a>.</p>;\n\nYou can manage many Prefect resources with tools like\n[Terraform](https://www.terraform.io/) and [Helm](https://helm.sh/).  These\noptions are a viable alternative to Prefect's CLI and UI.\n\n## Terraform\n\n<TF name=\"resources\" href={home.tf} />\n\nThis documentation represents all Prefect resources that are supported by Terraform.\nThis Terraform provider is maintained by the Prefect team, and is undergoing active development\nto reach [parity with the Prefect API](https://github.com/PrefectHQ/terraform-provider-prefect/milestone/1).\n\nThe Prefect team welcomes contributions, feature requests, and bug reports\nvia our [issue tracker](https://github.com/PrefectHQ/terraform-provider-prefect/issues).\n\n### Terraform Modules\n\nPrefect maintains several Terraform modules to help you get started with common infrastructure patterns:\n\n* [Bucket Sensors for AWS, Azure, and GCP](https://github.com/PrefectHQ/terraform-prefect-bucket-sensor)\n* [ECS Worker on AWS Fargate](https://github.com/PrefectHQ/terraform-prefect-ecs-worker)\n* [ACI Worker on Azure Container Instances](https://github.com/PrefectHQ/terraform-prefect-aci-worker)\n\n## Pulumi\n\nPrefect does not maintain an official Pulumi package.\nHowever, you can use Pulumiâ€™s terraform-provider to automatically generate a Pulumi SDK from the Prefect Terraform provider.\nFor details, refer to the [Pulumi documentation on Terraform providers](www.pulumi.com/registry/packages/terraform-provider/).\n\n<Tip>\n  You will need to be using Pulumi version >= 3.147.0.\n</Tip>\n\nIn this example, we will use Pulumi to deploy a flow to Prefect.\n\nPrefect recommends using the `uv` for managing Python dependencies.\nThis example will show you how to set up a Pulumi project using the `uv` toolchain.\n\n<AccordionGroup>\n  <Accordion title=\"Creating a new Pulumi project\">\n    To create a new Python Pulumi project using the `uv` toolchain, run the following command:\n\n    ```bash  theme={null}\n    pulumi new python \\\n    --yes \\\n    --generate-only \\\n    --name \"my-prefect-pulumi-project\" \\\n    --description \"A Pulumi project to manage Prefect resources\" \\\n    --runtime-options toolchain=uv \\\n    --runtime-options virtualenv=.venv\n    ```\n\n    <Warning>\n      Don't name your project any of the following, otherwise you will have package name conflicts:\n\n      * `pulumi`\n      * `prefect`\n      * `pulumi-prefect`\n    </Warning>\n\n    <Info>\n      An explanation of the [flags](https://www.pulumi.com/docs/iac/cli/commands/pulumi_new/#options) used:\n\n      * The `--yes` flag skips the interactive prompts and accepts the defaults. You can omit this flag,\n        or edit the generated `Pulumi.yaml` file later to customize your project settings.\n      * The `--generate-only` just creates a new Pulumi project. It does not create a stack, save config,\n        or install dependencies.\n      * The `--name` and `--description` flags set the name and description of your Pulumi project.\n      * The `--runtime-options toolchain=uv` and `--runtime-options virtualenv=.venv` flags configures\n        the Pulumi project to use the `uv` toolchain instead of the default, `pip`.\n    </Info>\n\n    To finish setting up your new Pulumi project, navigate to the project directory and install the dependencies:\n\n    ```bash  theme={null}\n    pulumi install\n    ```\n  </Accordion>\n\n  <Accordion title=\"Using an existing Pulumi project\">\n    If you already have a Pulumi project, you can switch to the `uv` toolchain by updating\n    your `pulumi.yaml` file `runtime` settings as shown below:\n\n    ```yaml Pulumi.yaml theme={null}\n    # other project settings...\n    runtime:\n      name: python\n      options:\n        toolchain: uv\n        virtualenv: .venv\n    ```\n\n    This configures your Pulumi project to use the `uv` toolchain and the virtual environment located at `.venv`.\n\n    Run the following to update Pulumi to use the `uv` toolchain:\n\n    ```bash  theme={null}\n    pulumi install\n    ```\n  </Accordion>\n</AccordionGroup>\n\n### Managing Resources with Pulumi\n\nTo manage resources with Pulumi, add the Prefect Terraform provider to your Pulumi project:\n\n```bash  theme={null}\npulumi package add terraform-provider prefecthq/prefect\n```\n\nOptionally, you can specify a specific version, e.g.:\n\n```bash  theme={null}\npulumi package add terraform-provider prefecthq/prefect 2.90.0\n```\n\nThis will auto-generate a `pulumi-prefect` Python package.\nThe code will be placed in the `sdks/prefect` directory inside the Pulumi project.\n\n### Example: Deploying a Flow with Pulumi\n\nThis simple example shows you how to deploy a flow to Prefect.\n\n```python  theme={null}\nimport json\nimport pulumi\nimport pulumi_prefect as prefect\nfrom prefect.utilities.callables import parameter_schema\nfrom typing import Callable, Any\n\n# Import your flow here\nfrom my_flow import test as example_flow\n\n\ndef generate_openapi_schema_for_flow(flow_obj: Callable[..., Any]) -> str:\n    \"\"\"\n    Utility function to generate an OpenAPI schema for a flow's parameters.\n    This is used to provide type information for deployments created via Pulumi.\n    \n    See also:\n        * `parameter_schema <https://github.com/PrefectHQ/prefect/blob/main/src/prefect/utilities/callables.py#L331>`_\n        * `model_dump_for_openapi <https://github.com/PrefectHQ/prefect/blob/main/src/prefect/utilities/callables.py#L247>`_\n    \"\"\"\n    return json.dumps(parameter_schema(flow_obj).model_dump_for_openapi())\n\n# Configure the Provider\nprovider = prefect.Provider(\n    \"prefect\",\n    # endpoint=\"https://api.prefect.cloud/api/account/<account>/workspace/<workspace>\",\n    # api_key=\"<your_api_key>\",  # or use pulumi.Config to manage secrets\n)\n\n# Register the Flow\nflow = prefect.Flow(\n    \"example-flow\",\n    name=\"example-flow\",\n    tags=[\"example\", \"pulumi\"],\n    opts=pulumi.ResourceOptions(provider=provider)\n)\n\n# Create a Deployment resource\ndeployment = prefect.Deployment(\n    \"example-deployment\",\n    name=\"example-deployment\",\n    flow_id=flow.id,\n    work_pool_name=\"example-work-pool\",\n    work_queue_name=\"default\",\n    parameters=json.dumps({\"foo\": \"bar\"}),\n    tags=[\"example\", \"pulumi\"],\n    enforce_parameter_schema=True,\n    parameter_openapi_schema=generate_openapi_schema_for_flow(example_flow),\n    opts=pulumi.ResourceOptions(provider=provider),\n\n    # specify how to get the flow code to the worker\n    # the Deployment resource does not have the same support as `prefect.yaml` for automatically packaging flow code\n    # see: https://registry.terraform.io/providers/PrefectHQ/prefect/latest/docs/resources/deployment#deployment-actions\n\n    # option 1: clone the repo at runtime\n    # pull_steps = [\n    #     {\n    #         \"type\": \"git_clone\",\n    #         \"repository\": \"https://github.com/some/repo\",\n    #         \"branch\": \"main\",\n    #         \"include_submodules\": True,\n    #     }\n    # ],\n    # entrypoint=\"flow.py:hello_flow\",\n\n    # option 2: use a pre-built container image\n    # note: you will need to build this image yourself and push it to a registry\n    # job_variables = json.dumps({\n    #     \"image\": \"example.registry.com/example-repo/example-image:v1\"\n    # })\n)\n\n# Add a schedule to the deployment to run every minute\nschedule = prefect.DeploymentSchedule(\n    \"example-schedule\",\n    deployment_id=deployment.id,\n    active=True,\n    cron=\"0 * * * *\",\n    timezone=\"UTC\",\n    opts=pulumi.ResourceOptions(provider=provider),\n)\n```\n\nNow you can run `pulumi up` to create the resources in your Prefect workspace.\n\n## Helm\n\n<HELM name=\"resources\" href={home.helm} />\n\nEach Helm chart subdirectory contains usage documentation. There are two main charts:\n\n* The `prefect-server` chart is used to a deploy a Prefect server. This is an alternative to using\n  [Prefect Cloud](https://app.prefect.cloud/).\n* The `prefect-worker` chart is used to deploy a [Prefect worker](/v3/deploy/infrastructure-concepts/workers).\n\nFinally, there is a `prefect-prometheus-exporter` chart that is used to deploy a Prometheus exporter,\nexposing Prefect metrics for monitoring and alerting.",
  "content_length": 8601
}