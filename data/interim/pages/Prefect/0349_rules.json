{
  "title": "rules",
  "source_url": "https://docs-3.prefect.io/v3/api-ref/python/prefect-server-orchestration-rules",
  "content": "# `prefect.server.orchestration.rules`\n\nPrefect's flow and task-run orchestration machinery.\n\nThis module contains all the core concepts necessary to implement Prefect's state\norchestration engine. These states correspond to intuitive descriptions of all the\npoints that a Prefect flow or task can observe executing user code and intervene, if\nnecessary. A detailed description of states can be found in our concept\n[documentation](https://docs.prefect.io/v3/concepts/states).\n\nPrefect's orchestration engine operates under the assumption that no governed user code\nwill execute without first requesting Prefect REST API validate a change in state and record\nmetadata about the run. With all attempts to run user code being checked against a\nPrefect instance, the Prefect REST API database becomes the unambiguous source of truth for managing\nthe execution of complex interacting workflows. Orchestration rules can be implemented\nas discrete units of logic that operate against each state transition and can be fully\nobservable, extensible, and customizable -- all without needing to store or parse a\nsingle line of user code.\n\n## Classes\n\n### `OrchestrationContext` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/orchestration/rules.py#L71\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\nA container for a state transition, governed by orchestration rules.\n\nWhen a flow- or task- run attempts to change state, Prefect REST API has an opportunity\nto decide whether this transition can proceed. All the relevant information\nassociated with the state transition is stored in an `OrchestrationContext`,\nwhich is subsequently governed by nested orchestration rules implemented using\nthe `BaseOrchestrationRule` ABC.\n\n`OrchestrationContext` introduces the concept of a state being `None` in the\ncontext of an intended state transition. An initial state can be `None` if a run\nis is attempting to set a state for the first time. The proposed state might be\n`None` if a rule governing the transition determines that no state change\nshould occur at all and nothing is written to the database.\n\n**Args:**\n\n* `session`: a SQLAlchemy database session\n* `initial_state`: the initial state of a run\n* `proposed_state`: the proposed state a run is transitioning into\n\n**Methods:**\n\n#### `entry_context` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/orchestration/rules.py#L177\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nentry_context(self) -> tuple[Optional[states.State], Optional[states.State], Self]\n```\n\nA convenience method that generates input parameters for orchestration rules.\n\nAn `OrchestrationContext` defines a state transition that is managed by\norchestration rules which can fire hooks before a transition has been committed\nto the database. These hooks have a consistent interface which can be generated\nwith this method.\n\n#### `exit_context` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/orchestration/rules.py#L192\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nexit_context(self) -> tuple[Optional[states.State], Optional[states.State], Self]\n```\n\nA convenience method that generates input parameters for orchestration rules.\n\nAn `OrchestrationContext` defines a state transition that is managed by\norchestration rules which can fire hooks after a transition has been committed\nto the database. These hooks have a consistent interface which can be generated\nwith this method.\n\n#### `flow_run` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/orchestration/rules.py#L207\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nflow_run(self) -> orm_models.FlowRun | None\n```\n\n#### `initial_state_type` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/orchestration/rules.py#L126\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\ninitial_state_type(self) -> Optional[states.StateType]\n```\n\nThe state type of `self.initial_state` if it exists.\n\n#### `model_validate_list` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/_internal/schemas/bases.py#L56\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nmodel_validate_list(cls, obj: Any) -> list[Self]\n```\n\n#### `proposed_state_type` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/orchestration/rules.py#L132\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nproposed_state_type(self) -> Optional[states.StateType]\n```\n\nThe state type of `self.proposed_state` if it exists.\n\n#### `reset_fields` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/_internal/schemas/bases.py#L85\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nreset_fields(self: Self) -> Self\n```\n\nReset the fields of the model that are in the `_reset_fields` set.\n\n**Returns:**\n\n* A new instance of the model with the reset fields.\n\n#### `run_settings` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/orchestration/rules.py#L143\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nrun_settings(self) -> RP\n```\n\nRun-level settings used to orchestrate the state transition.\n\n#### `safe_copy` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/orchestration/rules.py#L149\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nsafe_copy(self) -> Self\n```\n\nCreates a mostly-mutation-safe copy for use in orchestration rules.\n\nOrchestration rules govern state transitions using information stored in\nan `OrchestrationContext`. However, mutating objects stored on the context\ndirectly can have unintended side-effects. To guard against this,\n`self.safe_copy` can be used to pass information to orchestration rules\nwithout risking mutation.\n\n**Returns:**\n\n* A mutation-safe copy of the `OrchestrationContext`\n\n#### `validated_state_type` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/orchestration/rules.py#L138\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nvalidated_state_type(self) -> Optional[states.StateType]\n```\n\nThe state type of `self.validated_state` if it exists.\n\n### `FlowOrchestrationContext` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/orchestration/rules.py#L211\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\nA container for a flow run state transition, governed by orchestration rules.\n\nWhen a flow- run attempts to change state, Prefect REST API has an opportunity\nto decide whether this transition can proceed. All the relevant information\nassociated with the state transition is stored in an `OrchestrationContext`,\nwhich is subsequently governed by nested orchestration rules implemented using\nthe `BaseOrchestrationRule` ABC.\n\n`FlowOrchestrationContext` introduces the concept of a state being `None` in the\ncontext of an intended state transition. An initial state can be `None` if a run\nis is attempting to set a state for the first time. The proposed state might be\n`None` if a rule governing the transition determines that no state change\nshould occur at all and nothing is written to the database.\n\n**Args:**\n\n* `session`: a SQLAlchemy database session\n* `run`: the flow run attempting to change state\n* `initial_state`: the initial state of a run\n* `proposed_state`: the proposed state a run is transitioning into\n\n**Methods:**\n\n#### `flow_run` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/orchestration/rules.py#L364\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nflow_run(self) -> orm_models.FlowRun\n```\n\n#### `run_settings` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/orchestration/rules.py#L356\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nrun_settings(self) -> core.FlowRunPolicy\n```\n\nRun-level settings used to orchestrate the state transition.\n\n#### `safe_copy` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/orchestration/rules.py#L336\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nsafe_copy(self) -> Self\n```\n\nCreates a mostly-mutation-safe copy for use in orchestration rules.\n\nOrchestration rules govern state transitions using information stored in\nan `OrchestrationContext`. However, mutating objects stored on the context\ndirectly can have unintended side-effects. To guard against this,\n`self.safe_copy` can be used to pass information to orchestration rules\nwithout risking mutation.\n\n**Returns:**\n\n* A mutation-safe copy of `FlowOrchestrationContext`\n\n#### `task_run` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/orchestration/rules.py#L361\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\ntask_run(self) -> None\n```\n\n#### `validate_proposed_state` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/orchestration/rules.py#L252\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nvalidate_proposed_state(self, db: PrefectDBInterface)\n```\n\nValidates a proposed state by committing it to the database.\n\nAfter the `FlowOrchestrationContext` is governed by orchestration rules, the\nproposed state can be validated: the proposed state is added to the current\nSQLAlchemy session and is flushed. `self.validated_state` set to the flushed\nstate. The state on the run is set to the validated state as well.\n\nIf the proposed state is `None` when this method is called, no state will be\nwritten and `self.validated_state` will be set to the run's current state.\n\n**Returns:**\n\n* None\n\n### `TaskOrchestrationContext` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/orchestration/rules.py#L368\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\nA container for a task run state transition, governed by orchestration rules.\n\nWhen a task- run attempts to change state, Prefect REST API has an opportunity\nto decide whether this transition can proceed. All the relevant information\nassociated with the state transition is stored in an `OrchestrationContext`,\nwhich is subsequently governed by nested orchestration rules implemented using\nthe `BaseOrchestrationRule` ABC.\n\n`TaskOrchestrationContext` introduces the concept of a state being `None` in the\ncontext of an intended state transition. An initial state can be `None` if a run\nis is attempting to set a state for the first time. The proposed state might be\n`None` if a rule governing the transition determines that no state change\nshould occur at all and nothing is written to the database.\n\n**Args:**\n\n* `session`: a SQLAlchemy database session\n* `run`: the task run attempting to change state\n* `initial_state`: the initial state of a run\n* `proposed_state`: the proposed state a run is transitioning into\n\n**Methods:**\n\n#### `flow_run` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/orchestration/rules.py#L525\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nflow_run(self) -> orm_models.FlowRun | None\n```\n\n#### `run_settings` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/orchestration/rules.py#L517\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nrun_settings(self) -> core.TaskRunPolicy\n```\n\nRun-level settings used to orchestrate the state transition.\n\n#### `safe_copy` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/orchestration/rules.py#L497\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nsafe_copy(self) -> Self\n```\n\nCreates a mostly-mutation-safe copy for use in orchestration rules.\n\nOrchestration rules govern state transitions using information stored in\nan `OrchestrationContext`. However, mutating objects stored on the context\ndirectly can have unintended side-effects. To guard against this,\n`self.safe_copy` can be used to pass information to orchestration rules\nwithout risking mutation.\n\n**Returns:**\n\n* A mutation-safe copy of `TaskOrchestrationContext`\n\n#### `task_run` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/orchestration/rules.py#L522\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\ntask_run(self) -> orm_models.TaskRun\n```\n\n#### `validate_proposed_state` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/orchestration/rules.py#L409\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nvalidate_proposed_state(self, db: PrefectDBInterface)\n```\n\nValidates a proposed state by committing it to the database.\n\nAfter the `TaskOrchestrationContext` is governed by orchestration rules, the\nproposed state can be validated: the proposed state is added to the current\nSQLAlchemy session and is flushed. `self.validated_state` set to the flushed\nstate. The state on the run is set to the validated state as well.\n\nIf the proposed state is `None` when this method is called, no state will be\nwritten and `self.validated_state` will be set to the run's current state.\n\n**Returns:**\n\n* None\n\n### `BaseOrchestrationRule` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/orchestration/rules.py#L534\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\nAn abstract base class used to implement a discrete piece of orchestration logic.\n\nAn `OrchestrationRule` is a stateful context manager that directly governs a state\ntransition. Complex orchestration is achieved by nesting multiple rules.\nEach rule runs against an `OrchestrationContext` that contains the transition\ndetails; this context is then passed to subsequent rules. The context can be\nmodified by hooks that fire before and after a new state is validated and committed\nto the database. These hooks will fire as long as the state transition is\nconsidered \"valid\" and govern a transition by either modifying the proposed state\nbefore it is validated or by producing a side-effect.\n\nA state transition occurs whenever a flow- or task- run changes state, prompting\nPrefect REST API to decide whether or not this transition can proceed. The current state of\nthe run is referred to as the \"initial state\", and the state a run is\nattempting to transition into is the \"proposed state\". Together, the initial state\ntransitioning into the proposed state is the intended transition that is governed\nby these orchestration rules. After using rules to enter a runtime context, the\n`OrchestrationContext` will contain a proposed state that has been governed by\neach rule, and at that point can validate the proposed state and commit it to\nthe database. The validated state will be set on the context as\n`context.validated_state`, and rules will call the `self.after_transition` hook\nupon exiting the managed context.\n\nExamples:\n\nCreate a rule:\n\n```python  theme={null}\nclass BasicRule(BaseOrchestrationRule):\n    # allowed initial state types\n    FROM_STATES = [StateType.RUNNING]\n    # allowed proposed state types\n    TO_STATES = [StateType.COMPLETED, StateType.FAILED]\n\n    async def before_transition(initial_state, proposed_state, ctx):\n        # side effects and proposed state mutation can happen here\n        ...\n\n    async def after_transition(initial_state, validated_state, ctx):\n        # operations on states that have been validated can happen here\n        ...\n\n    async def cleanup(intitial_state, validated_state, ctx):\n        # reverts side effects generated by `before_transition` if necessary\n        ...\n```\n\nUse a rule:\n\n```python  theme={null}\nintended_transition = (StateType.RUNNING, StateType.COMPLETED)\nasync with BasicRule(context, *intended_transition):\n    # context.proposed_state has been governed by BasicRule\n    ...\n```\n\nUse multiple rules:\n\n```python  theme={null}\nrules = [BasicRule, BasicRule]\nintended_transition = (StateType.RUNNING, StateType.COMPLETED)\nasync with contextlib.AsyncExitStack() as stack:\n    for rule in rules:\n        stack.enter_async_context(rule(context, *intended_transition))\n\n    # context.proposed_state has been governed by all rules\n    ...\n```\n\n**Args:**\n\n* `context`: A `FlowOrchestrationContext` or `TaskOrchestrationContext` that is\n  passed between rules\n* `from_state_type`: The state type of the initial state of a run, if this\n  state type is not contained in `FROM_STATES`, no hooks will fire\n* `to_state_type`: The state type of the proposed state before orchestration, if\n  this state type is not contained in `TO_STATES`, no hooks will fire\n\n**Methods:**\n\n#### `abort_transition` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/orchestration/rules.py#L900\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nabort_transition(self, reason: str) -> None\n```\n\nAborts a proposed transition before the transition is validated.\n\nThis method will abort a proposed transition, expecting no further action to\noccur for this run. The proposed state is set to `None`, signaling to the\n`OrchestrationContext` that no state should be written to the database. A\nreason for aborting the transition is also provided. Rules that abort the\ntransition will not fizzle, despite the proposed state type changing.\n\n**Args:**\n\n* `reason`: The reason for aborting the transition\n\n#### `after_transition` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/orchestration/rules.py#L727\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nafter_transition(self, initial_state: Optional[states.State], validated_state: Optional[states.State], context: OrchestrationContext[T, RP]) -> None\n```\n\nImplements a hook that can fire after a state is committed to the database.\n\n**Args:**\n\n* `initial_state`: The initial state of a transition\n* `validated_state`: The governed state that has been committed to the database\n* `context`: A safe copy of the `OrchestrationContext`, with the exception of\n  `context.run`, mutating this context will have no effect on the broader\n  orchestration environment.\n\n**Returns:**\n\n* None\n\n#### `before_transition` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/orchestration/rules.py#L696\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nbefore_transition(self, initial_state: Optional[states.State], proposed_state: Optional[states.State], context: OrchestrationContext[T, RP]) -> None\n```\n\nImplements a hook that can fire before a state is committed to the database.\n\nThis hook may produce side-effects or mutate the proposed state of a\ntransition using one of four methods: `self.reject_transition`,\n`self.delay_transition`, `self.abort_transition`, and `self.rename_state`.\n\n**Args:**\n\n* `initial_state`: The initial state of a transition\n* `proposed_state`: The proposed state of a transition\n* `context`: A safe copy of the `OrchestrationContext`, with the exception of\n  `context.run`, mutating this context will have no effect on the broader\n  orchestration environment.\n\n**Returns:**\n\n* None\n\n#### `cleanup` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/orchestration/rules.py#L747\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\ncleanup(self, initial_state: Optional[states.State], validated_state: Optional[states.State], context: OrchestrationContext[T, RP]) -> None\n```\n\nImplements a hook that can fire after a state is committed to the database.\n\nThe intended use of this method is to revert side-effects produced by\n`self.before_transition` when the transition is found to be invalid on exit.\nThis allows multiple rules to be gracefully run in sequence, without logic that\nkeeps track of all other rules that might govern a transition.\n\n**Args:**\n\n* `initial_state`: The initial state of a transition\n* `validated_state`: The governed state that has been committed to the database\n* `context`: A safe copy of the `OrchestrationContext`, with the exception of\n  `context.run`, mutating this context will have no effect on the broader\n  orchestration environment.\n\n**Returns:**\n\n* None\n\n#### `delay_transition` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/orchestration/rules.py#L868\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\ndelay_transition(self, delay_seconds: int, reason: str) -> None\n```\n\nDelays a proposed transition before the transition is validated.\n\nThis method will delay a proposed transition, setting the proposed state to\n`None`, signaling to the `OrchestrationContext` that no state should be\nwritten to the database. The number of seconds a transition should be delayed is\npassed to the `OrchestrationContext`. A reason for delaying the transition is\nalso provided. Rules that delay the transition will not fizzle, despite the\nproposed state type changing.\n\n**Args:**\n\n* `delay_seconds`: The number of seconds the transition should be delayed\n* `reason`: The reason for delaying the transition\n\n#### `fizzled` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/orchestration/rules.py#L795\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nfizzled(self) -> bool\n```\n\nDetermines if a rule is fizzled and side-effects need to be reverted.\n\nRules are fizzled if the transitions were valid on entry (thus firing\n`self.before_transition`) but are invalid upon exiting the governed context,\nmost likely caused by another rule mutating the transition.\n\n**Returns:**\n\n* True if the rule is fizzled, False otherwise.\n\n#### `invalid` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/orchestration/rules.py#L772\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\ninvalid(self) -> bool\n```\n\nDetermines if a rule is invalid.\n\nInvalid rules do nothing and no hooks fire upon entering or exiting a governed\ncontext. Rules are invalid if the transition states types are not contained in\n`self.FROM_STATES` and `self.TO_STATES`, or if the context is proposing\na transition that differs from the transition the rule was instantiated with.\n\n**Returns:**\n\n* True if the rules in invalid, False otherwise.\n\n#### `invalid_transition` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/orchestration/rules.py#L811\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\ninvalid_transition(self) -> bool\n```\n\nDetermines if the transition proposed by the `OrchestrationContext` is invalid.\n\nIf the `OrchestrationContext` is attempting to manage a transition with this\nrule that differs from the transition the rule was instantiated with, the\ntransition is considered to be invalid. Depending on the context, a rule with an\ninvalid transition is either \"invalid\" or \"fizzled\".\n\n**Returns:**\n\n* True if the transition is invalid, False otherwise.\n\n#### `reject_transition` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/orchestration/rules.py#L830\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nreject_transition(self, state: Optional[states.State], reason: str) -> None\n```\n\nRejects a proposed transition before the transition is validated.\n\nThis method will reject a proposed transition, mutating the proposed state to\nthe provided `state`. A reason for rejecting the transition is also passed on\nto the `OrchestrationContext`. Rules that reject the transition will not fizzle,\ndespite the proposed state type changing.\n\n**Args:**\n\n* `state`: The new proposed state. If `None`, the current run state will be\n  returned in the result instead.\n* `reason`: The reason for rejecting the transition\n\n#### `rename_state` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/orchestration/rules.py#L924\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nrename_state(self, state_name: str) -> None\n```\n\nSets the \"name\" attribute on a proposed state.\n\nThe name of a state is an annotation intended to provide rich, human-readable\ncontext for how a run is progressing. This method only updates the name and not\nthe canonical state TYPE, and will not fizzle or invalidate any other rules\nthat might govern this state transition.\n\n#### `update_context_parameters` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/orchestration/rules.py#L936\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nupdate_context_parameters(self, key: str, value: Any) -> None\n```\n\nUpdates the \"parameters\" dictionary attribute with the specified key-value pair.\n\nThis mechanism streamlines the process of passing messages and information\nbetween orchestration rules if necessary and is simpler and more ephemeral than\nmessage-passing via the database or some other side-effect. This mechanism can\nbe used to break up large rules for ease of testing or comprehension, but note\nthat any rules coupled this way (or any other way) are no longer independent and\nthe order in which they appear in the orchestration policy priority will matter.\n\n### `FlowRunOrchestrationRule` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/orchestration/rules.py#L951\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n### `TaskRunOrchestrationRule` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/orchestration/rules.py#L957\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n### `GenericOrchestrationRule` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/orchestration/rules.py#L963\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n### `BaseUniversalTransform` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/orchestration/rules.py#L969\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\nAn abstract base class used to implement privileged bookkeeping logic.\n\nBeyond the orchestration rules implemented with the `BaseOrchestrationRule` ABC,\nUniversal transforms are not stateful, and fire their before- and after- transition\nhooks on every state transition unless the proposed state is `None`, indicating that\nno state should be written to the database. Because there are no guardrails in place\nto prevent directly mutating state or other parts of the orchestration context,\nuniversal transforms should only be used with care.\n\n**Args:**\n\n* `context`: A `FlowOrchestrationContext` or `TaskOrchestrationContext` that is\n  passed between transforms\n\n**Methods:**\n\n#### `after_transition` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/orchestration/rules.py#L1055\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nafter_transition(self, context: OrchestrationContext[T, RP]) -> None\n```\n\nImplements a hook that can fire after a state is committed to the database.\n\n**Args:**\n\n* `context`: the `OrchestrationContext` that contains transition details\n\n**Returns:**\n\n* None\n\n#### `before_transition` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/orchestration/rules.py#L1044\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nbefore_transition(self, context: OrchestrationContext[T, RP]) -> None\n```\n\nImplements a hook that fires before a state is committed to the database.\n\n**Args:**\n\n* `context`: the `OrchestrationContext` that contains transition details\n\n**Returns:**\n\n* None\n\n#### `exception_in_transition` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/orchestration/rules.py#L1079\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nexception_in_transition(self) -> bool\n```\n\nDetermines if the transition has encountered an exception.\n\n**Returns:**\n\n* True if the transition is encountered an exception, False otherwise.\n\n#### `nullified_transition` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/orchestration/rules.py#L1066\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nnullified_transition(self) -> bool\n```\n\nDetermines if the transition has been nullified.\n\nTransitions are nullified if the proposed state is `None`, indicating that\nnothing should be written to the database.\n\n**Returns:**\n\n* True if the transition is nullified, False otherwise.\n\n### `TaskRunUniversalTransform` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/orchestration/rules.py#L1090\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n### `FlowRunUniversalTransform` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/orchestration/rules.py#L1096\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n### `GenericUniversalTransform` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/orchestration/rules.py#L1102\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>",
  "content_length": 30810
}