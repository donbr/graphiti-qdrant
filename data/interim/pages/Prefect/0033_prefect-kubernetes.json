{
  "title": "prefect-kubernetes",
  "source_url": "https://docs-3.prefect.io/integrations/prefect-kubernetes/index",
  "content": "`prefect-kubernetes` contains Prefect tasks, flows, and blocks enabling orchestration, observation and management of Kubernetes resources.\n\nThis library is most commonly used for installation with a Kubernetes worker. See the [Prefect docs on deploying with Kubernetes](/v3/how-to-guides/deployment_infra/kubernetes) to learn how to create and run deployments in Kubernetes.\n\nPrefect provides a Helm chart for deploying a worker, a self-hosted Prefect server instance, and other resources to a Kubernetes cluster. See the [Prefect Helm chart](https://github.com/PrefectHQ/prefect-helm) for more information.\n\n## Getting started\n\n### Prerequisites\n\n* [Kubernetes installed](https://kubernetes.io/).\n\n### Install `prefect-kubernetes`\n\nThe following command will install a version of `prefect-kubernetes` compatible with your installed version of `prefect`.\nIf you don't already have `prefect` installed, it will install the newest version of `prefect` as well.\n\n```bash  theme={null}\npip install \"prefect[kubernetes]\"\n```\n\nUpgrade to the latest versions of `prefect` and `prefect-kubernetes`:\n\n```bash  theme={null}\npip install -U \"prefect[kubernetes]\"\n```\n\n### Register newly installed block types\n\nRegister the block types in the `prefect-kubernetes` module to make them available for use.\n\n```bash  theme={null}\nprefect block register -m prefect_kubernetes\n```\n\n## Examples\n\n### Use `with_options` to customize options on an existing task or flow\n\n```python  theme={null}\nfrom prefect_kubernetes.flows import run_namespaced_job\n\ncustomized_run_namespaced_job = run_namespaced_job.with_options(\n    name=\"My flow running a Kubernetes Job\",\n    retries=2,\n    retry_delay_seconds=10,\n) # this is now a new flow object that can be called\n```\n\n### Specify and run a Kubernetes Job from a YAML file\n\n```python  theme={null}\nfrom prefect import flow, get_run_logger\nfrom prefect_kubernetes.credentials import KubernetesCredentials\nfrom prefect_kubernetes.flows import run_namespaced_job # this is a flow\nfrom prefect_kubernetes.jobs import KubernetesJob\n\nk8s_creds = KubernetesCredentials.load(\"k8s-creds\")\n\njob = KubernetesJob.from_yaml_file( # or create in the UI with a dict manifest\n    credentials=k8s_creds,\n    manifest_path=\"path/to/job.yaml\",\n)\n\njob.save(\"my-k8s-job\", overwrite=True)\n\n\n@flow\ndef kubernetes_orchestrator():\n    # run the flow and send logs to the parent flow run's logger\n    logger = get_run_logger()\n    run_namespaced_job(job, print_func=logger.info)\n\n\nif __name__ == \"__main__\":\n    kubernetes_orchestrator()\n```\n\nAs with all Prefect flows and tasks, you can call the underlying function directly if you don't need Prefect features:\n\n```python  theme={null}\nrun_namespaced_job.fn(job, print_func=print)\n```\n\n### Generate a resource-specific client from `KubernetesClusterConfig`\n\n```python  theme={null}\n# with minikube / docker desktop & a valid ~/.kube/config this should ~just work~\nfrom prefect_kubernetes.credentials import KubernetesCredentials, KubernetesClusterConfig\n\nk8s_config = KubernetesClusterConfig.from_file('~/.kube/config')\n\nk8s_credentials = KubernetesCredentials(cluster_config=k8s_config)\n\nwith k8s_credentials.get_client(\"core\") as v1_core_client:\n    for namespace in v1_core_client.list_namespace().items:\n        print(namespace.metadata.name)\n```\n\n### List jobs in a namespace\n\n```python  theme={null}\nfrom prefect import flow\nfrom prefect_kubernetes.credentials import KubernetesCredentials\nfrom prefect_kubernetes.jobs import list_namespaced_job\n\n\n@flow\ndef kubernetes_orchestrator():\n    v1_job_list = list_namespaced_job(\n        kubernetes_credentials=KubernetesCredentials.load(\"k8s-creds\"),\n        namespace=\"my-namespace\",\n    )\n```\n\nFor assistance using Kubernetes, consult the [Kubernetes documentation](https://kubernetes.io/).\n\nRefer to the `prefect-kubernetes` [SDK documentation](https://reference.prefect.io/prefect_kubernetes/) to explore all the capabilities of the `prefect-kubernetes` library.",
  "content_length": 3964
}