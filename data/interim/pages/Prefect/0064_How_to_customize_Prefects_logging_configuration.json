{
  "title": "How to customize Prefect's logging configuration",
  "source_url": "https://docs-3.prefect.io/v3/advanced/logging-customization",
  "content": "Prefect relies on [the standard Python implementation of logging configuration](https://docs.python.org/3/library/logging.config.html).\nThe full specification of the default logging configuration for any version of Prefect can always be inspected [here](https://github.com/PrefectHQ/prefect/blob/main/src/prefect/logging/logging.yml).\nThe default logging level is `INFO`.\n\n### Customize logging configuration\n\nPrefect provides several settings to configure the logging level and individual loggers.\n\nAny value in [Prefect's logging configuration file](https://github.com/PrefectHQ/prefect/blob/main/src/prefect/logging/logging.yml) can be overridden through\na Prefect setting of the form `PREFECT_LOGGING_[PATH]_[TO]_[KEY]=value` corresponding to the nested address of the field you are configuring.\n\nFor example, to change the default logging level for flow runs but not task runs, update your profile with:\n\n```bash  theme={null}\nprefect config set PREFECT_LOGGING_LOGGERS_PREFECT_FLOW_RUNS_LEVEL=\"ERROR\"\n```\n\nor set the corresponding environment variable:\n\n```bash  theme={null}\nexport PREFECT_LOGGING_LOGGERS_PREFECT_FLOW_RUNS_LEVEL=\"ERROR\"\n```\n\nYou can also configure the \"root\" Python logger. The root logger receives logs from all loggers unless they\nexplicitly opt out by disabling propagation. By default, the root logger is configured to output `WARNING` level logs\nto the console. As with other logging settings, you can override this from the environment or in the logging configuration\nfile. For example, you can change the level with the `PREFECT_LOGGING_ROOT_LEVEL` environment variable.\n\nIn some situations you may want to completely overhaul the Prefect logging configuration by providing your own `logging.yml` file.\nYou can create your own version of `logging.yml` in one of two ways:\n\n1. Create a `logging.yml` file in your `PREFECT_HOME` directory (default is `~/.prefect`).\n2. Specify a custom path to your `logging.yml` file using the `PREFECT_LOGGING_SETTINGS_PATH` setting.\n\nIf Prefect cannot find the `logging.yml` file at the specified location, it will fall back to using the default logging configuration.\n\nSee the Python [Logging configuration](https://docs.python.org/3/library/logging.config.html#logging.config.dictConfig)\ndocumentation for more information about the configuration options and syntax used by `logging.yml`.\n\n<Note>\n  As with all Prefect settings, logging settings are loaded at runtime.\n  This means that to customize Prefect logging in a remote environment requires setting the appropriate environment variables and/or profile in that environment.\n</Note>\n\n### Formatters\n\nPrefect log formatters specify the format of log messages.\nThe default formatting for task and flow run records is\n`\"%(asctime)s.%(msecs)03d | %(levelname)-7s | Task run %(task_run_name)r - %(message)s\"` for tasks and\nsimilarly `\"%(asctime)s.%(msecs)03d | %(levelname)-7s | Flow run %(flow_run_name)r - %(message)s\"` for flows.\n\nThe variables available to interpolate in log messages vary by logger.\nIn addition to the run context, message string,\nand any keyword arguments, flow and task run loggers have access to additional variables.\n\nThe flow run logger has the following variables available for formatting:\n\n* `flow_run_name`\n* `flow_run_id`\n* `flow_name`\n\nThe task run logger has the following variables available for formatting:\n\n* `task_run_id`\n* `flow_run_id`\n* `task_run_name`\n* `task_name`\n* `flow_run_name`\n* `flow_name`\n\nYou can specify custom formatting by setting the relevant environment variable or by modifying the formatter in a custom `logging.yml` file as\ndescribed earlier.\nFor example, the following changes the formatting for the flow runs formatter:\n\n```bash  theme={null}\nPREFECT_LOGGING_FORMATTERS_STANDARD_FLOW_RUN_FMT=\"%(asctime)s.%(msecs)03d | %(levelname)-7s | %(flow_run_id)s - %(message)s\"\n```\n\nThe resulting messages, using the flow run ID instead of name, look like this:\n\n```bash  theme={null}\n10:40:01.211 | INFO    | e43a5a80-417a-41c4-a39e-2ef7421ee1fc - Created task run\n'othertask-1c085beb-3' for task 'othertask'\n```\n\n### Styles\n\nBy default, Prefect highlights specific keywords in the console logs with a variety of colors.\nYou can toggle highlighting on/off with the `PREFECT_LOGGING_COLORS` setting:\n\n```bash  theme={null}\nPREFECT_LOGGING_COLORS=False\n```\n\nYou can also change what gets highlighted and even adjust the colors by updating the styles - see the `styles`\nsection of [the Prefect logging configuration file](https://github.com/PrefectHQ/prefect/blob/main/src/prefect/logging/logging.yml) for available keys.\n\n<Note>\n  Note that these style settings only impact the display within a terminal, not the Prefect UI.\n</Note>\n\nYou can even build your own handler with a [custom highlighter](https://rich.readthedocs.io/en/stable/highlighting.html#custom-highlighters).\nFor example, to additionally highlight emails:\n\n1. Copy and paste the following code into  `my_package_or_module.py` (rename as needed) in the same directory as the flow run\n   script; or ideally as part of a Python package so it's available in `site-packages` and accessible anywhere within your environment.\n\n```python  theme={null}\nimport logging\nfrom typing import Dict, Union\n\nfrom rich.highlighter import Highlighter\n\nfrom prefect.logging.handlers import PrefectConsoleHandler\nfrom prefect.logging.highlighters import PrefectConsoleHighlighter\n\nclass CustomConsoleHighlighter(PrefectConsoleHighlighter):\n    base_style = \"log.\"\n    highlights = PrefectConsoleHighlighter.highlights + [\n        # ?P<email> is naming this expression as `email`\n        r\"(?P<email>[\\w-]+@([\\w-]+\\.)+[\\w-]+)\",\n    ]\n\nclass CustomConsoleHandler(PrefectConsoleHandler):\n    def __init__(\n        self,\n        highlighter: Highlighter = CustomConsoleHighlighter,\n        styles: Dict[str, str] = None,\n        level: Union[int, str] = logging.NOTSET,\n   ):\n        super().__init__(highlighter=highlighter, styles=styles, level=level)\n```\n\n2. Update `~/.prefect/logging.yml` to use `my_package_or_module.CustomConsoleHandler` and additionally reference the\n   base\\_style and named expression: `log.email`.\n\n```yaml  theme={null}\n    console_flow_runs:\n        level: 0\n        class: my_package_or_module.CustomConsoleHandler\n        formatter: flow_runs\n        styles:\n            log.email: magenta\n            # other styles can be appended here, e.g.\n            # log.completed_state: green\n```\n\n3. On your next flow run, text that looks like an email is highlighted. For example, `my@email.com` is colored in\n   magenta below:\n\n```python  theme={null}\nfrom prefect import flow\nfrom prefect.logging import get_run_logger\n\n@flow\ndef log_email_flow():\n    logger = get_run_logger()\n    logger.info(\"my@email.com\")\n\nlog_email_flow()\n```\n\n### Apply markup in logs\n\nTo use [Rich's markup](https://rich.readthedocs.io/en/stable/markup.html#console-markup) in Prefect logs, first\nconfigure `PREFECT_LOGGING_MARKUP`:\n\n```bash  theme={null}\nPREFECT_LOGGING_MARKUP=True\n```\n\nThe following will highlight \"fancy\" in red:\n\n```python  theme={null}\nfrom prefect import flow\nfrom prefect.logging import get_run_logger\n\n@flow\ndef my_flow():\n    logger = get_run_logger()\n    logger.info(\"This is [bold red]fancy[/]\")\n\nmy_flow()\n```\n\n<Warning>\n  **Inaccurate logs could result**\n\n  If enabled, strings that contain square brackets may be\n  inaccurately interpreted and lead to incomplete output. For example, `DROP TABLE [dbo].[SomeTable];\"` outputs\n  `DROP TABLE .[SomeTable];`.\n</Warning>\n\n## Include logs from other libraries\n\nBy default, Prefect won't capture log statements from libraries that your flows\nand tasks use. You can tell Prefect to include logs from these libraries with\nthe `PREFECT_LOGGING_EXTRA_LOGGERS` setting.\n\nTo use this setting, specify one or more Python library names to include,\nseparated by commas. For example, if you want Prefect to capture Dask\nand SciPy logging statements with your flow and task run logs, use:\n\n`PREFECT_LOGGING_EXTRA_LOGGERS=dask,scipy`\n\nConfigure this setting as an environment variable or in a profile. See\n[Settings](/v3/develop/settings-and-profiles/) for more details about how to use settings.",
  "content_length": 8172
}