{
  "title": "How to retrieve code from storage",
  "source_url": "https://docs-3.prefect.io/v3/how-to-guides/deployments/store-flow-code",
  "content": "Learn about code storage as it relates to execution of deployments\n\nWhen a deployment runs, the execution environment needs access to the flow code.\nFlow code is not stored directly in Prefect server or Prefect Cloud; instead, it must be made available to the execution environment. There are two main ways to achieve this:\n\n1. **Include source code directly in your runtime:** Often, this means [building your code into a Docker image](/v3/how-to-guides/deployment_infra/docker/#automatically-build-a-custom-docker-image-with-a-local-dockerfile).\n2. **Retrieve code from storage at runtime:** The [worker](/v3/concepts/workers/) pulls code from a specified location before starting the flow run.\n\nThis page focuses on the second approach: retrieving code from a storage location at runtime.\n\nYou have several options for where your code can be stored and pulled from:\n\n* Local filesystem\n* Git-based storage (GitHub, GitLab, Bitbucket)\n* Blob storage (AWS S3, Azure Blob Storage, GCP GCS)\n\nThe ideal choice depends on your team's needs and tools.\n\nIn the examples below, we show how to create a deployment configured to run on [dynamic infrastructure](/v3/concepts/work-pools) for each of these storage options.\n\n## Deployment creation options\n\nAs detailed in the [Deployment overview](/v3/deploy), you can create a deployment in one of two main ways:\n\n* [Python code with the `flow.deploy` method](/v3/how-to-guides/deployments/deploy-via-python)\n\n  * When using `.deploy`, specify a storage location for your flow with the `flow.from_source` method.\n\n  * The `source` is either a URL to a git repository or a storage object. For example:\n    * A local directory: `source=Path(__file__).parent` or `source=\"/path/to/file\"`\n    * A URL to a git repository: `source=\"https://github.com/org/my-repo.git\"`\n    * A storage object: `source=GitRepository(url=\"https://github.com/org/my-repo.git\")`\n\n  * The `entrypoint` is the path to the file the flow is located in and the function name, separated by a colon.\n\n* [YAML specification defined in a `prefect.yaml` file](/v3/how-to-guides/deployments/prefect-yaml)\n\n  * To create a `prefect.yaml` file interactively, run `prefect deploy` from the CLI and follow the prompts.\n\n  * The `prefect.yaml` file may define a `pull` section that specifies the storage location for your flow. For example:\n    * Set the working directory:\n    ```yaml  theme={null}\n    pull:\n        - prefect.deployments.steps.set_working_directory:\n            directory: /path/to/directory\n    ```\n    * Clone a git repository:\n    ```yaml  theme={null}\n    pull:\n        - prefect.deployments.steps.git_clone:\n            repository: https://github.com/org/my-repo.git\n    ```\n    * Pull from blob storage:\n    ```yaml  theme={null}\n    pull:\n        - prefect.deployments.steps.pull_from_blob_storage:\n            container: my-container\n            folder: my-folder\n    ```\n\nWhether you use `from_source` or `prefect.yaml` to specify the storage location for your flow code, the resulting deployment will have a set of `pull` steps that your worker will use to retrieve the flow code at runtime.\n\n## Store code locally\n\nIf using a Process work pool, you can use one of the remote code storage options shown above, or you can store your flow code in a local folder.\n\nHere is an example of how to create a deployment with flow code stored locally:\n\n<CodeGroup>\n  ```python local_process_deploy_local_code.py theme={null}\n  from prefect import flow\n  from pathlib import Path\n\n\n  @flow(log_prints=True)\n  def my_flow(name: str = \"World\"):\n      print(f\"Hello {name}!\")\n\n\n  if __name__ == \"__main__\":\n      my_flow.from_source(\n          source=str(Path(__file__).parent),  # code stored in local directory\n          entrypoint=\"local_process_deploy_local_code.py:my_flow\",\n      ).deploy(\n          name=\"local-process-deploy-local-code\",\n          work_pool_name=\"my-process-pool\",\n      )\n  ```\n\n  ```yaml prefect.yaml theme={null}\n  pull:\n  - prefect.deployments.steps.set_working_directory:\n      directory: /my_directory\n\n  deployments:\n  - name: local-process-deploy-local-code\n    entrypoint: local_process_deploy_local_code.py:my_flow\n    work_pool:\n      name: my-process-pool\n  ```\n</CodeGroup>\n\n## Git-based storage\n\nGit-based version control platforms provide redundancy, version control, and collaboration capabilities. Prefect supports:\n\n* [GitHub](https://github.com/)\n* [GitLab](https://www.gitlab.com)\n* [Bitbucket](https://bitbucket.org/)\n\nFor a public repository, you can use the repository URL directly.\n\nIf you are using a private repository and are authenticated in your environment at deployment creation and deployment execution, you can use the repository URL directly.\n\nAlternatively, for a private repository, you can create a `Secret` block or `git`-platform-specific credentials [block](/v3/develop/blocks/) to store your credentials:\n\n* [`GitHubCredentials`](https://docs.prefect.io/integrations/prefect-github/)\n* [`BitBucketCredentials`](https://docs.prefect.io/integrations/prefect-bitbucket/)\n* [`GitLabCredentials`](https://docs.prefect.io/integrations/prefect-gitlab/)\n\nThen you can reference this block in the Python `deploy` method or the `prefect.yaml` file pull step.\n\nIf using the Python `deploy` method with a private repository that references a block, provide a [`GitRepository`](https://reference.prefect.io/prefect/flows/#prefect.runner.storage.GitRepository) object instead of a URL, as shown below.\n\n<Tabs>\n  <Tab title=\"GitHub\">\n    <CodeGroup>\n      ```python gh_public_repo.py theme={null}\n      from prefect import flow\n\n      if __name__ == \"__main__\":\n          flow.from_source(\n              source=\"https://github.com/org/my-public-repo.git\",\n              entrypoint=\"gh_public_repo.py:my_flow\",\n          ).deploy(\n              name=\"my-github-deployment\",\n              work_pool_name=\"my_pool\",\n          )\n      ```\n\n      ```python gh_private_repo_credentials_block.py theme={null}\n      from prefect import flow\n      from prefect.runner.storage import GitRepository\n      from prefect_github import GitHubCredentials\n\n\n      if __name__ == \"__main__\":\n\n          github_repo = GitRepository(\n              url=\"https://github.com/org/my-private-repo.git\",\n              credentials=GitHubCredentials.load(\"my-github-credentials-block\"),\n          )\n\n          flow.from_source(\n              source=github_repo,\n              entrypoint=\"gh_private_repo_credentials_block.py:my_flow\",\n          ).deploy(\n              name=\"private-github-deploy\",\n              work_pool_name=\"my_pool\",\n          )\n      ```\n\n      ```python gh_private_repo_secret_block.py theme={null}\n      from prefect import flow\n      from prefect.runner.storage import GitRepository\n      from prefect.blocks.system import Secret\n\n\n      if __name__ == \"__main__\":\n\n          github_repo = GitRepository(\n              url=\"https://github.com/org/my-private-repo.git\",\n              credentials={\n                  \"access_token\": Secret.load(\"my-secret-block-with-my-gh-credentials\")\n              },\n          )\n\n          flow.from_source(\n              source=github_repo,\n              entrypoint=\"gh_private_repo_secret_block.py:my_flow\",\n          ).deploy(\n              name=\"private-github-deploy\",\n              work_pool_name=\"my_pool\",\n          )\n      ```\n\n      ```yaml prefect.yaml theme={null}\n      # relevant section of the file:\n      pull:\n          - prefect.deployments.steps.git_clone:\n              repository: https://gitlab.com/org/my-repo.git\n              # Uncomment the following line if using a credentials block\n              # credentials: \"{{ prefect.blocks.github-credentials.my-github-credentials-block }}\"\n              # Uncomment the following line if using a Secret block\n              # access_token: \"{{ prefect.blocks.secret.my-block-name }}\"\n      ```\n    </CodeGroup>\n\n    For accessing a private repository, we suggest creating a [Personal Access Tokens (PATs)](https://docs.github.com/en/github/authenticating-to-github/creating-a-personal-access-token).\n    We recommend using HTTPS with [fine-grained Personal Access Tokens](https://docs.github.com/en/authentication/keeping-your-account-and-data-secure/managing-your-personal-access-tokens#creating-a-fine-grained-personal-access-token) to limit access by repository.\n\n    <Warning>\n      **Personal Access Token Permissions**\n\n      When using a fine-grained token, ensure to add permissions to the token prior to saving. Per least privilege, we recommend granting the token the ability to read **Contents** and **Metadata** for your repository.\n    </Warning>\n\n    If using a `Secret` block, you can create it through code or the UI ahead of time and reference it at deployment creation as shown above.\n\n    If using a `GitHubCredentials` block to store your credentials, you can create it ahead of time and reference it at deployment creation.\n\n    1. Install `prefect-github` with `pip install -U prefect-github`\n    2. Register all block types defined in `prefect-github` with `prefect block register -m prefect_github`\n    3. Create a `GitHubCredentials` block through code or the Prefect UI and reference it at deployment creation as shown above.\n  </Tab>\n\n  <Tab title=\"Bitbucket\">\n    <CodeGroup>\n      ```python bb_public_repo.py theme={null}\n      from prefect import flow\n\n\n      if __name__ == \"__main__\":\n          flow.from_source(\n              source=\"https://bitbucket.com/org/my-public-repo.git\",\n              entrypoint=\"bb_public_repo.py:my_flow\",\n          ).deploy(\n              name=\"my-bitbucket-deployment\",\n              work_pool_name=\"my_pool\",\n          )\n      ```\n\n      ```python bb_private_repo_credentials_block.py theme={null}\n\n      from prefect import flow\n      from prefect.runner.storage import GitRepository\n      from prefect_bitbucket import BitBucketCredentials\n\n      if __name__ == \"__main__\":\n\n          github_repo = GitRepository(\n              url=\"https://bitbucket.com/org/my-private-repo.git\",\n              credentials=BitBucketCredentials.load(\"my-bitbucket-credentials-block\")\n          )\n\n          flow.from_source(\n              source=source,\n              entrypoint=\"bb_private_repo_credentials_block.py:my_flow\",\n          ).deploy(\n              name=\"private-bitbucket-deploy\",\n              work_pool_name=\"my_pool\",\n          )\n      ```\n\n      ```python bb_private_repo_secret_block.py theme={null}\n\n      from prefect import flow\n      from prefect.runner.storage import GitRepository\n      from prefect.blocks.system import Secret\n\n\n      if __name__ == \"__main__\":\n          github_repo=GitRepository(\n              url=\"https://bitbucket.com/org/my-private-repo.git\",\n              credentials={\n                  \"access_token\": Secret.load(\"my-secret-block-with-my-bb-credentials\")\n              },\n          )\n          \n          flow.from_source(\n              source=github_repo,\n              entrypoint=\"bb_private_repo_secret_block.py:my_flow\",\n          ).deploy(\n              name=\"private-bitbucket-deploy\",\n              work_pool_name=\"my_pool\",\n          )\n      ```\n\n      ```yaml prefect.yaml theme={null}\n      # relevant section of the file:\n      pull:\n          - prefect.deployments.steps.git_clone:\n              repository: https://bitbucket.org/org/my-private-repo.git\n              # Uncomment the following line if using a credentials block\n              # credentials: \"{{ prefect.blocks.bitbucket-credentials.my-bitbucket-credentials-block }}\"\n              # Uncomment the following line if using a Secret block\n              # access_token: \"{{ prefect.blocks.secret.my-block-name }}\"\n      ```\n    </CodeGroup>\n\n    For accessing a private repository, we recommend using HTTPS with Repository, Project, or Workspace [Access Tokens](https://support.atlassian.com/bitbucket-cloud/docs/access-tokens/).\n\n    [Create a token](https://support.atlassian.com/bitbucket-cloud/docs/create-a-repository-access-token/) with **read** access to the repository.\n\n    Bitbucket requires you prepend the token string with `x-token-auth:` The full string looks like this: `x-token-auth:abc_123_this_is_a_token`.\n\n    If using a `Secret` block, you can create it through code or the UI ahead of time and reference it at deployment creation as shown above.\n\n    If using a `BitBucketCredentials` block to store your credentials, you can create it ahead of time and reference it at deployment creation.\n\n    1. Install `prefect-bitbucket` with `pip install -U prefect-bitbucket`\n    2. Register all block types defined in `prefect-bitbucket` with `prefect block register -m prefect_bitbucket`\n    3. Create a `BitBucketCredentials` block in code or the Prefect UI and reference at deployment creation as shown above.\n  </Tab>\n\n  <Tab title=\"GitLab\">\n    <CodeGroup>\n      ```python gl_public_repo.py theme={null}\n      from prefect import flow\n\n\n      if __name__ == \"__main__\":\n          gitlab_repo = \"https://gitlab.com/org/my-public-repo.git\"\n\n          flow.from_source(\n              source=gitlab_repo,\n              entrypoint=\"gl_public_repo.py:my_flow\"\n          ).deploy(\n              name=\"my-gitlab-deployment\",\n              work_pool_name=\"my_pool\",\n          )\n      ```\n\n      ```python gl_private_repo_credentials_block.py theme={null}\n\n      from prefect import flow\n      from prefect.runner.storage import GitRepository\n      from prefect_gitlab import GitLabCredentials\n\n\n      if __name__ == \"__main__\":\n\n          gitlab_repo = GitRepository(\n              url=\"https://gitlab.com/org/my-private-repo.git\",\n              credentials=GitLabCredentials.load(\"my-gitlab-credentials-block\")\n          )\n          \n          flow.from_source(\n              source=gitlab_repo,\n              entrypoint=\"gl_private_repo_credentials_block.py:my_flow\",\n          ).deploy(\n              name=\"private-gitlab-deploy\",\n              work_pool_name=\"my_pool\",\n          )\n      ```\n\n      ```python gl_private_repo_secret_block.py     theme={null}\n\n      from prefect import flow\n      from prefect.runner.storage import GitRepository\n      from prefect.blocks.system import Secret\n\n\n      if __name__ == \"__main__\":\n          gitlab_repo = GitRepository(\n              url=\"https://gitlab.com/org/my-private-repo.git\",\n              credentials={\n                  \"access_token\": Secret.load(\"my-secret-block-with-my-gl-credentials\")\n              },\n          )\n\n          flow.from_source(   \n              source=gitlab_repo,\n              entrypoint=\"gl_private_repo_secret_block.py:my_flow\",\n          ).deploy(\n              name=\"private-gitlab-deploy\",\n              work_pool_name=\"my_pool\",\n          )\n      ```\n\n      ```yaml prefect.yaml theme={null}\n      # relevant section of the file:\n      pull:\n          - prefect.deployments.steps.git_clone:\n              repository: https://gitlab.com/org/my-private-repo.git\n              # Uncomment the following line if using a credentials block\n              # credentials: \"{{ prefect.blocks.gitlab-credentials.my-gitlab-credentials-block }}\"\n              # Uncomment the following line if using a Secret block\n              # access_token: \"{{ prefect.blocks.secret.my-block-name }}\"\n      ```\n    </CodeGroup>\n\n    For accessing a private repository, we recommend using HTTPS with [Project Access Tokens](https://docs.gitlab.com/ee/user/profile/personal_access_tokens.html).\n\n    [Create a token](https://docs.gitlab.com/ee/user/profile/personal_access_tokens.html) with the **read\\_repository** scope.\n\n    If using a `Secret` block, you can create it through code or the UI ahead of time and reference it at deployment creation as shown above.\n\n    If using a `GitLabCredentials` block to store your credentials, you can create it ahead of time and reference it at deployment creation.\n\n    1. Install `prefect-gitlab` with `pip install -U prefect-gitlab`\n    2. Register all block types defined in `prefect-gitlab` with `prefect block register -m prefect_gitlab`\n    3. Create a `GitLabCredentials` block in code or the Prefect UI and reference it at deployment creation as shown above.\n  </Tab>\n</Tabs>\n\nNote that you can specify a `branch` if creating a `GitRepository` object.\nThe default is `\"main\"`.\n\n<Warning>\n  **Push your code**\n\n  When you make a change to your code, Prefect does not push your code to your `git`-based version control platform.\n  This is intentional to avoid confusion about the `git` history and push process.\n</Warning>\n\n### Prefect Cloud GitHub Integration\n\n<span class=\"badge cloud\" /> If you're using Prefect Cloud you can use the Prefect Cloud GitHub App\nto authenticate to GitHub at runtime and access private repositories without creating a block and storing long\nlived credentials.\n\n1. [Install the Prefect Cloud GitHub App](https://github.com/apps/prefect-cloud/installations/new?) and select the\n   repositories you want to be able to access.\n\n2. Add the following pull steps to your `prefect.yaml` file. Make sure to replace `owner/repository` with the name of your repository:\n\n```yaml  theme={null}\npull:\n    - prefect.deployments.steps.run_shell_script:\n        id: get-github-token\n        script: uv tool run prefect-cloud github token owner/repository\n    - prefect.deployments.steps.git_clone:\n        id: git-clone\n        repository: https://x-access-token:{{ get-github-token.stdout }}@github.com/owner/repository.git\n```\n\n## Docker-based storage\n\nAnother popular flow code storage option is to include it in a Docker image.\nAll work pool options except **Process** and **Prefect Managed** allow you to bake your code into a Docker image.\n\nTo create a deployment with Docker-based flow code storage use the Python `deploy` method or create a `prefect.yaml` file.\n\n<Note>\n  If you use the Python `deploy` method to store the flow code in a Docker image, you don't need to use the `from_source` method.\n</Note>\n\nThe `prefect.yaml` file below was generated by running `prefect deploy` from the CLI (a few lines of metadata were excluded from the top of the file output for brevity).\n\nNote that the `build` section is necessary if baking your flow code into a Docker image.\n\n<CodeGroup>\n  ```python docker_deploy.py theme={null}\n  from prefect import flow\n\n\n  @flow\n  def my_flow():\n      print(\"Hello from inside a Docker container!\")\n\n  if __name__ == \"__main__\":\n      my_flow.deploy(\n          name=\"my-docker-deploy\",\n          work_pool_name=\"my_pool\",\n          image=\"my-docker-image:latest\",\n          push=False\n      )\n  ```\n\n  ```yaml prefect.yaml theme={null}\n  # build section allows you to manage and build docker images\n  build:\n  - prefect_docker.deployments.steps.build_docker_image:\n      requires: prefect-docker>=0.6.1\n      id: build-image\n      dockerfile: auto\n      image_name: my-registry/my-image\n      tag: latest\n\n  # push section allows you to manage if and how this project is uploaded to remote locations\n  push: null\n\n  # pull section allows you to provide instructions for cloning this project in remote locations\n  pull:\n  - prefect.deployments.steps.set_working_directory:\n      directory: /opt/prefect/my_directory\n\n\n  # the deployments section allows you to provide configuration for deploying flows\n  deployments:\n  - name: my-docker-deployment\n    entrypoint: my_file.py:my_flow\n    work_pool:\n      name: my_pool\n      job_variables:\n        image: '{{ build-image.image }}'\n\n  ```\n</CodeGroup>\n\nBy default, `.deploy` will build a Docker image that includes your flow code and any `pip` packages specified in a `requirements.txt` file.\n\nIn the examples above, we elected not to push the resulting image to a remote registry.\n\nTo push the image to a remote registry, pass `push=True` in the Python `deploy` method or add a `push_docker_image` step to the `push` section of the `prefect.yaml` file.\n\n### Custom Docker image\n\nIf an `image` is not specified by one of the methods above, deployment flow runs associated with a Docker work pool will use the base Prefect image (e.g. `prefecthq/prefect:3-latest`) when executing.\nAlternatively, you can create a custom Docker image outside of Prefect by running `docker build` && `docker push` elsewhere (e.g. in your CI/CD pipeline) and then reference the resulting `image` in the `job_variables` section of your deployment definition, or set the `image` as a default directly on the work pool.\n\nFor more information, see [this discussion of custom Docker images](/v3/how-to-guides/deployment_infra/docker/#automatically-build-a-custom-docker-image-with-a-local-dockerfile).\n\n## Blob storage\n\nAnother option for flow code storage is any [fsspec](https://filesystem-spec.readthedocs.io/en/latest/)-supported storage location, such as AWS S3, Azure Blob Storage, or GCP GCS.\n\nIf the storage location is publicly available, or if you are authenticated in the environment where you are creating and running your deployment, you can reference the storage location directly.\nYou don't need to pass credentials explicitly.\n\nTo pass credentials explicitly to authenticate to your storage location, you can use either of the following block types:\n\n* Prefect integration library storage blocks, such as the `prefect-aws` library's `S3Bucket` block, which can use a `AWSCredentials` block when it is created.\n* `Secret` blocks\n\n<Note>\n  If you use a storage block such as the `S3Bucket` block, you need to have the `prefect-aws` library available in the environment where your flow code runs.\n\n  You can do any of the following to make the library available:\n\n  1. Install the library into the execution environment directly\n  2. Specify the library in the work pool's Base Job Template in the **Environment Variables** section like this:`{\"EXTRA_PIP_PACKAGES\":\"prefect-aws\"}`\n  3. Specify the library in the environment variables of the `deploy` method as shown in the examples below\n  4. Specify the library in a `requirements.txt` file and reference the file in the `pull` step of the `prefect.yaml` file like this:\n\n  ```yaml  theme={null}\n      - prefect.deployments.steps.pip_install_requirements:\n          directory: \"{{ pull_code.directory }}\" \n          requirements_file: requirements.txt\n  ```\n</Note>\n\nThe examples below show how to create a deployment with flow code in a cloud provider storage location.\nFor each example, we show how to access code that is publicly available.\nThe `prefect.yaml` example includes an additional line to reference a credentials block if authenticating to a private storage location through that option.\n\nWe also include Python code that shows how to use an existing storage block and an example of that creates, but doesn't save, a storage block that references an existing nested credentials block.\n\n<Tabs>\n  <Tab title=\"AWS S3 bucket\">\n    <CodeGroup>\n      ```python s3_no_block.py theme={null}\n      from prefect import flow\n\n\n      if __name__ == \"__main__\":\n          flow.from_source(\n              source=\"s3://my-bucket/my-folder\",\n              entrypoint=\"my_file.py:my_flow\",\n          ).deploy(\n              name=\"my-aws-s3-deployment\",\n              work_pool_name=\"my-work-pool\"\n          )\n      ```\n\n      ```python s3_block.py theme={null}\n\n      from prefect import flow\n      from prefect_aws.s3 import S3Bucket\n\n      if __name__ == \"__main__\":\n          s3_bucket_block = S3Bucket.load(\"my-code-storage-block\")\n\n          # or:\n          # s3_bucket_block = S3Bucket(\n          #     bucket=\"my-bucket\",\n          #     folder=\"my-folder\",\n          #     credentials=AWSCredentials.load(\"my-credentials-block\")\n          # )\n\n          flow.from_source(\n              source=s3_bucket_block, \n              entrypoint=\"my_file.py:my_flow\"\n          ).deploy(\n              name=\"my-aws-s3-deployment\", \n              work_pool_name=\"my-work-pool\"\n              job_variables={\"env\": {\"EXTRA_PIP_PACKAGES\": \"prefect-aws\"} }, \n          )\n      ```\n\n      ```yaml prefect.yaml theme={null}\n      build: null\n\n      push:\n      - prefect_aws.deployments.steps.push_to_s3:\n          id: push_code\n          requires: prefect-aws>=0.5\n          bucket: my-bucket\n          folder: my-folder\n          credentials: \"{{ prefect.blocks.aws-credentials.my-credentials-block }}\" # if explicit authentication is required\n\n      pull:\n      - prefect_aws.deployments.steps.pull_from_s3:\n          id: pull_code\n          requires: prefect-aws>=0.5\n          bucket: '{{ push_code.bucket }}'\n          folder: '{{ push_code.folder }}'\n          credentials: \"{{ prefect.blocks.aws-credentials.my-credentials-block }}\" # if explicit authentication is required \n\n      deployments:\n      - name: my-aws-deployment\n        version: null\n        tags: []\n        concurrency_limit: null\n        description: null\n        entrypoint: my_file.py:my_flow\n        parameters: {}\n        work_pool:\n          name: my-work-pool\n          work_queue_name: null\n          job_variables: {}\n        enforce_parameter_schema: true\n        schedules: []\n      ```\n    </CodeGroup>\n\n    To create an `AwsCredentials` block:\n\n    1. Install the [prefect-aws](/integrations/prefect-aws) library with `pip install -U prefect-aws`\n    2. Register the blocks in prefect-aws with `prefect block register -m prefect_aws`\n    3. Create a user with a role with read and write permissions to access the bucket. If using the UI, create an access key pair with *IAM -> Users -> Security credentials -> Access keys -> Create access key*. Choose *Use case -> Other* and then copy the *Access key* and *Secret access key* values.\n    4. Create an [`AWSCredentials` block](/integrations/prefect-aws/index#save-credentials-to-an-aws-credentials-block) in code or the Prefect UI. In addition to the block name, most users will fill in the *AWS Access Key ID* and *AWS Access Key Secret* fields.\n    5. Reference the block as shown above.\n  </Tab>\n\n  <Tab title=\"Azure Blob Storage container\">\n    <CodeGroup>\n      ```python azure_no_block.py theme={null}\n      from prefect import flow\n\n\n      if __name__ == \"__main__\":\n          flow.from_source(\n              source=\"az://mycontainer/myfolder\",\n              entrypoint=\"my_file.py:my_flow\",\n          ).deploy(\n              name=\"my-azure-deployment\",\n              work_pool_name=\"my-work-pool\",\n              job_variables={\"env\": {\"EXTRA_PIP_PACKAGES\": \"prefect-azure\"} }, \n          )\n      ```\n\n      ```python azure_block.py theme={null}\n      from prefect import flow\n      from prefect_azure import AzureBlobCredentials, AzureBlobStorage\n\n\n      if __name__ == \"__main__\":\n\n          azure_blob_storage_block = AzureBlobStorage.load(\"my-code-storage-block\")\n\n          # or \n          # azure_blob_storage_block = AzureBlobStorage(   \n          #     container=\"my-prefect-azure-container\",\n          #     folder=\"my-folder\",\n          #     credentials=AzureBlobCredentials.load(\"my-credentials-block\")\n          # )\n\n          flow.from_source(source=azure_blob_storage_block, entrypoint=\"my_file.py:my_flow\").deploy(\n              name=\"my-azure-deployment\", work_pool_name=\"my-work-pool\"\n          )\n      ```\n\n      ```yaml prefect.yaml theme={null}\n      build: null\n\n      push:\n      - prefect_azure.deployments.steps.push_to_azure_blob_storage:\n          id: push_code\n          requires: prefect-azure>=0.4\n          container: my-prefect-azure-container\n          folder: my-folder\n          credentials: \"{{ prefect.blocks.azure-blob-storage-credentials.my-credentials-block }}\" \n          # if explicit authentication is required\n\n      pull:\n      - prefect_azure.deployments.steps.pull_from_azure_blob_storage:\n          id: pull_code\n          requires: prefect-azure>=0.4\n          container: '{{ push_code.container }}'\n          folder: '{{ push_code.folder }}'\n          credentials: \"{{ prefect.blocks.azure-blob-storage-credentials.my-credentials-block }}\" # if explicit authentication is required\n\n      deployments:\n      - name: my-azure-deployment\n        version: null\n        tags: []\n        concurrency_limit: null\n        description: null\n        entrypoint: my_file.py:my_flow\n        parameters: {}\n        work_pool:\n          name: my-work-pool\n          work_queue_name: null\n          job_variables: {}\n        enforce_parameter_schema: true\n        schedules: []\n      ```\n    </CodeGroup>\n\n    To create an `AzureBlobCredentials` block:\n\n    1. Install the [prefect-azure](/integrations/prefect-azure/) library with `pip install -U prefect-azure`\n    2. Register the blocks in prefect-azure with `prefect block register -m prefect_azure`\n    3. Create an access key for a role with sufficient (read and write) permissions to access the blob.\n       You can create a connection string containing all required information in the UI under *Storage Account -> Access keys*.\n    4. Create an Azure Blob Storage Credentials block in code or the Prefect UI. Enter a name for the block and paste the\n       connection string into the *Connection String* field.\n    5. Reference the block as shown above.\n  </Tab>\n\n  <Tab title=\"GCP GCS bucket\">\n    <CodeGroup>\n      ```python gcs_no_block.py theme={null}\n      from prefect import flow\n\n\n      if __name__ == \"__main__\":\n          flow.from_source(\n              source=\"gs://my-bucket/my-folder\",  \n              entrypoint=\"my_file.py:my_flow\",\n          ).deploy(\n              name=\"my-gcs-deployment\",\n              work_pool_name=\"my-work-pool\"\n          )\n      ```\n\n      ```python gcs_block.py theme={null}\n      from prefect import flow\n      from prefect_gcp import GcpCredentials, GCSBucket\n\n\n      if __name__ == \"__main__\":\n\n          gcs_bucket_block = GCSBucket.load(\"my-code-storage-block\")\n\n          # or \n          # gcs_bucket_block = GCSBucket(\n          #     bucket=\"my-bucket\",\n          #     folder=\"my-folder\",\n          #     credentials=GcpCredentials.load(\"my-credentials-block\")\n          # )\n\n          flow.from_source(\n              source=gcs_bucket_block,\n              entrypoint=\"my_file.py:my_flow\",\n          ).deploy(\n              name=\"my-gcs-deployment\",\n              work_pool_name=\"my_pool\",\n              job_variables={\"env\": {\"EXTRA_PIP_PACKAGES\": \"prefect-gcp\"} }, \n          )\n      ```\n\n      ```yaml prefect.yaml theme={null}\n      build: null\n\n      push:\n      - prefect_gcp.deployment.steps.push_to_gcs:\n          id: push_code\n          requires: prefect-gcp>=0.6\n          bucket: my-bucket\n          folder: my-folder\n          credentials: \"{{ prefect.blocks.gcp-credentials.my-credentials-block }}\" # if explicit authentication is required \n\n      pull:\n      - prefect_gcp.deployment.steps.pull_from_gcs:\n          id: pull_code\n          requires: prefect-gcp>=0.6\n          bucket: '{{ push_code.bucket }}'\n          folder: '{{ pull_code.folder }}'\n          credentials: \"{{ prefect.blocks.gcp-credentials.my-credentials-block }}\" # if explicit authentication is required \n\n      deployments:\n      - name: my-gcs-deployment\n          version: null\n          tags: []\n          concurrency_limit: null\n          description: null\n          entrypoint: my_file.py:my_flow\n          parameters: {}\n          work_pool:\n            name: my-work-pool\n            work_queue_name: null\n            job_variables: {}\n          enforce_parameter_schema: true\n          schedules: []\n      ```\n    </CodeGroup>\n\n    To create a `GcpCredentials` block:\n\n    1. Install the [prefect-gcp](/integrations/prefect-gcp/) library with `pip install -U prefect-gcp`\n    2. Register the blocks in prefect-gcp with `prefect block register -m prefect_gcp`\n    3. Create a service account in GCP for a role with read and write permissions to access the bucket contents.\n       If using the GCP console, go to *IAM & Admin -> Service accounts -> Create service account*.\n       After choosing a role with the required permissions,\n       see your service account and click on the three dot menu in the *Actions* column.\n       Select *Manage Keys -> ADD KEY -> Create new key -> JSON*. Download the JSON file.\n    4. Create a GCP Credentials block in code or the Prefect UI. Enter a name for the block and paste the entire contents of the JSON key file into the *Service Account Info* field.\n    5. Reference the block as shown above.\n  </Tab>\n</Tabs>\n\nAnother authentication option is to give the worker access to the storage location at runtime through SSH keys.",
  "content_length": 32339
}