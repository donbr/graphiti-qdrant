{
  "title": "configurations",
  "source_url": "https://docs-3.prefect.io/v3/api-ref/python/prefect-server-database-configurations",
  "content": "# `prefect.server.database.configurations`\n\n## Classes\n\n### `ConnectionTracker` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/database/configurations.py#L48\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\nA test utility which tracks the connections given out by a connection pool, to\nmake it easy to see which connections are currently checked out and open.\n\n**Methods:**\n\n#### `clear` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/database/configurations.py#L102\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nclear(self) -> None\n```\n\n#### `on_close` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/database/configurations.py#L81\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\non_close(self, adapted_connection: AdaptedConnection, connection_record: ConnectionPoolEntry) -> None\n```\n\n#### `on_close_detached` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/database/configurations.py#L92\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\non_close_detached(self, adapted_connection: AdaptedConnection) -> None\n```\n\n#### `on_connect` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/database/configurations.py#L72\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\non_connect(self, adapted_connection: AdaptedConnection, connection_record: ConnectionPoolEntry) -> None\n```\n\n#### `track_pool` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/database/configurations.py#L67\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\ntrack_pool(self, pool: sa.pool.Pool) -> None\n```\n\n### `BaseDatabaseConfiguration` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/database/configurations.py#L113\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\nAbstract base class used to inject database connection configuration into Prefect.\n\nThis configuration is responsible for defining how Prefect REST API creates and manages\ndatabase connections and sessions.\n\n**Methods:**\n\n#### `begin_transaction` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/database/configurations.py#L193\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nbegin_transaction(self, session: AsyncSession, with_for_update: bool = False) -> AbstractAsyncContextManager[AsyncSessionTransaction]\n```\n\nEnter a transaction for a session\n\n#### `create_db` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/database/configurations.py#L177\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\ncreate_db(self, connection: AsyncConnection, base_metadata: sa.MetaData) -> None\n```\n\nCreate the database\n\n#### `drop_db` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/database/configurations.py#L183\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\ndrop_db(self, connection: AsyncConnection, base_metadata: sa.MetaData) -> None\n```\n\nDrop the database\n\n#### `engine` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/database/configurations.py#L167\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nengine(self) -> AsyncEngine\n```\n\nReturns a SqlAlchemy engine\n\n#### `is_inmemory` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/database/configurations.py#L189\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nis_inmemory(self) -> bool\n```\n\nReturns true if database is run in memory\n\n#### `session` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/database/configurations.py#L171\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nsession(self, engine: AsyncEngine) -> AsyncSession\n```\n\nRetrieves a SQLAlchemy session for an engine.\n\n#### `unique_key` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/database/configurations.py#L160\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nunique_key(self) -> tuple[Hashable, ...]\n```\n\nReturns a key used to determine whether to instantiate a new DB interface.\n\n### `AsyncPostgresConfiguration` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/database/configurations.py#L200\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n**Methods:**\n\n#### `begin_transaction` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/database/configurations.py#L341\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nbegin_transaction(self, session: AsyncSession, with_for_update: bool = False) -> AsyncGenerator[AsyncSessionTransaction, None]\n```\n\n#### `begin_transaction` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/database/configurations.py#L193\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nbegin_transaction(self, session: AsyncSession, with_for_update: bool = False) -> AbstractAsyncContextManager[AsyncSessionTransaction]\n```\n\nEnter a transaction for a session\n\n#### `create_db` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/database/configurations.py#L349\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\ncreate_db(self, connection: AsyncConnection, base_metadata: sa.MetaData) -> None\n```\n\nCreate the database\n\n#### `create_db` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/database/configurations.py#L177\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\ncreate_db(self, connection: AsyncConnection, base_metadata: sa.MetaData) -> None\n```\n\nCreate the database\n\n#### `drop_db` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/database/configurations.py#L356\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\ndrop_db(self, connection: AsyncConnection, base_metadata: sa.MetaData) -> None\n```\n\nDrop the database\n\n#### `drop_db` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/database/configurations.py#L183\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\ndrop_db(self, connection: AsyncConnection, base_metadata: sa.MetaData) -> None\n```\n\nDrop the database\n\n#### `engine` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/database/configurations.py#L201\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nengine(self) -> AsyncEngine\n```\n\nRetrieves an async SQLAlchemy engine.\n\n**Args:**\n\n* `connection_url`: The database connection string.\n  Defaults to self.connection\\_url\n* `echo`: Whether to echo SQL sent\n  to the database. Defaults to self.echo\n* `timeout`: The database statement timeout, in seconds.\n  Defaults to self.timeout\n\n**Returns:**\n\n* a SQLAlchemy engine\n\n#### `engine` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/database/configurations.py#L167\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nengine(self) -> AsyncEngine\n```\n\nReturns a SqlAlchemy engine\n\n#### `is_inmemory` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/database/configurations.py#L363\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nis_inmemory(self) -> bool\n```\n\nReturns true if database is run in memory\n\n#### `is_inmemory` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/database/configurations.py#L189\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nis_inmemory(self) -> bool\n```\n\nReturns true if database is run in memory\n\n#### `schedule_engine_disposal` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/database/configurations.py#L307\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nschedule_engine_disposal(self, cache_key: _EngineCacheKey) -> None\n```\n\nDispose of an engine once the event loop is closing.\n\nSee caveats at `add_event_loop_shutdown_callback`.\n\nWe attempted to lazily clean up old engines when new engines are created, but\nif the loop the engine is attached to is already closed then the connections\ncannot be cleaned up properly and warnings are displayed.\n\nEngine disposal should only be important when running the application\nephemerally. Notably, this is an issue in our tests where many short-lived event\nloops and engines are created which can consume all of the available database\nconnection slots. Users operating at a scale where connection limits are\nencountered should be encouraged to use a standalone server.\n\n#### `session` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/database/configurations.py#L331\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nsession(self, engine: AsyncEngine) -> AsyncSession\n```\n\nRetrieves a SQLAlchemy session for an engine.\n\n**Args:**\n\n* `engine`: a sqlalchemy engine\n\n#### `session` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/database/configurations.py#L171\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nsession(self, engine: AsyncEngine) -> AsyncSession\n```\n\nRetrieves a SQLAlchemy session for an engine.\n\n#### `unique_key` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/database/configurations.py#L160\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nunique_key(self) -> tuple[Hashable, ...]\n```\n\nReturns a key used to determine whether to instantiate a new DB interface.\n\n### `AioSqliteConfiguration` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/database/configurations.py#L369\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n**Methods:**\n\n#### `begin_sqlite_conn` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/database/configurations.py#L509\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nbegin_sqlite_conn(self, conn: aiosqlite.AsyncAdapt_aiosqlite_connection) -> None\n```\n\n#### `begin_sqlite_stmt` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/database/configurations.py#L518\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nbegin_sqlite_stmt(self, conn: sa.Connection) -> None\n```\n\n#### `begin_transaction` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/database/configurations.py#L531\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nbegin_transaction(self, session: AsyncSession, with_for_update: bool = False) -> AsyncGenerator[AsyncSessionTransaction, None]\n```\n\n#### `begin_transaction` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/database/configurations.py#L193\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nbegin_transaction(self, session: AsyncSession, with_for_update: bool = False) -> AbstractAsyncContextManager[AsyncSessionTransaction]\n```\n\nEnter a transaction for a session\n\n#### `create_db` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/database/configurations.py#L551\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\ncreate_db(self, connection: AsyncConnection, base_metadata: sa.MetaData) -> None\n```\n\nCreate the database\n\n#### `create_db` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/database/configurations.py#L177\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\ncreate_db(self, connection: AsyncConnection, base_metadata: sa.MetaData) -> None\n```\n\nCreate the database\n\n#### `drop_db` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/database/configurations.py#L558\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\ndrop_db(self, connection: AsyncConnection, base_metadata: sa.MetaData) -> None\n```\n\nDrop the database\n\n#### `drop_db` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/database/configurations.py#L183\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\ndrop_db(self, connection: AsyncConnection, base_metadata: sa.MetaData) -> None\n```\n\nDrop the database\n\n#### `engine` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/database/configurations.py#L372\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nengine(self) -> AsyncEngine\n```\n\nRetrieves an async SQLAlchemy engine.\n\n**Args:**\n\n* `connection_url`: The database connection string.\n  Defaults to self.connection\\_url\n* `echo`: Whether to echo SQL sent\n  to the database. Defaults to self.echo\n* `timeout`: The database statement timeout, in seconds.\n  Defaults to self.timeout\n\n**Returns:**\n\n* a SQLAlchemy engine\n\n#### `engine` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/database/configurations.py#L167\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nengine(self) -> AsyncEngine\n```\n\nReturns a SqlAlchemy engine\n\n#### `is_inmemory` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/database/configurations.py#L565\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nis_inmemory(self) -> bool\n```\n\nReturns true if database is run in memory\n\n#### `is_inmemory` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/database/configurations.py#L189\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nis_inmemory(self) -> bool\n```\n\nReturns true if database is run in memory\n\n#### `schedule_engine_disposal` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/database/configurations.py#L434\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nschedule_engine_disposal(self, cache_key: _EngineCacheKey) -> None\n```\n\nDispose of an engine once the event loop is closing.\n\nSee caveats at `add_event_loop_shutdown_callback`.\n\nWe attempted to lazily clean up old engines when new engines are created, but\nif the loop the engine is attached to is already closed then the connections\ncannot be cleaned up properly and warnings are displayed.\n\nEngine disposal should only be important when running the application\nephemerally. Notably, this is an issue in our tests where many short-lived event\nloops and engines are created which can consume all of the available database\nconnection slots. Users operating at a scale where connection limits are\nencountered should be encouraged to use a standalone server.\n\n#### `session` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/database/configurations.py#L542\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nsession(self, engine: AsyncEngine) -> AsyncSession\n```\n\nRetrieves a SQLAlchemy session for an engine.\n\n**Args:**\n\n* `engine`: a sqlalchemy engine\n\n#### `session` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/database/configurations.py#L171\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nsession(self, engine: AsyncEngine) -> AsyncSession\n```\n\nRetrieves a SQLAlchemy session for an engine.\n\n#### `setup_sqlite` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/database/configurations.py#L458\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nsetup_sqlite(self, conn: DBAPIConnection, record: ConnectionPoolEntry) -> None\n```\n\nIssue PRAGMA statements to SQLITE on connect. PRAGMAs only last for the\nduration of the connection. See [https://www.sqlite.org/pragma.html](https://www.sqlite.org/pragma.html) for more info.\n\n#### `unique_key` <sup><a href=\"https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/database/configurations.py#L160\" target=\"_blank\"><Icon icon=\"github\" style=\"width: 14px; height: 14px;\" /></a></sup>\n\n```python  theme={null}\nunique_key(self) -> tuple[Hashable, ...]\n```\n\nReturns a key used to determine whether to instantiate a new DB interface.",
  "content_length": 18123
}